<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mr. Jawad Simulation Cells Are Everywhere</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',system-ui,-apple-system,sans-serif;background:#0a0e1a;color:#e0e0e0;overflow:hidden;height:100vh;width:100vw;}
.app{display:flex;height:100vh;width:100vw;}

/* LEFT SIDEBAR */
.left-sidebar{width:280px;min-width:280px;background:linear-gradient(180deg,#0f1628 0%,#141e35 100%);border-right:1px solid #1e2d4a;display:flex;flex-direction:column;overflow-y:auto;padding:12px;}
.left-sidebar::-webkit-scrollbar{width:4px;}
.left-sidebar::-webkit-scrollbar-thumb{background:#2a3a5c;border-radius:2px;}
.pick-header{text-align:center;font-size:14px;font-weight:700;color:#64b5f6;margin-bottom:8px;text-transform:uppercase;letter-spacing:1px;}
.pick-sub{text-align:center;font-size:11px;color:#78909c;margin-bottom:10px;}
.scenario-card{display:flex;align-items:center;gap:10px;padding:10px 12px;margin-bottom:6px;border-radius:10px;cursor:pointer;transition:all 0.3s;border:2px solid transparent;background:rgba(255,255,255,0.03);}
.scenario-card:hover{background:rgba(100,181,246,0.1);border-color:rgba(100,181,246,0.3);}
.scenario-card.selected{background:rgba(100,181,246,0.15);border-color:#64b5f6;box-shadow:0 0 12px rgba(100,181,246,0.2);}
.scenario-card.completed{opacity:0.7;}
.scenario-card.completed::after{content:'‚úì';position:absolute;right:8px;top:50%;transform:translateY(-50%);color:#4caf50;font-weight:700;font-size:16px;}
.scenario-card{position:relative;}
.sc-emoji{font-size:28px;flex-shrink:0;}
.sc-name{font-size:13px;font-weight:600;color:#cfd8dc;line-height:1.3;}
.divider{height:1px;background:linear-gradient(90deg,transparent,#2a3a5c,transparent);margin:12px 0;}
.sidebar-section-title{font-size:11px;font-weight:700;color:#78909c;text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px;}
.reading-tabs{display:flex;gap:4px;margin-bottom:12px;}
.reading-tab{flex:1;padding:8px 4px;text-align:center;font-size:12px;font-weight:700;border-radius:8px;cursor:pointer;transition:all 0.3s;border:2px solid #2a3a5c;background:rgba(255,255,255,0.02);color:#78909c;}
.reading-tab:hover{border-color:#64b5f6;color:#64b5f6;}
.reading-tab.active{background:linear-gradient(135deg,#1565c0,#1976d2);border-color:#42a5f5;color:#fff;box-shadow:0 2px 8px rgba(21,101,192,0.4);}
.keyword-list{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:12px;}
.keyword-pill{padding:4px 10px;border-radius:12px;font-size:11px;font-weight:600;background:rgba(255,255,255,0.05);color:#78909c;border:1px solid #2a3a5c;transition:all 0.3s;}
.keyword-pill.highlighted{background:rgba(255,193,7,0.15);color:#ffd54f;border-color:rgba(255,193,7,0.3);}
.btn-reset{width:100%;padding:10px;border:none;border-radius:8px;font-size:13px;font-weight:700;cursor:pointer;margin-bottom:6px;transition:all 0.3s;}
.btn-reset.red{background:linear-gradient(135deg,#c62828,#d32f2f);color:#fff;}
.btn-reset.red:hover{background:linear-gradient(135deg,#b71c1c,#c62828);}
.btn-reset.blue{background:linear-gradient(135deg,#1565c0,#1976d2);color:#fff;}
.btn-reset.blue:hover{background:linear-gradient(135deg,#0d47a1,#1565c0);}
.mix-rule{background:rgba(255,152,0,0.1);border:1px solid rgba(255,152,0,0.3);border-radius:8px;padding:8px;margin-bottom:10px;font-size:10px;color:#ffb74d;line-height:1.4;}

/* CENTER PANEL */
.center-panel{flex:1;display:flex;flex-direction:column;background:linear-gradient(180deg,#0d1320 0%,#111827 100%);min-width:0;}
.step-tabs{display:flex;padding:8px 16px;gap:4px;background:rgba(0,0,0,0.3);border-bottom:1px solid #1e2d4a;}
.step-tab{flex:1;padding:10px 8px;text-align:center;font-size:12px;font-weight:700;border-radius:8px;color:#546e7a;background:rgba(255,255,255,0.02);transition:all 0.5s;text-transform:uppercase;letter-spacing:1px;}
.step-tab.active{color:#fff;background:linear-gradient(135deg,#1565c0,#7c4dff);box-shadow:0 0 20px rgba(124,77,255,0.3);animation:tabGlow 2s ease-in-out infinite;}
.step-tab.done{color:#4caf50;background:rgba(76,175,80,0.1);}
@keyframes tabGlow{0%,100%{box-shadow:0 0 20px rgba(124,77,255,0.3);}50%{box-shadow:0 0 30px rgba(124,77,255,0.5);}}
.center-content{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;overflow-y:auto;}
.center-content::-webkit-scrollbar{width:4px;}
.center-content::-webkit-scrollbar-thumb{background:#2a3a5c;border-radius:2px;}

/* Welcome screen */
.welcome-screen{text-align:center;max-width:600px;}
.welcome-title{font-size:28px;font-weight:800;background:linear-gradient(135deg,#64b5f6,#ce93d8);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:16px;}
.welcome-sub{font-size:16px;color:#90a4ae;line-height:1.6;margin-bottom:20px;}
.welcome-mission{background:rgba(124,77,255,0.1);border:1px solid rgba(124,77,255,0.3);border-radius:12px;padding:16px;font-size:14px;color:#ce93d8;line-height:1.5;}

/* PREDICT */
.predict-card{background:linear-gradient(135deg,rgba(255,152,0,0.08),rgba(255,193,7,0.05));border:2px solid rgba(255,152,0,0.3);border-radius:16px;padding:28px;max-width:600px;width:100%;text-align:center;}
.predict-emoji{font-size:64px;margin-bottom:12px;}
.predict-title{font-size:22px;font-weight:800;color:#ffb74d;margin-bottom:8px;}
.predict-premise{font-size:15px;color:#b0bec5;line-height:1.6;margin-bottom:20px;}
.predict-question{font-size:17px;font-weight:700;color:#fff;margin-bottom:16px;}
.predict-options{display:flex;flex-direction:column;gap:8px;margin-bottom:16px;}
.predict-btn{padding:14px 20px;border-radius:10px;border:2px solid #2a3a5c;background:rgba(255,255,255,0.03);color:#cfd8dc;font-size:14px;font-weight:600;cursor:pointer;transition:all 0.3s;text-align:left;}
.predict-btn:hover{border-color:#ffb74d;background:rgba(255,152,0,0.1);color:#fff;}
.predict-btn.selected{border-color:#ff9800;background:rgba(255,152,0,0.15);color:#ffb74d;}

/* READ */
.read-card{background:linear-gradient(135deg,rgba(21,101,192,0.08),rgba(30,136,229,0.05));border:2px solid rgba(21,101,192,0.3);border-radius:16px;padding:24px;max-width:650px;width:100%;}
.read-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;}
.read-title{font-size:20px;font-weight:800;color:#64b5f6;}
.btn-read-aloud{display:flex;align-items:center;gap:6px;padding:8px 16px;border-radius:20px;border:2px solid #42a5f5;background:rgba(66,165,245,0.1);color:#64b5f6;font-size:13px;font-weight:700;cursor:pointer;transition:all 0.3s;}
.btn-read-aloud:hover{background:rgba(66,165,245,0.2);}
.btn-read-aloud.speaking{background:rgba(66,165,245,0.3);animation:pulse 1s infinite;}
@keyframes pulse{0%,100%{opacity:1;}50%{opacity:0.6;}}
.read-passage{font-size:17px;line-height:1.8;color:#cfd8dc;margin-bottom:16px;}
.read-passage .keyword{color:#ffd54f;font-weight:700;}
.read-passage .highlight-sentence{background:rgba(66,165,245,0.2);border-radius:4px;padding:2px 4px;}

/* WATCH */
.watch-area{width:100%;max-width:700px;position:relative;}
.watch-title{text-align:center;font-size:18px;font-weight:700;color:#ce93d8;margin-bottom:12px;}
.watch-arena{width:100%;height:380px;border-radius:16px;background:linear-gradient(180deg,#0a1628,#0d1f3c);border:2px solid rgba(124,77,255,0.3);position:relative;overflow:hidden;}
.gauge-container{position:absolute;left:20px;top:20px;bottom:20px;width:60px;display:flex;flex-direction:column;border-radius:10px;overflow:hidden;border:2px solid #37474f;}
.gauge-zone{flex:1;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:700;color:rgba(255,255,255,0.8);text-transform:uppercase;letter-spacing:0.5px;}
.gz-critical-high{background:linear-gradient(180deg,#b71c1c,#c62828);}
.gz-high{background:linear-gradient(180deg,#e65100,#f57c00);}
.gz-ok{background:linear-gradient(180deg,#2e7d32,#388e3c);}
.gz-low{background:linear-gradient(180deg,#d32f2f,#e53935);}
.gz-critical-low{background:linear-gradient(180deg,#b71c1c,#c62828);}
.gauge-needle{position:absolute;left:16px;width:68px;height:4px;background:#fff;border-radius:2px;transition:top 1.5s ease-in-out;box-shadow:0 0 10px rgba(255,255,255,0.8);z-index:5;}
.animation-stage{position:absolute;left:100px;right:20px;top:20px;bottom:20px;display:flex;align-items:center;justify-content:center;flex-direction:column;}
.anim-cell{width:120px;height:120px;border-radius:50%;position:relative;transition:all 1s;display:flex;align-items:center;justify-content:center;}
.anim-cell.healthy{background:radial-gradient(circle,#4caf50 0%,#2e7d32 70%,#1b5e20 100%);box-shadow:0 0 30px rgba(76,175,80,0.5);}
.anim-cell.stressed{background:radial-gradient(circle,#f44336 0%,#c62828 70%,#b71c1c 100%);box-shadow:0 0 30px rgba(244,67,54,0.5);}
.anim-cell.overactive{background:radial-gradient(circle,#ff9800 0%,#e65100 70%,#bf360c 100%);box-shadow:0 0 30px rgba(255,152,0,0.5);}
.anim-cell .nucleus{width:40px;height:40px;border-radius:50%;background:radial-gradient(circle,#64b5f6,#1565c0);transition:all 1s;}
.anim-cell .membrane{position:absolute;inset:-6px;border-radius:50%;border:3px dashed rgba(255,255,255,0.4);transition:all 1s;}
.anim-label{margin-top:12px;font-size:14px;font-weight:700;color:#b0bec5;text-align:center;transition:all 0.5s;}
.anim-detail{font-size:12px;color:#78909c;text-align:center;margin-top:4px;}
.split-cells{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;max-width:400px;}
.mini-cell{width:36px;height:36px;border-radius:50%;transition:all 0.5s;opacity:0;transform:scale(0);}
.mini-cell.show{opacity:1;transform:scale(1);}
.mini-cell.red{background:radial-gradient(circle,#f44336,#b71c1c);box-shadow:0 0 8px rgba(244,67,54,0.4);}
.mini-cell.green{background:radial-gradient(circle,#4caf50,#1b5e20);box-shadow:0 0 8px rgba(76,175,80,0.4);}
.mini-cell.orange{background:radial-gradient(circle,#ff9800,#e65100);box-shadow:0 0 8px rgba(255,152,0,0.4);}
.nerve-line{position:absolute;height:4px;background:linear-gradient(90deg,#64b5f6,#42a5f5);border-radius:2px;transition:all 1s;}
.nerve-spark{position:absolute;width:12px;height:12px;border-radius:50%;background:#fff;box-shadow:0 0 15px #64b5f6;transition:all 0.1s;}
.vessel-bg{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;}
.blood-vessel{width:80%;height:60px;background:linear-gradient(180deg,rgba(183,28,28,0.3),rgba(198,40,40,0.2));border-radius:30px;border:2px solid rgba(244,67,54,0.3);position:relative;overflow:hidden;}
.blood-cell{position:absolute;width:20px;height:20px;border-radius:50%;background:radial-gradient(circle,#ef5350,#c62828);transition:all 0.5s;}
.blood-cell.sickle{border-radius:50% 10% 50% 10%;background:radial-gradient(circle,#ff7043,#bf360c);}
.wall-layer{position:absolute;inset:-10px;border-radius:8px;border:4px solid transparent;transition:all 1s;}
.wall-layer.building{border-color:#4caf50;background:rgba(76,175,80,0.05);}

/* RECORD */
.record-card{text-align:center;max-width:500px;}
.record-emoji{font-size:64px;margin-bottom:12px;animation:bounce 0.6s ease-out;}
@keyframes bounce{0%{transform:scale(0);}60%{transform:scale(1.2);}100%{transform:scale(1);}}
.record-title{font-size:24px;font-weight:800;color:#4caf50;margin-bottom:8px;}
.record-sub{font-size:14px;color:#90a4ae;}

/* Action button */
.action-bar{padding:12px 20px;display:flex;justify-content:center;gap:12px;border-top:1px solid #1e2d4a;background:rgba(0,0,0,0.2);}
.btn-action{padding:14px 32px;border-radius:12px;border:none;font-size:15px;font-weight:700;cursor:pointer;transition:all 0.3s;text-transform:uppercase;letter-spacing:1px;}
.btn-action.primary{background:linear-gradient(135deg,#7c4dff,#651fff);color:#fff;box-shadow:0 4px 15px rgba(124,77,255,0.4);}
.btn-action.primary:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(124,77,255,0.6);}
.btn-action:disabled{opacity:0.4;cursor:not-allowed;transform:none!important;}

/* RIGHT SIDEBAR */
.right-sidebar{width:280px;min-width:280px;background:linear-gradient(180deg,#0f1628 0%,#141e35 100%);border-left:1px solid #1e2d4a;display:flex;flex-direction:column;padding:12px;overflow-y:auto;}
.right-sidebar::-webkit-scrollbar{width:4px;}
.right-sidebar::-webkit-scrollbar-thumb{background:#2a3a5c;border-radius:2px;}
.hud-title{font-size:12px;font-weight:700;color:#78909c;text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px;}
.hud-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:12px;}
.hud-stat{background:rgba(255,255,255,0.03);border:1px solid #1e2d4a;border-radius:10px;padding:10px 8px;text-align:center;}
.hud-stat-value{font-size:22px;font-weight:800;margin-bottom:2px;}
.hud-stat-label{font-size:10px;color:#78909c;text-transform:uppercase;letter-spacing:0.5px;}
.hud-stat.score .hud-stat-value{color:#ffd54f;}
.hud-stat.streak .hud-stat-value{color:#ff7043;}
.hud-stat.completed .hud-stat-value{color:#4caf50;}
.hud-stat.accuracy .hud-stat-value{color:#64b5f6;}
.progress-section{margin-bottom:12px;}
.progress-bar-bg{height:12px;background:#1e2d4a;border-radius:6px;overflow:hidden;margin-bottom:4px;}
.progress-bar-fill{height:100%;background:linear-gradient(90deg,#4caf50,#66bb6a);border-radius:6px;transition:width 0.5s;width:0%;}
.progress-msg{font-size:12px;color:#78909c;text-align:center;}
.data-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
.btn-copy{padding:6px 12px;border-radius:8px;border:1px solid #42a5f5;background:rgba(66,165,245,0.1);color:#64b5f6;font-size:11px;font-weight:700;cursor:pointer;transition:all 0.3s;}
.btn-copy:hover{background:rgba(66,165,245,0.2);}
.btn-copy.copied{background:rgba(76,175,80,0.2);border-color:#4caf50;color:#4caf50;}
.data-table-container{flex:1;overflow-y:auto;}
.data-table{width:100%;border-collapse:collapse;font-size:10px;}
.data-table th{background:#1565c0;color:#fff;padding:6px 4px;text-align:left;font-size:9px;text-transform:uppercase;letter-spacing:0.5px;position:sticky;top:0;z-index:2;}
.data-table td{padding:5px 4px;border-bottom:1px solid #1e2d4a;color:#b0bec5;vertical-align:top;line-height:1.3;}
.data-table tr:nth-child(even){background:rgba(255,255,255,0.02);}
.data-table tr.empty td{color:#37474f;font-style:italic;}

/* Completion overlay */
.completion-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:100;opacity:0;pointer-events:none;transition:opacity 0.5s;}
.completion-overlay.show{opacity:1;pointer-events:auto;}
.completion-card{background:linear-gradient(135deg,#1a237e,#4a148c);border-radius:20px;padding:40px;text-align:center;max-width:500px;box-shadow:0 20px 60px rgba(0,0,0,0.5);}
.completion-badge{font-size:80px;margin-bottom:16px;}
.completion-title{font-size:28px;font-weight:800;color:#ffd54f;margin-bottom:8px;}
.completion-sub{font-size:16px;color:#b0bec5;margin-bottom:24px;}
.btn-continue{padding:14px 32px;border-radius:12px;border:none;background:linear-gradient(135deg,#4caf50,#2e7d32);color:#fff;font-size:16px;font-weight:700;cursor:pointer;}

/* Particles */
.particle{position:absolute;border-radius:50%;pointer-events:none;animation:floatUp 3s ease-out forwards;}
@keyframes floatUp{0%{opacity:1;transform:translateY(0) scale(1);}100%{opacity:0;transform:translateY(-100px) scale(0.3);}}

/* Responsive */
@media(max-width:900px){
.left-sidebar,.right-sidebar{width:220px;min-width:220px;padding:8px;}
}
</style>
</head>
<body>

<div class="app">
<!-- LEFT SIDEBAR -->
<div class="left-sidebar">
<div class="pick-header">Pick Any 5 You Like</div>
<div class="pick-sub">Complete 5 stories (all 8 = extra credit)</div>
<div class="mix-rule">üìå Your 5 must include at least 1 DOWN story (cells damaged) and 1 UP story (cells out of control).</div>
<div id="scenarioList"></div>
<div class="divider"></div>
<div class="sidebar-section-title">Reading Level</div>
<div class="reading-tabs">
<div class="reading-tab active" data-level="low" onclick="setReadingLevel('low')">Low</div>
<div class="reading-tab" data-level="med" onclick="setReadingLevel('med')">Med</div>
<div class="reading-tab" data-level="high" onclick="setReadingLevel('high')">High</div>
</div>
<div class="divider"></div>
<div class="sidebar-section-title">Key Words</div>
<div class="keyword-list" id="keywordList"></div>
<div class="divider"></div>
<button class="btn-reset red" onclick="resetSim()">Reset</button>
<button class="btn-reset blue" onclick="newRun()">New Run</button>
</div>

<!-- CENTER PANEL -->
<div class="center-panel">
<div class="step-tabs">
<div class="step-tab" id="tab-predict">1. Predict</div>
<div class="step-tab" id="tab-read">2. Read</div>
<div class="step-tab" id="tab-watch">3. Watch</div>
<div class="step-tab" id="tab-record">4. Record</div>
</div>
<div class="center-content" id="centerContent">
<div class="welcome-screen" id="welcomeScreen">
<div class="welcome-title">üî¨ Cells Are Everywhere</div>
<div class="welcome-sub">Real people ‚Äî from a woman whose cells never died to a football player who lost feeling in his arm ‚Äî all have one thing in common: their stories start inside a single cell.</div>
<div class="welcome-mission">üéØ Mission: Investigate 8 real cell stories ‚Äî unlock each person's secret by reading what happened inside their cells.</div>
</div>
</div>
<div class="action-bar">
<button class="btn-action primary" id="actionBtn" onclick="handleAction()" disabled>Select a Scenario</button>
</div>
</div>

<!-- RIGHT SIDEBAR -->
<div class="right-sidebar">
<div class="hud-title">Progress</div>
<div class="hud-grid">
<div class="hud-stat score"><div class="hud-stat-value" id="hudScore">0</div><div class="hud-stat-label">Score</div></div>
<div class="hud-stat streak"><div class="hud-stat-value" id="hudStreak">0</div><div class="hud-stat-label">Streak</div></div>
<div class="hud-stat completed"><div class="hud-stat-value" id="hudCompleted">0/5</div><div class="hud-stat-label">Completed</div></div>
<div class="hud-stat accuracy"><div class="hud-stat-value" id="hudAccuracy">0%</div><div class="hud-stat-label">Accuracy</div></div>
</div>
<div class="progress-section">
<div class="progress-bar-bg"><div class="progress-bar-fill" id="progressFill"></div></div>
<div class="progress-msg" id="progressMsg">Pick 5 more you like!</div>
</div>
<div class="divider"></div>
<div class="data-header">
<div class="hud-title" style="margin:0">Data Table</div>
<button class="btn-copy" id="copyBtn" onclick="copyTable()">üìã Copy Table</button>
</div>
<div class="data-table-container">
<table class="data-table">
<thead><tr><th>Scenario</th><th>What Happened?</th><th>Response</th><th>Connection</th></tr></thead>
<tbody id="dataBody"></tbody>
</table>
</div>
</div>
</div>

<!-- COMPLETION OVERLAY -->
<div class="completion-overlay" id="completionOverlay">
<div class="completion-card">
<div class="completion-badge" id="completionBadge">üèÜ</div>
<div class="completion-title" id="completionTitle">Required Complete!</div>
<div class="completion-sub" id="completionSub">You finished 5 stories. Continue for Extra Credit?</div>
<button class="btn-continue" onclick="closeCompletion()">Keep Going!</button>
</div>
</div>

<script>
// ========== DATA ==========
const scenarios = [
{id:1,name:"The Immortal Woman",emoji:"üß¨",type:"up",premise:"Henrietta Lacks went to the hospital in 1951 with cancer ‚Äî doctors took some of her cells, and those cells never stopped dividing.",
predictQ:"What do you think happened to Henrietta's cells after doctors took them?",
predictOpts:["They died quickly like normal cells","They kept dividing and never stopped","They turned into a different type of cell"],
correctPredict:1,
gaugeDir:"up",
readings:{
low:{text:'Henrietta Lacks is 31 years old and dying of cancer in 1951. Doctors take some of her <span class="keyword">cells</span> without asking. Something shocking happens ‚Äî her <span class="keyword">cells</span> never stop dividing. Today, over 70 years later, her <span class="keyword">cells</span> are still alive in labs around the world.',keywords:['cell','cell division','nucleus']},
med:{text:'Henrietta Lacks is 31 years old and dying of cancer in a Baltimore hospital in 1951. A doctor takes a sample of her <span class="keyword">cells</span> ‚Äî she never finds out. In the lab, something unbelievable happens: her <span class="keyword">cells</span> refuse to die. Normal <span class="keyword">cells</span> stop dividing after a while, but Henrietta\'s keep going. Scientists name them HeLa <span class="keyword">cells</span>. They are still alive today and have been used in over 100,000 studies, including research that led to the polio vaccine.',keywords:['cell','cell division','nucleus']},
high:{text:'Henrietta Lacks is 31 years old and dying of cervical cancer at Johns Hopkins Hospital in 1951. A doctor named George Gey takes a sample of her <span class="keyword">cells</span> without telling her. In the lab, Gey watches something no scientist has ever seen ‚Äî her <span class="keyword">cells</span> divide and never stop. Normal human <span class="keyword">cells</span> divide about 40 to 60 times, then quit. Henrietta\'s ignore that limit. The <span class="keyword">nucleus</span> in each <span class="keyword">cell</span> keeps copying itself perfectly, over and over. Scientists call them HeLa <span class="keyword">cells</span>, and they become the most important <span class="keyword">cells</span> in medical history. They helped create the polio vaccine and have been used in over 100,000 research studies ‚Äî and <span class="keyword">cell division</span> is still happening in labs today.',keywords:['cell','cell division','nucleus']}
},
watchAnim:'immortal',
dataRow:{happened:"Doctors took Henrietta's cells in 1951",response:"Her cells never stopped dividing ‚Äî still alive today",connection:"The nucleus kept copying so cell division never stopped"}
},
{id:2,name:"The Deep-Sea Diver",emoji:"ü§ø",type:"down",premise:"A scuba diver surfaced too fast and nitrogen bubbles ripped through his cell membrane ‚Äî the barrier holding his cells together failed under pressure.",
predictQ:"What do you think happens to cells when a diver surfaces too fast?",
predictOpts:["The cells get stronger from the pressure","Bubbles tear through the cell membrane","The cells divide faster to repair damage"],
correctPredict:1,
gaugeDir:"down",
readings:{
low:{text:'A scuba diver in the Caribbean surfaces too fast after a deep dive. Tiny nitrogen bubbles form in his blood and rip through the <span class="keyword">cell membrane</span> on each <span class="keyword">cell</span>. The <span class="keyword">cell membrane</span> is the barrier that holds everything inside a <span class="keyword">cell</span> together ‚Äî when it tears, the cell dies. Doctors rush him to a pressure chamber to save his remaining <span class="keyword">cells</span>.',keywords:['cell','cell membrane']},
med:{text:'A scuba diver exploring a reef in the Caribbean makes a dangerous mistake ‚Äî he surfaces too fast. At depth, nitrogen gas dissolves into his blood under pressure. When he rises quickly, that gas forms bubbles, like opening a shaken soda can. The bubbles rip through the <span class="keyword">cell membrane</span> on every <span class="keyword">cell</span> they hit ‚Äî the thin barrier that holds every <span class="keyword">cell</span> together. Without an intact <span class="keyword">cell membrane</span>, the <span class="keyword">cell</span> cannot protect its <span class="keyword">organelles</span> or its <span class="keyword">nucleus</span>. Doctors call this "the bends," and without emergency treatment in a pressure chamber, the damaged <span class="keyword">cells</span> cannot recover.',keywords:['cell','cell membrane','organelle','nucleus']},
high:{text:'A scuba diver exploring a deep reef in the Caribbean makes a critical error ‚Äî he surfaces too fast. At 100 feet below the surface, nitrogen gas from the air he breathes dissolves into his blood under high pressure. When he rises quickly, the pressure drops and that nitrogen forms bubbles ‚Äî like opening a shaken soda can. Those bubbles slam into his <span class="keyword">cells</span> and rip through the <span class="keyword">cell membrane</span> on each one. The <span class="keyword">cell membrane</span> is the barrier that holds everything inside a <span class="keyword">cell</span> in place ‚Äî the <span class="keyword">organelles</span>, the <span class="keyword">nucleus</span>, all of it. When the membrane tears, the cell\'s insides leak out and the cell dies. Doctors rush him into a pressure chamber to force the nitrogen back into solution and give his surviving <span class="keyword">cells</span> time to repair. Without the <span class="keyword">cell membrane</span>, no <span class="keyword">cell</span> in the body can survive.',keywords:['cell','cell membrane','organelle','nucleus']}
},
watchAnim:'diver',
dataRow:{happened:"Nitrogen bubbles ripped through cell membranes",response:"Cells died ‚Äî rushed to pressure chamber",connection:"The cell membrane tore so cells couldn't hold together"}
},
{id:3,name:"The Burn Survivor",emoji:"üî•",type:"down",premise:"A firefighter suffered severe burns on his arms ‚Äî millions of skin cells were destroyed, and his body had to replace them as fast as possible to survive.",
predictQ:"What do you think the body does when millions of skin cells are destroyed by fire?",
predictOpts:["It gives up and the wound stays open","Surviving cells divide fast to close the wound","New cells come from a different part of the body"],
correctPredict:1,
gaugeDir:"down-recover",
readings:{
low:{text:'A firefighter in Texas suffers severe burns on both arms during a warehouse fire. The heat destroys millions of his skin <span class="keyword">cells</span> in seconds. His body responds by speeding up <span class="keyword">cell division</span> ‚Äî surviving <span class="keyword">cells</span> near the wound start copying themselves fast. The <span class="keyword">nucleus</span> in each surviving <span class="keyword">cell</span> carries the instructions to build replacements.',keywords:['cell','cell division','nucleus']},
med:{text:'A firefighter in Houston rushes into a burning warehouse and suffers severe burns on both arms. The extreme heat destroys millions of his skin <span class="keyword">cells</span> instantly ‚Äî the <span class="keyword">cell membrane</span> on each one breaks apart and the <span class="keyword">cells</span> die. His body kicks into emergency mode. Surviving <span class="keyword">cells</span> near the wound start dividing as fast as they can to close the gap. The <span class="keyword">nucleus</span> in each <span class="keyword">cell</span> copies its instructions and pushes out new cells at an incredible rate. His body can make about 3.8 million new <span class="keyword">cells</span> per second, and every one of those replacement cells needs a working <span class="keyword">nucleus</span> to know what to become.',keywords:['cell','cell membrane','cell division','nucleus']},
high:{text:'A firefighter in Houston rushes into a burning warehouse to rescue a trapped worker and suffers severe burns on both arms. The extreme heat destroys millions of his skin <span class="keyword">cells</span> in seconds ‚Äî the <span class="keyword">cell membrane</span> on each one melts, <span class="keyword">organelles</span> break apart, and the <span class="keyword">cells</span> die. His body has only one option: replace them. Surviving skin <span class="keyword">cells</span> near the wound immediately start dividing faster than normal. The <span class="keyword">nucleus</span> in each <span class="keyword">cell</span> copies every instruction it carries and pushes out daughter cells to fill the gap. The human body replaces about 3.8 million <span class="keyword">cells</span> per second under normal conditions ‚Äî after a burn, that number spikes even higher near the wound. New skin cells are built quickly, not perfectly, which is why burns often leave scars. The replacement <span class="keyword">cells</span> have a different structure than the originals, but they get the job done ‚Äî sealing the wound and protecting what is underneath.',keywords:['cell','cell membrane','organelle','cell division','nucleus']}
},
watchAnim:'burn',
dataRow:{happened:"Millions of skin cells destroyed by fire",response:"Body sped up cell division to close the wound",connection:"The nucleus carried instructions so cells could divide and rebuild skin"}
},
{id:4,name:"The Boy Who Lost Energy",emoji:"üîã",type:"down",premise:"Joe Wise loved sports until age 8, when the organelles inside his cells that make energy stopped working.",
predictQ:"What do you think happens to a person when the energy-makers inside their cells break?",
predictOpts:["They feel weak and tired all the time","Their cells divide faster to compensate","Nothing ‚Äî cells find another energy source"],
correctPredict:0,
gaugeDir:"down",
readings:{
low:{text:'Joe Wise loves baseball and football ‚Äî until age 8, when he starts feeling weak all the time. Doctors run test after test but cannot figure out what is wrong. Finally, they discover the <span class="keyword">organelles</span> inside his <span class="keyword">cells</span> that make <span class="keyword">energy</span> are broken. His <span class="keyword">cells</span> look normal from the outside, but the power source inside is failing.',keywords:['cell','organelle','energy']},
med:{text:'Joe Wise is an 8-year-old who loves baseball and football more than anything. One day, his legs feel heavy. Then his arms. Then everything. Doctors think he has arthritis or muscular dystrophy, but nothing fits. Years later, they finally find the answer ‚Äî the <span class="keyword">organelles</span> inside his <span class="keyword">cells</span> that produce <span class="keyword">energy</span> are broken. His <span class="keyword">cells</span> look completely normal from the outside ‚Äî the <span class="keyword">cell membrane</span> is intact ‚Äî but the tiny power sources inside cannot do their job.',keywords:['cell','organelle','energy','cell membrane']},
high:{text:'Joe Wise is an 8-year-old who lives for baseball and football. Then something changes. His legs feel heavy after short runs. His arms tire from things that used to be easy. Doctors test for arthritis, muscular dystrophy, and a dozen other conditions ‚Äî nothing fits. It takes years to find the real answer: the <span class="keyword">organelles</span> inside Joe\'s <span class="keyword">cells</span> that turn food into <span class="keyword">energy</span> are broken. From the outside, his <span class="keyword">cells</span> look perfectly normal ‚Äî the <span class="keyword">cell membrane</span> is intact, the <span class="keyword">nucleus</span> is there. But the power sources inside are failing, and without <span class="keyword">energy</span>, his muscles cannot work the way they should.',keywords:['cell','organelle','energy','cell membrane','nucleus']}
},
watchAnim:'energy',
dataRow:{happened:"Organelles that make energy broke down",response:"Joe became weak ‚Äî couldn't play sports",connection:"Organelles inside cells stopped making energy so muscles failed"}
},
{id:5,name:"The Rutgers Lab Discovery",emoji:"üî¨",type:"down",premise:"In 2025, Rutgers University scientists filmed plant cells building their cell walls in real time ‚Äî and discovered what happens when walls fail to form.",
predictQ:"What do you think happens to a plant cell that can't build its cell wall?",
predictOpts:["It grows even bigger without the wall","It collapses ‚Äî no structure to hold its shape","It builds a thicker cell membrane instead"],
correctPredict:1,
gaugeDir:"up-from-low",
readings:{
low:{text:'In 2025, scientists at Rutgers University do something no one has done before ‚Äî they film plant <span class="keyword">cells</span> building their <span class="keyword">cell walls</span> in real time. Without a <span class="keyword">cell wall</span>, a plant <span class="keyword">cell</span> collapses like a balloon with no air. The <span class="keyword">cell wall</span> is a rigid layer outside the <span class="keyword">cell membrane</span> that gives every plant its shape. That same wall material ‚Äî called cellulose ‚Äî ends up in your cotton T-shirts, your paper, and even your ice cream.',keywords:['cell','cell wall','cell membrane']},
med:{text:'In 2025, scientists at Rutgers University film something no one has ever seen ‚Äî a plant <span class="keyword">cell</span> building its <span class="keyword">cell wall</span> in real time. They watch cellulose fibers assemble themselves around the outside of the <span class="keyword">cell membrane</span>, forming a rigid shell. Without that <span class="keyword">cell wall</span>, the plant <span class="keyword">cell</span> collapses. With it, the cell holds its shape and the plant stands tall. The <span class="keyword">cell wall</span> is the reason a tree trunk is solid and a flower stem stays upright. That same material ‚Äî cellulose ‚Äî is harvested from cotton plants and turned into T-shirts, paper, diapers, and even the thickener in yogurt.',keywords:['cell','cell wall','cell membrane']},
high:{text:'In 2025, a team of scientists at Rutgers University in New Jersey does something that has never been done in the history of biology ‚Äî they film a living plant <span class="keyword">cell</span> building its <span class="keyword">cell wall</span> in real time. Using advanced cameras, they watch cellulose fibers assemble themselves around the outside of the <span class="keyword">cell membrane</span>, creating a rigid shell. Without that <span class="keyword">cell wall</span>, the plant <span class="keyword">cell</span> has no structure ‚Äî it collapses like a deflated balloon. With the wall in place, the <span class="keyword">cell</span> holds a strong rectangular shape. Every plant on Earth depends on <span class="keyword">cell walls</span> for support ‚Äî from blades of grass to redwood trees. The cellulose that makes up the <span class="keyword">cell wall</span> is the most common natural material on Earth. Humans harvest it from cotton plants to make clothing, from trees to make paper, and even use it as a thickener in yogurt and ice cream.',keywords:['cell','cell wall','cell membrane']}
},
watchAnim:'cellwall',
dataRow:{happened:"Scientists filmed plant cells building cell walls",response:"Without cell wall the cell collapsed ‚Äî with it the cell held shape",connection:"The cell wall gives plant cells structure ‚Äî without it they collapse"}
},
{id:6,name:"The Football Stinger",emoji:"üèà",type:"down",premise:"A high school football player took a hard hit and lost all feeling in his arm ‚Äî one of the longest cells in his body was damaged.",
predictQ:"What do you think happens when one of the longest cells in your body gets damaged?",
predictOpts:["The body quickly replaces it with a new cell","The electrical signal stops and the body part shuts down","The cell gets shorter but keeps working"],
correctPredict:1,
gaugeDir:"down",
readings:{
low:{text:'A high school football player takes a hard tackle and feels a burning shock down his arm. His arm goes completely numb ‚Äî he cannot move his fingers. The hit stretched one of the longest <span class="keyword">cells</span> in his body ‚Äî a single nerve <span class="keyword">cell</span> that runs from his neck to his hand. When that <span class="keyword">cell</span> is damaged, the electrical signal it carries stops, and the arm shuts down.',keywords:['cell']},
med:{text:'A high school football player takes a hard tackle and instantly feels a burning shock rip down his arm. Then nothing ‚Äî his arm goes completely numb and his fingers will not move. The hit stretched one of the longest <span class="keyword">cells</span> in his body: a single nerve <span class="keyword">cell</span> running from his spinal cord to his hand. That one <span class="keyword">cell</span> can be over 3 feet long. It carries electrical signals at up to 270 miles per hour, controlled by instructions from the <span class="keyword">nucleus</span> at the top. When the hit damages the <span class="keyword">cell</span>, the signal stops traveling, and the arm shuts down until the <span class="keyword">cell</span> can repair itself.',keywords:['cell','nucleus']},
high:{text:'A high school football player takes a helmet-to-shoulder tackle and feels a burning shock rip from his neck down to his fingertips. Then his whole arm goes dead ‚Äî numb, heavy, unable to move. Trainers call it a "stinger." The hit stretched one of the longest <span class="keyword">cells</span> in his body: a single nerve <span class="keyword">cell</span> that runs from his spinal cord to his hand ‚Äî over 3 feet of one continuous <span class="keyword">cell</span>. Under normal conditions, that nerve <span class="keyword">cell</span> fires electrical signals at up to 270 miles per hour. The <span class="keyword">nucleus</span> sits at the top, controlling everything, while the <span class="keyword">cell membrane</span> wraps the entire length like insulation on a wire. When the tackle damages the <span class="keyword">cell</span>, that signal path breaks. No signal means no movement ‚Äî and the arm shuts down completely until the <span class="keyword">cell</span> can repair the damage.',keywords:['cell','nucleus','cell membrane']}
},
watchAnim:'nerve',
dataRow:{happened:"Hard tackle stretched a 3-foot nerve cell",response:"Arm went numb ‚Äî couldn't move fingers",connection:"The cell carried electrical signals ‚Äî when damaged, the signal stopped"}
},
{id:7,name:"Dr. Hayflick's Discovery",emoji:"üö®",type:"up",premise:"In 1961, scientist Leonard Hayflick discovered that normal cells stop dividing after 40‚Äì60 times ‚Äî and that cancer cells ignore this limit completely.",
predictQ:"What do you think happens when cells ignore the limit on how many times they can divide?",
predictOpts:["The cells become healthier and live longer","The cells pile up into tumors that damage the body","The cells shrink to compensate for the extra divisions"],
correctPredict:1,
gaugeDir:"up",
readings:{
low:{text:'In 1961, scientist Leonard Hayflick discovers something nobody expected ‚Äî normal <span class="keyword">cells</span> can only divide about 40 to 60 times, then they stop forever. The <span class="keyword">nucleus</span> sends a signal that says "quit." But cancer <span class="keyword">cells</span> ignore the signal. They keep dividing without limit, piling up into tumors that crowd out healthy <span class="keyword">cells</span>.',keywords:['cell','nucleus','cell division']},
med:{text:'In 1961, biologist Leonard Hayflick makes a discovery that changes medicine forever. He finds that normal human <span class="keyword">cells</span> can only divide about 40 to 60 times before the <span class="keyword">nucleus</span> shuts <span class="keyword">cell division</span> down for good. Scientists call this the Hayflick Limit. But cancer <span class="keyword">cells</span> break the rule. Something goes wrong in the <span class="keyword">nucleus</span>, and the stop signal never fires. The <span class="keyword">cells</span> keep dividing without limit ‚Äî piling up into tumors that crowd out and kill the healthy <span class="keyword">cells</span> around them.',keywords:['cell','nucleus','cell division']},
high:{text:'In 1961, a biologist named Leonard Hayflick notices something strange in his lab. The human <span class="keyword">cells</span> he is growing stop dividing after about 40 to 60 rounds ‚Äî every time, without fail. He discovers that the <span class="keyword">nucleus</span> has a built-in counter that shuts <span class="keyword">cell division</span> down when the limit is reached. Scientists name it the Hayflick Limit, and it changes everything we know about aging and disease. But cancer <span class="keyword">cells</span> break this rule completely. A mutation in the <span class="keyword">nucleus</span> disables the stop signal, and the <span class="keyword">cell</span> keeps dividing without any limit. These out-of-control <span class="keyword">cells</span> pile up into tumors that invade healthy tissue. About 90 percent of solid tumors contain <span class="keyword">cells</span> with the wrong number of chromosomes ‚Äî proof that <span class="keyword">cell division</span> went seriously wrong.',keywords:['cell','nucleus','cell division']}
},
watchAnim:'hayflick',
dataRow:{happened:"Hayflick found cells stop dividing at 40‚Äì60 times",response:"Cancer cells ignore the limit and pile into tumors",connection:"The nucleus controls cell division ‚Äî when it breaks, cells divide without stopping"}
},
{id:8,name:"The Sickle Cell Fighter",emoji:"ü©∏",type:"down",premise:"A teenager with sickle cell disease lives with red blood cells whose cell membrane warps into a stiff sickle shape, blocking blood flow and causing intense pain.",
predictQ:"What do you think happens when red blood cells change from round to sickle-shaped?",
predictOpts:["They flow faster because they're more streamlined","They get stuck and block blood flow, causing pain","They bounce off blood vessel walls harmlessly"],
correctPredict:1,
gaugeDir:"down",
readings:{
low:{text:'A 15-year-old named Marcus has sickle cell disease. His red blood <span class="keyword">cells</span> are supposed to be round and smooth, but the <span class="keyword">cell membrane</span> on each one warps into a stiff crescent shape. The sickle-shaped <span class="keyword">cells</span> get stuck in his blood vessels and block blood flow. When blood cannot get through, Marcus feels extreme pain and his organs do not get the oxygen they need.',keywords:['cell','cell membrane']},
med:{text:'Marcus is 15 years old and lives with sickle cell disease ‚Äî a condition that changes the shape of his red blood <span class="keyword">cells</span>. Normal red blood <span class="keyword">cells</span> are round and flexible, sliding easily through blood vessels. Marcus\'s <span class="keyword">cells</span> are different. The <span class="keyword">cell membrane</span> on each of his red blood cells warps into a stiff crescent shape called a sickle. These rigid <span class="keyword">cells</span> jam together inside narrow blood vessels and block blood flow completely. When blood flow stops, Marcus\'s muscles and organs do not get oxygen ‚Äî causing intense pain that can last for hours or days.',keywords:['cell','cell membrane']},
high:{text:'Marcus is 15 years old and has sickle cell disease ‚Äî a genetic condition that affects the shape of his red blood <span class="keyword">cells</span>. Normal red blood <span class="keyword">cells</span> are round and flexible, with a smooth <span class="keyword">cell membrane</span> that lets them squeeze through the tiniest blood vessels. Marcus\'s <span class="keyword">cells</span> are built differently. A change in his DNA causes the <span class="keyword">cell membrane</span> on each red blood cell to warp into a stiff crescent shape ‚Äî like a sickle blade. These rigid <span class="keyword">cells</span> cannot bend. They pile up inside narrow blood vessels and create blockages that stop blood flow completely. When blood stops flowing, oxygen cannot reach Marcus\'s muscles and organs. The result is a pain crisis ‚Äî intense, stabbing pain that can last for hours or days and sometimes sends Marcus to the hospital.',keywords:['cell','cell membrane']}
},
watchAnim:'sickle',
dataRow:{happened:"Cell membrane warped red blood cells into sickle shape",response:"Cells blocked blood flow causing extreme pain",connection:"The cell membrane changed shape so cells got stuck in blood vessels"}
}
];

const allKeywords = ['cell','organelle','cell membrane','nucleus','cell wall','cell division','energy'];

// ========== STATE ==========
let state = {
readingLevel: 'low',
currentScenario: null,
currentStep: 'none', // none, predict, read, watch, record
completedScenarios: [],
predictions: {},
score: 0,
streak: 0,
totalPredictions: 0,
correctPredictions: 0,
dataRows: [],
speechActive: false,
selectedPrediction: null
};

let speechResumeInterval = null;

// ========== INIT ==========
function init() {
renderScenarioCards();
renderKeywords([]);
renderDataTable();
updateHUD();
}

function renderScenarioCards() {
const container = document.getElementById('scenarioList');
container.innerHTML = scenarios.map(s => {
const completed = state.completedScenarios.includes(s.id);
const selected = state.currentScenario && state.currentScenario.id === s.id;
return `<div class="scenario-card ${completed?'completed':''} ${selected?'selected':''}" onclick="selectScenario(${s.id})" data-id="${s.id}">
<span class="sc-emoji">${s.emoji}</span>
<span class="sc-name">${s.name}</span>
</div>`;
}).join('');
}

function renderKeywords(highlighted) {
const container = document.getElementById('keywordList');
container.innerHTML = allKeywords.map(kw => {
const isHL = highlighted.some(h => kw.toLowerCase().includes(h.toLowerCase()) || h.toLowerCase().includes(kw.toLowerCase()));
return `<span class="keyword-pill ${isHL?'highlighted':''}">${kw}</span>`;
}).join('');
}

function renderDataTable() {
const body = document.getElementById('dataBody');
let rows = '';
for (let i = 0; i < 8; i++) {
if (state.dataRows[i]) {
const d = state.dataRows[i];
rows += `<tr><td>${d.scenario}</td><td>${d.happened}</td><td>${d.response}</td><td>${d.connection}</td></tr>`;
} else {
rows += `<tr class="empty"><td>${i+1}.</td><td>‚Äî</td><td>‚Äî</td><td>‚Äî</td></tr>`;
}
}
body.innerHTML = rows;
}

function updateHUD() {
const completed = state.completedScenarios.length;
document.getElementById('hudScore').textContent = state.score;
document.getElementById('hudStreak').textContent = state.streak;
document.getElementById('hudCompleted').textContent = `${completed}/5`;
document.getElementById('hudAccuracy').textContent = state.totalPredictions > 0 ? Math.round((state.correctPredictions/state.totalPredictions)*100)+'%' : '0%';
const pct = Math.min(100, (completed / 5) * 100);
document.getElementById('progressFill').style.width = pct + '%';
const remaining = Math.max(0, 5 - completed);
if (completed >= 8) {
document.getElementById('progressMsg').textContent = 'üåü Extra Credit Complete!';
document.getElementById('progressFill').style.background = 'linear-gradient(90deg,#ffd54f,#ff9800)';
} else if (completed >= 5) {
document.getElementById('progressMsg').textContent = `‚úÖ Required done! ${8-completed} more for extra credit!`;
document.getElementById('progressFill').style.background = 'linear-gradient(90deg,#4caf50,#ffd54f)';
} else {
document.getElementById('progressMsg').textContent = `Pick ${remaining} more you like!`;
}
}

// ========== READING LEVEL ==========
function setReadingLevel(level) {
state.readingLevel = level;
document.querySelectorAll('.reading-tab').forEach(t => t.classList.remove('active'));
document.querySelector(`.reading-tab[data-level="${level}"]`).classList.add('active');
}

// ========== SCENARIO SELECTION ==========
function selectScenario(id) {
if (state.completedScenarios.includes(id)) return;
if (state.currentStep !== 'none' && state.currentStep !== 'record') return;
const sc = scenarios.find(s => s.id === id);
if (!sc) return;
state.currentScenario = sc;
state.currentStep = 'predict';
state.selectedPrediction = null;
renderScenarioCards();
const reading = sc.readings[state.readingLevel];
renderKeywords(reading.keywords);
showPredict();
updateTabs();
}

// ========== STEP MANAGEMENT ==========
function updateTabs() {
const steps = ['predict','read','watch','record'];
steps.forEach(s => {
const tab = document.getElementById('tab-'+s);
tab.classList.remove('active','done');
});
if (state.currentStep !== 'none') {
const idx = steps.indexOf(state.currentStep);
for (let i = 0; i < idx; i++) {
document.getElementById('tab-'+steps[i]).classList.add('done');
}
document.getElementById('tab-'+state.currentStep).classList.add('active');
}
}

// ========== PREDICT ==========
function showPredict() {
const sc = state.currentScenario;
const content = document.getElementById('centerContent');
content.innerHTML = `
<div class="predict-card">
<div class="predict-emoji">${sc.emoji}</div>
<div class="predict-title">${sc.name}</div>
<div class="predict-premise">${sc.premise}</div>
<div class="predict-question">${sc.predictQ}</div>
<div class="predict-options">
${sc.predictOpts.map((opt, i) => `<div class="predict-btn" data-idx="${i}" onclick="selectPrediction(${i})">${opt}</div>`).join('')}
</div>
</div>`;
const btn = document.getElementById('actionBtn');
btn.textContent = 'Lock Prediction';
btn.disabled = true;
btn.onclick = () => handleAction();
}

function selectPrediction(idx) {
state.selectedPrediction = idx;
document.querySelectorAll('.predict-btn').forEach(b => b.classList.remove('selected'));
document.querySelector(`.predict-btn[data-idx="${idx}"]`).classList.add('selected');
document.getElementById('actionBtn').disabled = false;
}

// ========== READ ==========
function showRead() {
const sc = state.currentScenario;
const reading = sc.readings[state.readingLevel];
const content = document.getElementById('centerContent');
content.innerHTML = `
<div class="read-card">
<div class="read-header">
<div class="read-title">${sc.emoji} ${sc.name}</div>
<button class="btn-read-aloud" id="readAloudBtn" onclick="toggleReadAloud()">üîä Read Aloud</button>
</div>
<div class="read-passage" id="readPassage">${reading.text}</div>
</div>`;
renderKeywords(reading.keywords);
const btn = document.getElementById('actionBtn');
btn.textContent = 'Watch What Happened';
btn.disabled = false;
}

// ========== READ ALOUD ==========
function toggleReadAloud() {
try {
if (state.speechActive) {
stopReadAloud();
return;
}
if (!window.speechSynthesis) {
document.getElementById('readAloudBtn').textContent = 'üìù Text Only';
return;
}
const passage = document.getElementById('readPassage');
const text = passage.innerText;
const utterance = new SpeechSynthesisUtterance(text);
utterance.rate = 0.9;
utterance.onend = () => { stopReadAloud(); };
utterance.onerror = () => { stopReadAloud(); };
window.speechSynthesis.cancel();
window.speechSynthesis.speak(utterance);
state.speechActive = true;
document.getElementById('readAloudBtn').classList.add('speaking');
document.getElementById('readAloudBtn').textContent = '‚èπ Stop';
// Chrome 15-second bug workaround
speechResumeInterval = setInterval(() => {
try { if (window.speechSynthesis && state.speechActive) window.speechSynthesis.resume(); } catch(e) {}
}, 10000);
} catch(e) {
document.getElementById('readAloudBtn').textContent = 'üìù Text Only';
}
}

function stopReadAloud() {
try {
if (window.speechSynthesis) window.speechSynthesis.cancel();
} catch(e) {}
state.speechActive = false;
if (speechResumeInterval) { clearInterval(speechResumeInterval); speechResumeInterval = null; }
const btn = document.getElementById('readAloudBtn');
if (btn) { btn.classList.remove('speaking'); btn.textContent = 'üîä Read Aloud'; }
}

// ========== WATCH ==========
function showWatch() {
stopReadAloud();
const sc = state.currentScenario;
const content = document.getElementById('centerContent');
content.innerHTML = `
<div class="watch-area">
<div class="watch-title">Watching: ${sc.name}</div>
<div class="watch-arena" id="watchArena"></div>
<div class="anim-label" id="animLabel">Preparing animation...</div>
<div class="anim-detail" id="animDetail"></div>
</div>`;
const btn = document.getElementById('actionBtn');
btn.textContent = 'Please watch...';
btn.disabled = true;
setTimeout(() => { runAnimation(sc); }, 500);
}

function runAnimation(sc) {
try {
const arena = document.getElementById('watchArena');
switch(sc.watchAnim) {
case 'immortal': animImmortal(arena, sc); break;
case 'diver': animDiver(arena, sc); break;
case 'burn': animBurn(arena, sc); break;
case 'energy': animEnergy(arena, sc); break;
case 'cellwall': animCellWall(arena, sc); break;
case 'nerve': animNerve(arena, sc); break;
case 'hayflick': animHayflick(arena, sc); break;
case 'sickle': animSickle(arena, sc); break;
default: finishWatch();
}
} catch(e) {
console.error('Animation error:', e);
finishWatch();
}
}

function finishWatch() {
const btn = document.getElementById('actionBtn');
btn.textContent = 'Record Data';
btn.disabled = false;
}

// ========== ANIMATIONS ==========

function buildGauge(arena, startZone) {
const zones = ['CRITICAL','HIGH','OK','LOW','CRITICAL'];
const classes = ['gz-critical-high','gz-high','gz-ok','gz-low','gz-critical-low'];
const zonePositions = {critical_high:10, high:30, ok:50, low:70, critical_low:90};
let gaugeHTML = '<div class="gauge-container">';
zones.forEach((z, i) => gaugeHTML += `<div class="gauge-zone ${classes[i]}">${z}</div>`);
gaugeHTML += '</div>';
gaugeHTML += `<div class="gauge-needle" id="gaugeNeedle" style="top:${zonePositions[startZone]}%"></div>`;
arena.innerHTML = gaugeHTML + `<div class="animation-stage" id="animStage"></div>`;
return {
setPosition: (zone) => {
const needle = document.getElementById('gaugeNeedle');
if (needle) needle.style.top = zonePositions[zone] + '%';
}
};
}

function setLabel(text, detail) {
const l = document.getElementById('animLabel');
const d = document.getElementById('animDetail');
if (l) l.textContent = text;
if (d) d.textContent = detail || '';
}

function animImmortal(arena) {
const gauge = buildGauge(arena, 'ok');
const stage = document.getElementById('animStage');
stage.innerHTML = `<div class="anim-cell healthy" id="mainCell"><div class="membrane"></div><div class="nucleus"></div></div><div class="split-cells" id="splitCells"></div>`;
setLabel('Henrietta\'s cell in the lab...', 'Nucleus glowing ‚Äî cell looks normal');

setTimeout(() => {
gauge.setPosition('high');
setLabel('Cell starts dividing...', 'Nucleus copies instructions ‚Äî cell division begins');
const mc = document.getElementById('mainCell');
mc.classList.remove('healthy'); mc.classList.add('overactive');
mc.style.transform = 'scale(0.8)';
const splits = document.getElementById('splitCells');
let count = 0;
const addCell = () => {
if (count >= 12) return;
const c = document.createElement('div');
c.className = 'mini-cell orange';
splits.appendChild(c);
setTimeout(() => c.classList.add('show'), 50);
count++;
};
const intv = setInterval(addCell, 300);
setTimeout(() => {
clearInterval(intv);
gauge.setPosition('critical_high');
setLabel('Cells NEVER stop dividing!', 'Over 70 years later ‚Äî still alive in labs worldwide');
const mc2 = document.getElementById('mainCell');
if(mc2) mc2.style.animation = 'pulse 0.5s infinite';
setTimeout(finishWatch, 2000);
}, 4000);
}, 1500);
}

function animDiver(arena) {
const gauge = buildGauge(arena, 'ok');
const stage = document.getElementById('animStage');
stage.innerHTML = `<div style="position:relative;width:200px;height:200px;">
<div class="anim-cell healthy" id="mainCell" style="width:140px;height:140px;position:absolute;left:30px;top:30px;"><div class="membrane" id="cellMembrane"></div><div class="nucleus"></div>
<div style="position:absolute;top:15px;left:15px;font-size:10px;color:rgba(255,255,255,0.6)">organelles</div>
<div style="position:absolute;width:8px;height:8px;border-radius:50%;background:#ce93d8;top:20px;left:60px;"></div>
<div style="position:absolute;width:6px;height:6px;border-radius:50%;background:#81d4fa;top:50px;left:30px;"></div>
</div>
</div>`;
setLabel('Healthy cell underwater...', 'Cell membrane intact ‚Äî organelles safe inside');

setTimeout(() => {
setLabel('Diver surfaces too fast!', 'Nitrogen bubbles forming...');
// Add bubbles
const cell = document.getElementById('mainCell');
for(let i=0;i<6;i++){
const b = document.createElement('div');
b.style.cssText = `position:absolute;width:${8+Math.random()*10}px;height:${8+Math.random()*10}px;border-radius:50%;background:rgba(255,255,255,0.6);left:${Math.random()*100}px;top:${Math.random()*100}px;animation:pulse 0.5s infinite;`;
cell.appendChild(b);
}
setTimeout(() => {
gauge.setPosition('low');
cell.classList.remove('healthy'); cell.classList.add('stressed');
const membrane = document.getElementById('cellMembrane');
if(membrane) { membrane.style.borderStyle = 'dotted'; membrane.style.borderColor = 'rgba(244,67,54,0.8)'; membrane.style.animation = 'pulse 0.3s infinite'; }
setLabel('Cell membrane TEARS!', 'Bubbles rip through ‚Äî cell contents leak out');
setTimeout(() => {
cell.style.opacity = '0.3';
cell.style.transform = 'scale(0.7)';
setLabel('Cell dies without its membrane', 'Doctors rush to pressure chamber');
setTimeout(finishWatch, 2000);
}, 2000);
}, 2000);
}, 1500);
}

function animBurn(arena) {
const gauge = buildGauge(arena, 'ok');
const stage = document.getElementById('animStage');
stage.innerHTML = `<div style="display:flex;gap:4px;flex-wrap:wrap;justify-content:center;max-width:300px;" id="skinGrid"></div>`;
const grid = document.getElementById('skinGrid');
for(let i=0;i<24;i++){
const c = document.createElement('div');
c.className = 'mini-cell green show';
c.id = 'skin'+i;
grid.appendChild(c);
}
setLabel('Healthy skin cells', 'Millions of cells protecting the body');

setTimeout(() => {
gauge.setPosition('low');
setLabel('FIRE! Skin cells destroyed!', 'Heat melts cell membranes ‚Äî cells die');
for(let i=6;i<18;i++){
const c = document.getElementById('skin'+i);
if(c){c.style.background='radial-gradient(circle,#ff5722,#bf360c)';c.style.opacity='0.3';}
}
setTimeout(() => {
setLabel('Surviving cells start dividing...', 'Nucleus copies instructions ‚Äî new cells fill the gap');
gauge.setPosition('low');
let idx = 6;
const rebuild = setInterval(() => {
if(idx >= 18){ clearInterval(rebuild); return; }
const c = document.getElementById('skin'+idx);
if(c){c.style.background='radial-gradient(circle,#66bb6a,#2e7d32)';c.style.opacity='0.8';c.style.transform='scale(1.1)';}
idx++;
}, 300);
setTimeout(() => {
gauge.setPosition('ok');
setLabel('Wound closing ‚Äî new cells growing', 'Scar tissue forms ‚Äî cells did their job');
setTimeout(finishWatch, 2000);
}, 4500);
}, 2000);
}, 1500);
}

function animEnergy(arena) {
const gauge = buildGauge(arena, 'ok');
const stage = document.getElementById('animStage');
stage.innerHTML = `<div style="position:relative;">
<div class="anim-cell healthy" id="mainCell" style="width:140px;height:140px;"><div class="membrane"></div><div class="nucleus"></div>
<div id="organelles" style="position:absolute;top:15px;right:15px;display:flex;gap:3px;flex-wrap:wrap;width:50px;">
<div style="width:10px;height:14px;border-radius:3px;background:#ff9800;" class="org"></div>
<div style="width:10px;height:14px;border-radius:3px;background:#ff9800;" class="org"></div>
<div style="width:10px;height:14px;border-radius:3px;background:#ff9800;" class="org"></div>
</div>
</div>
<div style="margin-top:10px;width:140px;height:16px;border-radius:8px;background:#1e2d4a;border:1px solid #37474f;overflow:hidden;">
<div id="energyBar" style="width:100%;height:100%;background:linear-gradient(90deg,#4caf50,#66bb6a);transition:width 1.5s;border-radius:8px;"></div>
</div>
<div style="text-align:center;font-size:11px;color:#78909c;margin-top:4px;">ENERGY</div>
</div>`;
setLabel('Joe\'s cell looks normal...', 'Membrane intact, nucleus present');

setTimeout(() => {
setLabel('Organelles start failing...', 'The power sources inside flicker and fade');
document.querySelectorAll('.org').forEach(o => { o.style.background = '#78909c'; o.style.animation = 'pulse 0.5s infinite'; });
document.getElementById('energyBar').style.width = '30%';
document.getElementById('energyBar').style.background = 'linear-gradient(90deg,#f44336,#ff5722)';
setTimeout(() => {
gauge.setPosition('low');
const cell = document.getElementById('mainCell');
cell.style.filter = 'brightness(0.5)';
document.getElementById('energyBar').style.width = '5%';
setLabel('Cell looks normal outside ‚Äî broken inside', 'Without energy, muscles can\'t work');
setTimeout(finishWatch, 2500);
}, 2500);
}, 1500);
}

function animCellWall(arena) {
const gauge = buildGauge(arena, 'low');
const stage = document.getElementById('animStage');
stage.innerHTML = `<div style="position:relative;">
<div id="plantCell" style="width:120px;height:80px;background:radial-gradient(circle,#66bb6a,#388e3c);border:3px dashed rgba(255,255,255,0.3);border-radius:40%;display:flex;align-items:center;justify-content:center;transition:all 1.5s;opacity:0.5;transform:scale(0.8);">
<div style="width:30px;height:30px;border-radius:50%;background:#64b5f6;"></div>
</div>
<div id="wallFrame" style="position:absolute;inset:-12px;border:4px solid transparent;border-radius:8px;transition:all 2s;"></div>
</div>
<div style="display:flex;gap:20px;margin-top:16px;font-size:11px;color:#78909c;" id="products"></div>`;
setLabel('Plant cell without a cell wall...', 'Floppy and shapeless ‚Äî like a deflated balloon');

setTimeout(() => {
setLabel('Cellulose fibers assembling...', 'Scientists at Rutgers filmed this in 2025!');
const wall = document.getElementById('wallFrame');
wall.style.borderColor = '#4caf50';
wall.style.background = 'rgba(76,175,80,0.08)';
wall.style.boxShadow = '0 0 15px rgba(76,175,80,0.3)';
setTimeout(() => {
gauge.setPosition('ok');
const cell = document.getElementById('plantCell');
cell.style.opacity = '1';
cell.style.transform = 'scale(1)';
cell.style.borderRadius = '8px';
cell.style.border = '3px solid #4caf50';
setLabel('Cell wall complete! Cell holds its shape.', 'Cellulose ‚Üí cotton ‚Üí T-shirts, paper, yogurt');
document.getElementById('products').innerHTML = 'üß¨‚Üí üëï T-shirt &nbsp; üìÑ Paper &nbsp; üå≥ Trees';
setTimeout(finishWatch, 2500);
}, 2500);
}, 1500);
}

function animNerve(arena) {
const gauge = buildGauge(arena, 'ok');
const stage = document.getElementById('animStage');
stage.innerHTML = `<div style="position:relative;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;">
<div style="display:flex;align-items:center;gap:0;width:90%;position:relative;" id="nerveContainer">
<div style="font-size:24px;">üß†</div>
<div style="flex:1;height:6px;background:linear-gradient(90deg,#64b5f6,#42a5f5);border-radius:3px;position:relative;" id="nerveLine">
<div id="sparkNode" style="position:absolute;width:14px;height:14px;border-radius:50%;background:#fff;box-shadow:0 0 15px #64b5f6;top:-4px;left:0;transition:left 1.5s linear;"></div>
</div>
<div style="font-size:24px;">‚úã</div>
</div>
<div style="display:flex;justify-content:space-between;width:85%;margin-top:8px;">
<span style="font-size:10px;color:#78909c;">Nucleus</span>
<span style="font-size:10px;color:#78909c;">Cell Membrane</span>
<span style="font-size:10px;color:#78909c;">Hand</span>
</div>
<div style="font-size:11px;color:#64b5f6;margin-top:8px;" id="speedLabel">Signal: 270 MPH ‚Üí</div>
</div>`;
setLabel('Nerve cell: 3 feet long', 'Electrical signal racing from brain to hand');

// Animate spark traveling
setTimeout(() => {
document.getElementById('sparkNode').style.left = '95%';
setTimeout(() => {
setLabel('HARD TACKLE!', 'Cell membrane damaged at the impact point');
const line = document.getElementById('nerveLine');
line.style.background = 'linear-gradient(90deg,#64b5f6 0%,#64b5f6 40%,#f44336 45%,#f44336 55%,#37474f 60%,#37474f 100%)';
document.getElementById('sparkNode').style.left = '42%';
document.getElementById('sparkNode').style.background = '#f44336';
document.getElementById('sparkNode').style.boxShadow = '0 0 15px #f44336';
gauge.setPosition('low');
document.getElementById('speedLabel').textContent = '270 MPH ‚Üí 0';
document.getElementById('speedLabel').style.color = '#f44336';
setTimeout(() => {
setLabel('Signal STOPS ‚Äî arm shuts down', 'No signal = no movement');
document.getElementById('sparkNode').style.opacity = '0.2';
setTimeout(finishWatch, 2000);
}, 2000);
}, 1800);
}, 500);
}

function animHayflick(arena) {
const gauge = buildGauge(arena, 'ok');
const stage = document.getElementById('animStage');
stage.innerHTML = `<div style="display:flex;flex-direction:column;align-items:center;gap:8px;">
<div style="display:flex;gap:4px;flex-wrap:wrap;justify-content:center;max-width:280px;" id="cellGrid"></div>
<div style="width:200px;height:4px;background:#37474f;border-radius:2px;position:relative;margin-top:8px;">
<div style="position:absolute;right:0;top:-14px;font-size:9px;color:#ff9800;">HAYFLICK LIMIT: 60</div>
<div id="limitLine" style="position:absolute;right:0;top:-2px;width:2px;height:8px;background:#ff9800;"></div>
<div id="divisionCounter" style="position:absolute;left:0;top:-2px;height:8px;background:#4caf50;border-radius:2px;width:0;transition:width 1s;"></div>
</div>
<div style="font-size:12px;color:#78909c;" id="divCount">Divisions: 0</div>
</div>`;
const grid = document.getElementById('cellGrid');
for(let i=0;i<16;i++){
const c=document.createElement('div');c.className='mini-cell green show';c.id='hcell'+i;grid.appendChild(c);
}
setLabel('Normal cells dividing...', 'Nucleus controls when to stop');

setTimeout(() => {
document.getElementById('divisionCounter').style.width = '90%';
document.getElementById('divCount').textContent = 'Divisions: 55';
setLabel('Approaching the Hayflick Limit...', 'Most cells will STOP at 40-60 divisions');
setTimeout(() => {
// Most cells stop
for(let i=0;i<14;i++){
const c=document.getElementById('hcell'+i);
if(c){c.style.opacity='0.4';c.style.filter='grayscale(1)';}
}
document.getElementById('divCount').textContent = 'Divisions: 60 ‚Äî STOPPED';
setLabel('Normal cells STOP dividing', 'But one cell ignores the limit...');
setTimeout(() => {
// Cancer cell goes crazy
const cancer = document.getElementById('hcell14');
const cancer2 = document.getElementById('hcell15');
if(cancer){cancer.className='mini-cell red show';cancer.style.animation='pulse 0.3s infinite';cancer.style.transform='scale(1.3)';}
if(cancer2){cancer2.className='mini-cell red show';cancer2.style.animation='pulse 0.3s infinite';}
gauge.setPosition('critical_high');
// Add more red cells
for(let i=0;i<6;i++){
setTimeout(()=>{
const c=document.createElement('div');c.className='mini-cell red';grid.appendChild(c);setTimeout(()=>c.classList.add('show'),50);
},i*300);
}
document.getElementById('divCount').textContent = 'Divisions: 200+ ‚Äî NO LIMIT';
document.getElementById('divCount').style.color = '#f44336';
setLabel('Cancer cells IGNORE the limit!', 'Uncontrolled division ‚Üí tumors form');
setTimeout(finishWatch, 3000);
}, 2000);
}, 2000);
}, 1500);
}

function animSickle(arena) {
const gauge = buildGauge(arena, 'ok');
const stage = document.getElementById('animStage');
stage.innerHTML = `<div style="position:relative;width:90%;height:80%;">
<div style="position:absolute;top:50%;left:10%;right:10%;height:50px;background:linear-gradient(180deg,rgba(183,28,28,0.2),rgba(198,40,40,0.15));border:2px solid rgba(244,67,54,0.3);border-radius:25px;transform:translateY(-50%);overflow:hidden;" id="vessel">
<div id="flowArrow" style="position:absolute;top:50%;left:5%;font-size:14px;color:rgba(255,255,255,0.4);transform:translateY(-50%);transition:opacity 1s;">‚Üí ‚Üí ‚Üí ‚Üí</div>
</div>
<div style="position:absolute;bottom:5%;left:50%;transform:translateX(-50%);display:flex;gap:20px;font-size:11px;" id="comparison">
<span style="color:#4caf50;">üî¥ Normal: round</span>
<span style="color:#ff9800;">üåô Sickle: crescent</span>
</div>
</div>`;
const vessel = document.getElementById('vessel');
// Normal cells flowing
for(let i=0;i<6;i++){
const c=document.createElement('div');
c.style.cssText=`position:absolute;width:16px;height:16px;border-radius:50%;background:radial-gradient(circle,#ef5350,#c62828);top:${10+Math.random()*20}px;left:${10+i*50}px;transition:all 1.5s;`;
c.className='bloodcell';
vessel.appendChild(c);
}
setLabel('Normal red blood cells flowing...', 'Round and flexible ‚Äî sliding through vessels');

setTimeout(() => {
setLabel('Marcus\'s cells start changing shape...', 'Cell membrane warps into a crescent');
const cells = vessel.querySelectorAll('.bloodcell');
cells.forEach((c,i)=>{
if(i>1){
c.style.borderRadius='50% 10% 50% 10%';
c.style.background='radial-gradient(circle,#ff7043,#bf360c)';
c.style.transform='rotate(20deg)';
}
});
setTimeout(() => {
gauge.setPosition('low');
// Jam them together
cells.forEach((c,i)=>{
if(i>1) c.style.left='55%';
});
document.getElementById('flowArrow').style.opacity='0';
setLabel('Sickle cells JAM and BLOCK the vessel!', 'Blood flow stops ‚Äî pain crisis begins');
// Pain indicator
const pain = document.createElement('div');
pain.style.cssText='position:absolute;top:10%;right:10%;font-size:24px;animation:pulse 0.5s infinite;';
pain.textContent='‚ö° PAIN';
stage.appendChild(pain);
setTimeout(finishWatch, 2500);
}, 2500);
}, 1500);
}

// ========== RECORD ==========
function showRecord() {
const sc = state.currentScenario;
// Check prediction
state.totalPredictions++;
const correct = state.selectedPrediction === sc.correctPredict;
if (correct) {
state.correctPredictions++;
state.score += 100;
state.streak++;
} else {
state.streak = 0;
}
state.completedScenarios.push(sc.id);
state.dataRows.push({
scenario: sc.name,
happened: sc.dataRow.happened,
response: sc.dataRow.response,
connection: sc.dataRow.connection
});

const content = document.getElementById('centerContent');
content.innerHTML = `
<div class="record-card">
<div class="record-emoji">${correct ? 'üéØ' : 'üìù'}</div>
<div class="record-title">${correct ? 'Great Prediction!' : 'Data Recorded!'}</div>
<div class="record-sub">${correct ? '+100 points! Streak: '+state.streak : 'Now you know what really happened.'}</div>
</div>`;

renderScenarioCards();
renderDataTable();
updateHUD();

const btn = document.getElementById('actionBtn');
btn.textContent = 'Pick Next Scenario';
btn.disabled = false;

// Check completion
const completed = state.completedScenarios.length;
if (completed === 5) {
setTimeout(() => showCompletion('required'), 1000);
} else if (completed === 8) {
setTimeout(() => showCompletion('extra'), 1000);
}
}

// ========== ACTION HANDLER ==========
function handleAction() {
switch(state.currentStep) {
case 'predict':
if (state.selectedPrediction === null) return;
state.currentStep = 'read';
updateTabs();
showRead();
break;
case 'read':
state.currentStep = 'watch';
updateTabs();
showWatch();
break;
case 'watch':
state.currentStep = 'record';
updateTabs();
showRecord();
break;
case 'record':
case 'none':
state.currentStep = 'none';
state.currentScenario = null;
state.selectedPrediction = null;
updateTabs();
const content = document.getElementById('centerContent');
const completed = state.completedScenarios.length;
if (completed >= 8) {
content.innerHTML = `<div class="welcome-screen"><div class="welcome-title">üåü All 8 Complete!</div><div class="welcome-sub">Amazing work! You investigated every cell story. Copy your data table and fill in your worksheet.</div></div>`;
document.getElementById('actionBtn').textContent = 'All Done!';
document.getElementById('actionBtn').disabled = true;
} else {
content.innerHTML = `<div class="welcome-screen"><div class="welcome-title">üî¨ Pick Your Next Story</div><div class="welcome-sub">Choose a scenario from the left sidebar to continue your investigation.</div></div>`;
document.getElementById('actionBtn').textContent = 'Select a Scenario';
document.getElementById('actionBtn').disabled = true;
}
renderScenarioCards();
break;
}
}

// ========== COMPLETION ==========
function showCompletion(type) {
const overlay = document.getElementById('completionOverlay');
if (type === 'required') {
document.getElementById('completionBadge').textContent = 'üèÜ';
document.getElementById('completionTitle').textContent = 'Required Complete!';
document.getElementById('completionSub').textContent = 'You finished 5 stories! Continue for Extra Credit?';
} else {
document.getElementById('completionBadge').textContent = 'üåü';
document.getElementById('completionTitle').textContent = 'Extra Credit Complete!';
document.getElementById('completionSub').textContent = 'You investigated all 8 cell stories! Amazing work!';
}
overlay.classList.add('show');
}

function closeCompletion() {
document.getElementById('completionOverlay').classList.remove('show');
}

// ========== COPY TABLE ==========
function copyTable() {
try {
let text = 'Scenario\tWhat Happened?\tPerson/Situation Response\tConnection to Cells?\n';
state.dataRows.forEach(d => {
text += `${d.scenario}\t${d.happened}\t${d.response}\t${d.connection}\n`;
});
navigator.clipboard.writeText(text).then(() => {
const btn = document.getElementById('copyBtn');
btn.textContent = '‚úì Copied!';
btn.classList.add('copied');
setTimeout(() => { btn.textContent = 'üìã Copy Table'; btn.classList.remove('copied'); }, 2000);
});
} catch(e) {
// Fallback
const ta = document.createElement('textarea');
let text = 'Scenario\tWhat Happened?\tPerson/Situation Response\tConnection to Cells?\n';
state.dataRows.forEach(d => { text += `${d.scenario}\t${d.happened}\t${d.response}\t${d.connection}\n`; });
ta.value = text;
document.body.appendChild(ta);
ta.select();
document.execCommand('copy');
document.body.removeChild(ta);
const btn = document.getElementById('copyBtn');
btn.textContent = '‚úì Copied!';
btn.classList.add('copied');
setTimeout(() => { btn.textContent = 'üìã Copy Table'; btn.classList.remove('copied'); }, 2000);
}
}

// ========== RESET / NEW RUN ==========
function resetSim() {
stopReadAloud();
state = {readingLevel:state.readingLevel,currentScenario:null,currentStep:'none',completedScenarios:[],predictions:{},score:0,streak:0,totalPredictions:0,correctPredictions:0,dataRows:[],speechActive:false,selectedPrediction:null};
init();
document.getElementById('centerContent').innerHTML = `<div class="welcome-screen"><div class="welcome-title">üî¨ Cells Are Everywhere</div><div class="welcome-sub">Real people ‚Äî from a woman whose cells never died to a football player who lost feeling in his arm ‚Äî all have one thing in common: their stories start inside a single cell.</div><div class="welcome-mission">üéØ Mission: Investigate 8 real cell stories ‚Äî unlock each person's secret by reading what happened inside their cells.</div></div>`;
document.getElementById('actionBtn').textContent = 'Select a Scenario';
document.getElementById('actionBtn').disabled = true;
updateTabs();
}

function newRun() { resetSim(); }

// ========== START ==========
init();
</script>
</body>
</html>
