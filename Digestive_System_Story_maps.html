<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mr. Jawad's Simulation - Digestive System The Food Journey</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',system-ui,-apple-system,sans-serif;background:#0a0a1a;color:#e0e0e0;overflow:hidden;height:100vh;width:100vw;}
#app{display:grid;grid-template-columns:280px 1fr 280px;height:100vh;gap:0;}
.left-sidebar{background:linear-gradient(180deg,#1a1a2e 0%,#16213e 100%);border-right:2px solid #2a2a4a;display:flex;flex-direction:column;overflow-y:auto;padding:12px;}
.left-sidebar::-webkit-scrollbar{width:6px;}
.left-sidebar::-webkit-scrollbar-thumb{background:#4a4a6a;border-radius:3px;}
.pick-header{text-align:center;font-size:15px;font-weight:700;color:#ffd54f;margin-bottom:10px;text-transform:uppercase;letter-spacing:1px;}
.pick-sub{text-align:center;font-size:12px;color:#aaa;margin-bottom:12px;}
.scenario-card{display:flex;align-items:center;gap:10px;padding:10px 12px;margin-bottom:6px;border-radius:10px;cursor:pointer;transition:all .3s;border:2px solid transparent;background:rgba(255,255,255,.04);position:relative;}
.scenario-card:hover{background:rgba(255,255,255,.08);border-color:rgba(255,255,255,.15);}
.scenario-card.selected{background:linear-gradient(135deg,rgba(33,150,243,.25),rgba(156,39,176,.2));border-color:#2196F3;box-shadow:0 0 12px rgba(33,150,243,.3);}
.scenario-card.completed{opacity:.7;}
.scenario-card.completed::after{content:'\2713';position:absolute;right:8px;color:#4CAF50;font-weight:700;font-size:16px;}
.sc-emoji{font-size:28px;flex-shrink:0;}
.sc-name{font-size:13px;font-weight:600;line-height:1.3;}
.divider{height:1px;background:linear-gradient(90deg,transparent,#4a4a6a,transparent);margin:12px 0;}
.sidebar-section-title{font-size:12px;font-weight:700;color:#aaa;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;}
.reading-levels{display:flex;gap:4px;margin-bottom:12px;}
.rl-btn{flex:1;padding:8px 4px;text-align:center;font-size:12px;font-weight:700;border:2px solid #4a4a6a;border-radius:8px;cursor:pointer;transition:all .3s;background:transparent;color:#aaa;}
.rl-btn:hover{border-color:#aaa;}
.rl-btn.active{background:linear-gradient(135deg,#2196F3,#1976D2);border-color:#2196F3;color:#fff;box-shadow:0 0 10px rgba(33,150,243,.3);}
.keywords-list{display:flex;flex-wrap:wrap;gap:5px;margin-bottom:12px;}
.kw-tag{padding:4px 8px;border-radius:6px;font-size:11px;font-weight:600;background:rgba(255,255,255,.06);color:#bbb;transition:all .3s;}
.kw-tag.highlighted{background:linear-gradient(135deg,rgba(76,175,80,.3),rgba(56,142,60,.2));color:#81C784;border:1px solid rgba(76,175,80,.4);}
.bottom-buttons{margin-top:auto;display:flex;gap:8px;padding-top:12px;}
.btn-reset{flex:1;padding:10px;border:none;border-radius:8px;font-size:12px;font-weight:700;cursor:pointer;transition:all .3s;}
.btn-reset.red{background:linear-gradient(135deg,#f44336,#c62828);color:#fff;}
.btn-reset.blue{background:linear-gradient(135deg,#2196F3,#1565C0);color:#fff;}
.btn-reset:hover{transform:scale(1.03);filter:brightness(1.1);}
.center-panel{display:flex;flex-direction:column;overflow:hidden;background:linear-gradient(180deg,#111122 0%,#0d0d1a 100%);}
.step-tabs{display:flex;gap:0;padding:8px 16px;background:rgba(0,0,0,.3);}
.step-tab{flex:1;text-align:center;padding:10px 8px;font-size:13px;font-weight:700;border-radius:8px;color:#555;transition:all .4s;position:relative;}
.step-tab.active{color:#fff;background:linear-gradient(135deg,rgba(33,150,243,.3),rgba(156,39,176,.2));box-shadow:0 0 15px rgba(33,150,243,.2);}
.step-tab.active::after{content:'';position:absolute;bottom:-2px;left:30%;right:30%;height:3px;background:linear-gradient(90deg,#2196F3,#9C27B0);border-radius:2px;}
.step-tab.done{color:#4CAF50;}
.center-content{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;overflow-y:auto;}
.center-content::-webkit-scrollbar{width:6px;}
.center-content::-webkit-scrollbar-thumb{background:#4a4a6a;border-radius:3px;}
.welcome-box{text-align:center;max-width:600px;}
.welcome-box h2{font-size:28px;background:linear-gradient(135deg,#ffd54f,#ff9800);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:12px;}
.welcome-box p{font-size:16px;color:#aaa;line-height:1.6;margin-bottom:8px;}
.mission-tag{display:inline-block;padding:8px 20px;border-radius:20px;background:linear-gradient(135deg,rgba(255,213,79,.15),rgba(255,152,0,.1));border:1px solid rgba(255,213,79,.3);color:#ffd54f;font-size:13px;font-weight:600;margin-top:12px;}
.predict-box{background:linear-gradient(135deg,rgba(255,213,79,.08),rgba(255,152,0,.05));border:2px solid rgba(255,213,79,.3);border-radius:16px;padding:30px;max-width:600px;width:100%;text-align:center;}
.predict-box h3{font-size:20px;color:#ffd54f;margin-bottom:16px;}
.predict-box p{font-size:16px;color:#ddd;line-height:1.6;margin-bottom:20px;}
.predict-options{display:flex;flex-direction:column;gap:10px;}
.predict-btn{padding:14px 20px;border:2px solid rgba(255,255,255,.1);border-radius:12px;background:rgba(255,255,255,.04);color:#ddd;font-size:14px;cursor:pointer;transition:all .3s;text-align:left;}
.predict-btn:hover{background:rgba(33,150,243,.15);border-color:rgba(33,150,243,.4);transform:translateX(4px);}
.predict-btn.chosen{background:linear-gradient(135deg,rgba(33,150,243,.2),rgba(156,39,176,.15));border-color:#2196F3;color:#fff;}
.read-card{background:linear-gradient(135deg,rgba(255,255,255,.06),rgba(255,255,255,.02));border:2px solid rgba(255,255,255,.1);border-radius:16px;padding:28px;max-width:650px;width:100%;position:relative;}
.read-card h3{font-size:18px;color:#64B5F6;margin-bottom:4px;}
.read-card .read-scenario-name{font-size:14px;color:#aaa;margin-bottom:16px;}
.read-passage{font-size:17px;line-height:1.7;color:#e0e0e0;}
.read-passage .kw-bold{color:#81C784;font-weight:700;}
.watch-arena{width:100%;max-width:700px;height:400px;position:relative;border-radius:16px;overflow:hidden;background:linear-gradient(180deg,#0d1b2a,#1b2838);border:2px solid rgba(255,255,255,.08);}
.digestive-tract{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:160px;height:360px;}
.organ-station{position:absolute;left:50%;transform:translateX(-50%);width:100px;text-align:center;transition:all .6s;}
.organ-station .organ-shape{width:60px;height:40px;margin:0 auto;border-radius:50%;transition:all .6s;position:relative;}
.organ-station .organ-label{font-size:10px;font-weight:700;color:#aaa;margin-top:3px;transition:all .3s;}
.organ-station.active .organ-shape{filter:brightness(1.5);box-shadow:0 0 20px currentColor;}
.organ-station.active .organ-label{color:#fff;}
.organ-station.damaged .organ-shape{animation:pulse-red .5s infinite alternate;}
@keyframes pulse-red{from{box-shadow:0 0 10px #f44336;}to{box-shadow:0 0 25px #f44336,0 0 40px rgba(244,67,54,.3);}}
.flow-arrow{position:absolute;left:50%;transform:translateX(-50%);color:#4CAF50;font-size:16px;transition:all .6s;opacity:.6;}
.flow-arrow.stopped{color:#f44336;opacity:.3;}
.ok-gauge{position:absolute;right:20px;top:50%;transform:translateY(-50%);width:30px;height:200px;border-radius:15px;background:rgba(255,255,255,.05);border:2px solid rgba(255,255,255,.1);overflow:hidden;}
.ok-zone{position:absolute;left:2px;right:2px;top:30%;height:40%;background:rgba(76,175,80,.15);border:1px dashed rgba(76,175,80,.4);border-radius:4px;}
.ok-zone-label{position:absolute;right:56px;top:45%;font-size:9px;color:#4CAF50;font-weight:700;letter-spacing:1px;}
.gauge-needle{position:absolute;left:4px;right:4px;height:6px;border-radius:3px;background:linear-gradient(90deg,#4CAF50,#66BB6A);transition:top 1.5s cubic-bezier(.4,0,.2,1);box-shadow:0 0 8px #4CAF50;}
.gauge-needle.warning{background:linear-gradient(90deg,#f44336,#e53935);box-shadow:0 0 8px #f44336;}
.gauge-needle.ok{background:linear-gradient(90deg,#4CAF50,#66BB6A);box-shadow:0 0 8px #4CAF50;}
.watch-label{position:absolute;bottom:12px;left:50%;transform:translateX(-50%);font-size:13px;font-weight:700;color:#ffd54f;text-align:center;text-shadow:0 0 10px rgba(255,213,79,.5);opacity:0;transition:opacity .5s;max-width:80%;}
.watch-label.show{opacity:1;}
.anim-particle{position:absolute;border-radius:50%;transition:all 1s;pointer-events:none;}
.anim-icon{position:absolute;font-size:20px;transition:all 1s;pointer-events:none;}
.anim-label{position:absolute;font-size:11px;font-weight:700;padding:3px 8px;border-radius:4px;background:rgba(0,0,0,.7);pointer-events:none;transition:all .5s;opacity:0;}
.anim-label.show{opacity:1;}
.record-box{text-align:center;max-width:500px;}
.record-box h3{font-size:22px;color:#4CAF50;margin-bottom:8px;}
.record-box p{font-size:15px;color:#aaa;margin-bottom:16px;}
.record-check{font-size:64px;margin-bottom:12px;animation:bounce-in .5s ease-out;}
@keyframes bounce-in{0%{transform:scale(0);}60%{transform:scale(1.2);}100%{transform:scale(1);}}
.action-area{padding:16px;display:flex;justify-content:center;gap:12px;background:rgba(0,0,0,.2);}
.action-btn{padding:14px 32px;border:none;border-radius:12px;font-size:15px;font-weight:700;cursor:pointer;transition:all .3s;color:#fff;}
.action-btn.primary{background:linear-gradient(135deg,#2196F3,#1976D2);box-shadow:0 4px 15px rgba(33,150,243,.3);}
.action-btn.primary:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(33,150,243,.4);}
.action-btn.speak{background:linear-gradient(135deg,#9C27B0,#7B1FA2);box-shadow:0 4px 15px rgba(156,39,176,.3);}
.action-btn.speak:hover{transform:translateY(-2px);}
.action-btn:disabled{opacity:.4;cursor:not-allowed;transform:none !important;}
.right-sidebar{background:linear-gradient(180deg,#1a1a2e 0%,#16213e 100%);border-left:2px solid #2a2a4a;display:flex;flex-direction:column;padding:12px;overflow-y:auto;}
.right-sidebar::-webkit-scrollbar{width:6px;}
.right-sidebar::-webkit-scrollbar-thumb{background:#4a4a6a;border-radius:3px;}
.progress-title{font-size:13px;font-weight:700;color:#ffd54f;text-transform:uppercase;letter-spacing:1px;margin-bottom:10px;}
.hud-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:12px;}
.hud-stat{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:8px;padding:8px;text-align:center;}
.hud-stat .hud-val{font-size:22px;font-weight:700;background:linear-gradient(135deg,#64B5F6,#42A5F5);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.hud-stat .hud-label{font-size:10px;color:#888;text-transform:uppercase;letter-spacing:.5px;margin-top:2px;}
.progress-bar-wrap{width:100%;height:14px;background:rgba(255,255,255,.06);border-radius:7px;overflow:hidden;margin-bottom:6px;border:1px solid rgba(255,255,255,.08);}
.progress-bar-fill{height:100%;background:linear-gradient(90deg,#4CAF50,#66BB6A);border-radius:7px;transition:width .5s;position:relative;}
.progress-bar-fill::after{content:'';position:absolute;top:0;left:0;right:0;height:50%;background:linear-gradient(180deg,rgba(255,255,255,.2),transparent);border-radius:7px 7px 0 0;}
.progress-msg{font-size:12px;color:#aaa;text-align:center;margin-bottom:12px;}
.data-title{font-size:13px;font-weight:700;color:#ffd54f;text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;display:flex;align-items:center;justify-content:space-between;}
.copy-btn{padding:4px 10px;border:1px solid rgba(255,213,79,.3);border-radius:6px;background:rgba(255,213,79,.1);color:#ffd54f;font-size:11px;font-weight:600;cursor:pointer;transition:all .3s;}
.copy-btn:hover{background:rgba(255,213,79,.2);}
.copy-btn.copied{background:rgba(76,175,80,.2);border-color:#4CAF50;color:#4CAF50;}
.data-table{width:100%;border-collapse:collapse;font-size:10px;}
.data-table th{background:rgba(33,150,243,.15);color:#64B5F6;padding:6px 4px;text-align:left;font-size:9px;text-transform:uppercase;letter-spacing:.5px;border-bottom:1px solid rgba(255,255,255,.1);}
.data-table td{padding:5px 4px;border-bottom:1px solid rgba(255,255,255,.04);color:#ccc;vertical-align:top;font-size:10px;line-height:1.3;}
.data-table tr:nth-child(even){background:rgba(255,255,255,.02);}
.data-table tr.new-row{animation:row-flash .6s ease-out;}
@keyframes row-flash{0%{background:rgba(76,175,80,.3);}100%{background:transparent;}}
.title-bar{background:linear-gradient(135deg,#1a237e,#4a148c);padding:8px 16px;text-align:center;border-bottom:2px solid rgba(255,255,255,.08);}
.title-bar h1{font-size:16px;font-weight:700;background:linear-gradient(135deg,#ffd54f,#ff9800);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.rules-panel{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.85);z-index:100;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .3s;}
.rules-panel.show{opacity:1;pointer-events:all;}
.rules-content{background:linear-gradient(135deg,#1a1a2e,#16213e);border:2px solid rgba(255,255,255,.1);border-radius:16px;padding:30px;max-width:500px;width:90%;}
.rules-content h3{color:#ffd54f;font-size:18px;margin-bottom:16px;}
.rules-content ol{padding-left:24px;margin-bottom:20px;}
.rules-content li{color:#ccc;margin-bottom:8px;font-size:14px;line-height:1.5;}
.rules-content .start-btn{display:block;width:100%;padding:14px;border:none;border-radius:10px;background:linear-gradient(135deg,#4CAF50,#2E7D32);color:#fff;font-size:16px;font-weight:700;cursor:pointer;transition:all .3s;}
.rules-content .start-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(76,175,80,.4);}
.completion-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.9);z-index:100;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .5s;}
.completion-overlay.show{opacity:1;pointer-events:all;}
.completion-content{text-align:center;max-width:500px;padding:40px;}
.completion-content h2{font-size:32px;background:linear-gradient(135deg,#ffd54f,#ff9800);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:16px;}
.completion-content .big-emoji{font-size:80px;margin-bottom:16px;animation:bounce-in .6s ease-out;}
.completion-content p{color:#ccc;font-size:16px;line-height:1.6;margin-bottom:12px;}
.badge{display:inline-block;padding:8px 20px;border-radius:20px;font-size:14px;font-weight:700;margin:8px;}
.badge.required{background:linear-gradient(135deg,rgba(76,175,80,.2),rgba(56,142,60,.15));border:2px solid #4CAF50;color:#4CAF50;}
.badge.extra{background:linear-gradient(135deg,rgba(255,213,79,.2),rgba(255,152,0,.15));border:2px solid #ffd54f;color:#ffd54f;}
</style>
</head>
<body>
<div class="title-bar"><h1>Mr. Jawad's Simulation - Digestive System: The Food Journey</h1></div>
<div id="app">
<div class="left-sidebar">
<div class="pick-header">Pick Any 5 You Like</div>
<div class="pick-sub" id="pickSub">8 stories available</div>
<div id="scenarioList"></div>
<div class="divider"></div>
<div class="sidebar-section-title">Reading Level</div>
<div class="reading-levels">
<div class="rl-btn active" data-level="low" onclick="setLevel('low')">Low</div>
<div class="rl-btn" data-level="med" onclick="setLevel('med')">Med</div>
<div class="rl-btn" data-level="high" onclick="setLevel('high')">High</div>
</div>
<div class="divider"></div>
<div class="sidebar-section-title">Key Words</div>
<div class="keywords-list" id="keywordsList"></div>
<div class="bottom-buttons">
<button class="btn-reset red" onclick="resetSim()">Reset</button>
<button class="btn-reset blue" onclick="newRun()">New Run</button>
</div>
</div>
<div class="center-panel">
<div class="step-tabs">
<div class="step-tab" id="tab1">1. PREDICT</div>
<div class="step-tab" id="tab2">2. READ</div>
<div class="step-tab" id="tab3">3. WATCH</div>
<div class="step-tab" id="tab4">4. RECORD</div>
</div>
<div class="center-content" id="centerContent"></div>
<div class="action-area" id="actionArea"></div>
</div>
<div class="right-sidebar">
<div class="progress-title">Progress</div>
<div class="hud-grid">
<div class="hud-stat"><div class="hud-val" id="hudScore">0</div><div class="hud-label">Score</div></div>
<div class="hud-stat"><div class="hud-val" id="hudStreak">0</div><div class="hud-label">Streak</div></div>
<div class="hud-stat"><div class="hud-val" id="hudCompleted">0/5</div><div class="hud-label">Completed</div></div>
<div class="hud-stat"><div class="hud-val" id="hudAccuracy">-</div><div class="hud-label">Accuracy</div></div>
</div>
<div class="progress-bar-wrap"><div class="progress-bar-fill" id="progressFill" style="width:0%"></div></div>
<div class="progress-msg" id="progressMsg">Pick a story to begin!</div>
<div class="divider"></div>
<div class="data-title"><span>Data Table</span><button class="copy-btn" id="copyBtn" onclick="copyTable()">ðŸ“‹ Copy Table</button></div>
<table class="data-table">
<thead><tr><th>Scenario</th><th>What Happened?</th><th>Response</th><th>Digestion?</th></tr></thead>
<tbody id="dataBody"></tbody>
</table>
</div>
</div>
<div class="rules-panel show" id="rulesPanel">
<div class="rules-content">
<h3>The Journey Inside: Your Mission</h3>
<p style="color:#aaa;margin-bottom:16px;font-size:14px;">Real people swallowed impossible things, broke world records, and survived stomach acid strong enough to dissolve metal. Now you trace what happened inside their bodies.</p>
<ol>
<li>Pick a scenario from the left sidebar.</li>
<li>Choose your reading level (Low, Med, or High).</li>
<li><strong>PREDICT</strong> - Click to predict what will happen.</li>
<li><strong>READ</strong> - Read the passage. Tap the speaker to hear it read aloud.</li>
<li><strong>WATCH</strong> - Watch the animation show what happened inside the body.</li>
<li><strong>RECORD</strong> - Data is recorded, then pick your next scenario.</li>
</ol>
<p style="color:#ffd54f;font-size:13px;margin-bottom:16px;">Complete 5 stories to finish. All 8 = extra credit!</p>
<button class="start-btn" onclick="startSim()">Start the Journey</button>
</div>
</div>
<div class="completion-overlay" id="completionOverlay">
<div class="completion-content" id="completionContent"></div>
</div>
<script>
var SCENARIOS=[
{id:1,name:"Joey Chestnut's Record",emoji:"\uD83C\uDF2D",organ:"stomach",
predict:{q:"Joey Chestnut eats 76 hot dogs in 10 minutes. What do you think happens inside his stomach?",
opts:["The stomach handles it fine","The stomach stretches and digestion stops","The food digests super fast","The stomach shrinks"]},
readings:{
low:{text:'Joey Chestnut eats 76 hot dogs in 10 minutes at the Nathan\'s Famous contest. His <kw>stomach</kw> stretches into a giant sac. Normal <kw>peristalsis</kw> \u2014 the squeezing that pushes food \u2014 shuts down completely. The food just sits there because <kw>mechanical digestion</kw> and <kw>chemical digestion</kw> cannot keep up.',answer:1},
med:{text:'Joey Chestnut eats 76 hot dogs in 10 minutes \u2014 a world record at the Nathan\'s Famous contest. Researchers use X-ray video to study what happens inside a speed eater\'s body. The <kw>stomach</kw> stretches into a massive sac that fills the abdomen. Normal <kw>peristalsis</kw> \u2014 the muscle squeezing that moves food forward \u2014 stops completely. Hot dog chunks sit barely touched because <kw>mechanical digestion</kw> and <kw>chemical digestion</kw> cannot process food this fast.',answer:1},
high:{text:'Joey Chestnut eats 76 hot dogs in 10 minutes \u2014 a world record at the Nathan\'s Famous contest. Scientists use X-ray video to study what happens inside a speed eater\'s body during a competition. The <kw>stomach</kw> stretches into a massive sac that fills nearly the entire abdomen. Normal <kw>peristalsis</kw> \u2014 the squeezing muscle motion that pushes food through the digestive tract \u2014 shuts down completely. Hot dog chunks sit in the <kw>stomach</kw> with almost no movement or processing. Neither <kw>mechanical digestion</kw> nor <kw>chemical digestion</kw> can handle this extreme volume. The <kw>gastric acid</kw> and <kw>enzymes</kw> are overwhelmed \u2014 the system was never designed for this much food at once.',answer:1}
},
dataRow:{what:"Ate 76 hot dogs in 10 min",response:"Stomach stretched, peristalsis stopped",connection:"Mechanical and chemical digestion overwhelmed"},
watchType:"stomach-overload"
},
{id:2,name:"The 29 Magnets",emoji:"\uD83E\uDDF2",organ:"small intestine",
predict:{q:"A 3-year-old swallows 29 small magnets over several days. What do you think happens inside the intestines?",
opts:["The magnets pass through safely","The magnets tear holes in the intestine walls","The stomach acid dissolves the magnets","The magnets stay in the stomach"]},
readings:{
low:{text:'A 3-year-old swallows 29 small magnets from a desk toy over several days. The magnets attract each other through different loops of intestine, pinching the walls together. The magnets tear holes in the intestinal wall where <kw>absorption</kw> normally happens. Surgeons must operate to remove them and repair the damage to the digestive path.',answer:1},
med:{text:'A 3-year-old swallows 29 small magnets from a desk toy over several days without anyone noticing. The magnets travel through the digestive tract by <kw>peristalsis</kw> \u2014 the normal squeezing that moves everything forward. But magnets in separate loops of intestine attract each other through the walls. They pinch the tissue together and bore holes through the intestinal lining. Surgeons find multiple holes in the intestinal wall that <kw>absorption</kw> and normal digestion cannot survive.',answer:1},
high:{text:'A 3-year-old swallows 29 small magnets from a desk toy over several days without anyone knowing. Each magnet enters the digestive tract and moves through by <kw>peristalsis</kw> \u2014 the normal squeezing motion that pushes everything forward. Some magnets end up in different loops of the small intestine at the same time. The magnetic force pulls them toward each other through the intestinal walls. The walls get pinched together so tightly that the magnets bore holes through the tissue. Surgeons find multiple perforations \u2014 tears that destroy the lining where <kw>absorption</kw> normally happens. The body\'s digestive path is broken in several places, and only emergency surgery can repair the damage.',answer:1}
},
dataRow:{what:"Swallowed 29 magnets over days",response:"Magnets tore holes in intestine walls",connection:"Absorption destroyed at damaged sites"},
watchType:"magnets-tear"
},
{id:3,name:"The Razor Blade Test",emoji:"\uD83D\uDD2A",organ:"stomach",
predict:{q:"Scientists drop a razor blade into stomach acid. What do you think happens to the blade?",
opts:["Nothing happens to the blade","The acid dissolves over a third of the blade","The blade cuts through the stomach","The acid makes the blade stronger"]},
readings:{
low:{text:'Scientists drop a razor blade into simulated <kw>gastric acid</kw> to test its power. After 24 hours, the blade loses over a third of its weight \u2014 the acid dissolves metal. The stomach\'s acid is nearly as strong as battery acid. Yet the stomach does not digest itself because a mucus lining replaces itself every few days.',answer:1},
med:{text:'Scientists drop a razor blade into simulated <kw>gastric acid</kw> to see how powerful stomach acid really is. After 24 hours, the blade loses 37% of its weight \u2014 the acid dissolves solid metal. Your stomach\'s pH is 1 to 2, nearly as strong as battery acid. So why does the stomach not digest itself? A protective mucus lining coats the stomach walls and replaces itself every 3 to 4 days. This is <kw>chemical digestion</kw> at its most extreme \u2014 powerful enough to destroy metal, yet controlled by the body\'s own defense system.',answer:1},
high:{text:'Scientists run an experiment: they drop a razor blade into simulated <kw>gastric acid</kw> to measure how powerful stomach acid truly is. After 24 hours, the blade loses 37% of its weight \u2014 the acid eats through solid metal. Your stomach\'s pH sits between 1 and 2, making it nearly as strong as battery acid. This is <kw>chemical digestion</kw> at full force \u2014 <kw>gastric acid</kw> combined with <kw>enzymes</kw> can break down almost anything organic. So how does the stomach survive its own acid? A protective mucus lining coats every surface of the stomach wall. This lining regenerates itself every 3 to 4 days through rapid cell growth. Without that constant repair, the acid would burn straight through the stomach tissue.',answer:1}
},
dataRow:{what:"Razor blade dropped in stomach acid",response:"Blade lost 37% weight, mucus protected stomach",connection:"Gastric acid powerful but mucus lining defends"},
watchType:"razor-dissolve"
},
{id:4,name:"A Teen's Mystery Pain",emoji:"\uD83D\uDE23",organ:"small intestine",
predict:{q:"A 14-year-old has constant cramps and diarrhea after every meal. What do you think is causing it?",
opts:["She ate something bad once","Her immune system attacks her own villi","Her stomach makes too much acid","She has a stomach virus"]},
readings:{
low:{text:'A 14-year-old gets constant cramps, bloating, and diarrhea after every meal. Doctors discover her immune system attacks her own <kw>villi</kw> every time she eats gluten. Without healthy <kw>villi</kw>, her small intestine cannot perform <kw>absorption</kw> \u2014 nutrients pass right through. Once she stops eating gluten, her <kw>villi</kw> slowly grow back.',answer:1},
med:{text:'A 14-year-old has constant stomach cramps, bloating, and diarrhea after meals but nobody knows why. A doctor discovers she has a condition where her immune system attacks her own <kw>villi</kw> every time she eats gluten. <kw>Villi</kw> are the tiny finger-like bumps lining the small intestine that handle <kw>absorption</kw> \u2014 pulling nutrients into the blood. With her <kw>villi</kw> destroyed, food passes through but her body gets almost nothing from it. After she stops eating gluten, her <kw>villi</kw> slowly regrow and <kw>absorption</kw> returns to normal within months.',answer:1},
high:{text:'A 14-year-old suffers constant cramps, bloating, and diarrhea after every meal for months. No one can figure out why until a doctor runs a special test. The results reveal that her immune system attacks her own <kw>villi</kw> \u2014 the tiny finger-like bumps lining the small intestine \u2014 every time she eats gluten. <kw>Villi</kw> are responsible for <kw>absorption</kw>, pulling nutrients from digested food into the bloodstream. When the <kw>villi</kw> flatten, the small intestine loses most of its surface area for <kw>absorption</kw>. She eats full meals but her body captures almost none of the nutrients. After she removes gluten from her diet, her <kw>villi</kw> slowly regrow over several months and her symptoms disappear completely.',answer:1}
},
dataRow:{what:"Immune system destroys villi when eating gluten",response:"Villi flattened, nutrients pass through unabsorbed",connection:"Absorption fails without healthy villi"},
watchType:"villi-attack"
},
{id:5,name:"The Backward Flow",emoji:"\uD83D\uDD25",organ:"esophagus",
predict:{q:"A teenager gets burning pain in his chest every night after eating. What do you think is happening?",
opts:["His heart is having problems","Stomach acid flows backward into the esophagus","His esophagus is too narrow","He is eating too fast"]},
readings:{
low:{text:'A teenager gets burning pain in his chest and throat every night after eating. The muscle valve between his esophagus and stomach stops closing properly. <kw>Gastric acid</kw> flows backward into the esophagus, which has no protective lining. The acid burns the tissue \u2014 this is acid reflux, and over 20% of Americans experience it.',answer:1},
med:{text:'A teenager gets a burning pain in his chest and throat every night, especially after eating and lying down. The problem is a muscle valve between his esophagus and stomach that stops closing properly. Normally this valve keeps <kw>gastric acid</kw> locked inside the stomach where it belongs. When it fails, <kw>gastric acid</kw> flows backward up into the esophagus. Unlike the stomach, the esophagus has no protective mucus lining \u2014 so the acid burns the tissue directly. Over 20% of Americans experience this condition, called acid reflux.',answer:1},
high:{text:'A teenager wakes up every night with a burning sensation in his chest and throat, especially after eating a big meal. His doctor explains that the lower esophageal sphincter \u2014 the muscle valve between the esophagus and stomach \u2014 is not closing properly. This valve is supposed to act as a one-way gate, keeping <kw>gastric acid</kw> sealed inside the stomach after eating. When the valve relaxes or weakens, powerful <kw>gastric acid</kw> flows backward up into the esophagus. The stomach survives its own acid because a mucus lining protects the walls and regenerates every few days. The esophagus has no such protection \u2014 <kw>chemical digestion</kw> was never supposed to happen here. The acid burns the exposed tissue, causing pain, swelling, and long-term damage if untreated.',answer:1}
},
dataRow:{what:"Valve fails, acid flows backward",response:"Gastric acid burns unprotected esophagus",connection:"Esophagus has no mucus lining to defend against acid"},
watchType:"acid-reflux"
},
{id:6,name:"The Penny's Trip",emoji:"\uD83E\uDE99",organ:"all",
predict:{q:"A kid swallows a penny. What do you think happens as it travels through the digestive system?",
opts:["The stomach acid dissolves it","The penny travels the whole path and comes out","The penny gets stuck in the stomach","The penny is absorbed into the blood"]},
readings:{
low:{text:'Over 80,000 kids visit the ER each year for swallowing objects \u2014 coins are number one. A swallowed penny travels the whole digestive path: mouth, esophagus, stomach, small intestine, large intestine, and out. <kw>Gastric acid</kw> has no effect on the penny because it is metal-coated. The penny traces the exact route your food follows every day through <kw>peristalsis</kw>.',answer:1},
med:{text:'Over 80,000 kids visit the ER each year for swallowing objects, and coins are the most common. A swallowed penny traces the complete digestive journey: mouth, esophagus, stomach, small intestine, large intestine, and out. <kw>Peristalsis</kw> \u2014 the squeezing muscle motion \u2014 pushes the penny forward through each organ. <kw>Gastric acid</kw> has no effect on the copper-coated penny, so it passes right through the stomach untouched. The penny follows the exact same path your food takes every single day. But button batteries are a different story \u2014 they can burn through the esophagus in under two hours.',answer:1},
high:{text:'Over 80,000 kids visit the ER each year in the United States for swallowing foreign objects, and coins top the list. A swallowed penny takes a complete tour of the digestive tract: mouth, esophagus, stomach, small intestine, large intestine, and finally out. At every stop, <kw>peristalsis</kw> \u2014 the rhythmic squeezing of muscles along the digestive walls \u2014 pushes the penny forward. When the penny reaches the stomach, <kw>gastric acid</kw> attacks it, but the copper-coated zinc does not break down. No <kw>mechanical digestion</kw> or <kw>chemical digestion</kw> can touch it, so the penny passes through unchanged. The penny\'s journey maps the exact route every piece of food follows through your body. But not all swallowed objects are this harmless \u2014 button batteries create an electrical current that can burn through esophagus tissue in under two hours.',answer:1}
},
dataRow:{what:"Penny swallowed, traced full path",response:"Peristalsis pushed penny through all organs safely",connection:"Gastric acid cannot dissolve metal coating"},
watchType:"penny-journey"
},
{id:7,name:"The Lactose Surprise",emoji:"\uD83E\uDD5B",organ:"large intestine",
predict:{q:"About 70% of the world can't fully digest milk sugar. What do you think happens when they drink milk?",
opts:["Their stomach acid is too weak","Undigested sugar causes gas and cramps in the large intestine","The milk just passes through with no effect","Their villi absorb it differently"]},
readings:{
low:{text:'About 70% of the world cannot fully digest lactose \u2014 the sugar in milk. Most people stop making enough lactase, the <kw>enzyme</kw> that breaks down lactose, after childhood. Undigested lactose reaches the large intestine, where bacteria produce gas, cramps, and diarrhea. <kw>Chemical digestion</kw> failed because the <kw>enzyme</kw> was missing.',answer:1},
med:{text:'About 70% of the world\'s population cannot fully digest lactose \u2014 the sugar found in milk and dairy. The reason is that most humans stop producing enough lactase after childhood. Lactase is the specific <kw>enzyme</kw> responsible for breaking lactose into smaller sugars the body can use. Without enough of this <kw>enzyme</kw>, the lactose skips through the small intestine undigested. When it reaches the large intestine, bacteria break down the sugar and produce gas, cramps, and diarrhea. <kw>Chemical digestion</kw> of lactose fails \u2014 not because the system is broken, but because the <kw>enzyme</kw> simply is not there.',answer:1},
high:{text:'About 70% of the world\'s population cannot fully digest lactose \u2014 the sugar in milk and dairy products. This is not a disease \u2014 it is actually the normal human condition. Most people\'s bodies stop producing enough lactase after early childhood. Lactase is the specific <kw>enzyme</kw> that breaks lactose into two smaller sugars the body can absorb. Without enough of this <kw>enzyme</kw>, lactose passes through the small intestine completely undigested. When the undigested lactose reaches the large intestine, bacteria ferment it and produce gas, painful cramps, and diarrhea. <kw>Chemical digestion</kw> of lactose fails at the <kw>enzyme</kw> step \u2014 the acid and the intestine work fine, but without the right <kw>enzyme</kw>, the sugar cannot be broken down.',answer:1}
},
dataRow:{what:"Body stops making lactase enzyme",response:"Undigested lactose causes gas and cramps",connection:"Chemical digestion fails without enzyme"},
watchType:"lactose-fail"
},
{id:8,name:"The 5-Day Backup",emoji:"\uD83D\uDE16",organ:"large intestine",
predict:{q:"A kid goes almost a week without a bowel movement. What do you think is happening in the large intestine?",
opts:["The large intestine absorbs too much water","The small intestine is blocked","The stomach stopped working","The food is still being digested"]},
readings:{
low:{text:'A kid goes almost a week without a bowel movement and has painful cramps and bloating. The large intestine\'s main job is <kw>absorption</kw> \u2014 pulling water from leftover food waste. When waste moves too slowly, too much water gets absorbed and the stool turns rock-hard. Without enough fiber and water, <kw>peristalsis</kw> slows and the whole system backs up.',answer:0},
med:{text:'A kid goes almost a week without a bowel movement and suffers painful cramps and bloating. The large intestine\'s main job is <kw>absorption</kw> \u2014 it pulls water and minerals out of leftover food waste. When waste moves too slowly through the large intestine, too much water gets absorbed. The stool becomes hard, dry, and stuck \u2014 making it painful or impossible to pass. <kw>Peristalsis</kw> \u2014 the muscle squeezing that keeps things moving \u2014 slows down when the diet lacks fiber and water. The trillions of bacteria in the large intestine also need fiber to function, so the entire end of the digestive journey grinds to a halt.',answer:0},
high:{text:'A kid goes almost a week without a bowel movement, dealing with painful cramps, bloating, and nausea. The large intestine has two main jobs: <kw>absorption</kw> of water from leftover waste and housing trillions of bacteria that break down remaining fiber. When waste moves through too slowly, the large intestine keeps pulling water out long past the normal amount. The stool becomes hard, dry, and compacted \u2014 stuck in place and painful to pass. <kw>Peristalsis</kw> \u2014 the rhythmic muscle squeezing that pushes waste forward \u2014 depends on fiber to give it something to grip and push against. Without enough fiber and water in the diet, the squeezing weakens and the whole system slows to a crawl. The bacteria that normally help digest remaining material also become less active, making the backup even worse.',answer:0}
},
dataRow:{what:"Waste moves too slowly, water over-absorbed",response:"Stool hardens, peristalsis nearly stops",connection:"Absorption overdone plus peristalsis failure equals blockage"},
watchType:"backup-block"
}
];

var KEYWORDS=["mechanical digestion","chemical digestion","gastric acid","villi","peristalsis","absorption","enzyme"];
var ORGANS=[
{id:"mouth",label:"Mouth",y:10,color:"#e91e63"},
{id:"esophagus",label:"Esophagus",y:70,color:"#9C27B0"},
{id:"stomach",label:"Stomach",y:140,color:"#4CAF50"},
{id:"small-intestine",label:"Sm. Intestine",y:215,color:"#2196F3"},
{id:"large-intestine",label:"Lg. Intestine",y:290,color:"#FF9800"}
];

var state={level:'low',currentScenario:null,step:'welcome',completed:{},score:0,streak:0,predictions:0,correctPredictions:0,prediction:null,shownRequired:false,shownExtra:false,speechActive:false};
var completedCount=0;
var synth=null,resumeInterval=null;

function countCompleted(){var c=0;for(var k in state.completed){if(state.completed[k])c++;}return c;}

function init(){renderScenarioCards();renderKeywords([]);showWelcome();updateHUD();}

function startSim(){document.getElementById('rulesPanel').classList.remove('show');}

function renderScenarioCards(){
var list=document.getElementById('scenarioList');
list.innerHTML='';
for(var i=0;i<SCENARIOS.length;i++){
var s=SCENARIOS[i];
var cls='scenario-card';
if(state.completed[s.id])cls+=' completed';
if(state.currentScenario&&state.currentScenario.id===s.id)cls+=' selected';
var div=document.createElement('div');
div.className=cls;
div.innerHTML='<span class="sc-emoji">'+s.emoji+'</span><span class="sc-name">'+s.name+'</span>';
div.setAttribute('data-id',s.id);
div.onclick=(function(sc){return function(){selectScenario(sc);};})(s);
list.appendChild(div);
}
}

function renderKeywords(activeKws){
var list=document.getElementById('keywordsList');
list.innerHTML='';
for(var i=0;i<KEYWORDS.length;i++){
var kw=KEYWORDS[i];
var span=document.createElement('span');
span.className='kw-tag';
if(activeKws&&activeKws.indexOf(kw)>=0)span.className+=' highlighted';
span.textContent=kw;
list.appendChild(span);
}
}

function setLevel(l){
state.level=l;
var btns=document.querySelectorAll('.rl-btn');
for(var i=0;i<btns.length;i++){
btns[i].classList.toggle('active',btns[i].getAttribute('data-level')===l);
}
if(state.step==='read'&&state.currentScenario)showRead();
}

function updateTabs(){
var steps=['predict','read','watch','record'];
var idx=steps.indexOf(state.step);
for(var n=1;n<=4;n++){
var tab=document.getElementById('tab'+n);
tab.className='step-tab';
if(n-1===idx)tab.className+=' active';
else if(n-1<idx)tab.className+=' done';
}
}

function updateHUD(){
var done=countCompleted();
document.getElementById('hudScore').textContent=state.score;
document.getElementById('hudStreak').textContent=state.streak;
document.getElementById('hudCompleted').textContent=done+'/5';
document.getElementById('hudAccuracy').textContent=state.predictions>0?Math.round(state.correctPredictions/state.predictions*100)+'%':'-';
var pct=Math.min(done/5*100,100);
document.getElementById('progressFill').style.width=pct+'%';
if(done===0)document.getElementById('progressMsg').textContent='Pick a story to begin!';
else if(done<5)document.getElementById('progressMsg').textContent='Pick '+(5-done)+' more you like!';
else if(done<8)document.getElementById('progressMsg').textContent='Required done! '+(8-done)+' more for extra credit!';
else document.getElementById('progressMsg').textContent='All 8 complete! Extra Credit earned!';
document.getElementById('pickSub').textContent=(8-done)+' stories remaining';
}

function selectScenario(s){
if(state.step!=='welcome'&&state.step!=='record'&&state.currentScenario)return;
if(state.completed[s.id])return;
state.currentScenario=s;
state.step='predict';
state.prediction=null;
renderScenarioCards();
updateTabs();
var txt=s.readings[state.level].text.toLowerCase();
var active=[];
for(var i=0;i<KEYWORDS.length;i++){if(txt.indexOf(KEYWORDS[i])>=0)active.push(KEYWORDS[i]);}
renderKeywords(active);
showPredict();
}

function showWelcome(){
state.step='welcome';updateTabs();
document.getElementById('centerContent').innerHTML='<div class="welcome-box"><h2>The Journey Inside</h2><p>Real people swallowed impossible things, broke world records, and survived stomach acid strong enough to dissolve metal.</p><p>Now you trace what happened inside their bodies.</p><div class="mission-tag">Complete 5 real-world digestive missions</div></div>';
document.getElementById('actionArea').innerHTML='';
}

function showPredict(){
state.step='predict';updateTabs();
var s=state.currentScenario;
var optsHtml='';
for(var i=0;i<s.predict.opts.length;i++){
optsHtml+='<div class="predict-btn" data-idx="'+i+'" onclick="choosePrediction('+i+')">'+s.predict.opts[i]+'</div>';
}
document.getElementById('centerContent').innerHTML='<div class="predict-box"><h3>'+s.emoji+' '+s.name+'</h3><p>'+s.predict.q+'</p><div class="predict-options">'+optsHtml+'</div></div>';
document.getElementById('actionArea').innerHTML='<button class="action-btn primary" id="predictNext" disabled onclick="goToRead()">Next: Read the Story</button>';
}

function choosePrediction(idx){
state.prediction=idx;
var btns=document.querySelectorAll('.predict-btn');
for(var i=0;i<btns.length;i++){btns[i].classList.toggle('chosen',parseInt(btns[i].getAttribute('data-idx'))===idx);}
document.getElementById('predictNext').disabled=false;
}

function goToRead(){
if(state.prediction===null)return;
state.predictions++;
var correct=state.currentScenario.readings[state.level].answer;
if(state.prediction===correct)state.correctPredictions++;
showRead();
}

function showRead(){
state.step='read';updateTabs();
var s=state.currentScenario;
var reading=s.readings[state.level];
var html=reading.text.replace(/<kw>(.*?)<\/kw>/g,'<span class="kw-bold">$1</span>');
var txt=reading.text.toLowerCase();
var active=[];
for(var i=0;i<KEYWORDS.length;i++){if(txt.indexOf(KEYWORDS[i])>=0)active.push(KEYWORDS[i]);}
renderKeywords(active);
document.getElementById('centerContent').innerHTML='<div class="read-card"><h3>Read: '+s.name+'</h3><div class="read-scenario-name">'+s.emoji+' Reading Level: '+state.level.toUpperCase()+'</div><div class="read-passage" id="readPassage">'+html+'</div></div>';
document.getElementById('actionArea').innerHTML='<button class="action-btn speak" id="speakBtn" onclick="readAloud()">Read Aloud</button><button class="action-btn primary" onclick="goToWatch()">Next: Watch</button>';
}

function readAloud(){
try{
if(state.speechActive){stopSpeech();return;}
if(!window.speechSynthesis){document.getElementById('speakBtn').textContent='Text Only';return;}
if(!synth)synth=window.speechSynthesis;
var passage=document.getElementById('readPassage');
if(!passage)return;
var text=passage.textContent;
var utt=new SpeechSynthesisUtterance(text);
utt.rate=0.9;utt.pitch=1;
utt.onend=function(){stopSpeech();};
utt.onerror=function(){stopSpeech();};
synth.cancel();
synth.speak(utt);
state.speechActive=true;
document.getElementById('speakBtn').textContent='Stop';
resumeInterval=setInterval(function(){if(synth&&synth.speaking)synth.resume();},10000);
setTimeout(function(){if(state.speechActive)stopSpeech();},60000);
}catch(e){document.getElementById('speakBtn').textContent='Text Only';}
}

function stopSpeech(){
try{if(synth)synth.cancel();}catch(e){}
state.speechActive=false;
if(resumeInterval){clearInterval(resumeInterval);resumeInterval=null;}
var btn=document.getElementById('speakBtn');
if(btn)btn.textContent='Read Aloud';
}

function goToWatch(){
stopSpeech();state.step='watch';updateTabs();showWatch();
}

function showWatch(){
var s=state.currentScenario;
document.getElementById('centerContent').innerHTML='<div class="watch-arena" id="watchArena"></div>';
document.getElementById('actionArea').innerHTML='<button class="action-btn primary" id="watchNextBtn" disabled onclick="goToRecord()">Recording data...</button>';
buildDigestiveTract();
runAnimation(s);
setTimeout(function(){
var btn=document.getElementById('watchNextBtn');
if(btn&&btn.disabled){btn.disabled=false;btn.textContent='Next: Record';}
},8000);
}

function buildDigestiveTract(){
var arena=document.getElementById('watchArena');
if(!arena)return;
var html='<div class="digestive-tract">';
for(var i=0;i<ORGANS.length;i++){
var o=ORGANS[i];
html+='<div class="organ-station" id="organ-'+o.id+'" style="top:'+o.y+'px;"><div class="organ-shape" style="background:'+o.color+';box-shadow:0 0 8px '+o.color+'40;"></div><div class="organ-label">'+o.label+'</div></div>';
if(i<ORGANS.length-1){
html+='<div class="flow-arrow" id="arrow-'+i+'" style="top:'+(o.y+45)+'px;">\u25BC</div>';
}
}
html+='</div>';
html+='<div class="ok-gauge"><div class="ok-zone"></div><div class="ok-zone-label">OK</div><div class="gauge-needle ok" id="gaugeNeedle" style="top:45%;"></div></div>';
html+='<div class="watch-label" id="watchLabel"></div>';
arena.innerHTML=html;
}

function showWatchLabel(text,delay){
setTimeout(function(){var lbl=document.getElementById('watchLabel');if(lbl){lbl.textContent=text;lbl.classList.add('show');}},delay);
}

function activateOrgan(organId,damaged,delay){
setTimeout(function(){
var el=document.getElementById('organ-'+organId);
if(el){el.classList.add('active');if(damaged)el.classList.add('damaged');}
},delay);
}

function stopArrows(indices,delay){
setTimeout(function(){
for(var i=0;i<indices.length;i++){
var a=document.getElementById('arrow-'+indices[i]);
if(a)a.classList.add('stopped');
}
},delay);
}

function moveNeedle(pct,warning,delay){
setTimeout(function(){
var needle=document.getElementById('gaugeNeedle');
if(!needle)return;
needle.style.top=pct+'%';
needle.className='gauge-needle '+(warning?'warning':'ok');
},delay);
}

function addParticle(x,y,size,color,delay){
setTimeout(function(){
var arena=document.getElementById('watchArena');
if(!arena)return;
var p=document.createElement('div');
p.className='anim-particle';
p.style.cssText='left:'+x+'px;top:'+y+'px;width:'+size+'px;height:'+size+'px;background:'+color+';opacity:0.8;';
arena.appendChild(p);
setTimeout(function(){p.style.opacity='0';p.style.transform='scale(2)';},100);
setTimeout(function(){try{arena.removeChild(p);}catch(e){}},2000);
},delay);
}

function addIcon(emoji,x,y,delay,endX,endY,dur){
dur=dur||1500;
setTimeout(function(){
var arena=document.getElementById('watchArena');
if(!arena)return;
var el=document.createElement('div');
el.className='anim-icon';
el.style.cssText='left:'+x+'px;top:'+y+'px;font-size:24px;transition:all '+dur+'ms ease-in-out;';
el.textContent=emoji;
arena.appendChild(el);
if(endX!==undefined&&endX!==null)setTimeout(function(){el.style.left=endX+'px';},50);
if(endY!==undefined&&endY!==null)setTimeout(function(){el.style.top=endY+'px';},50);
},delay);
}

function addLabel(text,x,y,delay){
setTimeout(function(){
var arena=document.getElementById('watchArena');
if(!arena)return;
var el=document.createElement('div');
el.className='anim-label';
el.style.cssText='left:'+x+'px;top:'+y+'px;color:#ffd54f;';
el.textContent=text;
arena.appendChild(el);
setTimeout(function(){el.classList.add('show');},50);
},delay);
}

function enableWatchNext(delay){
setTimeout(function(){
var btn=document.getElementById('watchNextBtn');
if(btn){btn.disabled=false;btn.textContent='Next: Record';}
},delay);
}

function runAnimation(s){
switch(s.watchType){
case 'stomach-overload':
activateOrgan('stomach',false,500);
showWatchLabel('Stomach stretches...',500);
for(var i=0;i<12;i++){addIcon('\uD83C\uDF2D',200+Math.random()*100,20,800+i*200,220+Math.random()*60,140+Math.random()*40,1200);}
setTimeout(function(){
var st=document.getElementById('organ-stomach');
if(st){var shape=st.querySelector('.organ-shape');if(shape){shape.style.width='100px';shape.style.height='65px';shape.style.borderRadius='40%';}}
},2000);
stopArrows([0,1,2,3],2500);
showWatchLabel('Peristalsis STOPPED!',2500);
activateOrgan('stomach',true,3000);
moveNeedle(75,true,3000);
addLabel('OVERWHELMED',170,180,3500);
enableWatchNext(5500);
break;

case 'magnets-tear':
activateOrgan('small-intestine',false,300);
showWatchLabel('Magnets travel through intestine...',300);
for(var i=0;i<6;i++){addIcon('\uD83E\uDDF2',180+Math.random()*80,80+i*15,500+i*300,200+Math.random()*40,200+Math.random()*30,1500);}
showWatchLabel('Magnets attract through walls!',2500);
for(var i=0;i<8;i++){addParticle(210+Math.random()*60,200+Math.random()*40,8,'#f44336',3000+i*150);}
activateOrgan('small-intestine',true,3000);
moveNeedle(80,true,3200);
addLabel('HOLES TORN',180,230,3500);
showWatchLabel('Absorption destroyed!',4000);
enableWatchNext(5500);
break;

case 'razor-dissolve':
activateOrgan('stomach',false,300);
showWatchLabel('Razor blade dropped into gastric acid...',300);
setTimeout(function(){
var arena=document.getElementById('watchArena');
if(!arena)return;
var blade=document.createElement('div');
blade.className='anim-icon';
blade.id='razorBlade';
blade.style.cssText='left:220px;top:130px;font-size:32px;transition:all 2s;';
blade.textContent='\uD83D\uDD2A';
arena.appendChild(blade);
},500);
for(var i=0;i<10;i++){addParticle(200+Math.random()*80,120+Math.random()*50,6,'#4CAF50',1000+i*200);}
setTimeout(function(){var b=document.getElementById('razorBlade');if(b){b.style.fontSize='20px';b.style.opacity='0.5';}},2000);
setTimeout(function(){var b=document.getElementById('razorBlade');if(b){b.style.fontSize='10px';b.style.opacity='0.2';}},3500);
showWatchLabel('Acid dissolves 37% of the blade!',2000);
addLabel('Mucus Shield',160,165,3000);
setTimeout(function(){
var st=document.getElementById('organ-stomach');
if(st){var shape=st.querySelector('.organ-shape');if(shape)shape.style.boxShadow='0 0 20px #4CAF50, inset 0 0 10px rgba(76,175,80,.3)';}
},3000);
moveNeedle(45,false,3500);
showWatchLabel('System PROTECTED!',4000);
enableWatchNext(5500);
break;

case 'villi-attack':
activateOrgan('small-intestine',false,300);
showWatchLabel('Villi line the small intestine...',300);
setTimeout(function(){
var arena=document.getElementById('watchArena');
if(!arena)return;
for(var i=0;i<8;i++){
var v=document.createElement('div');
v.className='anim-particle';
v.id='villi'+i;
v.style.cssText='left:'+(185+i*15)+'px;top:215px;width:6px;height:20px;background:#2196F3;border-radius:3px 3px 0 0;transition:all 1.5s;';
arena.appendChild(v);
}
},500);
setTimeout(function(){
showWatchLabel('Immune system ATTACKS villi!',0);
for(var i=0;i<8;i++){addParticle(185+i*15,210,5,'#f44336',i*100);}
},2000);
setTimeout(function(){
for(var i=0;i<8;i++){var v=document.getElementById('villi'+i);if(v){v.style.height='4px';v.style.background='#666';}}
},3000);
activateOrgan('small-intestine',true,3000);
moveNeedle(78,true,3200);
for(var i=0;i<5;i++){addIcon('\u26AA',190+i*12,200,3500+i*200,190+i*12,280,1500);}
addLabel('NO ABSORPTION',170,250,4000);
showWatchLabel('Nutrients pass through!',4000);
enableWatchNext(5500);
break;

case 'acid-reflux':
activateOrgan('esophagus',false,300);
activateOrgan('stomach',false,300);
showWatchLabel('Valve between esophagus and stomach...',300);
addLabel('Valve',195,105,500);
showWatchLabel('Valve FAILS!',1500);
setTimeout(function(){
var arena=document.getElementById('watchArena');
if(!arena)return;
for(var i=0;i<8;i++){
var p=document.createElement('div');
p.className='anim-particle';
p.style.cssText='left:'+(215+Math.random()*20)+'px;top:'+(140-i*3)+'px;width:5px;height:5px;background:#4CAF50;border-radius:50%;transition:all 1.5s;opacity:0.8;';
arena.appendChild(p);
(function(el,idx){
setTimeout(function(){el.style.top=(70+Math.random()*20)+'px';},1800+idx*150);
})(p,i);
}
},800);
setTimeout(function(){
for(var i=0;i<6;i++){addParticle(210+Math.random()*30,65+Math.random()*30,6,'#f44336',i*100);}
},3000);
activateOrgan('esophagus',true,3000);
moveNeedle(75,true,3200);
addLabel('NO PROTECTION',165,60,3500);
addLabel('Protected',165,170,3500);
showWatchLabel('Esophagus burns!',3500);
enableWatchNext(5500);
break;

case 'penny-journey':
showWatchLabel('Penny enters the digestive tract...',300);
setTimeout(function(){
var arena=document.getElementById('watchArena');
if(!arena)return;
var penny=document.createElement('div');
penny.className='anim-icon';
penny.id='pennyIcon';
penny.style.cssText='left:220px;top:10px;font-size:28px;transition:all 1s ease-in-out;';
penny.textContent='\uD83E\uDE99';
arena.appendChild(penny);
},200);
var delays=[500,1500,2500,3500,4500];
for(var i=0;i<ORGANS.length;i++){
(function(idx){
setTimeout(function(){
var penny=document.getElementById('pennyIcon');
if(penny)penny.style.top=(ORGANS[idx].y+5)+'px';
activateOrgan(ORGANS[idx].id,false,0);
if(ORGANS[idx].id==='stomach'){
addLabel('No Effect!',260,145,500);
for(var j=0;j<4;j++){addParticle(230+Math.random()*30,135+Math.random()*20,4,'#4CAF50',200+j*100);}
}
},delays[idx]);
})(i);
}
moveNeedle(45,false,1000);
showWatchLabel('Peristalsis pushes penny through!',2500);
addLabel('Full Path',260,290,5000);
showWatchLabel('System works!',5000);
enableWatchNext(6000);
break;

case 'lactose-fail':
activateOrgan('small-intestine',false,300);
showWatchLabel('Lactose enters the small intestine...',300);
for(var i=0;i<5;i++){addIcon('\u26AA',195+i*10,180,500+i*200,195+i*10,220,1500);}
addLabel('Low Lactase',260,210,1500);
showWatchLabel('Not enough enzyme!',2000);
for(var i=0;i<5;i++){addIcon('\u26AA',195+i*10,220,2500+i*200,200+i*8,290,1500);}
activateOrgan('large-intestine',false,3000);
setTimeout(function(){
var arena=document.getElementById('watchArena');
if(!arena)return;
for(var i=0;i<10;i++){
var b=document.createElement('div');
b.className='anim-particle';
b.style.cssText='left:'+(200+Math.random()*60)+'px;top:'+(280+Math.random()*30)+'px;width:'+(6+Math.random()*6)+'px;height:'+(6+Math.random()*6)+'px;background:rgba(255,152,0,.6);border-radius:50%;transition:all 1s;';
arena.appendChild(b);
(function(el){setTimeout(function(){el.style.top=(260-Math.random()*40)+'px';el.style.opacity='0';},200);})(b);
}
},3500);
activateOrgan('large-intestine',true,3800);
moveNeedle(72,true,3800);
addLabel('GAS + CRAMPS',170,305,4000);
showWatchLabel('Chemical digestion failed!',4000);
enableWatchNext(5500);
break;

case 'backup-block':
activateOrgan('large-intestine',false,300);
showWatchLabel('Waste moves through large intestine...',300);
setTimeout(function(){
var arena=document.getElementById('watchArena');
if(!arena)return;
var waste=document.createElement('div');
waste.className='anim-icon';
waste.id='wasteIcon';
waste.style.cssText='left:220px;top:230px;font-size:20px;transition:all 3s;';
waste.textContent='\uD83D\uDFE4';
arena.appendChild(waste);
setTimeout(function(){waste.style.top='280px';},200);
},500);
for(var i=0;i<8;i++){
(function(idx){
setTimeout(function(){
var arena=document.getElementById('watchArena');
if(!arena)return;
var drop=document.createElement('div');
drop.className='anim-particle';
drop.style.cssText='left:'+(240+Math.random()*20)+'px;top:'+(270+Math.random()*20)+'px;width:4px;height:4px;background:#42A5F5;border-radius:50%;transition:all 1s;';
arena.appendChild(drop);
setTimeout(function(){drop.style.left=(280+Math.random()*30)+'px';drop.style.opacity='0';},100);
},1000+idx*300);
})(i);
}
showWatchLabel('Too much water absorbed!',2500);
setTimeout(function(){var w=document.getElementById('wasteIcon');if(w){w.textContent='\u2B1B';w.style.fontSize='24px';}},3000);
stopArrows([2,3],3000);
activateOrgan('large-intestine',true,3200);
moveNeedle(78,true,3200);
addLabel('STUCK',230,285,3500);
addLabel('Low Fiber',165,305,3500);
showWatchLabel('Peristalsis fails!',4000);
enableWatchNext(5500);
break;
}
}

function goToRecord(){
state.step='record';updateTabs();
var s=state.currentScenario;
state.completed[s.id]=true;
state.score+=100+state.streak*10;
state.streak++;
var tbody=document.getElementById('dataBody');
var tr=document.createElement('tr');
tr.className='new-row';
tr.innerHTML='<td>'+s.emoji+' '+s.name+'</td><td>'+s.dataRow.what+'</td><td>'+s.dataRow.response+'</td><td>'+s.dataRow.connection+'</td>';
tbody.appendChild(tr);
updateHUD();
renderScenarioCards();
var done=countCompleted();
var msg='';
if(done<5)msg=(5-done)+' more to go!';
else if(done===5)msg='Required complete! Keep going for extra credit!';
else if(done<8)msg=(8-done)+' more for extra credit!';
else msg='All 8 complete! Extra Credit earned!';
document.getElementById('centerContent').innerHTML='<div class="record-box"><div class="record-check">\u2705</div><h3>Data Recorded!</h3><p>'+s.emoji+' '+s.name+' \u2014 Complete</p><p style="margin-top:12px;color:#ffd54f;font-size:14px;">'+msg+'</p></div>';
if(done===5&&!state.shownRequired){state.shownRequired=true;setTimeout(function(){showCompletion('required');},1000);}
else if(done===8&&!state.shownExtra){state.shownExtra=true;setTimeout(function(){showCompletion('extra');},1000);}
document.getElementById('actionArea').innerHTML=done<8?'<button class="action-btn primary" onclick="pickNext()">Pick Next Story</button>':'<button class="action-btn primary" onclick="pickNext()">View Your Data</button>';
}

function pickNext(){
state.currentScenario=null;state.step='welcome';updateTabs();
renderScenarioCards();renderKeywords([]);
var done=countCompleted();
if(done>=8){
document.getElementById('centerContent').innerHTML='<div class="welcome-box"><h2>All 8 Complete!</h2><p>Extra Credit Earned! Copy your data table and fill in your worksheet.</p><div class="mission-tag">Mission Complete</div></div>';
}else{showWelcome();}
document.getElementById('actionArea').innerHTML='';
}

function showCompletion(type){
var ov=document.getElementById('completionOverlay');
var cc=document.getElementById('completionContent');
if(type==='required'){
cc.innerHTML='<div class="big-emoji">\uD83C\uDF89</div><h2>Required Complete!</h2><p>You finished 5 stories. Nice work!</p><div class="badge required">5/5 Required</div><p style="margin-top:16px;">Continue for Extra Credit!</p><button class="action-btn primary" style="margin-top:20px;" onclick="document.getElementById(\'completionOverlay\').classList.remove(\'show\')">Keep Going</button>';
}else{
cc.innerHTML='<div class="big-emoji">\uD83C\uDFC6</div><h2>Extra Credit Complete!</h2><p>All 8 stories finished!</p><div class="badge extra">8/8 Extra Credit</div><p style="margin-top:16px;">Copy your data table and fill in your worksheet.</p><button class="action-btn primary" style="margin-top:20px;" onclick="document.getElementById(\'completionOverlay\').classList.remove(\'show\')">View Data</button>';
}
ov.classList.add('show');
}

function copyTable(){
try{
var rows=document.querySelectorAll('#dataBody tr');
if(rows.length===0){alert('No data recorded yet!');return;}
var text='Scenario\tWhat Happened?\tPerson/Situation Response\tConnection to Digestion?\n';
for(var r=0;r<rows.length;r++){
var cells=rows[r].querySelectorAll('td');
var line=[];
for(var c=0;c<cells.length;c++){line.push(cells[c].textContent.trim());}
text+=line.join('\t')+'\n';
}
if(navigator.clipboard&&navigator.clipboard.writeText){
navigator.clipboard.writeText(text).then(function(){
var btn=document.getElementById('copyBtn');
btn.textContent='Copied!';btn.classList.add('copied');
setTimeout(function(){btn.textContent='\uD83D\uDCCB Copy Table';btn.classList.remove('copied');},2000);
});
}else{
var ta=document.createElement('textarea');
ta.value=text;document.body.appendChild(ta);ta.select();
try{document.execCommand('copy');var btn=document.getElementById('copyBtn');btn.textContent='Copied!';setTimeout(function(){btn.textContent='\uD83D\uDCCB Copy Table';},2000);}catch(e2){}
document.body.removeChild(ta);
}
}catch(e){alert('Could not copy. Please copy the table manually.');}
}

function resetSim(){
state={level:state.level,currentScenario:null,step:'welcome',completed:{},score:0,streak:0,predictions:0,correctPredictions:0,prediction:null,shownRequired:false,shownExtra:false,speechActive:false};
document.getElementById('dataBody').innerHTML='';
updateHUD();renderScenarioCards();renderKeywords([]);showWelcome();
}

function newRun(){resetSim();}

init();
</script>
</body>
</html>
