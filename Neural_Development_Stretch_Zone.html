<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mr. Jawad Simulation: Brain Development - The Stretch Zone</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',system-ui,sans-serif;background:linear-gradient(135deg,#0a0a2e 0%,#1a1a4e 50%,#0d0d3d 100%);color:#fff;min-height:100vh;overflow-x:hidden}
.game-container{display:grid;grid-template-columns:280px 1fr 280px;grid-template-rows:28px 1fr;gap:10px;padding:10px;max-width:1400px;margin:0 auto;height:100vh;max-height:100vh}
.title-bar{grid-column:1/-1;text-align:center;padding:2px 8px;background:linear-gradient(135deg,#667eea,#764ba2);border-radius:6px;box-shadow:0 2px 12px rgba(102,126,234,.4);display:flex;align-items:center;justify-content:center;gap:8px;min-height:0}
.title-bar h1{font-size:.8rem;font-weight:700;letter-spacing:1px}
.title-bar .sub{font-size:.7rem;opacity:.8}

/* LEFT PANEL */
.left-panel{display:flex;flex-direction:column;gap:6px;overflow-y:auto}
.panel-section{background:rgba(255,255,255,.06);border-radius:10px;padding:10px;backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.1)}
.panel-section h3{font-size:.8rem;text-transform:uppercase;letter-spacing:1.5px;color:#aab;margin-bottom:8px}
.scenario-card{background:linear-gradient(135deg,rgba(255,255,255,.08),rgba(255,255,255,.03));border:2px solid rgba(255,255,255,.12);border-radius:10px;padding:10px;margin-bottom:6px;cursor:pointer;transition:all .3s;position:relative;overflow:hidden}
.scenario-card:hover{border-color:rgba(255,255,255,.3);transform:translateX(4px)}
.scenario-card.selected{border-color:#ffd700;box-shadow:0 0 15px rgba(255,215,0,.3)}
.scenario-card .card-emoji{font-size:1.4rem;margin-right:6px}
.scenario-card .card-text{font-size:.82rem;line-height:1.3}
.scenario-card .card-label{display:block;font-size:.65rem;color:#aab;margin-top:3px;text-transform:uppercase;letter-spacing:1px}

.support-btns{display:flex;gap:6px;flex-wrap:wrap}
.support-btn{flex:1;min-width:70px;padding:8px 4px;border:2px solid rgba(255,255,255,.15);border-radius:8px;background:rgba(255,255,255,.05);color:#fff;cursor:pointer;font-size:.75rem;text-align:center;transition:all .3s}
.support-btn:hover{background:rgba(255,255,255,.12)}
.support-btn.active{border-color:#ffd700;background:rgba(255,215,0,.15);box-shadow:0 0 10px rgba(255,215,0,.2)}

.go-btn{width:100%;padding:14px;border:none;border-radius:10px;font-size:1rem;font-weight:700;cursor:pointer;transition:all .3s;text-transform:uppercase;letter-spacing:2px}
.go-btn.ready{background:linear-gradient(135deg,#00c853,#69f0ae);color:#1a1a2e;box-shadow:0 4px 20px rgba(0,200,83,.4)}
.go-btn.ready:hover{transform:translateY(-2px);box-shadow:0 6px 25px rgba(0,200,83,.5)}
.go-btn.disabled{background:rgba(255,255,255,.1);color:rgba(255,255,255,.3);cursor:not-allowed}

/* CENTER PANEL - BRAIN ARENA */
.center-panel{display:flex;flex-direction:column;gap:6px;min-height:0}
.arena-container{flex:1;background:radial-gradient(ellipse at center,#1a1a4e 0%,#0a0a2e 70%);border-radius:16px;position:relative;overflow:hidden;border:1px solid rgba(255,255,255,.08);min-height:300px}
.brain-svg-container{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:85%;height:90%}
.zone-label{position:absolute;top:12px;left:50%;transform:translateX(-50%);font-size:1.6rem;font-weight:800;letter-spacing:3px;text-transform:uppercase;opacity:0;transition:all .8s;text-shadow:0 0 30px currentColor}
.zone-label.visible{opacity:1}
.zone-label.comfort{color:#4caf50}
.zone-label.stretch{color:#ffd700}
.zone-label.panic{color:#f44336}

/* Particles */
.particle{position:absolute;border-radius:50%;pointer-events:none;animation:particleFloat 2s ease-out forwards}
@keyframes particleFloat{0%{opacity:1;transform:translate(0,0) scale(1)}100%{opacity:0;transform:translate(var(--tx),var(--ty)) scale(0)}}

/* Growth rings */
.growth-ring{position:absolute;top:50%;left:50%;border-radius:50%;border:2px solid rgba(255,215,0,.6);transform:translate(-50%,-50%) scale(0);animation:ringExpand 1.5s ease-out forwards;pointer-events:none}
@keyframes ringExpand{0%{transform:translate(-50%,-50%) scale(0);opacity:1}100%{transform:translate(-50%,-50%) scale(3);opacity:0}}

/* Floating symbols */
.float-symbol{position:absolute;font-size:1.8rem;animation:floatUp 2s ease-out forwards;pointer-events:none}
@keyframes floatUp{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-80px) scale(1.5)}}

/* Shake */
@keyframes brainShake{0%,100%{transform:translate(-50%,-50%)}10%,30%,50%,70%,90%{transform:translate(calc(-50% + 4px),-50%)}20%,40%,60%,80%{transform:translate(calc(-50% - 4px),-50%)}}

/* Challenge Meter */
.challenge-meter{height:36px;background:rgba(0,0,0,.3);border-radius:8px;position:relative;overflow:hidden;border:1px solid rgba(255,255,255,.1)}
.meter-zones{display:flex;height:100%;position:relative}
.meter-zone{flex:1;display:flex;align-items:center;justify-content:center;font-size:.7rem;font-weight:700;letter-spacing:1px;text-transform:uppercase;position:relative}
.meter-zone.comfort-zone{background:linear-gradient(135deg,rgba(76,175,80,.25),rgba(76,175,80,.15))}
.meter-zone.stretch-zone{background:linear-gradient(135deg,rgba(255,215,0,.25),rgba(255,215,0,.15))}
.meter-zone.panic-zone{background:linear-gradient(135deg,rgba(244,67,54,.25),rgba(244,67,54,.15))}
.meter-indicator{position:absolute;top:2px;bottom:2px;width:6px;background:#fff;border-radius:3px;transition:left 1s cubic-bezier(.34,1.56,.64,1);box-shadow:0 0 15px rgba(255,255,255,.8);z-index:5}

/* RIGHT PANEL */
.right-panel{display:flex;flex-direction:column;gap:6px;overflow-y:auto}
.hud-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px}
.hud-item{background:rgba(255,255,255,.06);border-radius:8px;padding:8px;text-align:center;border:1px solid rgba(255,255,255,.08)}
.hud-item .hud-val{font-size:1.4rem;font-weight:800;background:linear-gradient(135deg,#ffd700,#ffab00);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hud-item .hud-label{font-size:.6rem;text-transform:uppercase;letter-spacing:1px;color:#aab;margin-top:2px}
.progress-bar{height:8px;background:rgba(255,255,255,.1);border-radius:4px;overflow:hidden}
.progress-fill{height:100%;background:linear-gradient(90deg,#667eea,#764ba2);border-radius:4px;transition:width .5s}
.status-msg{text-align:center;font-size:.8rem;color:#aab;padding:4px}
.boost-indicator{text-align:center;padding:6px;border-radius:8px;font-size:.75rem;font-weight:700;transition:all .3s}
.boost-indicator.active{background:linear-gradient(135deg,rgba(255,215,0,.2),rgba(255,171,0,.2));border:1px solid rgba(255,215,0,.3);color:#ffd700}
.boost-indicator.inactive{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.05);color:#667}

/* Data Table */
.data-table-wrap{flex:1;overflow-y:auto;min-height:0}
.copy-btn{width:100%;padding:6px;border:1px solid rgba(102,126,234,.4);border-radius:6px;background:rgba(102,126,234,.15);color:#99b;cursor:pointer;font-size:.7rem;margin-bottom:4px;transition:all .3s}
.copy-btn:hover{background:rgba(102,126,234,.3);color:#fff}
.copy-btn.copied{background:rgba(0,200,83,.2);border-color:rgba(0,200,83,.4);color:#69f0ae}
table.data-tbl{width:100%;border-collapse:collapse;font-size:.7rem}
table.data-tbl th{background:rgba(102,126,234,.2);padding:5px 4px;text-align:center;font-size:.6rem;text-transform:uppercase;letter-spacing:.5px;border-bottom:1px solid rgba(255,255,255,.1)}
table.data-tbl td{padding:4px;text-align:center;border-bottom:1px solid rgba(255,255,255,.05)}
table.data-tbl tr:nth-child(even){background:rgba(255,255,255,.02)}

.action-btns{display:flex;gap:6px;margin-top:auto}
.action-btns button{flex:1;padding:8px;border:none;border-radius:8px;font-size:.7rem;font-weight:600;cursor:pointer;transition:all .3s;text-transform:uppercase;letter-spacing:1px}
.btn-reset{background:linear-gradient(135deg,#ef5350,#e53935);color:#fff}
.btn-new{background:linear-gradient(135deg,#42a5f5,#1e88e5);color:#fff}
.btn-reset:hover,.btn-new:hover{transform:translateY(-1px);filter:brightness(1.1)}

/* Distraction overlay */
.distraction-overlay{position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.7);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:20;opacity:0;pointer-events:none;transition:opacity .3s}
.distraction-overlay.active{opacity:1;pointer-events:all}
.distraction-overlay .dist-icon{font-size:4rem;animation:distractPulse 0.5s ease-in-out infinite alternate}
@keyframes distractPulse{0%{transform:scale(1)}100%{transform:scale(1.2)}}
.distraction-overlay .dist-text{font-size:1rem;margin:10px 0;font-weight:700;color:#ff9800}
.distraction-overlay button{padding:12px 30px;border:none;border-radius:8px;background:linear-gradient(135deg,#ff9800,#f57c00);color:#fff;font-size:.9rem;font-weight:700;cursor:pointer}

/* Completion overlay */
.completion-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:100;opacity:0;pointer-events:none;transition:opacity .5s}
.completion-overlay.active{opacity:1;pointer-events:all}
.completion-card{background:linear-gradient(135deg,#1a1a4e,#2a2a6e);border-radius:20px;padding:40px;text-align:center;max-width:500px;border:2px solid rgba(255,215,0,.3);box-shadow:0 0 60px rgba(102,126,234,.3)}
.completion-card h2{font-size:2rem;margin-bottom:10px}
.completion-card .badge{font-size:4rem;margin:15px 0}
.completion-card p{color:#aab;margin:8px 0;font-size:.95rem}
.completion-card button{margin-top:15px;padding:12px 30px;border:none;border-radius:10px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;font-size:1rem;cursor:pointer;font-weight:700}

/* Round transition */
.round-banner{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);font-size:2.5rem;font-weight:900;color:#fff;text-shadow:0 0 40px rgba(102,126,234,.8);z-index:15;opacity:0;transition:all .5s;pointer-events:none}
.round-banner.show{transform:translate(-50%,-50%) scale(1);opacity:1}

/* Ambient stars */
.star{position:absolute;background:#fff;border-radius:50%;animation:twinkle var(--dur) ease-in-out infinite alternate}
@keyframes twinkle{0%{opacity:.2;transform:scale(.8)}100%{opacity:.8;transform:scale(1.2)}}

/* Neural pathway glow */
@keyframes neuronFire{0%{stroke-dashoffset:100;opacity:0}20%{opacity:1}80%{opacity:1}100%{stroke-dashoffset:0;opacity:0}}
@keyframes pulseGlow{0%,100%{filter:drop-shadow(0 0 3px currentColor)}50%{filter:drop-shadow(0 0 12px currentColor)}}
@keyframes dendGrow{0%{stroke-dashoffset:50;opacity:0}50%{opacity:1}100%{stroke-dashoffset:0;opacity:1}}

/* Responsive */
@media(max-width:1100px){.game-container{grid-template-columns:240px 1fr 240px;gap:8px;padding:8px}}
@media(max-width:900px){.game-container{grid-template-columns:1fr;grid-template-rows:auto 400px auto;height:auto}}
</style>
</head>
<body>
<div class="game-container">
<div class="title-bar">
<h1>Mr. Jawad Simulation: Brain Development</h1>
<div class="sub">‚Äî The Stretch Zone</div>
</div>

<!-- LEFT PANEL -->
<div class="left-panel">
<div class="panel-section">
<h3>Round <span id="roundNum">1</span> of 8</h3>
<div id="missionLine" style="font-size:.75rem;color:#ccd;margin-bottom:8px">Pick a challenge</div>
<div id="scenarioCards"></div>
</div>
<div class="panel-section">
<h3>Support Level</h3>
<div class="support-btns">
<button class="support-btn" data-help="none" onclick="selectHelp('none')">üí™ No Help</button>
<button class="support-btn" data-help="some" onclick="selectHelp('some')">üí° Some</button>
<button class="support-btn" data-help="full" onclick="selectHelp('full')">ü§ù Full</button>
</div>
</div>
<div class="panel-section" style="padding:8px">
<button id="goBtn" class="go-btn disabled" onclick="executeRound()" disabled>Pick a Card</button>
</div>
</div>

<!-- CENTER PANEL -->
<div class="center-panel">
<div class="arena-container" id="arena">
<!-- Ambient stars injected by JS -->
<div class="zone-label" id="zoneLabel"></div>
<div id="roundBanner" class="round-banner"></div>
<svg id="brainSvg" class="brain-svg-container" viewBox="0 0 400 350" xmlns="http://www.w3.org/2000/svg">
<!-- Brain base -->
<defs>
<radialGradient id="brainGrad" cx="50%" cy="50%" r="50%">
<stop offset="0%" style="stop-color:#e8b4d8;stop-opacity:1"/>
<stop offset="70%" style="stop-color:#c77dba;stop-opacity:1"/>
<stop offset="100%" style="stop-color:#9c5090;stop-opacity:1"/>
</radialGradient>
<radialGradient id="brainGlowGrad" cx="50%" cy="50%" r="55%">
<stop offset="0%" style="stop-color:rgba(255,255,255,0.15);stop-opacity:1"/>
<stop offset="100%" style="stop-color:rgba(255,255,255,0);stop-opacity:1"/>
</radialGradient>
<filter id="brainShadow"><feDropShadow dx="0" dy="4" stdDeviation="8" flood-color="rgba(0,0,0,.5)"/></filter>
<filter id="glow"><feGaussianBlur stdDeviation="3" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
<filter id="bigGlow"><feGaussianBlur stdDeviation="6" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
</defs>
<!-- Brain outer glow (animated) -->
<ellipse id="brainAura" cx="200" cy="170" rx="145" ry="125" fill="none" stroke="rgba(200,150,220,.15)" stroke-width="20" filter="url(#bigGlow)" style="transition:all 1s"/>
<!-- Left hemisphere -->
<path id="leftHemi" d="M200,60 C140,60 80,90 65,140 C50,190 55,240 80,270 C105,300 150,310 200,300" fill="url(#brainGrad)" stroke="#a0609a" stroke-width="2" filter="url(#brainShadow)" style="transition:all .8s"/>
<!-- Right hemisphere -->
<path id="rightHemi" d="M200,60 C260,60 320,90 335,140 C350,190 345,240 320,270 C295,300 250,310 200,300" fill="url(#brainGrad)" stroke="#a0609a" stroke-width="2" filter="url(#brainShadow)" style="transition:all .8s"/>
<!-- Brain folds / sulci -->
<g id="brainFolds" stroke="#9a5090" stroke-width="1.5" fill="none" opacity="0.6" style="transition:all .8s">
<path d="M130,130 Q160,110 190,130"/>
<path d="M120,160 Q155,140 195,155"/>
<path d="M110,190 Q145,175 190,185"/>
<path d="M125,220 Q160,205 195,215"/>
<path d="M140,248 Q170,235 195,242"/>
<path d="M210,130 Q240,110 270,130"/>
<path d="M205,155 Q245,140 280,160"/>
<path d="M210,185 Q250,175 290,190"/>
<path d="M205,215 Q240,205 275,220"/>
<path d="M205,242 Q230,235 260,248"/>
</g>
<!-- Central fissure -->
<line x1="200" y1="55" x2="200" y2="305" stroke="#7a4075" stroke-width="2.5" opacity=".5"/>
<!-- Brain stem -->
<path d="M185,295 Q200,340 215,295" fill="#b0709a" stroke="#9a5090" stroke-width="1.5"/>
<!-- Neural pathway network (initially dim) -->
<g id="neuralNet" opacity="0.15" style="transition:opacity 1s">
<!-- Left pathways -->
<path class="neural-path" d="M120,140 L160,120 L190,140 L170,170" stroke="#ffeb3b" stroke-width="1.5" fill="none" stroke-dasharray="4,4"/>
<path class="neural-path" d="M100,180 L140,165 L180,180 L160,210" stroke="#ffeb3b" stroke-width="1.5" fill="none" stroke-dasharray="4,4"/>
<path class="neural-path" d="M130,230 L165,215 L190,230" stroke="#ffeb3b" stroke-width="1.5" fill="none" stroke-dasharray="4,4"/>
<!-- Right pathways -->
<path class="neural-path" d="M280,140 L240,120 L210,140 L230,170" stroke="#ffeb3b" stroke-width="1.5" fill="none" stroke-dasharray="4,4"/>
<path class="neural-path" d="M300,180 L260,165 L220,180 L240,210" stroke="#ffeb3b" stroke-width="1.5" fill="none" stroke-dasharray="4,4"/>
<path class="neural-path" d="M270,230 L235,215 L210,230" stroke="#ffeb3b" stroke-width="1.5" fill="none" stroke-dasharray="4,4"/>
<!-- Cross connections -->
<path class="neural-path" d="M160,120 L240,120" stroke="#ffd700" stroke-width="1" fill="none" stroke-dasharray="3,5"/>
<path class="neural-path" d="M140,165 L260,165" stroke="#ffd700" stroke-width="1" fill="none" stroke-dasharray="3,5"/>
<path class="neural-path" d="M165,215 L235,215" stroke="#ffd700" stroke-width="1" fill="none" stroke-dasharray="3,5"/>
</g>
<!-- Neuron dots (synapses) -->
<g id="neuronDots" opacity="0.2" style="transition:opacity 1s">
<circle cx="160" cy="120" r="4" fill="#ffeb3b"/><circle cx="190" cy="140" r="4" fill="#ffeb3b"/>
<circle cx="140" cy="165" r="4" fill="#ffeb3b"/><circle cx="180" cy="180" r="4" fill="#ffeb3b"/>
<circle cx="165" cy="215" r="4" fill="#ffeb3b"/><circle cx="240" cy="120" r="4" fill="#ffeb3b"/>
<circle cx="210" cy="140" r="4" fill="#ffeb3b"/><circle cx="260" cy="165" r="4" fill="#ffeb3b"/>
<circle cx="220" cy="180" r="4" fill="#ffeb3b"/><circle cx="235" cy="215" r="4" fill="#ffeb3b"/>
<circle cx="200" cy="100" r="3" fill="#ffd700"/><circle cx="170" cy="170" r="3" fill="#ffd700"/>
<circle cx="230" cy="170" r="3" fill="#ffd700"/>
</g>
<!-- Traveling signals (hidden initially) -->
<g id="travelSignals"></g>
<!-- New dendrite growth (hidden initially) -->
<g id="newDendrites"></g>
<!-- Region labels -->
<g id="regionLabels" font-size="12" fill="rgba(255,255,255,.65)" text-anchor="middle" font-weight="700">
<text x="140" y="105">Frontal</text>
<text x="260" y="105">Parietal</text>
<text x="110" y="200">Temporal</text>
<text x="290" y="200">Occipital</text>
</g>
</svg>
<!-- Distraction overlay -->
<div class="distraction-overlay" id="distractionOverlay">
<div class="dist-icon">üì±</div>
<div class="dist-text">Distraction!</div>
<button onclick="dismissDistraction()">Tap to Refocus</button>
</div>
</div>
<!-- Challenge Meter -->
<div class="challenge-meter">
<div class="meter-zones">
<div class="meter-zone comfort-zone">Comfort</div>
<div class="meter-zone stretch-zone">Stretch</div>
<div class="meter-zone panic-zone">Panic</div>
<div class="meter-indicator" id="meterIndicator" style="left:50%"></div>
</div>
</div>
</div>

<!-- RIGHT PANEL -->
<div class="right-panel">
<div class="panel-section">
<h3>Stats</h3>
<div class="hud-grid">
<div class="hud-item"><div class="hud-val" id="hudScore">0</div><div class="hud-label">Score</div></div>
<div class="hud-item"><div class="hud-val" id="hudStreak">0</div><div class="hud-label">Streak</div></div>
<div class="hud-item"><div class="hud-val" id="hudDone">0/5</div><div class="hud-label">Done</div></div>
<div class="hud-item"><div class="hud-val" id="hudBest">-</div><div class="hud-label">Best Zone</div></div>
</div>
</div>
<div class="panel-section" style="padding:8px">
<div class="boost-indicator inactive" id="boostInd">üß† Brain Boost: Locked</div>
</div>
<div class="panel-section" style="padding:8px">
<div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:0%"></div></div>
<div class="status-msg" id="statusMsg">Complete 5 rounds</div>
</div>
<div class="panel-section" style="flex:1;display:flex;flex-direction:column;min-height:0">
<h3>Data Table</h3>
<button class="copy-btn" id="copyBtn" onclick="copyTable()">üìã Copy Table</button>
<div class="data-table-wrap">
<table class="data-tbl">
<thead><tr><th>Round</th><th>Challenge</th><th>Help</th><th>Score</th></tr></thead>
<tbody id="dataBody"></tbody>
</table>
</div>
</div>
<div class="action-btns">
<button class="btn-reset" onclick="resetGame()">Reset</button>
<button class="btn-new" onclick="newRun()">New Run</button>
</div>
</div>
</div>

<!-- Completion overlay -->
<div class="completion-overlay" id="completionOverlay">
<div class="completion-card" id="completionCard"></div>
</div>

<script>
// ===== GAME STATE =====
let state = {
  round: 1,
  score: 0,
  streak: 0,
  bestStreak: 0,
  boostActive: false,
  boostUsed: false,
  selectedScenario: null,
  selectedHelp: null,
  data: [],
  gameOver: false,
  zoneCounts: {comfort:0, stretch:0, panic:0},
  distractionActive: false
};

// ===== SCENARIO DATABASE =====
const scenarioPool = [
  // Round 1 - School Reading
  [
    {text:"Reread a book you finished", zone:"comfort", category:"School"},
    {text:"Read a new chapter with vocab help", zone:"stretch", category:"School"},
    {text:"Read a college article alone", zone:"panic", category:"School"}
  ],
  // Round 2 - Sports
  [
    {text:"Shoot free throws you always make", zone:"comfort", category:"Sports"},
    {text:"Try a new dribble move with a coach", zone:"stretch", category:"Sports"},
    {text:"Play 1v1 against the varsity captain", zone:"panic", category:"Sports"}
  ],
  // Round 3 - Gaming
  [
    {text:"Replay a level you already beat", zone:"comfort", category:"Gaming"},
    {text:"Try a harder level with 1 extra life", zone:"stretch", category:"Gaming"},
    {text:"Boss fight with no power-ups or saves", zone:"panic", category:"Gaming"}
  ],
  // Round 4 - Life Skills
  [
    {text:"Make a sandwich you make every day", zone:"comfort", category:"Life"},
    {text:"Cook a new recipe with instructions", zone:"stretch", category:"Life"},
    {text:"Cook a 5-course meal for 20 people", zone:"panic", category:"Life"}
  ],
  // Round 5 - Math
  [
    {text:"Do math problems you already know", zone:"comfort", category:"Math"},
    {text:"Try a new math concept with examples", zone:"stretch", category:"Math"},
    {text:"Solve advanced calculus with no notes", zone:"panic", category:"Math"}
  ],
  // Round 6 - Social
  [
    {text:"Talk to your best friend at lunch", zone:"comfort", category:"Social"},
    {text:"Introduce yourself to one new person", zone:"stretch", category:"Social"},
    {text:"Give a speech to 500 strangers", zone:"panic", category:"Social"}
  ],
  // Round 7 - Music
  [
    {text:"Play a song you already memorized", zone:"comfort", category:"Music"},
    {text:"Learn a new song with sheet music", zone:"stretch", category:"Music"},
    {text:"Improvise a solo at a live concert", zone:"panic", category:"Music"}
  ],
  // Round 8 - Creative
  [
    {text:"Color in a coloring book", zone:"comfort", category:"Art"},
    {text:"Draw something new from a tutorial", zone:"stretch", category:"Art"},
    {text:"Paint a mural with no sketch or plan", zone:"panic", category:"Art"}
  ]
];

const categoryEmojis = {School:"üìö",Sports:"üèÄ",Gaming:"üéÆ",Life:"üç≥",Math:"üî¢",Social:"üí¨",Music:"üéµ",Art:"üé®"};

// ===== INITIALIZATION =====
function init() {
  try {
    createAmbientStars();
    loadRound();
  } catch(e) { console.error("Init error:", e); }
}

function createAmbientStars() {
  try {
    const arena = document.getElementById('arena');
    for (let i = 0; i < 30; i++) {
      const star = document.createElement('div');
      star.className = 'star';
      star.style.cssText = `left:${Math.random()*100}%;top:${Math.random()*100}%;width:${1+Math.random()*2}px;height:${1+Math.random()*2}px;--dur:${1+Math.random()*3}s;animation-delay:${Math.random()*2}s`;
      arena.appendChild(star);
    }
  } catch(e) {}
}

// ===== ROUND MANAGEMENT =====
function loadRound() {
  try {
    if (state.round > 8) { showFinalCompletion(); return; }
    state.selectedScenario = null;
    state.selectedHelp = null;
    document.getElementById('roundNum').textContent = state.round;
    document.getElementById('missionLine').textContent = state.round <= 5 ? 'Pick a challenge' : 'Extra Credit!';
    updateGoButton();
    renderScenarioCards();
    clearSupportSelection();
    if (state.round === 6) showRoundBanner("Extra Credit!");
    else showRoundBanner("Round " + state.round);
  } catch(e) { console.error("loadRound error:", e); }
}

function renderScenarioCards() {
  try {
    const container = document.getElementById('scenarioCards');
    const scenarios = [...scenarioPool[state.round - 1]];
    // Shuffle
    for (let i = scenarios.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [scenarios[i], scenarios[j]] = [scenarios[j], scenarios[i]];
    }
    container.innerHTML = '';
    scenarios.forEach((s, i) => {
      const card = document.createElement('div');
      card.className = 'scenario-card';
      card.innerHTML = `<span class="card-emoji">${categoryEmojis[s.category]||'‚ùì'}</span><span class="card-text">${s.text}</span><span class="card-label">${s.category}</span>`;
      card.onclick = () => selectScenario(i, scenarios);
      card.dataset.idx = i;
      container.appendChild(card);
    });
    // Store shuffled for reference
    container._scenarios = scenarios;
  } catch(e) {}
}

function selectScenario(idx, scenarios) {
  try {
    if (state.gameOver || state.distractionActive) return;
    state.selectedScenario = scenarios[idx];
    document.querySelectorAll('.scenario-card').forEach((c, i) => {
      c.classList.toggle('selected', i === idx);
    });
    updateGoButton();
  } catch(e) {}
}

function selectHelp(level) {
  try {
    if (state.gameOver || state.distractionActive) return;
    state.selectedHelp = level;
    document.querySelectorAll('.support-btn').forEach(b => {
      b.classList.toggle('active', b.dataset.help === level);
    });
    updateGoButton();
  } catch(e) {}
}

function clearSupportSelection() {
  state.selectedHelp = null;
  document.querySelectorAll('.support-btn').forEach(b => b.classList.remove('active'));
}

function updateGoButton() {
  const btn = document.getElementById('goBtn');
  if (state.selectedScenario && state.selectedHelp) {
    btn.classList.remove('disabled');
    btn.classList.add('ready');
    btn.disabled = false;
    btn.textContent = 'GO!';
  } else {
    btn.classList.add('disabled');
    btn.classList.remove('ready');
    btn.disabled = true;
    btn.textContent = !state.selectedScenario ? 'Pick a Card' : 'Pick Support';
  }
}

// ===== EXECUTE ROUND =====
function executeRound() {
  try {
    if (!state.selectedScenario || !state.selectedHelp || state.gameOver) return;

    const scenario = state.selectedScenario;
    const help = state.selectedHelp;
    const zone = scenario.zone;

    // Calculate score
    let pts = 0;
    if (zone === 'stretch') {
      if (help === 'none') pts = state.boostActive ? 4 : 3;
      else if (help === 'some') pts = 2;
      else pts = 1;
    }

    // Distraction check (15% chance)
    if (Math.random() < 0.15) {
      state.distractionActive = true;
      showDistraction(zone, help, pts, scenario);
      return;
    }

    finishRound(zone, help, pts, scenario);
  } catch(e) { console.error("executeRound error:", e); }
}

function showDistraction(zone, help, pts, scenario) {
  try {
    document.getElementById('distractionOverlay').classList.add('active');
    state._pendingRound = { zone, help, pts: Math.max(0, pts - 1), scenario, distracted: true };
  } catch(e) {}
}

function dismissDistraction() {
  try {
    document.getElementById('distractionOverlay').classList.remove('active');
    state.distractionActive = false;
    if (state._pendingRound) {
      const p = state._pendingRound;
      finishRound(p.zone, p.help, p.pts, p.scenario, true);
      state._pendingRound = null;
    }
  } catch(e) {}
}

function finishRound(zone, help, pts, scenario, distracted = false) {
  try {
    // Update streak
    if (zone === 'stretch') {
      state.streak++;
      if (state.streak > state.bestStreak) state.bestStreak = state.streak;
    } else {
      state.streak = 0;
    }

    // Check boost
    if (state.streak >= 3 && !state.boostActive) {
      state.boostActive = true;
    }
    if (state.boostActive && zone === 'stretch' && help === 'none' && !state.boostUsed) {
      state.boostUsed = true;
    }
    // Deactivate boost after use or after streak breaks
    if (zone !== 'stretch') {
      state.boostActive = false;
      state.boostUsed = false;
    }

    state.score += pts;
    state.zoneCounts[zone]++;

    // Animate brain
    animateBrain(zone, pts);

    // Move challenge meter
    moveMeter(zone);

    // Show zone label
    showZoneLabel(zone);

    // Record data
    const helpLabel = help === 'none' ? 'No Help' : help === 'some' ? 'Some Help' : 'Full Help';
    const entry = {
      round: state.round,
      challenge: scenario.category,
      help: helpLabel,
      score: (distracted ? pts + ' (-1)' : '+' + pts)
    };
    state.data.push(entry);
    addDataRow(entry);

    // Update HUD
    updateHUD();

    // Check completion
    if (state.round === 5) {
      setTimeout(() => {
        if (state.score >= 15) showMidCompletion("üèÜ Brain Champion!", "15+ points! Keep going for extra credit!");
        else showMidCompletion("‚úÖ Required Done!", "Try rounds 6-8 for extra credit!");
      }, 2000);
    }
    if (state.round === 8) {
      setTimeout(() => showFinalCompletion(), 2000);
      state.gameOver = true;
    }

    // Next round
    state.round++;
    setTimeout(() => {
      if (!state.gameOver) loadRound();
    }, 2500);
  } catch(e) { console.error("finishRound error:", e); }
}

// ===== BRAIN ANIMATIONS =====
function animateBrain(zone, pts) {
  try {
    const arena = document.getElementById('arena');
    const neuralNet = document.getElementById('neuralNet');
    const neuronDots = document.getElementById('neuronDots');
    const brainAura = document.getElementById('brainAura');
    const leftHemi = document.getElementById('leftHemi');
    const rightHemi = document.getElementById('rightHemi');
    const svgContainer = document.querySelector('.brain-svg-container');

    // Clear old effects
    document.querySelectorAll('.particle,.growth-ring,.float-symbol,.traveling-dot,.new-dendrite-anim').forEach(e => e.remove());

    if (zone === 'comfort') {
      // DIM brain, Zzz symbols, low activity
      brainAura.setAttribute('stroke', 'rgba(76,175,80,.2)');
      brainAura.setAttribute('stroke-width', '15');
      neuralNet.style.opacity = '0.08';
      neuronDots.style.opacity = '0.1';
      leftHemi.style.filter = 'brightness(0.6) saturate(0.5)';
      rightHemi.style.filter = 'brightness(0.6) saturate(0.5)';
      // Float Zzz
      for (let i = 0; i < 4; i++) {
        setTimeout(() => {
          try {
            const zzz = document.createElement('div');
            zzz.className = 'float-symbol';
            zzz.textContent = 'üí§';
            zzz.style.left = (40 + Math.random() * 20) + '%';
            zzz.style.top = (30 + Math.random() * 20) + '%';
            arena.appendChild(zzz);
            setTimeout(() => zzz.remove(), 2000);
          } catch(e) {}
        }, i * 400);
      }
      // Reset after delay
      setTimeout(() => resetBrainVisuals(), 2200);

    } else if (zone === 'stretch') {
      // GLOW brain, neurons fire, growth rings, particles
      const intensity = pts >= 3 ? 1 : pts >= 2 ? 0.7 : 0.4;
      brainAura.setAttribute('stroke', `rgba(255,215,0,${0.3 * intensity})`);
      brainAura.setAttribute('stroke-width', String(20 + 15 * intensity));
      neuralNet.style.opacity = String(0.4 + 0.5 * intensity);
      neuronDots.style.opacity = String(0.5 + 0.5 * intensity);
      leftHemi.style.filter = `brightness(${1 + 0.3 * intensity}) saturate(${1 + 0.3 * intensity})`;
      rightHemi.style.filter = `brightness(${1 + 0.3 * intensity}) saturate(${1 + 0.3 * intensity})`;

      // Traveling signal dots
      const numSignals = pts >= 3 ? 8 : pts >= 2 ? 5 : 3;
      fireTravelingSignals(numSignals);

      // Growth rings
      const numRings = pts >= 3 ? 4 : pts >= 2 ? 2 : 1;
      for (let i = 0; i < numRings; i++) {
        setTimeout(() => {
          try {
            const ring = document.createElement('div');
            ring.className = 'growth-ring';
            ring.style.width = '80px';
            ring.style.height = '80px';
            arena.appendChild(ring);
            setTimeout(() => ring.remove(), 1500);
          } catch(e) {}
        }, i * 300);
      }

      // Sparkle particles
      const numParticles = Math.floor(12 * intensity);
      for (let i = 0; i < numParticles; i++) {
        setTimeout(() => spawnParticle(arena, '#ffd700'), i * 80);
      }

      // Lightning bolts
      for (let i = 0; i < Math.ceil(3 * intensity); i++) {
        setTimeout(() => {
          try {
            const bolt = document.createElement('div');
            bolt.className = 'float-symbol';
            bolt.textContent = '‚ö°';
            bolt.style.left = (30 + Math.random() * 40) + '%';
            bolt.style.top = (20 + Math.random() * 40) + '%';
            bolt.style.fontSize = '2rem';
            arena.appendChild(bolt);
            setTimeout(() => bolt.remove(), 2000);
          } catch(e) {}
        }, 200 + i * 350);
      }

      // GROWING text
      if (pts >= 2) {
        setTimeout(() => {
          try {
            const txt = document.createElement('div');
            txt.className = 'float-symbol';
            txt.textContent = 'GROWING!';
            txt.style.left = '50%';
            txt.style.top = '45%';
            txt.style.transform = 'translateX(-50%)';
            txt.style.fontSize = '1.5rem';
            txt.style.fontWeight = '900';
            txt.style.color = '#ffd700';
            txt.style.textShadow = '0 0 20px rgba(255,215,0,.8)';
            arena.appendChild(txt);
            setTimeout(() => txt.remove(), 2000);
          } catch(e) {}
        }, 500);
      }

      // New dendrites growing
      if (pts >= 2) growNewDendrites(Math.ceil(3 * intensity));

      setTimeout(() => resetBrainVisuals(), 2500);

    } else if (zone === 'panic') {
      // SHAKE, red flash, shutdown
      brainAura.setAttribute('stroke', 'rgba(244,67,54,.35)');
      brainAura.setAttribute('stroke-width', '25');
      neuralNet.style.opacity = '0.05';
      neuronDots.style.opacity = '0.05';
      leftHemi.style.filter = 'brightness(0.5) saturate(0.3) hue-rotate(-20deg)';
      rightHemi.style.filter = 'brightness(0.5) saturate(0.3) hue-rotate(-20deg)';

      // Shake
      svgContainer.style.animation = 'brainShake 0.5s ease-in-out 3';
      setTimeout(() => { svgContainer.style.animation = ''; }, 1500);

      // Stress marks
      for (let i = 0; i < 5; i++) {
        setTimeout(() => {
          try {
            const mark = document.createElement('div');
            mark.className = 'float-symbol';
            mark.textContent = '‚ùå';
            mark.style.left = (25 + Math.random() * 50) + '%';
            mark.style.top = (20 + Math.random() * 40) + '%';
            mark.style.fontSize = '1.5rem';
            arena.appendChild(mark);
            setTimeout(() => mark.remove(), 2000);
          } catch(e) {}
        }, i * 250);
      }

      // Red particles
      for (let i = 0; i < 8; i++) {
        setTimeout(() => spawnParticle(arena, '#f44336'), i * 100);
      }

      // Shrink effect
      svgContainer.style.transition = 'transform 0.8s';
      svgContainer.style.transform = 'translate(-50%,-50%) scale(0.88)';
      setTimeout(() => {
        svgContainer.style.transform = 'translate(-50%,-50%) scale(1)';
      }, 1200);

      setTimeout(() => resetBrainVisuals(), 2200);
    }
  } catch(e) { console.error("animateBrain error:", e); }
}

function resetBrainVisuals() {
  try {
    const brainAura = document.getElementById('brainAura');
    const leftHemi = document.getElementById('leftHemi');
    const rightHemi = document.getElementById('rightHemi');
    const neuralNet = document.getElementById('neuralNet');
    const neuronDots = document.getElementById('neuronDots');
    brainAura.setAttribute('stroke', 'rgba(200,150,220,.15)');
    brainAura.setAttribute('stroke-width', '20');
    neuralNet.style.opacity = '0.15';
    neuronDots.style.opacity = '0.2';
    leftHemi.style.filter = '';
    rightHemi.style.filter = '';
  } catch(e) {}
}

function fireTravelingSignals(count) {
  try {
    const svg = document.getElementById('brainSvg');
    const paths = svg.querySelectorAll('.neural-path');
    for (let i = 0; i < Math.min(count, paths.length); i++) {
      setTimeout(() => {
        try {
          const path = paths[i % paths.length];
          const dot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
          dot.setAttribute("r", "5");
          dot.setAttribute("fill", "#ffd700");
          dot.setAttribute("filter", "url(#glow)");
          dot.classList.add("traveling-dot");
          const anim = document.createElementNS("http://www.w3.org/2000/svg", "animateMotion");
          anim.setAttribute("dur", "0.8s");
          anim.setAttribute("repeatCount", "1");
          anim.setAttribute("fill", "freeze");
          const mpath = document.createElementNS("http://www.w3.org/2000/svg", "mpath");
          // Create a unique ID for this path if needed
          if (!path.id) path.id = 'np_' + Math.random().toString(36).substr(2,6);
          mpath.setAttributeNS("http://www.w3.org/1999/xlink", "href", "#" + path.id);
          anim.appendChild(mpath);
          dot.appendChild(anim);
          svg.querySelector('#travelSignals').appendChild(dot);
          setTimeout(() => dot.remove(), 1000);
        } catch(e) {}
      }, i * 150);
    }
  } catch(e) {}
}

function growNewDendrites(count) {
  try {
    const svg = document.getElementById('brainSvg');
    const g = svg.querySelector('#newDendrites');
    for (let i = 0; i < count; i++) {
      setTimeout(() => {
        try {
          const cx = 140 + Math.random() * 120;
          const cy = 120 + Math.random() * 100;
          const dx = (Math.random() - 0.5) * 40;
          const dy = (Math.random() - 0.5) * 40;
          const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
          line.setAttribute("x1", cx); line.setAttribute("y1", cy);
          line.setAttribute("x2", cx + dx); line.setAttribute("y2", cy + dy);
          line.setAttribute("stroke", "#69f0ae");
          line.setAttribute("stroke-width", "2");
          line.setAttribute("stroke-dasharray", "50");
          line.setAttribute("stroke-dashoffset", "50");
          line.classList.add("new-dendrite-anim");
          line.style.animation = "dendGrow 1s ease-out forwards";
          line.style.animationDelay = (i * 0.2) + "s";
          g.appendChild(line);
          setTimeout(() => line.remove(), 2500);
        } catch(e) {}
      }, i * 200);
    }
  } catch(e) {}
}

function spawnParticle(container, color) {
  try {
    const p = document.createElement('div');
    p.className = 'particle';
    const size = 4 + Math.random() * 6;
    const tx = (Math.random() - 0.5) * 120;
    const ty = -40 - Math.random() * 80;
    p.style.cssText = `width:${size}px;height:${size}px;background:${color};left:${45+Math.random()*10}%;top:${40+Math.random()*15}%;--tx:${tx}px;--ty:${ty}px;box-shadow:0 0 ${size*2}px ${color}`;
    container.appendChild(p);
    setTimeout(() => p.remove(), 2000);
  } catch(e) {}
}

function moveMeter(zone) {
  try {
    const ind = document.getElementById('meterIndicator');
    if (zone === 'comfort') ind.style.left = '16%';
    else if (zone === 'stretch') ind.style.left = '50%';
    else ind.style.left = '83%';
  } catch(e) {}
}

function showZoneLabel(zone) {
  try {
    const label = document.getElementById('zoneLabel');
    label.className = 'zone-label visible ' + zone;
    if (zone === 'comfort') label.textContent = 'Comfort Zone';
    else if (zone === 'stretch') label.textContent = 'Stretch Zone!';
    else label.textContent = 'Panic Zone';
    setTimeout(() => { label.classList.remove('visible'); }, 2000);
  } catch(e) {}
}

function showRoundBanner(text) {
  try {
    const banner = document.getElementById('roundBanner');
    banner.textContent = text;
    banner.classList.add('show');
    setTimeout(() => banner.classList.remove('show'), 1200);
  } catch(e) {}
}

// ===== HUD =====
function updateHUD() {
  try {
    document.getElementById('hudScore').textContent = state.score;
    document.getElementById('hudStreak').textContent = state.streak;
    document.getElementById('hudDone').textContent = Math.min(state.data.length, 8) + (state.data.length <= 5 ? '/5' : '/8');

    // Best zone
    const maxZone = Object.entries(state.zoneCounts).sort((a,b)=>b[1]-a[1])[0];
    if (maxZone[1] > 0) {
      const zoneEmoji = maxZone[0] === 'comfort' ? 'üü¢' : maxZone[0] === 'stretch' ? 'üü°' : 'üî¥';
      document.getElementById('hudBest').textContent = zoneEmoji;
    }

    // Boost
    const boostInd = document.getElementById('boostInd');
    if (state.boostActive) {
      boostInd.className = 'boost-indicator active';
      boostInd.textContent = 'üß† Brain Boost: ACTIVE!';
    } else if (state.streak >= 2) {
      boostInd.className = 'boost-indicator inactive';
      boostInd.textContent = `üß† Boost: ${state.streak}/3 streak`;
    } else {
      boostInd.className = 'boost-indicator inactive';
      boostInd.textContent = 'üß† Brain Boost: Locked';
    }

    // Progress
    const pct = Math.min(100, (state.data.length / 5) * 100);
    document.getElementById('progressFill').style.width = pct + '%';
    const remaining = Math.max(0, 5 - state.data.length);
    if (remaining > 0) {
      document.getElementById('statusMsg').textContent = `${remaining} more round${remaining>1?'s':''} to go!`;
    } else if (state.data.length < 8) {
      document.getElementById('statusMsg').textContent = 'Extra credit rounds!';
    } else {
      document.getElementById('statusMsg').textContent = 'All 8 complete!';
    }
  } catch(e) {}
}

function addDataRow(entry) {
  try {
    const tbody = document.getElementById('dataBody');
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${entry.round}</td><td>${entry.challenge}</td><td>${entry.help}</td><td>${entry.score}</td>`;
    tr.style.animation = 'fadeIn .3s';
    tbody.appendChild(tr);
  } catch(e) {}
}

// ===== COPY TABLE =====
function copyTable() {
  try {
    let text = "Round\tChallenge\tHelp\tScore\n";
    state.data.forEach(d => {
      text += `${d.round}\t${d.challenge}\t${d.help}\t${d.score}\n`;
    });
    navigator.clipboard.writeText(text).then(() => {
      const btn = document.getElementById('copyBtn');
      btn.textContent = '‚úÖ Copied!';
      btn.classList.add('copied');
      setTimeout(() => {
        btn.textContent = 'üìã Copy Table';
        btn.classList.remove('copied');
      }, 2000);
    }).catch(() => {
      // Fallback
      const ta = document.createElement('textarea');
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand('copy');
      ta.remove();
      const btn = document.getElementById('copyBtn');
      btn.textContent = '‚úÖ Copied!';
      btn.classList.add('copied');
      setTimeout(() => {
        btn.textContent = 'üìã Copy Table';
        btn.classList.remove('copied');
      }, 2000);
    });
  } catch(e) {}
}

// ===== COMPLETION =====
function showMidCompletion(title, msg) {
  try {
    const overlay = document.getElementById('completionOverlay');
    const card = document.getElementById('completionCard');
    const isBrainChamp = state.score >= 15;
    card.innerHTML = `
      <div class="badge">${isBrainChamp ? 'üèÜ' : '‚úÖ'}</div>
      <h2>${title}</h2>
      <p>${msg}</p>
      <p style="font-size:1.3rem;color:#ffd700;font-weight:800">Score: ${state.score}</p>
      <button onclick="document.getElementById('completionOverlay').classList.remove('active')">Continue</button>
    `;
    overlay.classList.add('active');
  } catch(e) {}
}

function showFinalCompletion() {
  try {
    const overlay = document.getElementById('completionOverlay');
    const card = document.getElementById('completionCard');
    const isBrainChamp = state.score >= 15;
    card.innerHTML = `
      <div class="badge">${isBrainChamp ? 'üèÜ' : 'üåü'}</div>
      <h2>${isBrainChamp ? 'Brain Champion!' : 'All 8 Complete!'}</h2>
      <p>Final Score: <strong style="color:#ffd700;font-size:1.5rem">${state.score}</strong></p>
      <p>Best Streak: ${state.bestStreak} | Stretch Zones: ${state.zoneCounts.stretch}</p>
      <p style="color:#69f0ae;font-weight:600">Extra Credit Complete! üéâ</p>
      <button onclick="document.getElementById('completionOverlay').classList.remove('active')">View Data</button>
    `;
    overlay.classList.add('active');
    state.gameOver = true;
  } catch(e) {}
}

// ===== RESET / NEW RUN =====
function resetGame() {
  try {
    state = {round:1,score:0,streak:0,bestStreak:0,boostActive:false,boostUsed:false,selectedScenario:null,selectedHelp:null,data:[],gameOver:false,zoneCounts:{comfort:0,stretch:0,panic:0},distractionActive:false};
    document.getElementById('dataBody').innerHTML = '';
    document.getElementById('completionOverlay').classList.remove('active');
    resetBrainVisuals();
    document.getElementById('meterIndicator').style.left = '50%';
    updateHUD();
    loadRound();
  } catch(e) {}
}

function newRun() {
  resetGame();
}

// ===== START =====
init();
</script>
</body>
</html>
