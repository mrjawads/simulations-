<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cells Are Everywhere ‚Äî Mr. Jawad's Sims</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg-deep: #0a0e1a;
  --bg-panel: #111827;
  --bg-card: #1a2236;
  --bg-card-hover: #222d45;
  --accent-green: #22c55e;
  --accent-red: #ef4444;
  --accent-orange: #f59e0b;
  --accent-blue: #3b82f6;
  --accent-purple: #a855f7;
  --accent-cyan: #06b6d4;
  --text-primary: #f1f5f9;
  --text-secondary: #94a3b8;
  --text-dim: #64748b;
  --border-subtle: rgba(148,163,184,0.12);
}
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family: 'Outfit', sans-serif;
  background: var(--bg-deep);
  color: var(--text-primary);
  min-height: 100vh;
  overflow-x: hidden;
}

/* ============ TOP BAR ============ */
.top-bar {
  background: linear-gradient(135deg, #111827 0%, #1a2236 100%);
  border-bottom: 1px solid var(--border-subtle);
  padding: 12px 24px;
  display: flex; align-items: center; justify-content: space-between;
  position: sticky; top: 0; z-index: 100;
}
.top-bar-left { display: flex; align-items: center; gap: 14px; }
.brand-icon {
  width: 36px; height: 36px;
  background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
  border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  font-size: 18px;
  box-shadow: 0 0 16px rgba(6,182,212,0.3);
}
.brand-title { font-weight: 700; font-size: 15px; letter-spacing: 0.5px; }
.brand-title span { color: var(--accent-cyan); }
.top-bar-center { display: flex; align-items: center; gap: 16px; }
.progress-wrap { display: flex; align-items: center; gap: 10px; }
.progress-label {
  font-family: 'Space Mono', monospace; font-size: 12px;
  color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px;
}
.progress-track { width: 200px; height: 8px; background: rgba(255,255,255,0.06); border-radius: 4px; overflow: hidden; }
.progress-fill {
  height: 100%; background: linear-gradient(90deg, var(--accent-cyan), var(--accent-green));
  border-radius: 4px; transition: width 0.6s cubic-bezier(0.22,1,0.36,1); width: 0%;
}
.progress-count { font-family: 'Space Mono', monospace; font-size: 13px; color: var(--accent-cyan); min-width: 40px; }
.top-bar-right { display: flex; gap: 10px; }
.btn-top {
  font-family: 'Outfit', sans-serif; font-size: 13px; font-weight: 600;
  padding: 8px 16px; border-radius: 8px; border: 1px solid var(--border-subtle);
  background: var(--bg-card); color: var(--text-primary); cursor: pointer; transition: all 0.2s;
}
.btn-top:hover { background: var(--bg-card-hover); border-color: var(--accent-cyan); }

/* ============ MAIN LAYOUT ============ */
.main-layout { display: grid; grid-template-columns: 280px 1fr 80px; min-height: calc(100vh - 57px); }

/* ============ SIDEBAR ============ */
.sidebar {
  background: var(--bg-panel); border-right: 1px solid var(--border-subtle);
  padding: 16px 12px; overflow-y: auto;
}
.sidebar-header {
  font-size: 11px; font-weight: 700; text-transform: uppercase;
  letter-spacing: 2px; color: var(--text-dim); margin-bottom: 6px; padding: 0 8px;
}
.sidebar-sub {
  font-size: 11px; color: var(--text-dim); padding: 0 8px;
  margin-bottom: 14px; line-height: 1.5;
}
.scenario-card {
  background: var(--bg-card); border: 1px solid var(--border-subtle);
  border-radius: 12px; padding: 12px 14px; margin-bottom: 8px;
  cursor: pointer; transition: all 0.25s; position: relative; overflow: hidden;
}
.scenario-card::before {
  content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 3px;
  background: var(--text-dim); border-radius: 0 2px 2px 0; transition: background 0.3s;
}
.scenario-card:hover { background: var(--bg-card-hover); transform: translateX(3px); }
.scenario-card.active { border-color: var(--accent-cyan); background: rgba(6,182,212,0.08); }
.scenario-card.active::before { background: var(--accent-cyan); }
.scenario-card.completed { cursor: default; opacity: 0.7; }
.scenario-card.completed::before { background: var(--accent-green); }
.scenario-card.completed .sc-check { opacity: 1; animation: checkPop 0.5s cubic-bezier(0.34,1.56,0.64,1); }
@keyframes checkPop { 0%{transform:scale(0);opacity:0} 60%{transform:scale(1.3)} 100%{transform:scale(1);opacity:1} }
.sc-top { display: flex; align-items: center; justify-content: space-between; }
.sc-left { display: flex; align-items: center; gap: 10px; }
.sc-emoji { font-size: 22px; }
.sc-title { font-size: 13px; font-weight: 600; line-height: 1.3; }
.sc-check {
  width: 22px; height: 22px; background: var(--accent-green); border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 12px; color: #fff; opacity: 0; transition: opacity 0.4s; flex-shrink: 0;
}
.sc-tag {
  display: inline-block; font-size: 10px; font-weight: 600; text-transform: uppercase;
  letter-spacing: 1px; padding: 2px 8px; border-radius: 4px; margin-top: 6px;
}
.sc-tag.down { background: rgba(239,68,68,0.15); color: var(--accent-red); }
.sc-tag.up { background: rgba(245,158,11,0.15); color: var(--accent-orange); }

/* ============ CENTER ============ */
.center { padding: 28px 32px; overflow-y: auto; max-height: calc(100vh - 57px); }

/* Welcome */
.welcome-screen { max-width: 700px; margin: 0 auto; text-align: center; padding-top: 40px; }
.welcome-icon { font-size: 64px; margin-bottom: 20px; animation: pulse-glow 2s ease-in-out infinite; }
@keyframes pulse-glow {
  0%,100% { filter: drop-shadow(0 0 8px rgba(6,182,212,0.4)); transform: scale(1); }
  50% { filter: drop-shadow(0 0 20px rgba(6,182,212,0.7)); transform: scale(1.05); }
}
.welcome-title {
  font-size: 28px; font-weight: 800; margin-bottom: 8px;
  background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
}
.welcome-sub { font-size: 15px; color: var(--text-secondary); margin-bottom: 28px; line-height: 1.6; }
.mission-box {
  background: var(--bg-card); border: 1px solid var(--border-subtle);
  border-radius: 16px; padding: 24px; text-align: left; margin-bottom: 24px;
}
.mission-label {
  font-family: 'Space Mono', monospace; font-size: 11px; text-transform: uppercase;
  letter-spacing: 2px; color: var(--accent-cyan); margin-bottom: 10px;
}
.mission-text { font-size: 15px; line-height: 1.7; color: var(--text-secondary); }
.mission-text strong { color: var(--text-primary); font-weight: 600; }
.rule-chips { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 14px; }
.rule-chip {
  font-size: 12px; font-weight: 500; padding: 6px 12px; border-radius: 20px;
  background: rgba(148,163,184,0.08); border: 1px solid var(--border-subtle); color: var(--text-secondary);
}
.welcome-start-btn {
  font-family: 'Outfit', sans-serif; font-size: 16px; font-weight: 700;
  padding: 14px 40px; border-radius: 12px; border: none;
  background: linear-gradient(135deg, var(--accent-cyan), var(--accent-blue));
  color: #fff; cursor: pointer; transition: all 0.3s;
  box-shadow: 0 4px 20px rgba(6,182,212,0.3);
}
.welcome-start-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 28px rgba(6,182,212,0.45); }

/* Scenario view */
.scenario-view { display: none; max-width: 760px; margin: 0 auto; }
.scenario-view.active { display: block; }
.sv-header { display: flex; align-items: center; gap: 14px; margin-bottom: 6px; }
.sv-emoji { font-size: 36px; }
.sv-title { font-size: 24px; font-weight: 800; }
.sv-premise { font-size: 14px; color: var(--text-secondary); line-height: 1.6; margin-bottom: 20px; padding-left: 50px; }

/* Steps */
.steps-indicator { display: flex; gap: 4px; margin-bottom: 24px; }
.step-pip { flex: 1; height: 4px; border-radius: 2px; background: rgba(255,255,255,0.06); transition: background 0.4s; }
.step-pip.done { background: var(--accent-green); }
.step-pip.current { background: var(--accent-cyan); animation: pip-pulse 1.5s ease-in-out infinite; }
@keyframes pip-pulse { 0%,100%{opacity:1} 50%{opacity:0.5} }

/* Level select */
.level-select { display: flex; gap: 10px; margin-bottom: 24px; }
.level-btn {
  font-family: 'Outfit', sans-serif; flex: 1; padding: 12px; border-radius: 10px;
  border: 1px solid var(--border-subtle); background: var(--bg-card);
  color: var(--text-secondary); font-size: 14px; font-weight: 600;
  cursor: pointer; transition: all 0.25s; text-align: center;
}
.level-btn:hover { background: var(--bg-card-hover); }
.level-btn.selected { border-color: var(--accent-cyan); background: rgba(6,182,212,0.1); color: var(--accent-cyan); }
.level-btn .level-label { font-size: 11px; font-weight: 400; color: var(--text-dim); display: block; margin-top: 2px; }

/* Step panels */
.step-panel { display: none; animation: fadeUp 0.4s ease; }
.step-panel.active { display: block; }
@keyframes fadeUp { from{opacity:0;transform:translateY(12px)} to{opacity:1;transform:translateY(0)} }
.step-label {
  font-family: 'Space Mono', monospace; font-size: 11px; text-transform: uppercase;
  letter-spacing: 2px; color: var(--accent-cyan); margin-bottom: 12px;
  display: flex; align-items: center; gap: 8px;
}
.step-label .step-num {
  background: var(--accent-cyan); color: var(--bg-deep); width: 20px; height: 20px;
  border-radius: 50%; display: inline-flex; align-items: center; justify-content: center;
  font-size: 11px; font-weight: 700;
}

/* Predict */
.predict-box { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 14px; padding: 24px; }
.predict-q { font-size: 16px; font-weight: 600; margin-bottom: 14px; line-height: 1.5; }
.predict-input, .record-input {
  width: 100%; min-height: 80px; background: rgba(255,255,255,0.04);
  border: 1px solid var(--border-subtle); border-radius: 10px; padding: 14px;
  color: var(--text-primary); font-family: 'Outfit', sans-serif; font-size: 14px;
  resize: vertical; transition: border-color 0.3s;
}
.predict-input:focus, .record-input:focus { outline: none; border-color: var(--accent-cyan); }
.predict-input::placeholder, .record-input::placeholder { color: var(--text-dim); }

/* Read */
.read-box {
  background: var(--bg-card); border: 1px solid var(--border-subtle);
  border-radius: 14px; padding: 28px; position: relative;
}
.read-text { font-size: 16px; line-height: 1.85; color: var(--text-primary); }
.read-text .kw { color: var(--accent-cyan); font-weight: 600; }
.read-aloud-row {
  display: flex; align-items: center; gap: 10px; margin-top: 16px;
  padding-top: 14px; border-top: 1px solid var(--border-subtle);
}
.read-aloud-btn {
  width: 38px; height: 38px; border-radius: 50%; border: 1px solid var(--border-subtle);
  background: var(--bg-card-hover); color: var(--text-secondary); font-size: 17px;
  cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
}
.read-aloud-btn:hover { border-color: var(--accent-cyan); color: var(--accent-cyan); }
.read-aloud-btn.speaking { border-color: var(--accent-green); color: var(--accent-green); animation: pip-pulse 1s ease-in-out infinite; }
.read-aloud-hint { font-size: 13px; color: var(--text-dim); }

/* Watch */
.watch-box {
  background: var(--bg-card); border: 1px solid var(--border-subtle);
  border-radius: 14px; padding: 28px; min-height: 300px;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
}
.watch-canvas-wrap { width: 100%; max-width: 500px; aspect-ratio: 5/3; position: relative; margin-bottom: 16px; }
.watch-canvas-wrap canvas { width: 100%; height: 100%; border-radius: 10px; }
.watch-desc { font-size: 13px; color: var(--text-secondary); text-align: center; line-height: 1.6; max-width: 500px; }

/* Record */
.record-box { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 14px; padding: 24px; }
.record-field { margin-bottom: 16px; }
.record-field:last-of-type { margin-bottom: 0; }
.record-label { font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; color: var(--text-dim); margin-bottom: 6px; }
.record-input { min-height: 56px; }
.record-hint { font-size: 12px; color: var(--text-dim); margin-top: 4px; font-style: italic; }

/* Buttons */
.step-nav { display: flex; justify-content: flex-end; margin-top: 20px; }
.btn-next, .btn-submit {
  font-family: 'Outfit', sans-serif; font-size: 14px; font-weight: 700;
  padding: 12px 28px; border-radius: 10px; border: none; cursor: pointer;
  transition: all 0.3s; display: flex; align-items: center; gap: 8px;
}
.btn-next { background: var(--accent-cyan); color: var(--bg-deep); }
.btn-next:hover { box-shadow: 0 4px 16px rgba(6,182,212,0.4); transform: translateY(-1px); }
.btn-next:disabled, .btn-submit:disabled { opacity: 0.3; cursor: not-allowed; transform: none!important; box-shadow: none!important; }
.btn-submit { background: var(--accent-green); color: var(--bg-deep); }
.btn-submit:hover { box-shadow: 0 4px 16px rgba(34,197,94,0.4); transform: translateY(-1px); }

/* ============ GAUGE RAIL ============ */
.gauge-rail {
  background: var(--bg-panel); border-left: 1px solid var(--border-subtle);
  display: flex; flex-direction: column; align-items: center; padding: 20px 10px;
}
.gauge-title {
  font-family: 'Space Mono', monospace; font-size: 9px; text-transform: uppercase;
  letter-spacing: 1.5px; color: var(--text-dim); writing-mode: vertical-rl;
  transform: rotate(180deg); margin-bottom: 12px;
}
.gauge-container {
  flex: 1; width: 44px; background: rgba(255,255,255,0.03); border-radius: 22px;
  position: relative; overflow: hidden; border: 1px solid var(--border-subtle);
}
.gauge-zones { position: absolute; inset: 0; display: flex; flex-direction: column; }
.gz { flex: 1; opacity: 0.15; }
.gz.crit-high { background: #dc2626; }
.gz.high { background: #f59e0b; }
.gz.ok { background: #22c55e; }
.gz.low { background: #ef4444; }
.gz.crit-low { background: #dc2626; }

/* Cell icon indicator embedded in gauge center */
.gauge-indicator {
  position: absolute; left: 50%; transform: translate(-50%, -50%);
  width: 34px; height: 34px; border-radius: 50%;
  border: 3px solid var(--bg-deep);
  transition: top 1.2s cubic-bezier(0.22,1,0.36,1), background 0.8s, box-shadow 0.8s;
  top: 50%; z-index: 2;
  display: flex; align-items: center; justify-content: center;
}
/* Cell inner: membrane ring + nucleus dot */
.cell-inner {
  width: 24px; height: 24px; border-radius: 50%; position: relative;
  display: flex; align-items: center; justify-content: center;
}
.cell-inner .membrane {
  position: absolute; inset: 0; border-radius: 50%;
  border: 2px solid rgba(255,255,255,0.5);
  transition: all 1s ease;
}
.cell-inner .nuc {
  width: 8px; height: 8px; border-radius: 50%;
  background: rgba(255,255,255,0.8);
  transition: all 1s ease;
}

/* Gauge states */
.gauge-indicator.state-ok {
  top: 50%; background: var(--accent-green); box-shadow: 0 0 12px rgba(34,197,94,0.5);
}
.gauge-indicator.state-ok .membrane { border-color: rgba(255,255,255,0.6); border-style: solid; }
.gauge-indicator.state-ok .nuc { background: rgba(255,255,255,0.9); transform: scale(1); }

.gauge-indicator.state-low {
  top: 70%; background: var(--accent-red); box-shadow: 0 0 12px rgba(239,68,68,0.5);
}
.gauge-indicator.state-low .membrane { border-color: rgba(255,255,255,0.3); border-style: dashed; }
.gauge-indicator.state-low .nuc { background: rgba(255,255,255,0.4); transform: scale(0.8); }

.gauge-indicator.state-critical-low {
  top: 87%; background: #dc2626; box-shadow: 0 0 16px rgba(220,38,38,0.6);
}
.gauge-indicator.state-critical-low .membrane { border-color: rgba(255,255,255,0.15); border-style: dotted; }
.gauge-indicator.state-critical-low .nuc { background: rgba(255,255,255,0.25); transform: scale(0.6); }

.gauge-indicator.state-high {
  top: 30%; background: var(--accent-orange); box-shadow: 0 0 12px rgba(245,158,11,0.5);
}
.gauge-indicator.state-high .membrane { border-color: rgba(255,255,255,0.5); }
.gauge-indicator.state-high .nuc { background: rgba(255,255,255,0.8); }

.gauge-indicator.state-critical-high {
  top: 10%; background: #dc2626; box-shadow: 0 0 16px rgba(220,38,38,0.6);
  animation: gauge-flash 0.8s ease-in-out infinite;
}
.gauge-indicator.state-critical-high .membrane { border-color: rgba(255,255,255,0.5); animation: split-pulse 0.6s ease-in-out infinite; }
.gauge-indicator.state-critical-high .nuc { background: rgba(255,255,255,0.9); animation: split-pulse 0.6s ease-in-out infinite; }

@keyframes gauge-flash {
  0%,100% { box-shadow: 0 0 16px rgba(220,38,38,0.6); }
  50% { box-shadow: 0 0 28px rgba(220,38,38,0.9); }
}
@keyframes split-pulse {
  0%,100% { transform: scale(1); } 50% { transform: scale(1.2); }
}

.gauge-labels { margin-top: 8px; display: flex; flex-direction: column; align-items: center; gap: 2px; }
.gl { font-family: 'Space Mono', monospace; font-size: 8px; letter-spacing: 0.5px; color: var(--text-dim); }

/* ============ MODALS ============ */
.modal-overlay {
  display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7);
  z-index: 500; align-items: center; justify-content: center; backdrop-filter: blur(4px);
}
.modal-overlay.show { display: flex; }
.modal-box {
  background: var(--bg-panel); border: 1px solid var(--border-subtle); border-radius: 16px;
  padding: 28px; max-width: 900px; width: 92%; max-height: 85vh; overflow-y: auto;
  animation: fadeUp 0.3s ease;
}
.modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
.modal-title { font-size: 18px; font-weight: 700; }
.modal-close {
  width: 32px; height: 32px; border-radius: 8px; border: 1px solid var(--border-subtle);
  background: var(--bg-card); color: var(--text-secondary); font-size: 16px; cursor: pointer;
  display: flex; align-items: center; justify-content: center; transition: all 0.2s;
}
.modal-close:hover { border-color: var(--accent-red); color: var(--accent-red); }

.data-table { width: 100%; border-collapse: separate; border-spacing: 0; font-size: 13px; }
.data-table th {
  font-family: 'Space Mono', monospace; font-size: 10px; text-transform: uppercase;
  letter-spacing: 1px; color: var(--text-dim); padding: 10px 12px; text-align: left;
  border-bottom: 1px solid var(--border-subtle); background: var(--bg-card); position: sticky; top: 0;
}
.data-table th:first-child { border-radius: 8px 0 0 0; }
.data-table th:last-child { border-radius: 0 8px 0 0; }
.data-table td {
  padding: 10px 12px; border-bottom: 1px solid rgba(148,163,184,0.06);
  color: var(--text-secondary); vertical-align: top;
}
.data-table tr:hover td { background: rgba(255,255,255,0.02); }
.data-table .empty-row td { color: var(--text-dim); font-style: italic; }

.req-badges { display: flex; gap: 10px; margin-bottom: 16px; flex-wrap: wrap; }
.req-badge {
  font-size: 12px; font-weight: 600; padding: 6px 14px; border-radius: 20px;
  border: 1px solid var(--border-subtle); background: var(--bg-card); color: var(--text-secondary);
}
.req-badge.met { border-color: var(--accent-green); background: rgba(34,197,94,0.1); color: var(--accent-green); }

.btn-copy {
  font-family: 'Outfit', sans-serif; font-size: 13px; font-weight: 600;
  padding: 8px 18px; border-radius: 8px; border: 1px solid var(--border-subtle);
  background: var(--bg-card); color: var(--text-primary); cursor: pointer; transition: all 0.25s;
  display: flex; align-items: center; gap: 6px;
}
.btn-copy:hover { border-color: var(--accent-cyan); background: var(--bg-card-hover); }
.btn-copy.copied { border-color: var(--accent-green); color: var(--accent-green); }

.rules-list { list-style: none; padding: 0; }
.rules-list li {
  padding: 10px 0; border-bottom: 1px solid var(--border-subtle);
  font-size: 14px; color: var(--text-secondary); line-height: 1.6; display: flex; gap: 10px;
}
.rules-list li:last-child { border-bottom: none; }
.rule-num { font-family: 'Space Mono', monospace; font-size: 12px; color: var(--accent-cyan); flex-shrink: 0; margin-top: 1px; }

.complete-banner {
  display: none; background: linear-gradient(135deg, rgba(34,197,94,0.15), rgba(6,182,212,0.15));
  border: 1px solid var(--accent-green); border-radius: 14px; padding: 20px 24px;
  margin-bottom: 24px; text-align: center; animation: fadeUp 0.5s ease;
}
.complete-banner.show { display: block; }
.complete-banner h3 { font-size: 18px; font-weight: 700; color: var(--accent-green); margin-bottom: 4px; }
.complete-banner p { font-size: 13px; color: var(--text-secondary); }

.toast {
  position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%) translateY(80px);
  background: var(--accent-green); color: var(--bg-deep); padding: 12px 24px;
  border-radius: 10px; font-weight: 600; font-size: 14px; z-index: 600;
  opacity: 0; transition: all 0.4s cubic-bezier(0.22,1,0.36,1); pointer-events: none;
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

@media (max-width: 900px) {
  .main-layout { grid-template-columns: 1fr; grid-template-rows: auto 1fr; }
  .sidebar { border-right: none; border-bottom: 1px solid var(--border-subtle); display: flex; flex-direction: column; padding: 12px; }
  .scenario-cards-wrap { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 6px; }
  .scenario-card { min-width: 180px; flex-shrink: 0; margin-bottom: 0; }
  .gauge-rail { display: none; }
  .center { padding: 20px 16px; }
  .progress-track { width: 120px; }
  .top-bar { flex-wrap: wrap; gap: 8px; }
}
</style>
</head>
<body>

<div class="top-bar">
  <div class="top-bar-left">
    <div class="brand-icon">üî¨</div>
    <div class="brand-title"><span>Mr. Jawad's Sims</span> ‚Äî Cells Are Everywhere</div>
  </div>
  <div class="top-bar-center">
    <div class="progress-wrap">
      <span class="progress-label">Progress</span>
      <div class="progress-track"><div class="progress-fill" id="progressFill"></div></div>
      <span class="progress-count" id="progressCount">0 / 5</span>
    </div>
  </div>
  <div class="top-bar-right">
    <button class="btn-top" onclick="openModal('dataModal')">üìä Data Table</button>
    <button class="btn-top" onclick="openModal('rulesModal')">üìã Rules</button>
  </div>
</div>

<div class="main-layout">
  <div class="sidebar">
    <div class="sidebar-header">Mission Scenarios</div>
    <div class="sidebar-sub">Complete 5 minimum (all 8 = extra credit). Must include at least 1 ‚¨á DOWN and 1 ‚¨Ü UP story.</div>
    <div class="scenario-cards-wrap" id="scenarioCards"></div>
  </div>

  <div class="center" id="centerContent">
    <div class="welcome-screen" id="welcomeScreen">
      <div class="welcome-icon">üß¨</div>
      <div class="welcome-title">Cells Are Everywhere</div>
      <div class="welcome-sub">Real people. Real events. One thing in common: their stories start inside a single cell.</div>
      <div class="mission-box">
        <div class="mission-label">Your Mission</div>
        <div class="mission-text">Investigate <strong>8 real cell stories</strong>. Read what happened inside each person's cells. Record your findings. Unlock the secret: <strong>every part of your body comes down to what your cells are doing right now.</strong></div>
        <div class="rule-chips">
          <span class="rule-chip">5 scenarios required</span>
          <span class="rule-chip">All 8 = extra credit</span>
          <span class="rule-chip">Pick your reading level</span>
          <span class="rule-chip">Any order you want</span>
        </div>
      </div>
      <button class="welcome-start-btn" onclick="dismissWelcome()">Begin Investigation ‚ûú</button>
    </div>

    <div class="scenario-view" id="scenarioView">
      <div class="complete-banner" id="completeBanner"><h3>‚úÖ Mission Complete!</h3><p>You've completed 5 scenarios. Keep going for extra credit, or check your data table!</p></div>
      <div class="sv-header">
        <div class="sv-emoji" id="svEmoji"></div>
        <div class="sv-title" id="svTitle"></div>
      </div>
      <div class="sv-premise" id="svPremise"></div>
      <div class="level-select" id="levelSelect">
        <button class="level-btn" data-level="low" onclick="selectLevel('low')">Low<span class="level-label">3‚Äì4 sentences</span></button>
        <button class="level-btn" data-level="medium" onclick="selectLevel('medium')">Medium<span class="level-label">5‚Äì6 sentences</span></button>
        <button class="level-btn" data-level="high" onclick="selectLevel('high')">High<span class="level-label">7‚Äì8 sentences</span></button>
      </div>
      <div class="steps-indicator" id="stepsIndicator">
        <div class="step-pip" data-step="0"></div>
        <div class="step-pip" data-step="1"></div>
        <div class="step-pip" data-step="2"></div>
        <div class="step-pip" data-step="3"></div>
      </div>

      <div class="step-panel" id="stepPredict">
        <div class="step-label"><span class="step-num">1</span> PREDICT</div>
        <div class="predict-box">
          <div class="predict-q" id="predictQ"></div>
          <textarea class="predict-input" id="predictInput" placeholder="Type your prediction here..."></textarea>
        </div>
        <div class="step-nav"><button class="btn-next" id="btnPredictNext" onclick="goStep(1)" disabled>Next: Read ‚ûú</button></div>
      </div>

      <div class="step-panel" id="stepRead">
        <div class="step-label"><span class="step-num">2</span> READ</div>
        <div class="read-box">
          <div class="read-text" id="readText"></div>
          <div class="read-aloud-row">
            <button class="read-aloud-btn" id="readAloudBtn" onclick="toggleReadAloud()" title="Read aloud">üîä</button>
            <span class="read-aloud-hint">Tap the speaker to hear this read.</span>
          </div>
        </div>
        <div class="step-nav"><button class="btn-next" onclick="goStep(2)">Next: Watch ‚ûú</button></div>
      </div>

      <div class="step-panel" id="stepWatch">
        <div class="step-label"><span class="step-num">3</span> WATCH</div>
        <div class="watch-box">
          <div class="watch-canvas-wrap"><canvas id="watchCanvas"></canvas></div>
          <div class="watch-desc" id="watchDesc"></div>
        </div>
        <div class="step-nav"><button class="btn-next" onclick="goStep(3)">Next: Record ‚ûú</button></div>
      </div>

      <div class="step-panel" id="stepRecord">
        <div class="step-label"><span class="step-num">4</span> RECORD</div>
        <div class="record-box">
          <div class="record-field">
            <div class="record-label">What Happened?</div>
            <textarea class="record-input" id="recWhat" placeholder="Describe what happened in the story..."></textarea>
          </div>
          <div class="record-field">
            <div class="record-label">Person/Situation Response</div>
            <textarea class="record-input" id="recResponse" placeholder="How did the person or situation respond?"></textarea>
          </div>
          <div class="record-field">
            <div class="record-label">Connection to Cells?</div>
            <textarea class="record-input" id="recConnection" placeholder='Use: "This happened because the ____ (cell membrane / nucleus / organelle / cell wall / cell division) ____."'></textarea>
            <div class="record-hint">Starter: "This happened because the ____ (cell membrane / nucleus / organelle / cell wall / cell division) ____."</div>
          </div>
        </div>
        <div class="step-nav"><button class="btn-submit" id="btnRecordSubmit" onclick="submitRecord()" disabled>‚úì Save & Complete</button></div>
      </div>
    </div>
  </div>

  <div class="gauge-rail">
    <div class="gauge-title">Cell State</div>
    <div class="gauge-container">
      <div class="gauge-zones">
        <div class="gz crit-high"></div><div class="gz high"></div><div class="gz ok"></div><div class="gz low"></div><div class="gz crit-low"></div>
      </div>
      <div class="gauge-indicator state-ok" id="gaugeIndicator">
        <div class="cell-inner"><div class="membrane"></div><div class="nuc"></div></div>
      </div>
    </div>
    <div class="gauge-labels">
      <span class="gl">CRIT</span><span class="gl">HIGH</span><span class="gl">OK</span><span class="gl">LOW</span><span class="gl">CRIT</span>
    </div>
  </div>
</div>

<div class="modal-overlay" id="dataModal">
  <div class="modal-box">
    <div class="modal-header">
      <div class="modal-title">üìä Your Data Table</div>
      <div style="display:flex;gap:10px;align-items:center;">
        <button class="btn-copy" id="btnCopy" onclick="copyDataTable()">üìã Copy to Clipboard</button>
        <button class="modal-close" onclick="closeModal('dataModal')">‚úï</button>
      </div>
    </div>
    <div class="req-badges" id="reqBadges"></div>
    <table class="data-table">
      <thead><tr><th style="width:15%">Scenario</th><th style="width:28%">What Happened?</th><th style="width:28%">Person/Situation Response</th><th style="width:29%">Connection to Cells?</th></tr></thead>
      <tbody id="dataTableBody"></tbody>
    </table>
  </div>
</div>

<div class="modal-overlay" id="rulesModal">
  <div class="modal-box" style="max-width:600px;">
    <div class="modal-header">
      <div class="modal-title">üìã Rules & Instructions</div>
      <button class="modal-close" onclick="closeModal('rulesModal')">‚úï</button>
    </div>
    <ol class="rules-list">
      <li><span class="rule-num">01</span> Pick any scenario from the sidebar. Complete them in any order.</li>
      <li><span class="rule-num">02</span> Choose your reading level (Low, Med, or High). Level does not affect your score.</li>
      <li><span class="rule-num">03</span> Complete all 4 steps: Predict ‚Üí Read ‚Üí Watch ‚Üí Record before moving on.</li>
      <li><span class="rule-num">04</span> <strong>5 scenarios minimum</strong>. All 8 = extra credit.</li>
      <li><span class="rule-num">05</span> Your 5 must include at least <strong>1 DOWN story</strong> (cells damaged: ü§øüî•üîãüèàü©∏) and at least <strong>1 UP story</strong> (cells out of control: üß¨üö®).</li>
      <li><span class="rule-num">06</span> No scenario can be repeated for credit.</li>
    </ol>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const SCENARIOS=[{id:1,title:"The Immortal Woman",emoji:"üß¨",type:"up",premise:"Henrietta Lacks went to the hospital in 1951 with cancer ‚Äî doctors took some of her cells, and those cells never stopped dividing.",gaugeState:"critical-high",predictQ:"A woman named Henrietta Lacks went to the hospital with cancer in 1951. Doctors took some of her cells. What do you think happened to those cells?",readings:{low:'Henrietta Lacks is 31 years old and dying of cancer in 1951. Doctors take some of her <span class="kw">cells</span> without asking. Something shocking happens ‚Äî her <span class="kw">cells</span> never stop dividing. Today, over 70 years later, her <span class="kw">cells</span> are still alive in labs around the world.',medium:'Henrietta Lacks is 31 years old and dying of cancer in a Baltimore hospital in 1951. A doctor takes a sample of her <span class="kw">cells</span> ‚Äî she never finds out. In the lab, something unbelievable happens: her <span class="kw">cells</span> refuse to die. Normal <span class="kw">cells</span> stop dividing after a while, but Henrietta\'s keep going. Scientists name them HeLa <span class="kw">cells</span>. They are still alive today and have been used in over 100,000 studies, including research that led to the polio vaccine.',high:'Henrietta Lacks is 31 years old and dying of cervical cancer at Johns Hopkins Hospital in 1951. A doctor named George Gey takes a sample of her <span class="kw">cells</span> without telling her. In the lab, Gey watches something no scientist has ever seen ‚Äî her <span class="kw">cells</span> divide and never stop. Normal human <span class="kw">cells</span> divide about 40 to 60 times, then quit. Henrietta\'s ignore that limit. The <span class="kw">nucleus</span> in each <span class="kw">cell</span> keeps copying itself perfectly, over and over. Scientists call them HeLa <span class="kw">cells</span>, and they become the most important <span class="kw">cells</span> in medical history. They helped create the polio vaccine and have been used in over 100,000 research studies ‚Äî and <span class="kw">cell division</span> is still happening in labs today.'},watchDesc:"The cell-state gauge jumps past HIGH into CRITICAL as cells split rapidly ‚Äî 2, 4, 8, 16 ‚Äî multiplying without stopping. The nucleus glows brightly as cell division accelerates out of control.",animation:"immortal"},{id:2,title:"The Deep-Sea Diver",emoji:"ü§ø",type:"down",premise:"A scuba diver surfaced too fast and nitrogen bubbles ripped through his cell membrane ‚Äî the barrier holding his cells together failed under pressure.",gaugeState:"low",predictQ:"A scuba diver is deep underwater and surfaces too fast. Tiny nitrogen bubbles form in his blood. What do you think happens to his cells?",readings:{low:'A scuba diver in the Caribbean surfaces too fast after a deep dive. Tiny nitrogen bubbles form in his blood and rip through the <span class="kw">cell membrane</span> on each <span class="kw">cell</span>. The <span class="kw">cell membrane</span> is the barrier that holds everything inside a <span class="kw">cell</span> together ‚Äî when it tears, the cell dies. Doctors rush him to a pressure chamber to save his remaining <span class="kw">cells</span>.',medium:'A scuba diver exploring a reef in the Caribbean makes a dangerous mistake ‚Äî he surfaces too fast. At depth, nitrogen gas dissolves into his blood under pressure. When he rises quickly, that gas forms bubbles, like opening a shaken soda can. The bubbles rip through the <span class="kw">cell membrane</span> on every <span class="kw">cell</span> they hit ‚Äî the thin barrier that holds every <span class="kw">cell</span> together. Without an intact <span class="kw">cell membrane</span>, the <span class="kw">cell</span> cannot protect its <span class="kw">organelles</span> or its <span class="kw">nucleus</span>. Doctors call this "the bends," and without emergency treatment in a pressure chamber, the damaged <span class="kw">cells</span> cannot recover.',high:'A scuba diver exploring a deep reef in the Caribbean makes a critical error ‚Äî he surfaces too fast. At 100 feet below the surface, nitrogen gas from the air he breathes dissolves into his blood under high pressure. When he rises quickly, the pressure drops and that nitrogen forms bubbles ‚Äî like opening a shaken soda can. Those bubbles slam into his <span class="kw">cells</span> and rip through the <span class="kw">cell membrane</span> on each one. The <span class="kw">cell membrane</span> is the barrier that holds everything inside a <span class="kw">cell</span> in place ‚Äî the <span class="kw">organelles</span>, the <span class="kw">nucleus</span>, all of it. When the membrane tears, the cell\'s insides leak out and the cell dies. Doctors rush him into a pressure chamber to force the nitrogen back into solution and give his surviving <span class="kw">cells</span> time to repair. Without the <span class="kw">cell membrane</span>, no <span class="kw">cell</span> in the body can survive.'},watchDesc:"The gauge drops from OK to LOW. A healthy cell with a smooth membrane is hit by bubbles ‚Äî the membrane tears, contents leak out, and the cell collapses.",animation:"diver"},{id:3,title:"The Burn Survivor",emoji:"üî•",type:"down",premise:"A firefighter suffered severe burns on his arms ‚Äî millions of skin cells were destroyed, and his body had to replace them as fast as possible to survive.",gaugeState:"low-to-ok",predictQ:"A firefighter suffers severe burns on both arms. Millions of his skin cells are destroyed by heat. What do you think his body does next?",readings:{low:'A firefighter in Texas suffers severe burns on both arms during a warehouse fire. The heat destroys millions of his skin <span class="kw">cells</span> in seconds. His body responds by speeding up <span class="kw">cell division</span> ‚Äî surviving <span class="kw">cells</span> near the wound start copying themselves fast. The <span class="kw">nucleus</span> in each surviving <span class="kw">cell</span> carries the instructions to build replacements.',medium:'A firefighter in Houston rushes into a burning warehouse and suffers severe burns on both arms. The extreme heat destroys millions of his skin <span class="kw">cells</span> instantly ‚Äî the <span class="kw">cell membrane</span> on each one breaks apart and the <span class="kw">cells</span> die. His body kicks into emergency mode. Surviving <span class="kw">cells</span> near the wound start dividing as fast as they can to close the gap. The <span class="kw">nucleus</span> in each <span class="kw">cell</span> copies its instructions and pushes out new cells at an incredible rate. His body can make about 3.8 million new <span class="kw">cells</span> per second, and every one of those replacement cells needs a working <span class="kw">nucleus</span> to know what to become.',high:'A firefighter in Houston rushes into a burning warehouse to rescue a trapped worker and suffers severe burns on both arms. The extreme heat destroys millions of his skin <span class="kw">cells</span> in seconds ‚Äî the <span class="kw">cell membrane</span> on each one melts, <span class="kw">organelles</span> break apart, and the <span class="kw">cells</span> die. His body has only one option: replace them. Surviving skin <span class="kw">cells</span> near the wound immediately start dividing faster than normal. The <span class="kw">nucleus</span> in each <span class="kw">cell</span> copies every instruction it carries and pushes out daughter cells to fill the gap. The human body replaces about 3.8 million <span class="kw">cells</span> per second under normal conditions ‚Äî after a burn, that number spikes even higher near the wound. New skin cells are built quickly, not perfectly, which is why burns often leave scars. The replacement <span class="kw">cells</span> have a different structure than the originals, but they get the job done ‚Äî sealing the wound and protecting what is underneath.'},watchDesc:"The gauge drops to LOW then slowly climbs back toward OK. Skin cells burn away, leaving a dark gap. Surviving cells at the edges split rapidly as the nucleus glows, filling the wound row by row.",animation:"burn"},{id:4,title:"The Boy Who Lost Energy",emoji:"üîã",type:"down",premise:"Joe Wise loved sports until age 8, when the organelles inside his cells that make energy stopped working.",gaugeState:"low",predictQ:"An 8-year-old boy named Joe loves sports, but suddenly starts feeling weak all the time. Doctors find the problem inside his cells. What do you think went wrong?",readings:{low:'Joe Wise loves baseball and football ‚Äî until age 8, when he starts feeling weak all the time. Doctors run test after test but cannot figure out what is wrong. Finally, they discover the <span class="kw">organelles</span> inside his <span class="kw">cells</span> that make <span class="kw">energy</span> are broken. His <span class="kw">cells</span> look normal from the outside, but the power source inside is failing.',medium:'Joe Wise is an 8-year-old who loves baseball and football more than anything. One day, his legs feel heavy. Then his arms. Then everything. Doctors think he has arthritis or muscular dystrophy, but nothing fits. Years later, they finally find the answer ‚Äî the <span class="kw">organelles</span> inside his <span class="kw">cells</span> that produce <span class="kw">energy</span> are broken. His <span class="kw">cells</span> look completely normal from the outside ‚Äî the <span class="kw">cell membrane</span> is intact ‚Äî but the tiny power sources inside cannot do their job.',high:'Joe Wise is an 8-year-old who lives for baseball and football. Then something changes. His legs feel heavy after short runs. His arms tire from things that used to be easy. Doctors test for arthritis, muscular dystrophy, and a dozen other conditions ‚Äî nothing fits. It takes years to find the real answer: the <span class="kw">organelles</span> inside Joe\'s <span class="kw">cells</span> that turn food into <span class="kw">energy</span> are broken. From the outside, his <span class="kw">cells</span> look perfectly normal ‚Äî the <span class="kw">cell membrane</span> is intact, the <span class="kw">nucleus</span> is there. But the power sources inside are failing, and without <span class="kw">energy</span>, his muscles cannot work the way they should.'},watchDesc:"The gauge drops from OK to LOW. A cell dims as the organelles inside flicker and fade to gray. The cell membrane stays intact, but an ENERGY bar drains to nearly empty.",animation:"energy"},{id:5,title:"The Rutgers Lab Discovery",emoji:"üî¨",type:"down",premise:"In 2025, Rutgers University scientists filmed plant cells building their cell walls in real time ‚Äî and discovered what happens when walls fail to form.",gaugeState:"low-to-ok",predictQ:"Scientists film a plant cell that has no cell wall yet. What do you think the plant cell looks like without a wall, and what happens when the wall is built?",readings:{low:'In 2025, scientists at Rutgers University do something no one has done before ‚Äî they film plant <span class="kw">cells</span> building their <span class="kw">cell walls</span> in real time. Without a <span class="kw">cell wall</span>, a plant <span class="kw">cell</span> collapses like a balloon with no air. The <span class="kw">cell wall</span> is a rigid layer outside the <span class="kw">cell membrane</span> that gives every plant its shape. That same wall material ‚Äî called cellulose ‚Äî ends up in your cotton T-shirts, your paper, and even your ice cream.',medium:'In 2025, scientists at Rutgers University film something no one has ever seen ‚Äî a plant <span class="kw">cell</span> building its <span class="kw">cell wall</span> in real time. They watch cellulose fibers assemble themselves around the outside of the <span class="kw">cell membrane</span>, forming a rigid shell. Without that <span class="kw">cell wall</span>, the plant <span class="kw">cell</span> collapses. With it, the cell holds its shape and the plant stands tall. The <span class="kw">cell wall</span> is the reason a tree trunk is solid and a flower stem stays upright. That same material ‚Äî cellulose ‚Äî is harvested from cotton plants and turned into T-shirts, paper, diapers, and even the thickener in yogurt.',high:'In 2025, a team of scientists at Rutgers University in New Jersey does something that has never been done in the history of biology ‚Äî they film a living plant <span class="kw">cell</span> building its <span class="kw">cell wall</span> in real time. Using advanced cameras, they watch cellulose fibers assemble themselves around the outside of the <span class="kw">cell membrane</span>, creating a rigid shell. Without that <span class="kw">cell wall</span>, the plant <span class="kw">cell</span> has no structure ‚Äî it collapses like a deflated balloon. With the wall in place, the <span class="kw">cell</span> holds a strong rectangular shape. Every plant on Earth depends on <span class="kw">cell walls</span> for support ‚Äî from blades of grass to redwood trees. The cellulose that makes up the <span class="kw">cell wall</span> is the most common natural material on Earth. Humans harvest it from cotton plants to make clothing, from trees to make paper, and even use it as a thickener in yogurt and ice cream.'},watchDesc:"The gauge starts at LOW, then climbs to OK as the wall builds. A floppy plant cell gets a rigid green cell wall assembled around it piece by piece ‚Äî cellulose fibers weave together and the cell snaps into shape.",animation:"rutgers"},{id:6,title:"The Football Stinger",emoji:"üèà",type:"down",premise:"A high school football player took a hard hit and lost all feeling in his arm ‚Äî one of the longest cells in his body was damaged.",gaugeState:"low",predictQ:"A football player takes a hard hit and his entire arm goes numb. The problem is one single cell that runs from his neck to his hand. What do you think happened to that cell?",readings:{low:'A high school football player takes a hard tackle and feels a burning shock down his arm. His arm goes completely numb ‚Äî he cannot move his fingers. The hit stretched one of the longest <span class="kw">cells</span> in his body ‚Äî a single nerve <span class="kw">cell</span> that runs from his neck to his hand. When that <span class="kw">cell</span> is damaged, the electrical signal it carries stops, and the arm shuts down.',medium:'A high school football player takes a hard tackle and instantly feels a burning shock rip down his arm. Then nothing ‚Äî his arm goes completely numb and his fingers will not move. The hit stretched one of the longest <span class="kw">cells</span> in his body: a single nerve <span class="kw">cell</span> running from his spinal cord to his hand. That one <span class="kw">cell</span> can be over 3 feet long. It carries electrical signals at up to 270 miles per hour, controlled by instructions from the <span class="kw">nucleus</span> at the top. When the hit damages the <span class="kw">cell</span>, the signal stops traveling, and the arm shuts down until the <span class="kw">cell</span> can repair itself.',high:'A high school football player takes a helmet-to-shoulder tackle and feels a burning shock rip from his neck down to his fingertips. Then his whole arm goes dead ‚Äî numb, heavy, unable to move. Trainers call it a "stinger." The hit stretched one of the longest <span class="kw">cells</span> in his body: a single nerve <span class="kw">cell</span> that runs from his spinal cord to his hand ‚Äî over 3 feet of one continuous <span class="kw">cell</span>. Under normal conditions, that nerve <span class="kw">cell</span> fires electrical signals at up to 270 miles per hour. The <span class="kw">nucleus</span> sits at the top, controlling everything, while the <span class="kw">cell membrane</span> wraps the entire length like insulation on a wire. When the tackle damages the <span class="kw">cell</span>, that signal path breaks. No signal means no movement ‚Äî and the arm shuts down completely until the <span class="kw">cell</span> can repair the damage.'},watchDesc:"The gauge drops from OK to LOW. A long nerve cell stretches across the screen. A signal spark races along it ‚Äî then a red impact hits, the spark dies, and the hand at the end goes gray.",animation:"football"},{id:7,title:"Dr. Hayflick's Discovery",emoji:"üö®",type:"up",premise:"In 1961, scientist Leonard Hayflick discovered that normal cells stop dividing after 40‚Äì60 times ‚Äî and that cancer cells ignore this limit completely.",gaugeState:"critical-high",predictQ:"A scientist discovers that normal cells can only divide a certain number of times before they stop. But some cells break that rule. What do you think happens when cells ignore the limit?",readings:{low:'In 1961, scientist Leonard Hayflick discovers something nobody expected ‚Äî normal <span class="kw">cells</span> can only divide about 40 to 60 times, then they stop forever. The <span class="kw">nucleus</span> sends a signal that says "quit." But cancer <span class="kw">cells</span> ignore the signal. They keep dividing without limit, piling up into tumors that crowd out healthy <span class="kw">cells</span>.',medium:'In 1961, biologist Leonard Hayflick makes a discovery that changes medicine forever. He finds that normal human <span class="kw">cells</span> can only divide about 40 to 60 times before the <span class="kw">nucleus</span> shuts <span class="kw">cell division</span> down for good. Scientists call this the Hayflick Limit. But cancer <span class="kw">cells</span> break the rule. Something goes wrong in the <span class="kw">nucleus</span>, and the stop signal never fires. The <span class="kw">cells</span> keep dividing without limit ‚Äî piling up into tumors that crowd out and kill the healthy <span class="kw">cells</span> around them.',high:'In 1961, a biologist named Leonard Hayflick notices something strange in his lab. The human <span class="kw">cells</span> he is growing stop dividing after about 40 to 60 rounds ‚Äî every time, without fail. He discovers that the <span class="kw">nucleus</span> has a built-in counter that shuts <span class="kw">cell division</span> down when the limit is reached. Scientists name it the Hayflick Limit, and it changes everything we know about aging and disease. But cancer <span class="kw">cells</span> break this rule completely. A mutation in the <span class="kw">nucleus</span> disables the stop signal, and the <span class="kw">cell</span> keeps dividing without any limit. These out-of-control <span class="kw">cells</span> pile up into tumors that invade healthy tissue. About 90 percent of solid tumors contain <span class="kw">cells</span> with the wrong number of chromosomes ‚Äî proof that <span class="kw">cell division</span> went seriously wrong.'},watchDesc:"The gauge climbs past HIGH into CRITICAL. A grid of green cells divides normally until hitting a STOP line. One cell turns red, blasts through the limit, and keeps splitting ‚Äî chaotic red clumps push healthy cells aside.",animation:"hayflick"},{id:8,title:"The Sickle Cell Fighter",emoji:"ü©∏",type:"down",premise:"A teenager with sickle cell disease lives with red blood cells whose cell membrane warps into a stiff sickle shape, blocking blood flow and causing intense pain.",gaugeState:"critical-low",predictQ:"A teenager's red blood cells are supposed to be round and smooth. Instead, they are shaped like a crescent moon. What do you think happens when these stiff cells try to move through tiny blood vessels?",readings:{low:'A 15-year-old named Marcus has sickle cell disease. His red blood <span class="kw">cells</span> are supposed to be round and smooth, but the <span class="kw">cell membrane</span> on each one warps into a stiff crescent shape. The sickle-shaped <span class="kw">cells</span> get stuck in his blood vessels and block blood flow. When blood cannot get through, Marcus feels extreme pain and his organs do not get the oxygen they need.',medium:'Marcus is 15 years old and lives with sickle cell disease ‚Äî a condition that changes the shape of his red blood <span class="kw">cells</span>. Normal red blood <span class="kw">cells</span> are round and flexible, sliding easily through blood vessels. Marcus\'s <span class="kw">cells</span> are different. The <span class="kw">cell membrane</span> on each of his red blood cells warps into a stiff crescent shape called a sickle. These rigid <span class="kw">cells</span> jam together inside narrow blood vessels and block blood flow completely. When blood flow stops, Marcus\'s muscles and organs do not get oxygen ‚Äî causing intense pain that can last for hours or days.',high:'Marcus is 15 years old and has sickle cell disease ‚Äî a genetic condition that affects the shape of his red blood <span class="kw">cells</span>. Normal red blood <span class="kw">cells</span> are round and flexible, with a smooth <span class="kw">cell membrane</span> that lets them squeeze through the tiniest blood vessels. Marcus\'s <span class="kw">cells</span> are built differently. A change in his DNA causes the <span class="kw">cell membrane</span> on each red blood cell to warp into a stiff crescent shape ‚Äî like a sickle blade. These rigid <span class="kw">cells</span> cannot bend. They pile up inside narrow blood vessels and create blockages that stop blood flow completely. When blood stops flowing, oxygen cannot reach Marcus\'s muscles and organs. The result is a pain crisis ‚Äî intense, stabbing pain that can last for hours or days and sometimes sends Marcus to the hospital.'},watchDesc:"The gauge drops from OK into LOW, nearly touching CRITICAL. Round red blood cells flow through a vessel, then some warp into crescent shapes. The sickle cells jam together and block the vessel ‚Äî blood flow stops and a pain indicator flashes.",animation:"sickle"}];

let completedScenarios={},currentScenarioId=null,currentStep=0,currentLevel=null,welcomeDismissed=false,speaking=false,animFrame=null;

function init(){renderSidebar();renderDataTable();updateProgress();updateReqBadges();}

function renderSidebar(){
  const w=document.getElementById('scenarioCards');w.innerHTML='';
  SCENARIOS.forEach(s=>{const c=document.createElement('div');c.className='scenario-card'+(completedScenarios[s.id]?' completed':'')+(currentScenarioId===s.id?' active':'');c.id='sc-card-'+s.id;c.onclick=()=>selectScenario(s.id);c.innerHTML=`<div class="sc-top"><div class="sc-left"><div class="sc-emoji">${s.emoji}</div><div class="sc-title">${s.title}</div></div><div class="sc-check">‚úì</div></div><span class="sc-tag ${s.type==='down'?'down':'up'}">${s.type==='down'?'‚¨á Cells Damaged':'‚¨Ü Cells Out of Control'}</span>`;w.appendChild(c);});
}

function dismissWelcome(){welcomeDismissed=true;document.getElementById('welcomeScreen').style.display='none';document.getElementById('scenarioView').classList.add('active');document.getElementById('svEmoji').textContent='üëà';document.getElementById('svTitle').textContent='Pick a Scenario';document.getElementById('svPremise').textContent='Choose any scenario from the sidebar to begin your investigation.';document.getElementById('levelSelect').style.display='none';document.getElementById('stepsIndicator').style.display='none';hideAllSteps();}

function selectScenario(id){
  if(completedScenarios[id])return;if(!welcomeDismissed)dismissWelcome();stopSpeech();if(animFrame){cancelAnimationFrame(animFrame);animFrame=null;}
  currentScenarioId=id;currentStep=0;currentLevel=null;const s=SCENARIOS.find(x=>x.id===id);
  document.querySelectorAll('.scenario-card').forEach(c=>c.classList.remove('active'));document.getElementById('sc-card-'+id).classList.add('active');
  document.getElementById('scenarioView').classList.add('active');document.getElementById('svEmoji').textContent=s.emoji;document.getElementById('svTitle').textContent=s.title;document.getElementById('svPremise').textContent=s.premise;document.getElementById('predictQ').textContent=s.predictQ;
  document.getElementById('levelSelect').style.display='flex';document.querySelectorAll('.level-btn').forEach(b=>b.classList.remove('selected'));document.getElementById('stepsIndicator').style.display='none';hideAllSteps();
  document.getElementById('predictInput').value='';document.getElementById('recWhat').value='';document.getElementById('recResponse').value='';document.getElementById('recConnection').value='';document.getElementById('btnPredictNext').disabled=true;document.getElementById('btnRecordSubmit').disabled=true;
  setGauge('ok');document.getElementById('centerContent').scrollTop=0;
}

function selectLevel(l){currentLevel=l;document.querySelectorAll('.level-btn').forEach(b=>b.classList.remove('selected'));document.querySelector(`.level-btn[data-level="${l}"]`).classList.add('selected');document.getElementById('stepsIndicator').style.display='flex';currentStep=0;showStep(0);updateStepPips();}

function hideAllSteps(){['stepPredict','stepRead','stepWatch','stepRecord'].forEach(id=>document.getElementById(id).classList.remove('active'));}
function showStep(s){hideAllSteps();const p=['stepPredict','stepRead','stepWatch','stepRecord'];document.getElementById(p[s]).classList.add('active');if(s===1)loadReadingText();if(s===2)runWatchAnimation();}
function updateStepPips(){document.querySelectorAll('.step-pip').forEach(p=>{const s=parseInt(p.dataset.step);p.classList.remove('done','current');if(s<currentStep)p.classList.add('done');if(s===currentStep)p.classList.add('current');});}
function goStep(n){stopSpeech();currentStep=n;showStep(n);updateStepPips();document.getElementById('centerContent').scrollTop=0;}

document.getElementById('predictInput').addEventListener('input',function(){document.getElementById('btnPredictNext').disabled=this.value.trim().length<3;});

function loadReadingText(){const s=SCENARIOS.find(x=>x.id===currentScenarioId);document.getElementById('readText').innerHTML=s.readings[currentLevel];}

function toggleReadAloud(){
  if(speaking){stopSpeech();return;}
  const t=document.getElementById('readText').textContent;
  if('speechSynthesis' in window){const u=new SpeechSynthesisUtterance(t);u.rate=0.9;u.onend=()=>{speaking=false;document.getElementById('readAloudBtn').classList.remove('speaking');};u.onerror=()=>{speaking=false;document.getElementById('readAloudBtn').classList.remove('speaking');};speaking=true;document.getElementById('readAloudBtn').classList.add('speaking');window.speechSynthesis.speak(u);}
}
function stopSpeech(){if('speechSynthesis' in window)window.speechSynthesis.cancel();speaking=false;const b=document.getElementById('readAloudBtn');if(b)b.classList.remove('speaking');}

function setGauge(state){document.getElementById('gaugeIndicator').className='gauge-indicator state-'+state;}

function runWatchAnimation(){
  const s=SCENARIOS.find(x=>x.id===currentScenarioId);const canvas=document.getElementById('watchCanvas');const wrap=canvas.parentElement;
  canvas.width=wrap.clientWidth*2;canvas.height=wrap.clientHeight*2;canvas.style.width=wrap.clientWidth+'px';canvas.style.height=wrap.clientHeight+'px';
  const ctx=canvas.getContext('2d');ctx.scale(2,2);const W=wrap.clientWidth,H=wrap.clientHeight;
  document.getElementById('watchDesc').textContent=s.watchDesc;
  if(s.gaugeState==='low-to-ok'){
    setTimeout(()=>setGauge('low'),400);
    setTimeout(()=>setGauge('ok'),4000);
  } else if(s.id===8 && currentLevel==='high'){
    // Sickle cell at HIGH: push nearly to critical
    setTimeout(()=>setGauge('low'),400);
    setTimeout(()=>setGauge('critical-low'),1800);
  } else {
    setTimeout(()=>setGauge(s.gaugeState),600);
  }
  if(animFrame)cancelAnimationFrame(animFrame);
  anims[s.animation](ctx,W,H);
}

const anims={
  immortal(ctx,W,H){let cells=[{x:W/2,y:H/2,r:18}];let f=0;function d(){if(f>180)return;ctx.fillStyle='#0a0e1a';ctx.fillRect(0,0,W,H);if(f%30===25&&cells.length<40){const n=[];cells.forEach(c=>{if(Math.random()<0.5&&cells.length+n.length<40)n.push({x:c.x+(Math.random()-.5)*30,y:c.y+(Math.random()-.5)*20,r:12});});cells=cells.concat(n);}cells.forEach(c=>{const p=1+Math.sin(f*.1+c.x)*.1;ctx.beginPath();ctx.arc(c.x,c.y,c.r*p,0,Math.PI*2);ctx.fillStyle=f>60?'rgba(239,68,68,0.25)':'rgba(34,197,94,0.2)';ctx.fill();ctx.strokeStyle=f>60?'#ef4444':'#22c55e';ctx.lineWidth=1.5;ctx.stroke();ctx.beginPath();ctx.arc(c.x,c.y,5*p,0,Math.PI*2);ctx.fillStyle=f>60?'rgba(239,68,68,0.7)':'rgba(6,182,212,0.7)';ctx.fill();});ctx.fillStyle='#94a3b8';ctx.font='11px "Space Mono",monospace';ctx.fillText('CELLS: '+cells.length,10,20);if(f>90){ctx.fillStyle='#ef4444';ctx.fillText('‚ö† UNLIMITED DIVISION',10,36);}f++;animFrame=requestAnimationFrame(d);}d();},

  diver(ctx,W,H){let f=0;const cx=W/2,cy=H/2,cr=40;let holes=[],leaked=[];function d(){if(f>200)return;ctx.fillStyle='#0a1628';ctx.fillRect(0,0,W,H);for(let i=0;i<8;i++){ctx.beginPath();ctx.arc(30+i*50+Math.sin(f*.02+i)*10,H-(f*.5+i*30)%H,3+i%3,0,Math.PI*2);ctx.fillStyle='rgba(59,130,246,0.15)';ctx.fill();}if(f<80){ctx.beginPath();ctx.arc(cx,cy,cr,0,Math.PI*2);ctx.strokeStyle='#22c55e';ctx.lineWidth=3;ctx.stroke();ctx.fillStyle='rgba(34,197,94,0.1)';ctx.fill();}else{for(let a=0;a<Math.PI*2;a+=.3){if(!holes.some(h=>Math.abs(h-a)<.4)){ctx.beginPath();ctx.arc(cx+Math.cos(a)*cr,cy+Math.sin(a)*cr,2,0,Math.PI*2);ctx.fillStyle='rgba(239,68,68,0.5)';ctx.fill();}}leaked.forEach(l=>{l.x+=l.vx;l.y+=l.vy;l.a*=.98;ctx.beginPath();ctx.arc(l.x,l.y,3,0,Math.PI*2);ctx.fillStyle=`rgba(6,182,212,${l.a})`;ctx.fill();});}if(f<140){ctx.beginPath();ctx.arc(cx,cy,12,0,Math.PI*2);ctx.fillStyle=`rgba(6,182,212,${f<80?.8:Math.max(0,.8-(f-80)*.01)})`;ctx.fill();}if(f<120){[[cx-15,cy-10],[cx+12,cy+8],[cx-8,cy+14]].forEach(([ox,oy])=>{ctx.beginPath();ctx.arc(ox,oy,4,0,Math.PI*2);ctx.fillStyle='rgba(168,85,247,0.4)';ctx.fill();});}if(f>50&&f<90){const nb=Math.min(6,Math.floor((f-50)/5));for(let i=0;i<nb;i++){const a=(i/6)*Math.PI*2+f*.05;const dist=cr+20-(f-50)*.8;const bx=cx+Math.cos(a)*Math.max(dist,cr-5);const by=cy+Math.sin(a)*Math.max(dist,cr-5);ctx.beginPath();ctx.arc(bx,by,5,0,Math.PI*2);ctx.fillStyle='rgba(245,158,11,0.6)';ctx.fill();}}if(f===80){holes=[.5,1.8,3.2,4.5,5.5];for(let i=0;i<10;i++){const a=Math.random()*Math.PI*2;leaked.push({x:cx+Math.cos(a)*20,y:cy+Math.sin(a)*20,vx:Math.cos(a)*.8,vy:Math.sin(a)*.8,a:.7});}}ctx.fillStyle='#94a3b8';ctx.font='11px "Space Mono",monospace';if(f<60)ctx.fillText('CELL MEMBRANE: INTACT',10,20);else if(f>=80){ctx.fillStyle='#ef4444';ctx.fillText('CELL MEMBRANE: RUPTURED',10,20);}f++;animFrame=requestAnimationFrame(d);}d();},

  burn(ctx,W,H){let f=0;const cols=12,rows=6,cw=W/cols,ch=(H-30)/rows;let grid=[];for(let r=0;r<rows;r++){grid[r]=[];for(let c=0;c<cols;c++)grid[r][c]={state:'alive',regen:0};}const bs=3,be=8;let rep=0;function d(){if(f>220)return;ctx.fillStyle='#0a0e1a';ctx.fillRect(0,0,W,H);if(f>30&&f<60){const p=(f-30)/30;for(let r=0;r<rows;r++)for(let c=bs;c<=be;c++)if(Math.random()<p*.3)grid[r][c].state='dead';}if(f===60)for(let r=0;r<rows;r++)for(let c=bs;c<=be;c++)grid[r][c].state='dead';if(f>80){for(let r=0;r<rows;r++)for(let c=bs;c<=be;c++){if(grid[r][c].state==='dead'){const hn=(c>0&&grid[r][c-1].state!=='dead')||(c<cols-1&&grid[r][c+1].state!=='dead');if(hn&&Math.random()<.03){grid[r][c].state='regen';grid[r][c].regen=f;rep++;}}}}for(let r=0;r<rows;r++)for(let c=0;c<cols;c++){const x=c*cw+2,y=r*ch+2,w=cw-4,h=ch-4;ctx.beginPath();const rr=4;ctx.moveTo(x+rr,y);ctx.lineTo(x+w-rr,y);ctx.quadraticCurveTo(x+w,y,x+w,y+rr);ctx.lineTo(x+w,y+h-rr);ctx.quadraticCurveTo(x+w,y+h,x+w-rr,y+h);ctx.lineTo(x+rr,y+h);ctx.quadraticCurveTo(x,y+h,x,y+h-rr);ctx.lineTo(x,y+rr);ctx.quadraticCurveTo(x,y,x+rr,y);ctx.closePath();if(grid[r][c].state==='alive'){ctx.fillStyle='rgba(34,197,94,0.3)';ctx.strokeStyle='#22c55e';}else if(grid[r][c].state==='dead'){ctx.fillStyle=f<60?'rgba(239,68,68,0.4)':'rgba(30,30,30,0.5)';ctx.strokeStyle=f<60?'#ef4444':'#333';}else{const age=f-grid[r][c].regen;ctx.fillStyle=`rgba(6,182,212,${.2+Math.min(1,age/30)*.2})`;ctx.strokeStyle='#06b6d4';}ctx.fill();ctx.lineWidth=1;ctx.stroke();if(grid[r][c].state!=='dead'){ctx.beginPath();ctx.arc(x+w/2,y+h/2,3,0,Math.PI*2);ctx.fillStyle=grid[r][c].state==='regen'?'rgba(6,182,212,0.8)':'rgba(34,197,94,0.6)';ctx.fill();}}ctx.fillStyle='#94a3b8';ctx.font='11px "Space Mono",monospace';ctx.fillText('CELLS REPLACED: '+rep,10,H-8);if(f>30&&f<65){ctx.fillStyle='#ef4444';ctx.fillText('üî• BURN DAMAGE',W-140,20);}if(f>80){ctx.fillStyle='#06b6d4';ctx.fillText('REGENERATING...',W-140,20);}f++;animFrame=requestAnimationFrame(d);}d();},

  energy(ctx,W,H){let f=0;const cx=W/2,cy=H/2,cr=50;const orgs=[];for(let i=0;i<6;i++){const a=(i/6)*Math.PI*2;orgs.push({x:cx+Math.cos(a)*25,y:cy+Math.sin(a)*25});}function d(){if(f>200)return;ctx.fillStyle='#0a0e1a';ctx.fillRect(0,0,W,H);ctx.beginPath();ctx.arc(cx,cy,cr,0,Math.PI*2);ctx.strokeStyle=f<80?'#22c55e':'#64748b';ctx.lineWidth=2.5;ctx.stroke();ctx.fillStyle='rgba(34,197,94,0.05)';ctx.fill();ctx.beginPath();ctx.arc(cx,cy,14,0,Math.PI*2);ctx.fillStyle=f<80?'rgba(6,182,212,0.6)':'rgba(100,116,139,0.4)';ctx.fill();const fade=Math.min(1,Math.max(0,(f-60)/80));orgs.forEach(o=>{const gl=1-fade;ctx.beginPath();ctx.arc(o.x,o.y,7,0,Math.PI*2);ctx.fillStyle=`rgba(245,158,11,${gl*.7+(f>60?Math.random()*.3:0)})`;ctx.fill();if(gl>.3){ctx.beginPath();ctx.arc(o.x,o.y,10,0,Math.PI*2);ctx.strokeStyle=`rgba(245,158,11,${gl*.3})`;ctx.lineWidth=1;ctx.stroke();}});const bW=100,bH=12,bX=cx-bW/2,bY=cy+cr+20;ctx.fillStyle='rgba(255,255,255,0.06)';ctx.fillRect(bX,bY,bW,bH);const en=Math.max(.05,1-fade);ctx.fillStyle=en>.5?'#22c55e':en>.2?'#f59e0b':'#ef4444';ctx.fillRect(bX,bY,bW*en,bH);ctx.strokeStyle='rgba(255,255,255,0.1)';ctx.strokeRect(bX,bY,bW,bH);ctx.fillStyle='#94a3b8';ctx.font='10px "Space Mono",monospace';ctx.fillText('ENERGY',bX,bY-4);const fx=W-60,fy=H/2;if(f<80){ctx.fillStyle='#22c55e';ctx.beginPath();ctx.arc(fx,fy-20,8,0,Math.PI*2);ctx.fill();ctx.strokeStyle='#22c55e';ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(fx,fy-12);ctx.lineTo(fx,fy+5);ctx.stroke();ctx.beginPath();ctx.moveTo(fx,fy+5);ctx.lineTo(fx-8,fy+20);ctx.stroke();ctx.beginPath();ctx.moveTo(fx,fy+5);ctx.lineTo(fx+8,fy+20);ctx.stroke();}else{ctx.fillStyle='#ef4444';ctx.beginPath();ctx.arc(fx,fy-10,8,0,Math.PI*2);ctx.fill();ctx.strokeStyle='#ef4444';ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(fx,fy-2);ctx.lineTo(fx+5,fy+12);ctx.stroke();ctx.beginPath();ctx.moveTo(fx+5,fy+12);ctx.lineTo(fx-3,fy+25);ctx.stroke();ctx.beginPath();ctx.moveTo(fx+5,fy+12);ctx.lineTo(fx+12,fy+25);ctx.stroke();}if(f>100){ctx.fillStyle='#ef4444';ctx.font='11px "Space Mono",monospace';ctx.fillText('POWER SOURCE: FAILING',10,20);}f++;animFrame=requestAnimationFrame(d);}d();},

  rutgers(ctx,W,H){let f=0;const cx=W/2,cy=H/2;function d(){if(f>200)return;ctx.fillStyle='#071210';ctx.fillRect(0,0,W,H);const bp=Math.min(1,Math.max(0,(f-40)/100));ctx.beginPath();ctx.arc(cx,cy,35,0,Math.PI*2);ctx.strokeStyle='rgba(34,197,94,0.4)';ctx.lineWidth=1.5;ctx.stroke();if(f<50){ctx.beginPath();for(let a=0;a<Math.PI*2;a+=.1){const w=30+Math.sin(a*3+f*.1)*8;const px=cx+Math.cos(a)*w;const py=cy+Math.sin(a)*w;a===0?ctx.moveTo(px,py):ctx.lineTo(px,py);}ctx.closePath();ctx.fillStyle='rgba(34,197,94,0.08)';ctx.fill();}if(bp>0){const hw=46,hh=36;const pts=[[cx-hw,cy-hh],[cx+hw,cy-hh],[cx+hw,cy+hh],[cx-hw,cy+hh]];const sides=Math.floor(bp*4);const partial=(bp*4)%1;ctx.beginPath();ctx.moveTo(pts[0][0],pts[0][1]);for(let i=0;i<sides&&i<4;i++)ctx.lineTo(pts[(i+1)%4][0],pts[(i+1)%4][1]);if(sides<4){const fr=pts[sides];const to=pts[(sides+1)%4];ctx.lineTo(fr[0]+(to[0]-fr[0])*partial,fr[1]+(to[1]-fr[1])*partial);}ctx.strokeStyle=`rgba(34,197,94,${.5+bp*.5})`;ctx.lineWidth=4;ctx.stroke();for(let i=0;i<Math.floor(bp*12);i++){const a=(i/12)*Math.PI*2;ctx.beginPath();ctx.moveTo(cx+Math.cos(a)*38,cy+Math.sin(a)*38);ctx.lineTo(cx+Math.cos(a)*52,cy+Math.sin(a)*52);ctx.strokeStyle='rgba(34,197,94,0.3)';ctx.lineWidth=1;ctx.stroke();}}ctx.beginPath();ctx.arc(cx,cy,10,0,Math.PI*2);ctx.fillStyle='rgba(6,182,212,0.5)';ctx.fill();ctx.fillStyle='#94a3b8';ctx.font='11px "Space Mono",monospace';if(f<50)ctx.fillText('WITHOUT WALL: COLLAPSED',10,20);else if(bp>=1){ctx.fillStyle='#22c55e';ctx.fillText('WITH WALL: STRONG ‚úì',10,20);}if(bp>.8){ctx.fillStyle='#94a3b8';ctx.font='11px "Space Mono",monospace';ctx.fillText('CELL WALL ‚Üí CELLULOSE ‚Üí üëï üìÑ üå≤',10,H-12);ctx.fillStyle='#64748b';ctx.font='10px "Space Mono",monospace';ctx.fillText('RUTGERS 2025',W-100,20);}f++;animFrame=requestAnimationFrame(d);}d();},

  football(ctx,W,H){let f=0;const sx=50,ex=W-50,ny=H/2;function d(){if(f>200)return;ctx.fillStyle='#0a0e1a';ctx.fillRect(0,0,W,H);ctx.fillStyle='#64748b';ctx.font='20px sans-serif';ctx.fillText('üß†',sx-15,ny-30);if(f>80)ctx.globalAlpha=.3;ctx.fillText('‚úã',ex-10,ny-30);ctx.globalAlpha=1;ctx.beginPath();ctx.moveTo(sx,ny);ctx.lineTo(ex,ny);ctx.strokeStyle=f>80?'rgba(100,116,139,0.3)':'rgba(6,182,212,0.4)';ctx.lineWidth=8;ctx.stroke();ctx.beginPath();ctx.moveTo(sx,ny);ctx.lineTo(ex,ny);ctx.strokeStyle=f>80?'rgba(100,116,139,0.2)':'rgba(6,182,212,0.2)';ctx.lineWidth=16;ctx.stroke();ctx.beginPath();ctx.arc(sx,ny,12,0,Math.PI*2);ctx.fillStyle='rgba(6,182,212,0.6)';ctx.fill();ctx.fillStyle='#0a0e1a';ctx.font='8px "Space Mono",monospace';ctx.fillText('N',sx-3,ny+3);if(f<80){const spX=sx+(ex-sx)*(f/80);ctx.beginPath();ctx.arc(spX,ny,6,0,Math.PI*2);ctx.fillStyle='#f59e0b';ctx.fill();ctx.beginPath();ctx.arc(spX,ny,10,0,Math.PI*2);ctx.strokeStyle='rgba(245,158,11,0.3)';ctx.lineWidth=2;ctx.stroke();}const ix=(sx+ex)/2;if(f>=70&&f<100){const int=1-(f-70)/30;ctx.beginPath();ctx.arc(ix,ny,20+(f-70)*.5,0,Math.PI*2);ctx.fillStyle=`rgba(239,68,68,${int*.4})`;ctx.fill();ctx.fillStyle='#ef4444';ctx.font='14px sans-serif';ctx.fillText('üí•',ix-8,ny-25);}ctx.fillStyle='#94a3b8';ctx.font='11px "Space Mono",monospace';if(f<70)ctx.fillText('SIGNAL: 270 MPH ‚Üí',10,20);else{ctx.fillStyle='#ef4444';ctx.fillText('SIGNAL: BROKEN ‚úï',10,20);}ctx.fillStyle='#64748b';ctx.font='10px "Space Mono",monospace';ctx.fillText('‚Üê 3 FEET (1 CELL) ‚Üí',W/2-60,H-12);f++;animFrame=requestAnimationFrame(d);}d();},

  hayflick(ctx,W,H){let f=0;let cells=[];const co=10,ro=5;for(let r=0;r<ro;r++)for(let c=0;c<co;c++)cells.push({x:20+c*(W-40)/co,y:20+r*(H-60)/ro});let rC=[];function d(){if(f>240)return;ctx.fillStyle='#0a0e1a';ctx.fillRect(0,0,W,H);if(f>50){ctx.fillStyle='rgba(245,158,11,0.15)';ctx.fillRect(0,0,W,20);ctx.fillStyle='#f59e0b';ctx.font='10px "Space Mono",monospace';ctx.fillText('HAYFLICK LIMIT: 60',W/2-60,16);}cells.forEach(c=>{ctx.beginPath();ctx.arc(c.x+(W-40)/co/2,c.y+(H-60)/ro/2,8,0,Math.PI*2);ctx.fillStyle='rgba(34,197,94,0.3)';ctx.fill();ctx.strokeStyle='#22c55e';ctx.lineWidth=1;ctx.stroke();});if(f===80)rC.push({x:W/2,y:H/2});if(f>80&&f%8===0&&rC.length<35){const p=rC[Math.floor(Math.random()*rC.length)];rC.push({x:p.x+(Math.random()-.5)*30,y:p.y+(Math.random()-.5)*25});}rC.forEach(rc=>{ctx.beginPath();ctx.arc(rc.x,rc.y,8+Math.sin(f*.15)*2,0,Math.PI*2);ctx.fillStyle='rgba(239,68,68,0.35)';ctx.fill();ctx.strokeStyle='#ef4444';ctx.lineWidth=1;ctx.stroke();});if(f>80){ctx.fillStyle='#ef4444';ctx.font='11px "Space Mono",monospace';ctx.fillText('DIVISIONS: '+(60+rC.length*5)+' ‚ö†',10,H-10);}f++;animFrame=requestAnimationFrame(d);}d();},

  sickle(ctx,W,H){let f=0;const vy=H/2,vh=50;let rbcs=[];for(let i=0;i<12;i++)rbcs.push({x:-30-i*40,y:vy+(Math.random()-.5)*20,sickle:i>6,speed:1.2+Math.random()*.5});let blocked=false;const bx=W*.6;function d(){if(f>220)return;ctx.fillStyle='#1a0a0a';ctx.fillRect(0,0,W,H);ctx.fillStyle='rgba(239,68,68,0.08)';ctx.fillRect(0,vy-vh/2,W,vh);ctx.strokeStyle='rgba(239,68,68,0.3)';ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(0,vy-vh/2);ctx.lineTo(W,vy-vh/2);ctx.stroke();ctx.beginPath();ctx.moveTo(0,vy+vh/2);ctx.lineTo(W,vy+vh/2);ctx.stroke();ctx.beginPath();ctx.moveTo(bx-40,vy-vh/2);ctx.lineTo(bx,vy-vh/4);ctx.lineTo(bx+40,vy-vh/2);ctx.fillStyle='#1a0a0a';ctx.fill();ctx.beginPath();ctx.moveTo(bx-40,vy+vh/2);ctx.lineTo(bx,vy+vh/4);ctx.lineTo(bx+40,vy+vh/2);ctx.fill();rbcs.forEach(rbc=>{if(!blocked||rbc.x<bx-10)rbc.x+=rbc.speed;if(rbc.sickle&&rbc.x>bx-15){rbc.x=bx-15+(Math.random()-.5)*5;blocked=true;}if(rbc.x>W+30)rbc.x=-30;if(!rbc.sickle){ctx.beginPath();ctx.ellipse(rbc.x,rbc.y,12,10,0,0,Math.PI*2);ctx.fillStyle='rgba(239,68,68,0.5)';ctx.fill();ctx.strokeStyle='#ef4444';ctx.lineWidth=1.5;ctx.stroke();}else{const wp=Math.min(1,Math.max(0,(f-40)/40));ctx.beginPath();if(wp<1)ctx.ellipse(rbc.x,rbc.y,12,10-wp*5,0,0,Math.PI*2);else{ctx.arc(rbc.x,rbc.y,10,.3,Math.PI-.3);ctx.arc(rbc.x+4,rbc.y,7,Math.PI-.3,.3,true);}ctx.closePath();ctx.fillStyle='rgba(220,38,38,0.6)';ctx.fill();ctx.strokeStyle='#dc2626';ctx.lineWidth=1.5;ctx.stroke();}});if(blocked&&f>100){ctx.fillStyle=`rgba(239,68,68,${.5+Math.sin(f*.1)*.3})`;ctx.beginPath();ctx.arc(bx,vy,6,0,Math.PI*2);ctx.fill();ctx.fillStyle='#ef4444';ctx.font='11px "Space Mono",monospace';ctx.fillText('‚ö† BLOCKED',bx-30,vy-vh/2-10);ctx.fillStyle=`rgba(239,68,68,${.3+Math.sin(f*.15)*.2})`;ctx.font='16px sans-serif';ctx.fillText('‚ö°',bx+30,vy+5);}ctx.fillStyle='#94a3b8';ctx.font='11px "Space Mono",monospace';if(f<60)ctx.fillText('NORMAL: ROUND CELLS',10,20);else if(blocked){ctx.fillStyle='#ef4444';ctx.fillText('SICKLE CELLS: JAMMED',10,20);}if(f>80){ctx.fillStyle='#64748b';ctx.font='10px "Space Mono",monospace';ctx.fillText('Normal: ‚¨≠ Round    Sickle: ‚òΩ Crescent',10,H-10);}f++;animFrame=requestAnimationFrame(d);}d();}
};

['recWhat','recResponse','recConnection'].forEach(id=>{document.getElementById(id).addEventListener('input',checkRecordReady);});
function checkRecordReady(){const w=document.getElementById('recWhat').value.trim(),r=document.getElementById('recResponse').value.trim(),c=document.getElementById('recConnection').value.trim();document.getElementById('btnRecordSubmit').disabled=!(w.length>2&&r.length>2&&c.length>2);}

function submitRecord(){
  const s=SCENARIOS.find(x=>x.id===currentScenarioId);
  completedScenarios[s.id]={title:s.title,what:document.getElementById('recWhat').value.trim(),response:document.getElementById('recResponse').value.trim(),connection:document.getElementById('recConnection').value.trim()};
  // Animate gauge back to OK with a brief hold
  setTimeout(()=>setGauge('ok'),800);
  renderSidebar();renderDataTable();updateProgress();updateReqBadges();
  const count=Object.keys(completedScenarios).length;
  if(count>=5)document.getElementById('completeBanner').classList.add('show');
  showToast('‚úì '+s.title+' complete!');
  // Scroll sidebar to highlight the completed card
  const card=document.getElementById('sc-card-'+s.id);
  if(card)card.scrollIntoView({behavior:'smooth',block:'nearest'});
  currentScenarioId=null;
  document.getElementById('svEmoji').textContent='‚úÖ';document.getElementById('svTitle').textContent=s.title+' ‚Äî Complete!';
  const copyBtn=count>=1?'<div style="margin-top:16px;"><button class="btn-copy" onclick="openModal(\'dataModal\')" style="display:inline-flex;margin-right:8px;">üìä View Data Table</button><button class="btn-copy" onclick="copyDataTable()">üìã Copy Data to Clipboard</button></div>':'';
  document.getElementById('svPremise').innerHTML=(count<5?`Great work! ${5-count} more scenario${5-count>1?'s':''} to go. Pick your next one from the sidebar.`:count<8?'Mission complete! Keep going for extra credit, or check your data table.':'All 8 scenarios done! Amazing work. Check your full data table.')+copyBtn;
  document.getElementById('levelSelect').style.display='none';document.getElementById('stepsIndicator').style.display='none';hideAllSteps();
}

function updateProgress(){const c=Object.keys(completedScenarios).length;document.getElementById('progressFill').style.width=Math.min(100,(c/5)*100)+'%';document.getElementById('progressCount').textContent=c+' / 5'+(c>5?' ‚≠ê':'');}

function renderDataTable(){const tb=document.getElementById('dataTableBody');tb.innerHTML='';SCENARIOS.forEach(s=>{const d=completedScenarios[s.id];const tr=document.createElement('tr');if(!d)tr.className='empty-row';tr.innerHTML=`<td>${s.emoji} ${s.title}</td><td>${d?d.what:'‚Äî'}</td><td>${d?d.response:'‚Äî'}</td><td>${d?d.connection:'‚Äî'}</td>`;tb.appendChild(tr);});}

function updateReqBadges(){const comp=Object.keys(completedScenarios),cnt=comp.length,hD=comp.some(id=>SCENARIOS.find(s=>s.id==id&&s.type==='down')),hU=comp.some(id=>SCENARIOS.find(s=>s.id==id&&s.type==='up'));document.getElementById('reqBadges').innerHTML=`<span class="req-badge ${cnt>=5?'met':''}">${cnt>=5?'‚úì':'‚óã'} 5 Scenarios (${cnt}/5)</span><span class="req-badge ${hD?'met':''}">${hD?'‚úì':'‚óã'} 1+ DOWN Story</span><span class="req-badge ${hU?'met':''}">${hU?'‚úì':'‚óã'} 1+ UP Story</span>${cnt===8?'<span class="req-badge met">‚≠ê ALL 8 ‚Äî Extra Credit!</span>':''}`;}

function copyDataTable(){
  const comp=Object.values(completedScenarios);
  if(!comp.length){showToast('No data to copy yet!');return;}
  let t='Scenario\tWhat Happened?\tPerson/Situation Response\tConnection to Cells?\n';
  SCENARIOS.forEach(s=>{const d=completedScenarios[s.id];if(d)t+=`${s.title}\t${d.what}\t${d.response}\t${d.connection}\n`;});
  navigator.clipboard.writeText(t).then(()=>{const b=document.getElementById('btnCopy');b.classList.add('copied');b.innerHTML='‚úì Copied!';showToast('Data table copied to clipboard!');setTimeout(()=>{b.classList.remove('copied');b.innerHTML='üìã Copy to Clipboard';},2500);}).catch(()=>{const ta=document.createElement('textarea');ta.value=t;document.body.appendChild(ta);ta.select();document.execCommand('copy');document.body.removeChild(ta);showToast('Data table copied!');});
}

function openModal(id){document.getElementById(id).classList.add('show');}
function closeModal(id){document.getElementById(id).classList.remove('show');}
document.querySelectorAll('.modal-overlay').forEach(o=>{o.addEventListener('click',e=>{if(e.target===o)o.classList.remove('show');});});

function showToast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2500);}

init();
</script>
</body>
</html>
