<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Science Department Simulation ‚Äî When Wildlife Takes Over Your Block</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:#1a1a2e;color:#e0e0e0;overflow:hidden;height:100vh;}
.app{display:flex;flex-direction:column;height:100vh;}
.top-bar{background:linear-gradient(135deg,#2d5016,#1b5e20,#2e7d32);padding:8px 20px;display:flex;align-items:center;justify-content:space-between;border-bottom:3px solid #4CAF50;flex-shrink:0;}
.top-bar h1{font-size:18px;color:#fff;font-weight:700;text-shadow:0 2px 4px rgba(0,0,0,0.3);}
.top-bar .mission{font-size:12px;color:#a5d6a7;font-style:italic;}
.main-area{display:flex;flex:1;overflow:hidden;}
.left-sidebar{width:280px;min-width:280px;background:linear-gradient(180deg,#1a1a2e,#16213e);border-right:2px solid #2a2a4a;display:flex;flex-direction:column;overflow-y:auto;}
.left-header{padding:12px 14px 8px;font-size:15px;font-weight:700;color:#81c784;text-align:center;}
.left-header span{color:#a5d6a7;font-size:12px;display:block;margin-top:2px;}
.scenario-list{flex:1;overflow-y:auto;padding:4px 10px;}
.scenario-card{display:flex;align-items:center;gap:10px;padding:10px 12px;margin-bottom:6px;border-radius:10px;cursor:pointer;transition:all 0.3s;border:2px solid transparent;background:rgba(255,255,255,0.04);}
.scenario-card:hover{background:rgba(76,175,80,0.15);border-color:rgba(76,175,80,0.3);}
.scenario-card.active{background:rgba(76,175,80,0.25);border-color:#4CAF50;box-shadow:0 0 12px rgba(76,175,80,0.3);}
.scenario-card.completed{opacity:0.7;border-color:#388E3C;}
.scenario-card.completed::after{content:'‚úì';position:absolute;right:10px;color:#4CAF50;font-weight:700;font-size:18px;}
.scenario-card{position:relative;}
.scenario-card .sc-emoji{font-size:28px;flex-shrink:0;}
.scenario-card .sc-name{font-size:13px;font-weight:600;color:#e0e0e0;line-height:1.3;}
.divider{height:1px;background:linear-gradient(90deg,transparent,#4a4a6a,transparent);margin:10px 14px;}
.reading-section{padding:8px 14px;}
.reading-section h3{font-size:12px;color:#90CAF9;margin-bottom:6px;text-transform:uppercase;letter-spacing:1px;}
.level-tabs{display:flex;gap:4px;}
.level-tab{flex:1;padding:7px 0;text-align:center;border-radius:6px;cursor:pointer;font-size:12px;font-weight:700;transition:all 0.3s;border:1px solid #3a3a5a;background:rgba(255,255,255,0.05);color:#aaa;}
.level-tab.active{background:#1E88E5;color:#fff;border-color:#1E88E5;box-shadow:0 0 8px rgba(30,136,229,0.4);}
.keywords-section{padding:8px 14px;}
.keywords-section h3{font-size:12px;color:#CE93D8;margin-bottom:6px;text-transform:uppercase;letter-spacing:1px;}
.keyword-tag{display:inline-block;background:rgba(156,39,176,0.2);color:#CE93D8;padding:3px 8px;border-radius:4px;font-size:11px;margin:2px;border:1px solid rgba(156,39,176,0.3);}
.left-buttons{padding:10px 14px;display:flex;gap:8px;}
.btn-reset{flex:1;padding:8px;border:none;border-radius:8px;font-weight:700;font-size:12px;cursor:pointer;transition:all 0.3s;}
.btn-reset.red{background:linear-gradient(135deg,#c62828,#e53935);color:#fff;}
.btn-reset.blue{background:linear-gradient(135deg,#1565C0,#1E88E5);color:#fff;}
.btn-reset:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,0.3);}
.center-panel{flex:1;display:flex;flex-direction:column;background:linear-gradient(180deg,#0f1923,#1a2332);overflow:hidden;}
.step-tabs{display:flex;padding:8px 16px;gap:4px;flex-shrink:0;}
.step-tab{flex:1;padding:8px 4px;text-align:center;border-radius:8px 8px 0 0;font-size:12px;font-weight:700;color:#666;background:rgba(255,255,255,0.03);border:1px solid #2a2a4a;border-bottom:none;transition:all 0.4s;}
.step-tab.active{color:#fff;background:rgba(76,175,80,0.2);border-color:#4CAF50;box-shadow:0 0 15px rgba(76,175,80,0.2);animation:tabGlow 2s ease-in-out infinite;}
.step-tab.done{color:#4CAF50;background:rgba(76,175,80,0.1);border-color:#388E3C;}
@keyframes tabGlow{0%,100%{box-shadow:0 0 10px rgba(76,175,80,0.2);}50%{box-shadow:0 0 20px rgba(76,175,80,0.4);}}
.center-content{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:16px;overflow-y:auto;}
.welcome-screen{text-align:center;max-width:500px;}
.welcome-screen .big-icon{font-size:80px;margin-bottom:16px;animation:float 3s ease-in-out infinite;}
@keyframes float{0%,100%{transform:translateY(0);}50%{transform:translateY(-10px);}}
.welcome-screen h2{font-size:24px;color:#81c784;margin-bottom:8px;}
.welcome-screen p{font-size:14px;color:#aaa;line-height:1.6;}
.predict-card,.read-card,.watch-card,.record-card{width:100%;max-width:680px;border-radius:16px;padding:28px;animation:fadeIn 0.4s ease;}
@keyframes fadeIn{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
.predict-card{background:linear-gradient(135deg,rgba(255,152,0,0.15),rgba(255,152,0,0.05));border:2px solid rgba(255,152,0,0.3);}
.predict-card h3{color:#FFB74D;font-size:18px;margin-bottom:14px;}
.predict-card p{color:#ddd;font-size:15px;line-height:1.6;margin-bottom:16px;}
.predict-options{display:flex;flex-direction:column;gap:8px;}
.predict-opt{padding:12px 16px;border-radius:10px;cursor:pointer;border:2px solid rgba(255,152,0,0.2);background:rgba(255,255,255,0.04);color:#e0e0e0;font-size:14px;transition:all 0.3s;text-align:left;}
.predict-opt:hover{border-color:#FF9800;background:rgba(255,152,0,0.15);}
.predict-opt.selected{border-color:#FF9800;background:rgba(255,152,0,0.25);color:#FFB74D;font-weight:600;}
.read-card{background:linear-gradient(135deg,rgba(30,136,229,0.12),rgba(30,136,229,0.04));border:2px solid rgba(30,136,229,0.3);}
.read-card h3{color:#64B5F6;font-size:18px;margin-bottom:4px;}
.read-card .cause-effect{background:rgba(76,175,80,0.15);border-left:4px solid #4CAF50;padding:10px 14px;border-radius:0 8px 8px 0;margin-top:14px;font-size:13px;color:#a5d6a7;}
.read-text{font-size:15px;line-height:1.8;color:#ddd;margin-top:12px;}
.read-text b,.read-text strong{color:#CE93D8;font-weight:700;}
.read-aloud-btn{display:inline-flex;align-items:center;gap:6px;background:rgba(30,136,229,0.2);color:#64B5F6;border:1px solid rgba(30,136,229,0.3);padding:6px 14px;border-radius:20px;cursor:pointer;font-size:12px;margin-top:10px;transition:all 0.3s;}
.read-aloud-btn:hover{background:rgba(30,136,229,0.4);}
.read-aloud-btn.speaking{background:rgba(30,136,229,0.5);animation:pulse 1s infinite;}
@keyframes pulse{0%,100%{opacity:1;}50%{opacity:0.6;}}
.watch-card{background:linear-gradient(135deg,rgba(156,39,176,0.12),rgba(156,39,176,0.04));border:2px solid rgba(156,39,176,0.3);text-align:center;position:relative;overflow:hidden;}
.watch-card h3{color:#CE93D8;font-size:18px;margin-bottom:20px;text-shadow:0 0 20px rgba(156,39,176,0.5);}
.watch-bg-pulse{position:absolute;top:0;left:0;right:0;bottom:0;pointer-events:none;opacity:0;transition:opacity 1s;}
.watch-bg-pulse.active{opacity:1;animation:bgPulseAnim 2s ease-in-out 3;}
@keyframes bgPulseAnim{0%,100%{background:radial-gradient(circle at center,transparent 60%,rgba(255,0,0,0) 100%);}50%{background:radial-gradient(circle at center,rgba(255,60,60,0.08) 20%,transparent 70%);}}
.meter-container{width:100%;max-width:500px;margin:0 auto;position:relative;display:flex;align-items:center;justify-content:center;gap:20px;}
.meter-labels-left{display:flex;flex-direction:column;justify-content:space-between;height:360px;text-align:right;width:100px;}
.meter-labels-right{display:flex;flex-direction:column;justify-content:space-between;height:360px;text-align:left;width:100px;}
.meter-zone-label{font-size:11px;font-weight:700;padding:4px 8px;border-radius:6px;transition:all 0.5s;opacity:0.5;}
.meter-zone-label.lit{opacity:1;transform:scale(1.1);}
.mzl-red{color:#ff5252;background:rgba(255,82,82,0.1);}
.mzl-orange{color:#FF9800;background:rgba(255,152,0,0.1);}
.mzl-green{color:#4CAF50;background:rgba(76,175,80,0.15);}
.mzl-purple{color:#CE93D8;background:rgba(156,39,176,0.1);}
.mzl-dpurple{color:#9C27B0;background:rgba(156,39,176,0.15);}
.meter-col{position:relative;}
.meter-bg{width:90px;height:360px;margin:0 auto;border-radius:45px;background:linear-gradient(180deg,#b71c1c 0%,#c62828 10%,#e53935 18%,#FF6F00 28%,#FF9800 35%,#FFC107 42%,#4CAF50 48%,#2E7D32 52%,#4CAF50 58%,#FFC107 65%,#FF9800 72%,#7B1FA2 82%,#4A148C 92%,#311B92 100%);position:relative;border:3px solid rgba(255,255,255,0.15);box-shadow:0 0 30px rgba(0,0,0,0.6),inset 0 0 20px rgba(0,0,0,0.4),0 0 60px rgba(100,100,255,0.05);}
.meter-glass{position:absolute;top:0;left:0;right:0;bottom:0;border-radius:45px;background:linear-gradient(90deg,rgba(255,255,255,0.18) 0%,rgba(255,255,255,0.03) 40%,transparent 60%,rgba(0,0,0,0.1) 100%);pointer-events:none;}
.meter-ok-zone{position:absolute;left:-8px;right:-8px;top:43%;height:14%;border:2px solid rgba(76,175,80,0.7);border-radius:8px;background:rgba(76,175,80,0.08);box-shadow:0 0 15px rgba(76,175,80,0.2);display:flex;align-items:center;justify-content:center;}
.meter-ok-text{font-size:10px;color:#81c784;font-weight:700;text-transform:uppercase;letter-spacing:2px;text-shadow:0 0 6px rgba(76,175,80,0.5);}
.meter-needle{position:absolute;left:50%;width:110px;height:6px;background:linear-gradient(90deg,transparent,#fff 20%,#fff 80%,transparent);border-radius:3px;transform:translateX(-50%);transition:top 2s cubic-bezier(0.34,1.56,0.64,1);box-shadow:0 0 15px rgba(255,255,255,0.9),0 0 30px rgba(255,255,255,0.4);z-index:5;}
.meter-needle::before{content:'';position:absolute;left:50%;top:50%;width:16px;height:16px;background:radial-gradient(circle,#fff,#ddd);border-radius:50%;transform:translate(-50%,-50%);box-shadow:0 0 10px rgba(255,255,255,0.8);}
.meter-needle.moving{animation:needleGlow 0.5s ease-in-out 4;}
@keyframes needleGlow{0%,100%{box-shadow:0 0 15px rgba(255,255,255,0.9),0 0 30px rgba(255,255,255,0.4);}50%{box-shadow:0 0 25px rgba(255,255,255,1),0 0 50px rgba(255,200,50,0.6);}}
.meter-ticks{position:absolute;top:0;left:0;right:0;bottom:0;pointer-events:none;}
.meter-tick{position:absolute;right:-2px;width:12px;height:2px;background:rgba(255,255,255,0.3);border-radius:1px;}
.meter-particles{position:absolute;top:0;left:0;right:0;bottom:0;pointer-events:none;overflow:hidden;border-radius:45px;}
.m-particle{position:absolute;width:3px;height:3px;border-radius:50%;opacity:0;}
.m-particle.active{animation:mParticleRise 1.5s ease-out forwards;}
@keyframes mParticleRise{0%{opacity:0.8;transform:translateY(0) scale(1);}100%{opacity:0;transform:translateY(-60px) scale(0.3);}}
.zone-readout{margin-top:20px;font-size:22px;font-weight:700;padding:10px 28px;border-radius:12px;display:inline-block;transition:all 0.5s;transform:scale(0);letter-spacing:1px;}
.zone-readout.visible{transform:scale(1);}
.zone-ok{color:#4CAF50;background:rgba(76,175,80,0.15);border:2px solid #4CAF50;box-shadow:0 0 20px rgba(76,175,80,0.3);}
.zone-ooc{color:#FF9800;background:rgba(255,152,0,0.15);border:2px solid #FF9800;box-shadow:0 0 20px rgba(255,152,0,0.3);animation:zoneFlash 1.5s ease-in-out 2;}
.zone-ooc-red{color:#ff5252;background:rgba(255,82,82,0.15);border:2px solid #ff5252;box-shadow:0 0 20px rgba(255,82,82,0.3);animation:zoneFlash 1s ease-in-out 3;}
.zone-collapse{color:#CE93D8;background:rgba(156,39,176,0.15);border:2px solid #9C27B0;box-shadow:0 0 20px rgba(156,39,176,0.3);animation:zoneFlash 0.8s ease-in-out 4;}
@keyframes zoneFlash{0%,100%{opacity:1;}50%{opacity:0.5;}}
.record-card{background:linear-gradient(135deg,rgba(76,175,80,0.12),rgba(76,175,80,0.04));border:2px solid rgba(76,175,80,0.3);text-align:center;}
.record-card h3{color:#81c784;font-size:20px;margin-bottom:10px;}
.record-card p{color:#aaa;font-size:14px;}
.action-bar{padding:12px 16px;display:flex;justify-content:center;gap:10px;flex-shrink:0;}
.action-btn{padding:12px 28px;border:none;border-radius:12px;font-weight:700;font-size:14px;cursor:pointer;transition:all 0.3s;color:#fff;box-shadow:0 4px 12px rgba(0,0,0,0.2);}
.action-btn:hover{transform:translateY(-2px);box-shadow:0 6px 16px rgba(0,0,0,0.3);}
.action-btn:disabled{opacity:0.4;cursor:not-allowed;transform:none;}
.action-btn.green{background:linear-gradient(135deg,#2E7D32,#4CAF50);}
.action-btn.blue{background:linear-gradient(135deg,#1565C0,#1E88E5);}
.action-btn.purple{background:linear-gradient(135deg,#6A1B9A,#9C27B0);}
.action-btn.orange{background:linear-gradient(135deg,#E65100,#FF9800);}
.right-sidebar{width:280px;min-width:280px;background:linear-gradient(180deg,#1a1a2e,#16213e);border-left:2px solid #2a2a4a;display:flex;flex-direction:column;overflow-y:auto;}
.progress-header{padding:12px 14px 6px;font-size:14px;font-weight:700;color:#FFB74D;text-align:center;}
.hud-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px;padding:6px 12px;}
.hud-item{background:rgba(255,255,255,0.05);border-radius:8px;padding:8px;text-align:center;border:1px solid #2a2a4a;}
.hud-item .hud-val{font-size:20px;font-weight:700;color:#fff;}
.hud-item .hud-label{font-size:10px;color:#888;text-transform:uppercase;letter-spacing:0.5px;}
.hud-score .hud-val{color:#FFD54F;}
.hud-streak .hud-val{color:#FF7043;}
.hud-done .hud-val{color:#4CAF50;}
.hud-acc .hud-val{color:#42A5F5;}
.progress-bar-wrap{padding:8px 12px;}
.progress-bar-outer{background:rgba(255,255,255,0.1);border-radius:10px;height:16px;overflow:hidden;position:relative;}
.progress-bar-inner{height:100%;background:linear-gradient(90deg,#4CAF50,#81C784);border-radius:10px;transition:width 0.8s;width:0%;}
.progress-msg{text-align:center;font-size:12px;color:#a5d6a7;padding:4px 12px 8px;min-height:22px;}
.data-header{padding:8px 14px 4px;font-size:13px;font-weight:700;color:#90CAF9;border-top:1px solid #2a2a4a;}
.data-table-wrap{flex:1;overflow-y:auto;padding:4px 8px;}
.data-table{width:100%;border-collapse:collapse;font-size:10px;}
.data-table th{background:rgba(30,136,229,0.2);color:#64B5F6;padding:5px 4px;border:1px solid #2a2a4a;font-size:9px;position:sticky;top:0;}
.data-table td{padding:4px;border:1px solid #2a2a4a;color:#ccc;vertical-align:top;font-size:9px;line-height:1.3;}
.data-table tr:nth-child(even){background:rgba(255,255,255,0.02);}
.badge-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:1000;animation:fadeIn 0.5s;}
.badge-content{background:linear-gradient(135deg,#1a1a2e,#16213e);border:3px solid #FFD54F;border-radius:20px;padding:40px;text-align:center;max-width:440px;box-shadow:0 0 40px rgba(255,213,79,0.3);}
.badge-content .badge-icon{font-size:80px;margin-bottom:16px;animation:float 2s ease-in-out infinite;}
.badge-content h2{color:#FFD54F;font-size:28px;margin-bottom:8px;}
.badge-content p{color:#aaa;font-size:14px;margin-bottom:20px;}
.badge-content button{padding:12px 32px;background:linear-gradient(135deg,#F9A825,#FFD54F);color:#333;border:none;border-radius:10px;font-weight:700;font-size:16px;cursor:pointer;}
.fullmap-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.85);display:flex;align-items:center;justify-content:center;z-index:1000;animation:fadeIn 0.5s;}
.fullmap-content{background:linear-gradient(135deg,#1a1a2e,#0d1117);border:3px solid #4CAF50;border-radius:20px;padding:30px;text-align:center;max-width:600px;width:90%;box-shadow:0 0 40px rgba(76,175,80,0.3);}
.fullmap-content h2{color:#4CAF50;font-size:26px;margin-bottom:6px;}
.fullmap-content p{color:#aaa;font-size:13px;margin-bottom:16px;}
.island-map{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:20px;}
.island-spot{background:rgba(76,175,80,0.15);border:2px solid #4CAF50;border-radius:10px;padding:10px 6px;text-align:center;}
.island-spot .is-emoji{font-size:28px;}
.island-spot .is-name{font-size:10px;color:#a5d6a7;margin-top:4px;}
.fullmap-content button{padding:10px 28px;background:linear-gradient(135deg,#2E7D32,#4CAF50);color:#fff;border:none;border-radius:10px;font-weight:700;font-size:14px;cursor:pointer;}
.particles{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;overflow:hidden;}
.particle{position:absolute;width:4px;height:4px;border-radius:50%;animation:particleFloat 3s ease-in-out infinite;}
@keyframes particleFloat{0%{transform:translateY(0) scale(1);opacity:0.7;}50%{transform:translateY(-20px) scale(1.5);opacity:1;}100%{transform:translateY(-40px) scale(0);opacity:0;}}
::-webkit-scrollbar{width:6px;}
::-webkit-scrollbar-track{background:rgba(255,255,255,0.02);}
::-webkit-scrollbar-thumb{background:#3a3a5a;border-radius:3px;}
.highlight-word{color:#CE93D8;font-weight:700;}
.read-text .sentence{transition:background 0.3s;}
.read-text .sentence.speaking-active{background:rgba(30,136,229,0.3);border-radius:4px;padding:0 2px;}
</style>
</head>
<body>
<div class="app">
<div class="top-bar">
<div>
<h1>üåç Science Department Simulation ‚Äî When Wildlife Takes Over Your Block</h1>
<div class="mission">Read real stories about SI wildlife events and record how each one pushed the ecosystem out of balance.</div>
</div>
</div>
<div class="main-area">
<div class="left-sidebar">
<div class="left-header">Pick Any Story You Like<span id="scenarioCount">0 of 8 completed</span></div>
<div class="scenario-list" id="scenarioList"></div>
<div class="divider"></div>
<div class="reading-section">
<h3>Reading Level</h3>
<div class="level-tabs">
<div class="level-tab active" data-level="low" onclick="setLevel('low')">Low</div>
<div class="level-tab" data-level="med" onclick="setLevel('med')">Med</div>
<div class="level-tab" data-level="high" onclick="setLevel('high')">High</div>
</div>
</div>
<div class="divider"></div>
<div class="keywords-section">
<h3>Key Words</h3>
<div id="keywordsArea">
<span class="keyword-tag">ecosystem</span>
<span class="keyword-tag">population</span>
<span class="keyword-tag">extirpation</span>
<span class="keyword-tag">invasive species</span>
<span class="keyword-tag">native species</span>
<span class="keyword-tag">cascade effect</span>
<span class="keyword-tag">overpopulation</span>
</div>
</div>
<div class="left-buttons">
<button class="btn-reset red" onclick="resetAll()">Reset</button>
<button class="btn-reset blue" onclick="newRun()">New Run</button>
</div>
</div>
<div class="center-panel">
<div class="step-tabs">
<div class="step-tab" id="stab1">1. PREDICT</div>
<div class="step-tab" id="stab2">2. READ</div>
<div class="step-tab" id="stab3">3. WATCH</div>
<div class="step-tab" id="stab4">4. RECORD</div>
</div>
<div class="center-content" id="centerContent">
<div class="welcome-screen">
<div class="big-icon">üèùÔ∏è</div>
<h2>Staten Island Under Siege</h2>
<p>Real wildlife is taking over Staten Island streets, parks, and hospitals. Pick any story from the sidebar to start your investigation. Complete 5 to earn your Ecosystem Investigator badge!</p>
</div>
</div>
<div class="action-bar" id="actionBar"></div>
</div>
<div class="right-sidebar">
<div class="progress-header">üìä Progress</div>
<div class="hud-grid">
<div class="hud-item hud-score"><div class="hud-val" id="hudScore">0</div><div class="hud-label">Score</div></div>
<div class="hud-item hud-streak"><div class="hud-val" id="hudStreak">0</div><div class="hud-label">Streak</div></div>
<div class="hud-item hud-done"><div class="hud-val" id="hudDone">0/5</div><div class="hud-label">Completed</div></div>
<div class="hud-item hud-acc"><div class="hud-val" id="hudAcc">0%</div><div class="hud-label">Accuracy</div></div>
</div>
<div class="progress-bar-wrap">
<div class="progress-bar-outer"><div class="progress-bar-inner" id="progressBar"></div></div>
</div>
<div class="progress-msg" id="progressMsg">Pick 5 stories you like!</div>
<div class="data-header">üìã Data Table</div>
<div class="data-table-wrap">
<table class="data-table">
<thead><tr><th>Scenario</th><th>What Happened?</th><th>What People Did</th><th>Connection</th></tr></thead>
<tbody id="dataBody"></tbody>
</table>
</div>
</div>
</div>
</div>

<script>
const scenarios = [
{id:1,emoji:'üöó',name:'Deer vs. Drivers',
low:{text:'<span class="sentence">Deer came back to Staten Island in the 1990s after being gone for almost 100 years.</span> <span class="sentence">With no predators, the <b>population</b> exploded.</span> <span class="sentence">During fall mating season, deer run across busy roads ‚Äî and deer-car crashes surged to about 45 per month.</span>',cause:'No predators ‚Üí deer population exploded, 45 crashes per month'},
med:{text:'<span class="sentence"><b>Deer</b> were once <b>extirpated</b> from Staten Island ‚Äî gone for nearly a century.</span> <span class="sentence">In the 1990s, they swam back from New Jersey with no natural predators waiting.</span> <span class="sentence">The <b>population</b> grew fast because nothing kept it in check.</span> <span class="sentence">During fall mating season, bucks chase does across roads without stopping for traffic.</span> <span class="sentence">Deer-vehicle collisions hit about 45 per month during the October to December peak ‚Äî a direct <b>cascade effect</b> of missing predators.</span>',cause:'Extirpated species returned with no predators ‚Üí population explosion, 45 collisions per month'},
high:{text:'<span class="sentence"><b>Deer</b> were <b>extirpated</b> from Staten Island by the early 1900s ‚Äî hunters wiped out the local <b>population</b>.</span> <span class="sentence">Nearly a century later, deer swam back from New Jersey across the Raritan Bay.</span> <span class="sentence">With no wolves or natural predators left on the island, nothing controlled their numbers.</span> <span class="sentence">The <b>population</b> exploded to over 2,000 deer by 2017 ‚Äî a clear case of <b>overpopulation</b>.</span> <span class="sentence">During fall mating season, bucks chase does across busy streets without stopping for traffic.</span> <span class="sentence">Deer-vehicle collisions surged to about 45 per month during the October to December peak.</span> <span class="sentence">This is a <b>cascade effect</b> ‚Äî one missing piece (predators) caused a chain of problems across the whole <b>ecosystem</b>.</span>',cause:'No predators ‚Üí overpopulation to 2,000+, cascade of crashes and ecosystem damage'},
meterPos:22,zone:'ooc',zoneLabel:'Out of Control',
predict:'What will happen when deer return to an island with no predators?',
predictOpts:['Population stays the same','Population explodes and causes problems','Predators will appear naturally','Deer will leave on their own'],correctPredict:1,
dataRow:['Deer vs. Drivers','Deer returned with no predators, population exploded to 2,000+','45 deer-car crashes/month during fall; city launched sterilization','No predators ‚Üí overpopulation ‚Üí cascade effect hit drivers']},
{id:2,emoji:'ü¶É',name:'Turkeys at Hospital',
low:{text:'<span class="sentence">Wild turkeys multiplied across Staten Island neighborhoods including near Staten Island University Hospital.</span> <span class="sentence">The turkeys block traffic, damage cars, chase pets, and leave droppings everywhere.</span> <span class="sentence">Nobody can agree on whether to remove them or leave them alone.</span>',cause:'Turkeys multiplied with no natural checks ‚Üí block traffic, damage cars, droppings everywhere'},
med:{text:'<span class="sentence">Wild turkeys ‚Äî likely descended from released pets ‚Äî spread across Staten Island neighborhoods like Dongan Hills and Ocean Breeze.</span> <span class="sentence">Their <b>population</b> multiplied with no natural checks in the suburban <b>ecosystem</b>.</span> <span class="sentence">Turkeys began blocking traffic, damaging cars, chasing pets, and leaving droppings on yards and rooftops near Staten Island University Hospital.</span> <span class="sentence">Some residents want them removed, but others say leave them alone.</span> <span class="sentence">The state wildlife agency calls them hybrids and will not release them into wild <b>populations</b> elsewhere.</span>',cause:'No natural checks in suburban ecosystem ‚Üí turkey overpopulation, neighborhood disruption'},
high:{text:'<span class="sentence">Wild turkeys ‚Äî likely descended from released pets ‚Äî began spreading across Staten Island neighborhoods including Dongan Hills, Ocean Breeze, and the area around Staten Island University Hospital.</span> <span class="sentence">With abundant food and no natural predators in the suburban <b>ecosystem</b>, the turkey <b>population</b> multiplied quickly.</span> <span class="sentence">Turkeys block traffic, damage cars by pecking at reflections, chase pets, and cover yards and rooftops with droppings.</span> <span class="sentence">Residents are split ‚Äî some want the turkeys removed and others want them left alone.</span> <span class="sentence">The state Department of Environmental Conservation calls them hybrids and refuses to release them into wild <b>populations</b> elsewhere.</span> <span class="sentence">This is a case of <b>overpopulation</b> in an <b>ecosystem</b> that was never designed for large flocks of turkeys.</span> <span class="sentence">Without a clear solution, the turkeys keep multiplying ‚Äî a <b>cascade effect</b> with no end in sight.</span>',cause:'No predators in suburban ecosystem ‚Üí overpopulation, cascade with no solution'},
meterPos:28,zone:'ooc',zoneLabel:'Out of Control',
predict:'What happens when turkeys multiply near a hospital with no natural checks?',
predictOpts:['They stay in the woods','They cause problems for people and property','Hospital staff will train them','They migrate south'],correctPredict:1,
dataRow:['Turkeys at Hospital','Turkeys multiplied with no natural checks in suburban areas','Block traffic, damage cars, chase pets, droppings everywhere','No natural checks ‚Üí overpopulation in wrong ecosystem']},
{id:3,emoji:'ü™≤',name:'Lanternfly Landing',
low:{text:'<span class="sentence">The spotted lanternfly is an <b>invasive species</b> from Asia.</span> <span class="sentence">It was first found in New York on Staten Island in August 2020 at Clay Pit Ponds park.</span> <span class="sentence">The lanternfly feeds on over 70 types of plants and leaves behind sticky honeydew that grows black mold.</span> <span class="sentence">NYC told residents to kill them on sight.</span>',cause:'Invasive insect arrived with no predators ‚Üí feeds on 70+ plants, grows black mold'},
med:{text:'<span class="sentence">The spotted lanternfly is an <b>invasive species</b> ‚Äî a non-native insect from Asia that does not belong in our <b>ecosystem</b>.</span> <span class="sentence">It was first confirmed in New York on Staten Island in August 2020 at Clay Pit Ponds State Park Preserve.</span> <span class="sentence">The lanternfly feeds on over 70 plant species and secretes sticky honeydew that grows damaging black mold.</span> <span class="sentence">It spread quickly from Staten Island to all five boroughs.</span> <span class="sentence">NYC\'s 311 hotline tells residents to kill them on sight, while state agencies spend millions on containment.</span> <span class="sentence">Unlike deer or turkeys, this is not a <b>native species</b> returning ‚Äî it is a true invader with almost no natural predators here.</span>',cause:'Invasive species with no natural predators ‚Üí rapid spread across all 5 boroughs'},
high:{text:'<span class="sentence">The spotted lanternfly is an <b>invasive species</b> ‚Äî a non-native insect from Asia that causes serious harm to the <b>ecosystem</b>.</span> <span class="sentence">It was first confirmed in New York on Staten Island in August 2020 at Clay Pit Ponds State Park Preserve.</span> <span class="sentence">The lanternfly feeds on over 70 plant species and secretes sticky honeydew that grows damaging black mold on plants and surfaces.</span> <span class="sentence">It spread from Staten Island to all five boroughs in just a few years.</span> <span class="sentence">NYC\'s 311 hotline officially tells residents to kill them on sight.</span> <span class="sentence">State agencies are spending millions on containment programs.</span> <span class="sentence">Unlike deer and turkeys, which are <b>native species</b> that were <b>extirpated</b> and then returned, the lanternfly is a true invader with almost no natural predators in this <b>ecosystem</b>.</span> <span class="sentence">Some spiders, praying mantises, and birds are slowly starting to eat them, but not fast enough to stop the <b>cascade effect</b> on local plants.</span>',cause:'Invasive species with zero natural predators ‚Üí cascade effect destroying local plants'},
meterPos:12,zone:'ooc-red',zoneLabel:'Out of Control',
predict:'What happens when an invasive insect from another continent arrives?',
predictOpts:['Local animals eat it quickly','It dies in the new climate','It spreads with no predators to stop it','It only affects one plant'],correctPredict:2,
dataRow:['Lanternfly Landing','Invasive insect from Asia arrived with no predators','NYC told residents to kill on sight; millions spent on containment','Invasive species with no predators ‚Üí uncontrolled spread']},
{id:4,emoji:'ü¶å',name:'The Deer Swimmers',
low:{text:'<span class="sentence">Deer once lived on Staten Island, but hunters killed them all by the early 1900s ‚Äî this is called <b>extirpation</b>.</span> <span class="sentence">In the 1990s, deer swam back from New Jersey across the water.</span> <span class="sentence">With no predators left on the island, the <b>population</b> exploded to over 2,000 deer by 2017.</span> <span class="sentence">The city chose sterilization over hunting to control them.</span>',cause:'Deer returned to island with no predators ‚Üí population exploded to 2,000+'},
med:{text:'<span class="sentence">Deer are a <b>native species</b> on Staten Island ‚Äî they lived there for thousands of years before humans hunted them to local extinction.</span> <span class="sentence">This local extinction is called <b>extirpation</b> ‚Äî the species is gone from one area but still exists elsewhere.</span> <span class="sentence">In the 1990s, deer swam back from New Jersey across the Raritan Bay.</span> <span class="sentence">But the <b>ecosystem</b> had changed ‚Äî no wolves or predators remained to control the <b>population</b>.</span> <span class="sentence">By January 2017, scientists estimated about 2,053 deer on the island.</span> <span class="sentence">The city chose a sterilization program over hunting because 475,000 people live on Staten Island.</span>',cause:'Extirpated species returned, no predators ‚Üí population hit 2,053'},
high:{text:'<span class="sentence">Deer are a <b>native species</b> on Staten Island ‚Äî they naturally belong there and lived on the island for thousands of years.</span> <span class="sentence">By the early 1900s, hunters had killed every last deer on the island ‚Äî a process scientists call <b>extirpation</b>, meaning local extinction.</span> <span class="sentence">The species was not gone from Earth, just gone from Staten Island.</span> <span class="sentence">In the 1990s, deer swam back from New Jersey across the Raritan Bay and found a completely changed <b>ecosystem</b>.</span> <span class="sentence">No wolves or natural predators remained on the island to control their numbers.</span> <span class="sentence">The <b>population</b> exploded from about 25 in 2008 to over 2,053 by January 2017 ‚Äî classic <b>overpopulation</b>.</span> <span class="sentence">Scientists debated what to do about a <b>native species</b> that came home to a world without its old predators.</span> <span class="sentence">The city chose to sterilize bucks rather than allow hunting in a borough of 475,000 people.</span>',cause:'Native species returned to changed ecosystem ‚Üí overpopulation from 25 to 2,053'},
meterPos:20,zone:'ooc',zoneLabel:'Out of Control',
predict:'What happens when a native species returns to an island where its predators are gone?',
predictOpts:['The ecosystem goes back to normal','The species stays at a small number','The population grows out of control','Other animals become predators'],correctPredict:2,
dataRow:['Deer Swimmers','Deer swam back from NJ, no predators, population hit 2,053','City chose sterilization over hunting (475K residents)','Native species returned to changed ecosystem ‚Üí overpopulation']},
{id:5,emoji:'üî¨',name:'The Tick Surge',
low:{text:'<span class="sentence">As the deer <b>population</b> grew on Staten Island, so did the ticks that live on them.</span> <span class="sentence">Lyme disease cases surged across the island.</span> <span class="sentence">The city spent about $600,000 extra per year on tick control ‚Äî but the real cause was too many deer.</span>',cause:'Deer population grew ‚Üí ticks and Lyme disease surged'},
med:{text:'<span class="sentence">As the deer <b>population</b> grew on Staten Island, so did the <b>population</b> of black-legged ticks that live on deer.</span> <span class="sentence">These ticks carry Lyme disease, which became a major health concern on the island.</span> <span class="sentence">The city increased spending by about $600,000 per year on tick surveillance and control.</span> <span class="sentence">Some argued that tick spraying was treating the symptom, not the cause.</span> <span class="sentence">The real problem was deer <b>overpopulation</b> ‚Äî a <b>cascade effect</b> where too many deer led to too many ticks led to too much disease.</span>',cause:'Deer overpopulation ‚Üí more ticks ‚Üí more Lyme disease (cascade)'},
high:{text:'<span class="sentence">As the deer <b>population</b> grew on Staten Island, so did the <b>population</b> of black-legged deer ticks that feed on them.</span> <span class="sentence">These ticks carry Lyme disease, and cases surged on Staten Island ‚Äî jumping roughly 250% between 2012 and 2016.</span> <span class="sentence">Tick-borne illness became a major public health concern for the borough.</span> <span class="sentence">The city increased spending by about $600,000 per year on tick surveillance and control programs.</span> <span class="sentence">But some scientists argued that spraying for ticks was only treating the symptom, not the root cause.</span> <span class="sentence">The real driver was deer <b>overpopulation</b> ‚Äî a textbook <b>cascade effect</b> where one imbalance (no predators) triggered a chain: more deer ‚Üí more ticks ‚Üí more disease.</span> <span class="sentence">This showed how problems in one part of the <b>ecosystem</b> ripple outward to affect human health.</span>',cause:'Deer overpopulation ‚Üí Lyme disease cases up ~250% (cascade to human health)'},
meterPos:15,zone:'ooc-red',zoneLabel:'Out of Control',
predict:'What happens to tick populations when deer numbers explode?',
predictOpts:['Ticks decrease because deer move around','Tick populations stay the same','Tick populations explode too, spreading disease','Ticks only live on dogs, not deer'],correctPredict:2,
dataRow:['Tick Surge','Deer overpopulation led to tick explosion','$600K/year on tick control; Lyme disease surged ~250%','Deer overpopulation ‚Üí cascade to ticks ‚Üí human health']},
{id:6,emoji:'üò°',name:'Turkey Slaughter',
low:{text:'<span class="sentence">By 2013, large flocks of turkeys were overwhelming the area around a Staten Island psychiatric hospital.</span> <span class="sentence">In August 2013, about 80 turkeys were rounded up by the USDA and killed.</span> <span class="sentence">People were furious ‚Äî animal activists protested loudly.</span> <span class="sentence">Later, over 150 turkeys were relocated to a sanctuary, but the sanctuary ran out of room.</span>',cause:'Turkey overpopulation ‚Üí USDA killed 80 turkeys, massive public outrage'},
med:{text:'<span class="sentence">By 2013, large flocks of turkeys had overwhelmed the area around a Staten Island psychiatric hospital.</span> <span class="sentence">The turkey <b>population</b> had no natural checks in the suburban <b>ecosystem</b>.</span> <span class="sentence">In August 2013, about 80 turkeys were rounded up by the USDA and killed ‚Äî sparking massive public outcry from animal activists.</span> <span class="sentence">Later, over 150 turkeys were relocated to And-Hof Sanctuary in the Catskills, but the sanctuary ran out of room.</span> <span class="sentence">The debate showed how <b>overpopulation</b> of one species forces people to make difficult choices with no easy answers.</span>',cause:'No natural checks ‚Üí overpopulation forced difficult human choices'},
high:{text:'<span class="sentence">By 2013, large flocks of wild turkeys had overwhelmed the area around a Staten Island psychiatric hospital.</span> <span class="sentence">The turkey <b>population</b> had multiplied with no natural predators or controls in the suburban <b>ecosystem</b>.</span> <span class="sentence">In August 2013, about 80 turkeys were rounded up by the USDA and killed ‚Äî a decision that was not announced publicly beforehand.</span> <span class="sentence">The killing sparked massive public outcry from animal activists across New York City.</span> <span class="sentence">In response, over 150 turkeys were later relocated to And-Hof Sanctuary in the Catskills.</span> <span class="sentence">But the sanctuary eventually ran out of room, and turkeys kept multiplying on Staten Island.</span> <span class="sentence">This story shows the <b>cascade effect</b> of <b>overpopulation</b> ‚Äî when an <b>ecosystem</b> cannot handle a species, humans are forced into difficult decisions with no perfect answer.</span>',cause:'Overpopulation with no solution ‚Üí forced killing, public outcry, still no fix'},
meterPos:8,zone:'ooc-red',zoneLabel:'Out of Control',
predict:'What happens when people try to solve overpopulation by killing the animals?',
predictOpts:['Everyone agrees it was the right decision','It solves the problem permanently','It causes public outrage and the problem continues','The animals come back stronger'],correctPredict:2,
dataRow:['Turkey Slaughter','80 turkeys killed by USDA, overpopulation continued','Massive public outcry; 150 relocated but sanctuary ran out of room','Overpopulation forces impossible human choices']},
{id:7,emoji:'üåø',name:'Vanishing Forest Floor',
low:{text:'<span class="sentence">With thousands of deer on Staten Island, they ate through native plants, shrubs, and ground cover in the parks.</span> <span class="sentence">Songbirds lost their habitat because the low plants they need for nesting were gone.</span> <span class="sentence">Most people never noticed, but the <b>ecosystem</b> was being destroyed from the ground up.</span>',cause:'Too many deer ‚Üí native plants eaten, songbird habitat destroyed'},
med:{text:'<span class="sentence">With deer at extremely high densities, they ate through <b>native</b> plants, shrubs, and forest understory across Staten Island parks.</span> <span class="sentence">The ground cover disappeared, leaving bare soil where thick vegetation once grew.</span> <span class="sentence">Songbirds and ground-nesting birds lost the habitat they depend on for protection from predators.</span> <span class="sentence">Scientists warned that this damage was invisible to most people but devastating to biodiversity.</span> <span class="sentence">This is a <b>cascade effect</b> ‚Äî deer <b>overpopulation</b> did not just hurt plants, it triggered a chain that threatened entire bird <b>populations</b>.</span>',cause:'Deer overpopulation ‚Üí understory destroyed, bird populations threatened'},
high:{text:'<span class="sentence">With deer densities estimated at about 92 per square mile on Staten Island, the animals ate through <b>native</b> plants, shrubs, and forest understory across the island\'s parks.</span> <span class="sentence">The ground cover that once supported a diverse <b>ecosystem</b> disappeared, leaving bare trampled soil.</span> <span class="sentence">Songbirds lost the low shrubs and plants they need for nesting and protection from predators.</span> <span class="sentence">Ground-nesting bird species were hit hardest because their nests were completely exposed.</span> <span class="sentence">A U.S. Forest Service study found that deer densities of just 20 per square mile can eliminate certain warbler and flycatcher species ‚Äî Staten Island had over four times that number.</span> <span class="sentence">Parks staff began fencing sensitive areas to protect remaining plants, but the damage was already widespread.</span> <span class="sentence">Most Staten Island residents never saw this destruction because it happened quietly in the forest understory.</span> <span class="sentence">This invisible <b>cascade effect</b> shows how <b>overpopulation</b> of one <b>native species</b> can silently collapse an entire <b>ecosystem</b> from the ground up.</span>',cause:'92 deer per square mile ‚Üí invisible cascade collapsing ecosystem from ground up'},
meterPos:78,zone:'collapse',zoneLabel:'Collapsing',
predict:'What happens to the forest when thousands of deer eat all the low plants?',
predictOpts:['New plants grow back faster','The forest stays healthy','Birds and other animals lose their habitat','Deer switch to eating something else'],correctPredict:2,
dataRow:['Vanishing Forest','Deer ate native plants, destroyed forest understory','Most people never noticed; parks staff fenced areas','Overpopulation ‚Üí invisible cascade collapsing ecosystem']},
{id:8,emoji:'üçá',name:'Lanternfly vs. Farms',
low:{text:'<span class="sentence">The spotted lanternfly spread from Staten Island across New York State.</span> <span class="sentence">By 2024, it reached the Finger Lakes grape-growing region, threatening farms.</span> <span class="sentence">The state is spending millions to fight one <b>invasive species</b> ‚Äî and the debate is whether it is worth the cost.</span>',cause:'Lanternfly spread from SI unchecked ‚Üí threatens grape farms statewide'},
med:{text:'<span class="sentence">The spotted lanternfly ‚Äî the <b>invasive species</b> first found on Staten Island ‚Äî spread across New York State within a few years.</span> <span class="sentence">By July 2024, it reached the Finger Lakes region, home to New York\'s grape industry.</span> <span class="sentence">Researchers projected that losses could grow from $1.5 million in year one to nearly $9 million by year three if left unchecked.</span> <span class="sentence">State agencies, Cornell University, and grape growers launched education and control programs.</span> <span class="sentence">The debate centers on how much money a state should spend to fight one <b>invasive</b> insect ‚Äî especially when the <b>ecosystem</b> might eventually develop its own defenses.</span>',cause:'Invasive spread unchecked ‚Üí projected losses up to $9 million by year three'},
high:{text:'<span class="sentence">The spotted lanternfly ‚Äî the <b>invasive species</b> first confirmed on Staten Island in 2020 ‚Äî spread rapidly across New York State.</span> <span class="sentence">By July 2024, it had reached the Finger Lakes region, the heart of New York\'s grape industry.</span> <span class="sentence">Researchers at Cornell projected that grape industry losses could grow from $1.5 million in the first year to $4 million in year two and nearly $9 million by year three.</span> <span class="sentence">State agencies, Cornell University researchers, and grape growers launched aggressive education and control programs.</span> <span class="sentence">Unlike deer and turkeys, which are <b>native species</b> that returned after <b>extirpation</b>, the lanternfly has zero evolutionary history in this <b>ecosystem</b>.</span> <span class="sentence">No local predator evolved to eat it, so the <b>population</b> grows without natural checks.</span> <span class="sentence">Some scientists point out that urban heat islands help lanternflies survive longer, connecting climate to the invasion.</span> <span class="sentence">The debate is whether massive government spending can stop an <b>invasive species</b> ‚Äî or whether the <b>ecosystem</b> will eventually self-correct through new predator relationships.</span>',cause:'Invasive species with zero natural predators ‚Üí growing agricultural losses statewide'},
meterPos:10,zone:'ooc-red',zoneLabel:'Out of Control',
predict:'What happens when an invasive insect reaches farmland with no predators to stop it?',
predictOpts:['Farmers can easily control it','It only damages wild plants','It causes millions in crop damage','Cold winters kill it off'],correctPredict:2,
dataRow:['Lanternfly vs. Farms','Lanternfly spread from SI to Finger Lakes grape region','State spending millions; Cornell launched control programs','Invasive species with no predators ‚Üí statewide agricultural damage']}
];

let state={currentScenario:null,step:null,level:'low',completed:new Set(),score:0,streak:0,predictions:0,correctPredictions:0,selectedPrediction:null,badgeShown:false,mapShown:false,speechSynth:window.speechSynthesis,speaking:false};

function init(){
const list=document.getElementById('scenarioList');
scenarios.forEach(s=>{
const card=document.createElement('div');
card.className='scenario-card';
card.id='sc-'+s.id;
card.innerHTML=`<span class="sc-emoji">${s.emoji}</span><span class="sc-name">${s.name}</span>`;
card.onclick=()=>selectScenario(s.id);
list.appendChild(card);
});
updateHUD();
}

function selectScenario(id){
if(state.completed.has(id))return;
if(state.currentScenario&&state.step&&state.step!=='record-done')return;
state.currentScenario=id;
state.step='predict';
state.selectedPrediction=null;
document.querySelectorAll('.scenario-card').forEach(c=>c.classList.remove('active'));
document.getElementById('sc-'+id).classList.add('active');
updateStepTabs();
showPredict();
}

function updateStepTabs(){
['stab1','stab2','stab3','stab4'].forEach(t=>document.getElementById(t).className='step-tab');
const steps=['predict','read','watch','record','record-done'];
const idx=steps.indexOf(state.step);
if(idx>=0){
if(idx>=0)document.getElementById('stab1').classList.add(idx>0?'done':'active');
if(idx>=1)document.getElementById('stab2').classList.add(idx>1?'done':'active');
if(idx>=2)document.getElementById('stab3').classList.add(idx>2?'done':'active');
if(idx>=3)document.getElementById('stab4').classList.add(idx>3?'done':'active');
}
}

function getScenario(id){return scenarios.find(s=>s.id===id);}

function showPredict(){
const s=getScenario(state.currentScenario);
const cc=document.getElementById('centerContent');
let optsHtml=s.predictOpts.map((o,i)=>`<div class="predict-opt" data-idx="${i}" onclick="pickPrediction(${i})">${o}</div>`).join('');
cc.innerHTML=`<div class="predict-card"><h3>üîÆ Predict ‚Äî ${s.emoji} ${s.name}</h3><p>${s.predict}</p><div class="predict-options">${optsHtml}</div></div>`;
document.getElementById('actionBar').innerHTML=`<button class="action-btn orange" id="predictBtn" disabled onclick="goToRead()">Submit Prediction ‚Üí</button>`;
}

function pickPrediction(idx){
state.selectedPrediction=idx;
document.querySelectorAll('.predict-opt').forEach((o,i)=>{o.classList.toggle('selected',i===idx);});
document.getElementById('predictBtn').disabled=false;
}

function goToRead(){
state.step='read';
state.predictions++;
const s=getScenario(state.currentScenario);
if(state.selectedPrediction===s.correctPredict){state.correctPredictions++;state.streak++;state.score+=100+(state.streak-1)*25;}
else{state.streak=0;state.score+=25;}
updateHUD();
updateStepTabs();
showRead();
}

function showRead(){
const s=getScenario(state.currentScenario);
const levelData=s[state.level==='med'?'med':state.level==='high'?'high':'low'];
const cc=document.getElementById('centerContent');
cc.innerHTML=`<div class="read-card"><h3>üìñ Read ‚Äî ${s.emoji} ${s.name}</h3><div class="read-text">${levelData.text}</div><div class="cause-effect"><strong>Cause ‚Üí Effect:</strong> ${levelData.cause}</div><button class="read-aloud-btn" id="readAloudBtn" onclick="toggleReadAloud()">üîä Read Aloud</button></div>`;
document.getElementById('actionBar').innerHTML=`<button class="action-btn purple" onclick="goToWatch()">Watch the Meter Change ‚Üí</button>`;
}

function toggleReadAloud(){
if(state.speaking){state.speechSynth.cancel();state.speaking=false;document.getElementById('readAloudBtn').classList.remove('speaking');document.getElementById('readAloudBtn').innerHTML='üîä Read Aloud';document.querySelectorAll('.sentence').forEach(s=>s.classList.remove('speaking-active'));return;}
const sentences=document.querySelectorAll('.read-text .sentence');
if(!sentences.length)return;
state.speaking=true;
document.getElementById('readAloudBtn').classList.add('speaking');
document.getElementById('readAloudBtn').innerHTML='‚èπ Stop';
let idx=0;
function speakNext(){
if(idx>=sentences.length||!state.speaking){state.speaking=false;document.getElementById('readAloudBtn')?.classList.remove('speaking');if(document.getElementById('readAloudBtn'))document.getElementById('readAloudBtn').innerHTML='üîä Read Aloud';sentences.forEach(s=>s.classList.remove('speaking-active'));return;}
sentences.forEach(s=>s.classList.remove('speaking-active'));
sentences[idx].classList.add('speaking-active');
const u=new SpeechSynthesisUtterance(sentences[idx].textContent);
u.rate=0.9;u.onend=()=>{idx++;speakNext();};
state.speechSynth.speak(u);
}
speakNext();
}

function goToWatch(){
state.speechSynth.cancel();state.speaking=false;
state.step='watch';
updateStepTabs();
showWatch();
}

function showWatch(){
const s=getScenario(state.currentScenario);
const cc=document.getElementById('centerContent');
const needleStart=50;
let ticksHtml='';
for(let i=0;i<=100;i+=5){ticksHtml+=`<div class="meter-tick" style="top:${i}%"></div>`;}
cc.innerHTML=`<div class="watch-card">
<div class="watch-bg-pulse" id="watchBgPulse"></div>
<h3>üëÅÔ∏è Watch the Ecosystem Disruption Meter</h3>
<div class="meter-container">
<div class="meter-labels-left">
<div class="meter-zone-label mzl-red" id="mzlDanger">üî¥ DANGER</div>
<div class="meter-zone-label mzl-orange" id="mzlWarning">‚ö†Ô∏è WARNING</div>
<div class="meter-zone-label mzl-green" id="mzlOk">‚úÖ OK ZONE</div>
<div class="meter-zone-label mzl-purple" id="mzlStressed">üò∞ STRESSED</div>
<div class="meter-zone-label mzl-dpurple" id="mzlCollapse">üíÄ COLLAPSE</div>
</div>
<div class="meter-col">
<div class="meter-bg">
<div class="meter-glass"></div>
<div class="meter-ticks">${ticksHtml}</div>
<div class="meter-ok-zone"><span class="meter-ok-text">OK Zone</span></div>
<div class="meter-particles" id="meterParticles"></div>
<div class="meter-needle" id="meterNeedle" style="top:${needleStart}%"></div>
</div>
</div>
<div class="meter-labels-right">
<div class="meter-zone-label mzl-red">OUT OF<br>CONTROL</div>
<div class="meter-zone-label mzl-orange">ELEVATED</div>
<div class="meter-zone-label mzl-green">BALANCED</div>
<div class="meter-zone-label mzl-purple">DECLINING</div>
<div class="meter-zone-label mzl-dpurple">COLLAPSING</div>
</div>
</div>
<div class="zone-readout" id="zoneReadout">...</div>
</div>`;
document.getElementById('actionBar').innerHTML='';
setTimeout(()=>{
const needle=document.getElementById('meterNeedle');
needle.classList.add('moving');
needle.style.top=s.meterPos+'%';
document.getElementById('watchBgPulse').classList.add('active');
spawnMeterParticles(s.meterPos,s.zone);
setTimeout(()=>{
needle.classList.remove('moving');
const readout=document.getElementById('zoneReadout');
let cls='zone-ok',txt='‚úÖ OK Zone';
if(s.zone==='ooc'){cls='zone-ooc';txt='‚ö†Ô∏è Out of Control';lightLabel('mzlWarning');}
else if(s.zone==='ooc-red'){cls='zone-ooc-red';txt='üî¥ Out of Control';lightLabel('mzlDanger');}
else if(s.zone==='collapse'){cls='zone-collapse';txt='üíÄ Collapsing';lightLabel('mzlCollapse');}
else{lightLabel('mzlOk');}
readout.className='zone-readout '+cls+' visible';
readout.textContent=txt;
document.getElementById('actionBar').innerHTML=`<button class="action-btn green" onclick="goToRecord()">Record Data ‚úì</button>`;
},2200);
},400);
}

function lightLabel(id){const el=document.getElementById(id);if(el)el.classList.add('lit');}

function spawnMeterParticles(pos,zone){
const container=document.getElementById('meterParticles');
if(!container)return;
const colors={'ooc':['#FF9800','#FFC107','#FFD54F'],'ooc-red':['#ff5252','#FF6E40','#FF9800'],'collapse':['#CE93D8','#9C27B0','#7B1FA2'],'ok':['#4CAF50','#81C784','#A5D6A7']};
const palette=colors[zone]||colors['ooc'];
let count=0;
const interval=setInterval(()=>{
if(count>=30||!document.getElementById('meterParticles')){clearInterval(interval);return;}
const p=document.createElement('div');
p.className='m-particle';
const c=palette[Math.floor(Math.random()*palette.length)];
p.style.background=c;
p.style.boxShadow=`0 0 6px ${c}`;
p.style.left=Math.random()*100+'%';
p.style.top=(pos+Math.random()*20-10)+'%';
p.style.width=(2+Math.random()*4)+'px';
p.style.height=p.style.width;
container.appendChild(p);
requestAnimationFrame(()=>p.classList.add('active'));
setTimeout(()=>p.remove(),1500);
count++;
},80);
}

function goToRecord(){
state.step='record-done';
updateStepTabs();
const s=getScenario(state.currentScenario);
state.completed.add(s.id);
document.getElementById('sc-'+s.id).classList.add('completed');
document.getElementById('sc-'+s.id).classList.remove('active');
addDataRow(s);
updateHUD();
const cc=document.getElementById('centerContent');
const count=state.completed.size;
let msg='';
if(count<5)msg=`Story recorded! Pick ${5-count} more to earn your badge.`;
else if(count===5)msg='üéñÔ∏è Ecosystem Investigator badge earned! Continue for extra credit!';
else if(count<8)msg=`${8-count} more for the Full Map!`;
else msg='üó∫Ô∏è All 8 complete ‚Äî Full Map unlocked!';
cc.innerHTML=`<div class="record-card"><h3>‚úÖ Data Recorded!</h3><p>${s.emoji} ${s.name} ‚Äî complete</p><p style="margin-top:12px;color:#81c784;font-weight:600;">${msg}</p></div>`;
document.getElementById('actionBar').innerHTML='';
state.currentScenario=null;
if(count===5&&!state.badgeShown){state.badgeShown=true;setTimeout(showBadge,800);}
if(count===8&&!state.mapShown){state.mapShown=true;setTimeout(showFullMap,800);}
}

function addDataRow(s){
const tbody=document.getElementById('dataBody');
const tr=document.createElement('tr');
tr.innerHTML=`<td><strong>${s.emoji} ${s.dataRow[0]}</strong></td><td>${s.dataRow[1]}</td><td>${s.dataRow[2]}</td><td>${s.dataRow[3]}</td>`;
tr.style.animation='fadeIn 0.5s';
tbody.appendChild(tr);
}

function updateHUD(){
document.getElementById('hudScore').textContent=state.score;
document.getElementById('hudStreak').textContent=state.streak;
document.getElementById('hudDone').textContent=state.completed.size+'/5';
const acc=state.predictions>0?Math.round(state.correctPredictions/state.predictions*100):0;
document.getElementById('hudAcc').textContent=acc+'%';
const pct=Math.min(100,state.completed.size/5*100);
document.getElementById('progressBar').style.width=pct+'%';
document.getElementById('scenarioCount').textContent=state.completed.size+' of 8 completed';
const remain=5-state.completed.size;
if(remain>0)document.getElementById('progressMsg').textContent=`Pick ${remain} more stories!`;
else if(state.completed.size<8)document.getElementById('progressMsg').textContent=`Badge earned! ${8-state.completed.size} more for Full Map`;
else document.getElementById('progressMsg').textContent='üó∫Ô∏è Full Map unlocked!';
}

function setLevel(lv){
state.level=lv;
document.querySelectorAll('.level-tab').forEach(t=>t.classList.toggle('active',t.dataset.level===lv));
if(state.step==='read')showRead();
}

function showBadge(){
const overlay=document.createElement('div');
overlay.className='badge-overlay';
overlay.innerHTML=`<div class="badge-content"><div class="badge-icon">üéñÔ∏è</div><h2>Ecosystem Investigator!</h2><p>You completed 5 real Staten Island wildlife stories and earned your badge! Continue to unlock the Full Map of the island's ecosystem crisis.</p><button onclick="this.closest('.badge-overlay').remove()">Continue ‚Üí</button></div>`;
document.body.appendChild(overlay);
}

function showFullMap(){
const overlay=document.createElement('div');
overlay.className='fullmap-overlay';
let spots=scenarios.map(s=>`<div class="island-spot"><div class="is-emoji">${s.emoji}</div><div class="is-name">${s.name}</div></div>`).join('');
overlay.innerHTML=`<div class="fullmap-content"><h2>üó∫Ô∏è Full Map Unlocked!</h2><p>You investigated all 8 ecosystem disruptions across Staten Island. Extra credit earned!</p><div class="island-map">${spots}</div><button onclick="this.closest('.fullmap-overlay').remove()">Close</button></div>`;
document.body.appendChild(overlay);
}

function resetAll(){
state.speechSynth.cancel();
state={currentScenario:null,step:null,level:state.level,completed:new Set(),score:0,streak:0,predictions:0,correctPredictions:0,selectedPrediction:null,badgeShown:false,mapShown:false,speechSynth:window.speechSynthesis,speaking:false};
document.querySelectorAll('.scenario-card').forEach(c=>{c.classList.remove('active','completed');});
document.getElementById('dataBody').innerHTML='';
document.getElementById('actionBar').innerHTML='';
document.getElementById('centerContent').innerHTML=`<div class="welcome-screen"><div class="big-icon">üèùÔ∏è</div><h2>Staten Island Under Siege</h2><p>Real wildlife is taking over Staten Island streets, parks, and hospitals. Pick any story from the sidebar to start your investigation. Complete 5 to earn your Ecosystem Investigator badge!</p></div>`;
['stab1','stab2','stab3','stab4'].forEach(t=>document.getElementById(t).className='step-tab');
updateHUD();
}

function newRun(){resetAll();}

init();
</script>
</body>
</html>
