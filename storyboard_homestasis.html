<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mr Jawad Simulation Homeostasis</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Segoe UI',Arial,sans-serif;background:linear-gradient(135deg,#1a1a2e 0%,#16213e 50%,#0f3460 100%);min-height:100vh;color:#fff}
.app{display:flex;flex-direction:column;height:100vh}
.header{background:linear-gradient(90deg,#4CAF50,#9C27B0);padding:12px 20px;text-align:center}
.header h1{font-size:1.4em;margin:0}
.main-layout{display:flex;flex:1;overflow:hidden}
.left-sidebar{width:280px;min-width:280px;background:rgba(255,255,255,0.05);border-right:1px solid rgba(255,255,255,0.1);display:flex;flex-direction:column;overflow-y:auto}
.sidebar-section{padding:15px;border-bottom:1px solid rgba(255,255,255,0.1)}
.sidebar-title{font-size:0.75em;text-transform:uppercase;letter-spacing:1px;color:#888;margin-bottom:10px}
.scenario-btn{width:100%;padding:10px 12px;margin-bottom:8px;border:2px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:#fff;border-radius:8px;cursor:pointer;text-align:left;font-size:0.85em;transition:all 0.2s;display:flex;align-items:center;gap:8px}
.scenario-btn:hover{border-color:rgba(76,175,80,0.5);background:rgba(76,175,80,0.1)}
.scenario-btn.active{border-color:#4CAF50;background:rgba(76,175,80,0.2)}
.scenario-btn.completed{border-color:#9C27B0;background:rgba(156,39,176,0.2)}
.scenario-btn.completed::after{content:'‚úì';margin-left:auto;color:#9C27B0;font-weight:bold}
.scenario-icon{font-size:1.2em}
.level-selector{display:flex;gap:5px}
.level-btn{flex:1;padding:8px;border:2px solid rgba(255,255,255,0.15);background:transparent;color:#aaa;border-radius:6px;cursor:pointer;font-size:0.8em;transition:all 0.2s}
.level-btn:hover{border-color:rgba(255,255,255,0.3)}
.level-btn.active{background:#4CAF50;border-color:#4CAF50;color:#fff}
.word-bank{display:flex;flex-wrap:wrap;gap:6px}
.word-tag{background:rgba(156,39,176,0.2);border:1px solid rgba(156,39,176,0.3);padding:4px 8px;border-radius:4px;font-size:0.75em;color:#ddd}
.action-btns{padding:15px;margin-top:auto}
.btn{width:100%;padding:10px 16px;border:none;border-radius:8px;cursor:pointer;font-size:0.9em;font-weight:600;transition:all 0.2s;margin-bottom:8px}
.btn-reset{background:#E91E63;color:#fff}
.btn-new{background:#2196F3;color:#fff}
.btn:hover{transform:translateY(-1px);filter:brightness(1.1)}
.center-panel{flex:1;display:flex;flex-direction:column;overflow:hidden}
.step-tabs{display:flex;background:rgba(0,0,0,0.3);padding:12px 15px;gap:10px;justify-content:center}
.step-tab{padding:10px 24px;border-radius:20px;background:rgba(255,255,255,0.1);color:#666;font-size:0.85em;font-weight:600;transition:all 0.3s}
.step-tab.active{background:linear-gradient(135deg,#E91E63,#9C27B0);color:#fff;box-shadow:0 0 20px rgba(233,30,99,0.4)}
.step-tab.done{background:rgba(76,175,80,0.3);color:#4CAF50}
.center-content{flex:1;display:flex;flex-direction:column;padding:20px;overflow-y:auto}
.content-area{flex:1;display:flex;flex-direction:column;justify-content:center;align-items:center}
.content-card{background:rgba(255,255,255,0.08);border-radius:15px;padding:30px;max-width:650px;width:100%;text-align:center;border:1px solid rgba(255,255,255,0.1)}
.content-card h2{font-size:1.3em;margin-bottom:15px;color:#E91E63}
.content-card p{color:#ccc;line-height:1.6;font-size:1em}
.reading-box{text-align:left;background:rgba(0,0,0,0.3);padding:20px;border-radius:10px;margin:15px 0;max-height:280px;overflow-y:auto;line-height:1.7}
.reading-box strong{color:#ffd700}
.predict-choices{display:flex;flex-direction:column;gap:10px;margin:20px 0;text-align:left}
.predict-choice{padding:14px 18px;border:2px solid rgba(255,255,255,0.2);background:rgba(255,255,255,0.05);border-radius:10px;cursor:pointer;transition:all 0.2s;font-size:0.95em}
.predict-choice:hover{border-color:rgba(76,175,80,0.5);background:rgba(76,175,80,0.1)}
.predict-choice.selected{border-color:#4CAF50;background:rgba(76,175,80,0.25)}
.predict-choice.correct{border-color:#4CAF50;background:rgba(76,175,80,0.3)}
.predict-choice.incorrect{border-color:#E91E63;background:rgba(233,30,99,0.2);opacity:0.6}
.meter-area{display:flex;justify-content:center;align-items:center;gap:50px;margin:25px 0}
.body-icon{font-size:100px}
.meter-wrap{position:relative}
.meter{width:50px;height:200px;background:linear-gradient(180deg,#ff4444 0%,#ff8800 20%,#44ff44 35%,#44ff44 65%,#ff8800 80%,#ff4444 100%);border-radius:25px;position:relative;border:3px solid rgba(255,255,255,0.3)}
.meter-needle{position:absolute;left:-10px;width:70px;height:6px;background:#fff;border-radius:3px;transition:top 1.5s ease-out;box-shadow:0 0 15px rgba(255,255,255,0.8)}
.meter-labels{position:absolute;left:65px;top:0;height:100%;display:flex;flex-direction:column;justify-content:space-between;font-size:0.7em;color:#aaa;padding:5px 0}
.action-area{padding:15px 20px;display:flex;justify-content:center;gap:15px;background:rgba(0,0,0,0.2);min-height:70px;align-items:center}
.btn-action{padding:12px 40px;background:linear-gradient(135deg,#4CAF50,#2E7D32);color:#fff;border:none;border-radius:10px;font-size:1em;font-weight:600;cursor:pointer;transition:all 0.2s}
.btn-action:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 5px 20px rgba(76,175,80,0.4)}
.btn-action:disabled{opacity:0.4;cursor:not-allowed}
.btn-speak{padding:12px 20px;background:transparent;border:2px solid #00bcd4;color:#00bcd4;border-radius:10px;cursor:pointer;font-size:0.9em}
.btn-speak:hover{background:rgba(0,188,212,0.1)}
.right-sidebar{width:280px;min-width:280px;background:rgba(255,255,255,0.05);border-left:1px solid rgba(255,255,255,0.1);display:flex;flex-direction:column;overflow-y:auto}
.hud-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;padding:15px}
.hud-item{background:rgba(255,255,255,0.08);border-radius:10px;padding:12px;text-align:center}
.hud-value{font-size:1.6em;font-weight:bold;background:linear-gradient(90deg,#00d4ff,#9c27b0);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hud-label{font-size:0.7em;color:#888;text-transform:uppercase;margin-top:4px}
.progress-section{padding:15px;border-bottom:1px solid rgba(255,255,255,0.1)}
.progress-bar{height:14px;background:rgba(255,255,255,0.1);border-radius:7px;overflow:hidden;margin:10px 0}
.progress-fill{height:100%;background:linear-gradient(90deg,#4CAF50,#9C27B0);transition:width 0.5s;border-radius:7px}
.status-msg{text-align:center;color:#aaa;font-size:0.85em;padding:5px 0}
.data-section{flex:1;padding:15px;overflow-y:auto}
.data-table{width:100%;font-size:0.72em;border-collapse:collapse}
.data-table th{background:rgba(76,175,80,0.3);padding:8px 5px;text-align:left;position:sticky;top:0}
.data-table td{padding:8px 5px;border-bottom:1px solid rgba(255,255,255,0.1);vertical-align:top}
.intro-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#1a1a2e,#16213e);z-index:100;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:40px}
.intro-overlay h1{font-size:2.5em;margin-bottom:20px;background:linear-gradient(90deg,#4CAF50,#9C27B0);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.intro-overlay p{font-size:1.1em;color:#aaa;max-width:450px;text-align:center;margin-bottom:30px;line-height:1.6}
.intro-btn{padding:16px 50px;font-size:1.1em;background:linear-gradient(135deg,#4CAF50,#2E7D32);color:#fff;border:none;border-radius:12px;cursor:pointer;font-weight:600}
.intro-btn:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(76,175,80,0.4)}
.hidden{display:none!important}
.feedback{padding:12px 15px;border-radius:8px;margin-top:15px;font-size:0.95em}
.feedback.correct{background:rgba(76,175,80,0.2);border:1px solid #4CAF50;color:#4CAF50}
.feedback.incorrect{background:rgba(233,30,99,0.2);border:1px solid #E91E63;color:#E91E63}
</style>
</head>
<body>
<div class="intro-overlay" id="introScreen">
<h1>‚öñÔ∏è Body Balance Investigator</h1>
<p>Explore real stories of people facing extreme conditions. Discover how homeostasis kept them alive.</p>
<button class="intro-btn" onclick="startApp()">Begin Investigation</button>
</div>

<div class="app hidden" id="mainApp">
<div class="header"><h1>‚öñÔ∏è Mr Jawad Simulation: Homeostasis</h1></div>
<div class="main-layout">

<div class="left-sidebar">
<div class="sidebar-section">
<div class="sidebar-title">Choose a Case (pick 5)</div>
<div id="scenarioList"></div>
</div>
<div class="sidebar-section">
<div class="sidebar-title">Reading Level</div>
<div class="level-selector" id="levelSelector">
<button class="level-btn active" id="btnLow">Low</button>
<button class="level-btn" id="btnMed">Med</button>
<button class="level-btn" id="btnHigh">High</button>
</div>
</div>
<div class="sidebar-section">
<div class="sidebar-title">Key Words</div>
<div class="word-bank">
<span class="word-tag">homeostasis</span>
<span class="word-tag">set point</span>
<span class="word-tag">receptor</span>
<span class="word-tag">response</span>
<span class="word-tag">balance</span>
<span class="word-tag">feedback</span>
</div>
</div>
<div class="action-btns">
<button class="btn btn-new" onclick="resetCurrent()">Restart Current</button>
<button class="btn btn-reset" onclick="resetAll()">Reset All</button>
</div>
</div>

<div class="center-panel">
<div class="step-tabs">
<div class="step-tab" id="tab1">1. PREDICT</div>
<div class="step-tab" id="tab2">2. READ</div>
<div class="step-tab" id="tab3">3. WATCH</div>
<div class="step-tab" id="tab4">4. RECORD</div>
</div>
<div class="center-content">
<div class="content-area" id="contentArea">
<div class="content-card">
<h2>üëà Select a Scenario</h2>
<p>Choose a case from the left sidebar to begin your investigation.</p>
</div>
</div>
</div>
<div class="action-area" id="actionArea"></div>
</div>

<div class="right-sidebar">
<div class="hud-grid">
<div class="hud-item"><div class="hud-value" id="hudDone">0/5</div><div class="hud-label">Completed</div></div>
<div class="hud-item"><div class="hud-value" id="hudStreak">0</div><div class="hud-label">Streak</div></div>
<div class="hud-item"><div class="hud-value" id="hudScore">0</div><div class="hud-label">Score</div></div>
<div class="hud-item"><div class="hud-value" id="hudAcc">100%</div><div class="hud-label">Accuracy</div></div>
</div>
<div class="progress-section">
<div class="sidebar-title">Progress to Goal</div>
<div class="progress-bar"><div class="progress-fill" id="progBar" style="width:0%"></div></div>
<div class="status-msg" id="statusMsg">Pick 5 scenarios you like!</div>
</div>
<div class="data-section">
<div class="sidebar-title">üìä Data Table</div>
<table class="data-table">
<thead><tr><th>Scenario</th><th>What Changed</th><th>Body Response</th><th>Connection</th></tr></thead>
<tbody id="dataBody"></tbody>
</table>
</div>
</div>

</div>
</div>

<script>
var scenarios = [
{id:1,name:"Marathon Runner",icon:"üèÉ‚Äç‚ôÄÔ∏è",meterStart:25,meterEnd:100,change:"Temp rose to 104¬∞F",response:"Sweating, vessel dilation",connection:"Hypothalamus triggered cooling",
predictions:[
{text:"The body will sweat and dilate blood vessels to cool down",correct:true},
{text:"The body will shiver to warm up",correct:false},
{text:"The body will do nothing",correct:false},
{text:"The body will constrict blood vessels",correct:false}
],
textLow:"A runner races on a hot day. Her body temperature rises above 104¬∞F. Her <strong>receptors</strong> detect the dangerous heat. Her <strong>hypothalamus</strong> triggers heavy sweating. Her body works to cool down toward the <strong>set point</strong> of 98.6¬∞F.",
textMed:"A marathon runner competes in Phoenix during extreme heat. Her core temperature rises above 104¬∞F. Temperature <strong>receptors</strong> detect this dangerous change. Her <strong>hypothalamus</strong> responds by triggering heavy sweating. Blood vessels dilate to release heat. Her body fights to return to the <strong>set point</strong> of 98.6¬∞F.",
textHigh:"During a Phoenix summer marathon, a runner's muscles generate significant metabolic heat. Her core temperature climbs past 104¬∞F. Temperature <strong>receptors</strong> in her skin and hypothalamus detect the rising heat. Her <strong>hypothalamus</strong> triggers maximum sweat production. Blood vessels dilate through vasodilation. This <strong>negative feedback</strong> response demonstrates how <strong>homeostasis</strong> maintains the body's <strong>set point</strong>."},
{id:2,name:"Astronaut Scott Kelly",icon:"üöÄ",meterStart:90,meterEnd:110,change:"Fluids shifted to head",response:"Reduced blood volume",connection:"Body adapted to zero gravity",
predictions:[
{text:"The body will reduce blood volume and heart size to adapt",correct:true},
{text:"The body will increase blood pressure dramatically",correct:false},
{text:"The body will produce more blood cells",correct:false},
{text:"Nothing will change in the body",correct:false}
],
textLow:"Scott Kelly lived on the space station for 340 days. Without gravity, his body fluids shifted toward his head. His <strong>receptors</strong> detected the fluid change. His body reduced blood volume as a <strong>response</strong>. His heart got smaller. His body tried to find a new <strong>balance</strong> in space.",
textMed:"NASA astronaut Scott Kelly spent 340 days aboard the ISS. In microgravity, his body fluids shifted upward toward his head. <strong>Receptors</strong> in his blood vessels detected this unusual distribution. His body's <strong>homeostasis</strong> systems activated. His kidneys excreted more fluid. His heart decreased in size, establishing a new temporary <strong>set point</strong>.",
textHigh:"Scott Kelly lived aboard the ISS for 340 days. In microgravity, fluid redistributed toward his head. Baroreceptors in his blood vessels detected what seemed like excess blood volume. His body initiated multiple <strong>homeostasis</strong> responses. His kidneys increased urine production. His heart atrophied. This demonstrates how <strong>negative feedback</strong> can establish new equilibrium states."},
{id:3,name:"Everest Climber",icon:"üèîÔ∏è",meterStart:175,meterEnd:110,change:"Oxygen dropped dangerously",response:"Faster breathing, more RBCs",connection:"Chemoreceptors triggered response",
predictions:[
{text:"The body will breathe faster and make more red blood cells",correct:true},
{text:"The body will breathe slower to conserve energy",correct:false},
{text:"The body will sweat to release oxygen",correct:false},
{text:"The body will lower heart rate",correct:false}
],
textLow:"A climber reaches 26,000 feet on Everest. The air has only one-third the oxygen. His <strong>receptors</strong> detect the low oxygen. His body <strong>responds</strong> by breathing faster. His heart pumps faster. His body fights to maintain oxygen <strong>balance</strong>.",
textMed:"At 26,000 feet on Everest, a climber enters the Death Zone. Each breath contains only one-third the oxygen available at sea level. Chemoreceptors detect the falling oxygen levels. The brainstem <strong>responds</strong> by dramatically increasing breathing rate. His heart rate accelerates. Over days, his body produces more red blood cells.",
textHigh:"Above 26,000 feet lies the Death Zone where oxygen is insufficient for human survival. Arterial oxygen saturation drops below 70%. Chemoreceptors in his carotid arteries detect this depletion. His brainstem <strong>responds</strong> by tripling breathing rate. His heart rate elevates to 120 bpm. His bone marrow increases red blood cell production. These <strong>homeostasis</strong> mechanisms represent <strong>negative feedback</strong>."},
{id:4,name:"Diabetic NBA Player",icon:"üèÄ",meterStart:25,meterEnd:100,change:"No insulin production",response:"Manual insulin injections",connection:"Replaced broken feedback loop",
predictions:[
{text:"He must inject insulin manually to replace the broken system",correct:true},
{text:"His body will start making insulin again on its own",correct:false},
{text:"Exercise alone will fix his blood sugar",correct:false},
{text:"His body doesn't need insulin",correct:false}
],
textLow:"NBA player Chris Dudley has Type 1 diabetes. His pancreas cannot make insulin. Without insulin, his blood sugar stays high. He must inject insulin before games. The insulin works like the missing hormone. He carefully monitors to maintain <strong>balance</strong>.",
textMed:"Chris Dudley was diagnosed with Type 1 diabetes at age 16. In Type 1 diabetes, the immune system destroys insulin-producing cells. Without insulin, glucose accumulates in the blood. Normal <strong>homeostasis</strong> mechanisms fail. Dudley learned to become his own <strong>homeostasis</strong> system by injecting insulin. He replaced his body's missing <strong>negative feedback</strong> loop.",
textHigh:"Chris Dudley received a Type 1 diabetes diagnosis at age 16. The immune system destroyed insulin-producing beta cells in his pancreas. Without endogenous insulin, glucose transporters cannot activate. Blood glucose levels rise unchecked because the <strong>negative feedback</strong> mechanism is broken. Dudley became a pioneer by managing his own glucose <strong>homeostasis</strong>. His artificial <strong>response</strong> system mimicked what healthy cells would release."},
{id:5,name:"Arctic Explorer",icon:"‚ùÑÔ∏è",meterStart:175,meterEnd:110,change:"Extreme cold (-35¬∞F)",response:"Shivering, vasoconstriction",connection:"Hypothalamus triggered warming",
predictions:[
{text:"The body will shiver and constrict blood vessels to stay warm",correct:true},
{text:"The body will sweat to cool down",correct:false},
{text:"The body will dilate blood vessels",correct:false},
{text:"The body will slow down the heart",correct:false}
],
textLow:"Explorer Ann Bancroft skied across Antarctica in extreme cold. Temperatures dropped below -30¬∞F. Her skin <strong>receptors</strong> detected the cold. Her body <strong>responded</strong> by shivering to generate heat. Blood vessels constricted to keep warm blood near organs.",
textMed:"Ann Bancroft attempted to ski across Antarctica facing temperatures as low as -35¬∞F. Cold <strong>receptors</strong> in her skin continuously signaled dangerous temperature drops to her <strong>hypothalamus</strong>. Her <strong>hypothalamus</strong> triggered powerful shivering. Vasoconstriction narrowed blood vessels near her skin. Her metabolism increased dramatically.",
textHigh:"Ann Bancroft undertook an Antarctic expedition skiing through temperatures reaching -35¬∞F. Cold thermoreceptors in her skin transmitted danger signals. The <strong>hypothalamus</strong> compared her actual temperature against the <strong>set point</strong> of 98.6¬∞F. Her <strong>hypothalamus</strong> orchestrated multiple warming <strong>responses</strong>. Shivering thermogenesis activated. Extreme vasoconstriction redirected blood flow. This <strong>negative feedback</strong> response demonstrated <strong>homeostasis</strong> under extreme stress."},
{id:6,name:"Desert Rescue",icon:"üèúÔ∏è",meterStart:175,meterEnd:110,change:"Severe dehydration",response:"Reduced urine, intense thirst",connection:"Osmoreceptors conserved water",
predictions:[
{text:"The body will reduce urine and trigger intense thirst",correct:true},
{text:"The body will increase urine output",correct:false},
{text:"The body will stop sweating completely",correct:false},
{text:"The body will lower body temperature",correct:false}
],
textLow:"A hiker got lost in Death Valley during summer. Temperatures exceeded 118¬∞F. His body lost water through sweating. <strong>Receptors</strong> detected dehydration. His body <strong>responded</strong> by reducing urine output. His <strong>hypothalamus</strong> triggered intense thirst signals.",
textMed:"A solo hiker became disoriented in Death Valley where temperatures exceeded 118¬∞F. His body sweated heavily. Osmoreceptors signaled dangerous dehydration to his <strong>hypothalamus</strong>. His <strong>hypothalamus</strong> triggered two critical <strong>responses</strong>. First, ADH caused his kidneys to retain water. Second, powerful thirst signals drove water-seeking behavior.",
textHigh:"A solo hiker became lost in Death Valley during July when temperatures exceeded 118¬∞F. His blood plasma volume decreased significantly. Osmoreceptors in his <strong>hypothalamus</strong> detected dangerous concentration changes. His <strong>hypothalamus</strong> orchestrated multiple water-conserving <strong>responses</strong>. ADH release surged, directing his kidneys to reabsorb nearly all filtered water. Intense thirst signals drove water-seeking behavior. His body demonstrated remarkable <strong>negative feedback</strong> efficiency."},
{id:7,name:"Addiction Recovery",icon:"üß†",meterStart:175,meterEnd:110,change:"Brain dopamine depleted",response:"Withdrawal, then restoration",connection:"Brain slowly restored balance",
predictions:[
{text:"The brain will have withdrawal symptoms, then slowly restore dopamine",correct:true},
{text:"The brain will immediately return to normal",correct:false},
{text:"The brain will permanently lose all dopamine",correct:false},
{text:"Nothing will happen to the brain",correct:false}
],
textLow:"A person stopped opioid drug use. The drugs had changed how their brain made dopamine. When drugs stopped, <strong>receptors</strong> detected very low dopamine. The brain <strong>responded</strong> with cravings. Over weeks, the brain slowly restored normal dopamine. The body worked to return to <strong>balance</strong>.",
textMed:"Medical cases show how addiction disrupts brain <strong>homeostasis</strong>. When a person regularly uses opioid drugs, the brain reduces its own dopamine production. When drug use stops, <strong>receptors</strong> detect severely low levels. The brain's <strong>response</strong> creates withdrawal symptoms. Over time, the brain slowly restores its natural production. This demonstrates the brain's ability to restore <strong>homeostasis</strong>.",
textHigh:"Clinical research documents how chronic opioid use disrupts brain <strong>homeostasis</strong>. Opioids repeatedly flood the brain with dopamine. The brain adapts by reducing its own production. When drug use ceases, dopamine levels plummet below baseline. The brain's <strong>response</strong> manifests as withdrawal syndrome. Over weeks to months, the brain gradually upregulates natural production. New dopamine <strong>receptors</strong> form through neuroplasticity. The brain's eventual return to <strong>balance</strong> demonstrates self-correcting capacity."},
{id:8,name:"Titanic Survivor",icon:"üö¢",meterStart:175,meterEnd:120,change:"28¬∞F water immersion",response:"Violent shivering",connection:"Hypothalamus maximized heat",
predictions:[
{text:"The body will shiver violently and constrict blood vessels",correct:true},
{text:"The body will relax to conserve energy",correct:false},
{text:"The body will increase blood flow to skin",correct:false},
{text:"The body will stop all responses",correct:false}
],
textLow:"When the Titanic sank, survivors floated in 28¬∞F water. Cold <strong>receptors</strong> immediately detected the deadly cold. Core temperature began dropping. Survivors' bodies <strong>responded</strong> with violent shivering. Blood vessels constricted to protect vital organs.",
textMed:"On April 15, 1912, Titanic survivors entered North Atlantic water at 28¬∞F. The body loses heat 25 times faster in water than air. Cold <strong>receptors</strong> sent urgent signals to the <strong>hypothalamus</strong>. The <strong>hypothalamus</strong> triggered maximum defensive <strong>responses</strong>. Violent shivering generated metabolic heat. Extreme vasoconstriction shut blood flow to extremities.",
textHigh:"When RMS Titanic sank, approximately 1,500 people entered the North Atlantic at 28¬∞F. Water conducts heat 25 times more efficiently than air. Cold thermoreceptors fired continuously. The <strong>hypothalamus</strong> recognized massive deviation from the 98.6¬∞F <strong>set point</strong>. Survivors' bodies mounted maximum thermoregulatory <strong>responses</strong>. Violent shivering generated metabolic heat at 500% above normal. Extreme vasoconstriction redirected blood to protect the core. Those pulled from water quickly survived, demonstrating successful <strong>homeostasis</strong> defense."}
];

var current = null;
var phase = 0;
var readingLevel = "Low";
var selectedPrediction = null;
var completed = [];
var streak = 0;
var score = 0;
var totalAttempts = 0;
var correctPredictions = 0;

function startApp() {
    document.getElementById("introScreen").classList.add("hidden");
    document.getElementById("mainApp").classList.remove("hidden");
    renderScenarios();
    setupLevelButtons();
}

function setupLevelButtons() {
    document.getElementById("btnLow").onclick = function() { setLevel("Low"); };
    document.getElementById("btnMed").onclick = function() { setLevel("Med"); };
    document.getElementById("btnHigh").onclick = function() { setLevel("High"); };
}

function setLevel(lvl) {
    readingLevel = lvl;
    var btns = document.querySelectorAll(".level-btn");
    for (var i = 0; i < btns.length; i++) {
        btns[i].classList.remove("active");
    }
    document.getElementById("btn" + lvl).classList.add("active");
    if (phase === 2) {
        renderPhase();
    }
}

function getReadingText(scenario) {
    if (readingLevel === "Low") return scenario.textLow;
    if (readingLevel === "Med") return scenario.textMed;
    if (readingLevel === "High") return scenario.textHigh;
    return scenario.textLow;
}

function renderScenarios() {
    var list = document.getElementById("scenarioList");
    list.innerHTML = "";
    for (var i = 0; i < scenarios.length; i++) {
        var s = scenarios[i];
        var btn = document.createElement("button");
        btn.className = "scenario-btn";
        if (current && current.id === s.id) btn.classList.add("active");
        if (completed.indexOf(s.id) !== -1) btn.classList.add("completed");
        btn.innerHTML = '<span class="scenario-icon">' + s.icon + '</span>' + s.name;
        btn.setAttribute("data-id", s.id);
        btn.onclick = (function(scenario) {
            return function() { selectScenario(scenario); };
        })(s);
        list.appendChild(btn);
    }
}

function selectScenario(s) {
    current = s;
    phase = 1;
    selectedPrediction = null;
    renderScenarios();
    updateTabs();
    renderPhase();
}

function updateTabs() {
    for (var i = 1; i <= 4; i++) {
        var tab = document.getElementById("tab" + i);
        tab.classList.remove("active", "done");
        if (i < phase) tab.classList.add("done");
        if (i === phase) tab.classList.add("active");
    }
}

function renderPhase() {
    var area = document.getElementById("contentArea");
    var actions = document.getElementById("actionArea");
    
    if (phase === 1) {
        var choicesHTML = '<div class="predict-choices">';
        for (var i = 0; i < current.predictions.length; i++) {
            choicesHTML += '<div class="predict-choice" id="pred' + i + '">' + current.predictions[i].text + '</div>';
        }
        choicesHTML += '</div>';
        
        area.innerHTML = '<div class="content-card"><h2>ü§î Make Your Prediction</h2><p><strong>' + current.icon + ' ' + current.name + '</strong></p><p style="margin-top:10px;color:#aaa">What do you think the body will do?</p>' + choicesHTML + '<div id="predFeedback"></div></div>';
        actions.innerHTML = '<button class="btn-action" id="submitPred" disabled>Submit Prediction ‚Üí</button>';
        
        // Attach click handlers
        for (var j = 0; j < current.predictions.length; j++) {
            (function(idx) {
                document.getElementById("pred" + idx).onclick = function() { selectPrediction(idx); };
            })(j);
        }
        document.getElementById("submitPred").onclick = submitPrediction;
    }
    else if (phase === 2) {
        var readingText = getReadingText(current);
        area.innerHTML = '<div class="content-card"><h2>üìñ Read the True Story</h2><div class="reading-box">' + readingText + '</div></div>';
        actions.innerHTML = '<button class="btn-speak" id="speakBtn">üîä Read Aloud</button><button class="btn-action" id="nextBtn">Watch Response ‚Üí</button>';
        document.getElementById("speakBtn").onclick = speakText;
        document.getElementById("nextBtn").onclick = nextPhase;
    }
    else if (phase === 3) {
        area.innerHTML = '<div class="content-card"><h2>üìä Watch the Body Respond</h2><p>See how the body works to restore balance...</p><div class="meter-area"><div class="body-icon">üßç</div><div class="meter-wrap"><div class="meter"><div class="meter-needle" id="needle" style="top:' + current.meterStart + 'px"></div></div><div class="meter-labels"><span>TOO HIGH</span><span style="color:#4CAF50">OK ZONE</span><span>TOO LOW</span></div></div></div><p id="watchMsg" style="color:#888">The body is responding...</p></div>';
        actions.innerHTML = '';
        setTimeout(function() {
            document.getElementById("needle").style.top = current.meterEnd + "px";
        }, 300);
        setTimeout(function() {
            document.getElementById("watchMsg").innerHTML = '<span style="color:#4CAF50">‚úì Body activated responses to restore balance!</span>';
            actions.innerHTML = '<button class="btn-action" id="nextBtn">Record Data ‚Üí</button>';
            document.getElementById("nextBtn").onclick = nextPhase;
        }, 2000);
    }
    else if (phase === 4) {
        area.innerHTML = '<div class="content-card"><h2>‚úÖ Record Your Data</h2><table style="width:100%;text-align:left;margin:15px 0"><tr><td style="padding:8px;color:#888">Scenario:</td><td style="padding:8px">' + current.icon + ' ' + current.name + '</td></tr><tr><td style="padding:8px;color:#888">What Changed:</td><td style="padding:8px">' + current.change + '</td></tr><tr><td style="padding:8px;color:#888">Body Response:</td><td style="padding:8px">' + current.response + '</td></tr><tr><td style="padding:8px;color:#888">Homeostasis Connection:</td><td style="padding:8px">' + current.connection + '</td></tr></table><p style="color:#4CAF50">Click below to save this to your data table.</p></div>';
        actions.innerHTML = '<button class="btn-action" id="saveBtn">Save to Table ‚úì</button>';
        document.getElementById("saveBtn").onclick = saveRecord;
    }
}

function selectPrediction(idx) {
    selectedPrediction = idx;
    var choices = document.querySelectorAll(".predict-choice");
    for (var i = 0; i < choices.length; i++) {
        choices[i].classList.remove("selected");
    }
    document.getElementById("pred" + idx).classList.add("selected");
    document.getElementById("submitPred").disabled = false;
}

function submitPrediction() {
    if (selectedPrediction === null) return;
    
    totalAttempts++;
    var isCorrect = current.predictions[selectedPrediction].correct;
    
    var choices = document.querySelectorAll(".predict-choice");
    for (var i = 0; i < choices.length; i++) {
        choices[i].onclick = null;
        choices[i].style.cursor = "default";
        if (current.predictions[i].correct) {
            choices[i].classList.add("correct");
        } else if (i === selectedPrediction && !isCorrect) {
            choices[i].classList.add("incorrect");
        }
    }
    
    var feedback = document.getElementById("predFeedback");
    if (isCorrect) {
        correctPredictions++;
        streak++;
        score += 50;
        feedback.innerHTML = '<div class="feedback correct">‚úì Correct! Great prediction!</div>';
    } else {
        streak = 0;
        feedback.innerHTML = '<div class="feedback incorrect">‚úó Not quite. The correct answer is highlighted in green.</div>';
    }
    
    updateHUD();
    document.getElementById("actionArea").innerHTML = '<button class="btn-action" id="continueBtn">Continue to Read ‚Üí</button>';
    document.getElementById("continueBtn").onclick = nextPhase;
}

function nextPhase() {
    phase++;
    updateTabs();
    renderPhase();
}

function saveRecord() {
    if (completed.indexOf(current.id) === -1) {
        completed.push(current.id);
        score += 50;
        
        var row = document.createElement("tr");
        row.innerHTML = '<td>' + current.icon + ' ' + current.name + '</td><td>' + current.change + '</td><td>' + current.response + '</td><td>' + current.connection + '</td>';
        document.getElementById("dataBody").appendChild(row);
        
        updateHUD();
    }
    
    phase = 0;
    current = null;
    selectedPrediction = null;
    renderScenarios();
    updateTabs();
    
    document.getElementById("contentArea").innerHTML = '<div class="content-card"><h2>üéâ Data Recorded!</h2><p>Great work! Select another scenario from the left to continue.</p></div>';
    document.getElementById("actionArea").innerHTML = '';
    
    if (completed.length === 5) {
        setTimeout(function() { alert("‚úì Required Complete! Continue for extra credit by doing all 8!"); }, 500);
    } else if (completed.length === 8) {
        setTimeout(function() { alert("üèÜ Extra Credit Complete! You investigated all 8 cases!"); }, 500);
    }
}

function updateHUD() {
    document.getElementById("hudDone").textContent = completed.length + "/5";
    document.getElementById("hudStreak").textContent = streak;
    document.getElementById("hudScore").textContent = score;
    var acc = totalAttempts > 0 ? Math.round(correctPredictions / totalAttempts * 100) : 100;
    document.getElementById("hudAcc").textContent = acc + "%";
    document.getElementById("progBar").style.width = Math.min(completed.length / 5 * 100, 100) + "%";
    
    var remaining = 5 - completed.length;
    var msg = "Pick " + remaining + " more!";
    if (completed.length >= 5 && completed.length < 8) msg = "‚úì Required done! " + (8 - completed.length) + " more for extra credit!";
    if (completed.length === 8) msg = "üèÜ All complete!";
    document.getElementById("statusMsg").textContent = msg;
}

function speakText() {
    var box = document.querySelector(".reading-box");
    if (box && window.speechSynthesis) {
        speechSynthesis.cancel();
        var text = box.innerText;
        var utt = new SpeechSynthesisUtterance(text);
        utt.rate = 0.9;
        speechSynthesis.speak(utt);
    }
}

function resetCurrent() {
    if (current) {
        phase = 1;
        selectedPrediction = null;
        updateTabs();
        renderPhase();
    }
}

function resetAll() {
    if (confirm("Reset all progress?")) {
        completed = [];
        streak = 0;
        score = 0;
        totalAttempts = 0;
        correctPredictions = 0;
        current = null;
        phase = 0;
        selectedPrediction = null;
        document.getElementById("dataBody").innerHTML = "";
        updateHUD();
        renderScenarios();
        document.getElementById("contentArea").innerHTML = '<div class="content-card"><h2>üëà Select a Scenario</h2><p>Choose a case from the left sidebar to begin.</p></div>';
        document.getElementById("actionArea").innerHTML = "";
        for (var i = 1; i <= 4; i++) {
            document.getElementById("tab" + i).classList.remove("active", "done");
        }
    }
}
</script>
</body>
</html>
