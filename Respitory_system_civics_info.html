<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Science Department Simulation: Respiratory System ‚Äî Policy and Responsibility</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
            overflow: hidden;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            background: linear-gradient(90deg, #4CAF50, #2196F3, #9C27B0);
            padding: 12px 24px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .mission {
            font-size: 0.85rem;
            opacity: 0.95;
            margin-top: 4px;
        }

        /* Main Layout */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Left Sidebar */
        .left-sidebar {
            width: 260px;
            min-width: 260px;
            background: linear-gradient(180deg, #1e2a4a 0%, #162036 100%);
            padding: 14px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            overflow-y: auto;
            border-right: 2px solid #3d5a80;
        }

        .sidebar-section {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 10px;
        }

        .sidebar-title {
            font-size: 0.8rem;
            font-weight: 700;
            color: #64B5F6;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .scenario-count {
            background: #4CAF50;
            color: white;
            font-size: 0.65rem;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: auto;
        }

        .scenario-cards {
            display: flex;
            flex-direction: column;
            gap: 5px;
            max-height: 260px;
            overflow-y: auto;
        }

        .scenario-card {
            background: rgba(255,255,255,0.08);
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 8px 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .scenario-card:hover {
            background: rgba(255,255,255,0.15);
            transform: translateX(4px);
        }

        .scenario-card.selected {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            border-color: #81C784;
            box-shadow: 0 0 15px rgba(76,175,80,0.4);
        }

        .scenario-card.completed {
            opacity: 0.7;
            position: relative;
        }

        .scenario-card.completed::after {
            content: '‚úì';
            position: absolute;
            right: 8px;
            color: #4CAF50;
            font-weight: bold;
            font-size: 1rem;
        }

        .scenario-card .emoji {
            font-size: 1.3rem;
        }

        .scenario-card .name {
            font-size: 0.8rem;
            font-weight: 600;
        }

        /* Reading Level */
        .reading-level-tabs {
            display: flex;
            gap: 5px;
        }

        .level-tab {
            flex: 1;
            padding: 7px 4px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.7rem;
            font-weight: 600;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.1);
            color: #aaa;
        }

        .level-tab:hover {
            background: rgba(255,255,255,0.2);
        }

        .level-tab.active {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
            box-shadow: 0 0 10px rgba(33,150,243,0.4);
        }

        /* Key Words */
        .key-words-list {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .key-word {
            background: linear-gradient(135deg, #9C27B0, #7B1FA2);
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        /* Buttons */
        .sidebar-buttons {
            display: flex;
            gap: 8px;
            margin-top: auto;
        }

        .btn-reset, .btn-new {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 700;
            transition: all 0.3s ease;
        }

        .btn-reset {
            background: linear-gradient(135deg, #f44336, #c62828);
            color: white;
        }

        .btn-new {
            background: linear-gradient(135deg, #2196F3, #1565C0);
            color: white;
        }

        .btn-reset:hover, .btn-new:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        /* Center Panel */
        .center-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 14px;
            gap: 12px;
            overflow: hidden;
        }

        /* Step Indicator */
        .step-indicator {
            display: flex;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 4px;
            gap: 4px;
        }

        .step-tab {
            flex: 1;
            padding: 8px 6px;
            text-align: center;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 700;
            transition: all 0.3s ease;
            color: #666;
            background: transparent;
        }

        .step-tab.active {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
            box-shadow: 0 0 20px rgba(76,175,80,0.5);
            animation: pulse 2s infinite;
        }

        .step-tab.completed {
            background: rgba(76,175,80,0.3);
            color: #81C784;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(76,175,80,0.5); }
            50% { box-shadow: 0 0 30px rgba(76,175,80,0.8); }
        }

        /* Main Content Area */
        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.03);
            border-radius: 16px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        /* Welcome State */
        .welcome-state {
            text-align: center;
            animation: fadeIn 0.5s ease;
        }

        .welcome-state .icon {
            font-size: 4rem;
            margin-bottom: 16px;
        }

        .welcome-state h2 {
            font-size: 1.5rem;
            margin-bottom: 12px;
            color: #64B5F6;
        }

        .welcome-state p {
            color: #aaa;
            font-size: 1rem;
        }

        /* Predict State */
        .predict-state {
            text-align: center;
            animation: fadeIn 0.5s ease;
            max-width: 600px;
        }

        .predict-state h2 {
            font-size: 1.3rem;
            color: #FFB74D;
            margin-bottom: 16px;
        }

        .predict-question {
            background: rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #FFB74D;
        }

        .predict-question p {
            font-size: 1.05rem;
            line-height: 1.5;
        }

        .predict-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
        }

        .predict-btn {
            padding: 14px 36px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            transition: all 0.3s ease;
        }

        .predict-btn.yes {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
        }

        .predict-btn.no {
            background: linear-gradient(135deg, #f44336, #c62828);
            color: white;
        }

        .predict-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        /* Read State */
        .read-state {
            width: 100%;
            max-width: 700px;
            animation: fadeIn 0.5s ease;
        }

        .read-state h2 {
            font-size: 1.2rem;
            color: #64B5F6;
            margin-bottom: 12px;
            text-align: center;
        }

        .reading-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.12), rgba(255,255,255,0.05));
            border-radius: 16px;
            padding: 20px;
            border: 2px solid rgba(100,181,246,0.3);
            max-height: 280px;
            overflow-y: auto;
        }

        .reading-text {
            font-size: 1rem;
            line-height: 1.75;
            color: #e0e0e0;
        }

        .reading-text .keyword {
            color: #4FC3F7;
            font-weight: 700;
        }

        .read-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 16px;
        }

        .btn-read-aloud {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            background: linear-gradient(135deg, #FF9800, #F57C00);
            color: white;
            transition: all 0.3s ease;
        }

        .btn-continue {
            padding: 10px 28px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 700;
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
            transition: all 0.3s ease;
        }

        .btn-read-aloud:hover, .btn-continue:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        /* Watch State - ENHANCED */
        .watch-state {
            text-align: center;
            animation: fadeIn 0.5s ease;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .watch-state h2 {
            font-size: 1.2rem;
            color: #CE93D8;
            margin-bottom: 12px;
        }

        .watch-content {
            flex: 1;
            display: flex;
            gap: 20px;
            min-height: 0;
        }

        /* Scene Visual - Left side of watch */
        .scene-visual {
            flex: 1;
            background: linear-gradient(135deg, #1a237e 0%, #0d47a1 100%);
            border-radius: 16px;
            padding: 16px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .scene-title {
            font-size: 1rem;
            font-weight: 700;
            color: #fff;
            margin-bottom: 10px;
            text-align: center;
        }

        .scene-container {
            flex: 1;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .scene-svg {
            width: 100%;
            height: 100%;
            max-height: 300px;
        }

        /* Meter Visual - Right side of watch */
        .meter-visual {
            width: 280px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .meter-container {
            background: linear-gradient(135deg, #263238, #37474F);
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .meter-title {
            font-size: 0.9rem;
            font-weight: 700;
            margin-bottom: 12px;
            color: #B0BEC5;
            text-align: center;
        }

        .meter-gauge {
            position: relative;
            height: 40px;
            background: linear-gradient(90deg, #f44336 0%, #f44336 33%, #FFC107 33%, #FFC107 66%, #4CAF50 66%, #4CAF50 100%);
            border-radius: 20px;
            margin-bottom: 8px;
            overflow: visible;
        }

        .meter-zones {
            display: flex;
            height: 100%;
        }

        .meter-zone {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.6rem;
            font-weight: 700;
            text-transform: uppercase;
            color: rgba(255,255,255,0.9);
        }

        .meter-needle {
            position: absolute;
            width: 6px;
            height: 50px;
            background: white;
            top: -5px;
            left: 10%;
            border-radius: 3px;
            box-shadow: 0 0 15px rgba(255,255,255,0.8);
            transition: left 2s ease-out;
        }

        .meter-needle::after {
            content: '‚ñº';
            position: absolute;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1rem;
            color: white;
            text-shadow: 0 0 10px rgba(255,255,255,0.8);
        }

        .ok-zone-marker {
            position: absolute;
            right: 5%;
            top: -24px;
            background: #4CAF50;
            color: white;
            padding: 3px 10px;
            border-radius: 6px;
            font-size: 0.65rem;
            font-weight: 700;
        }

        .meter-labels {
            display: flex;
            justify-content: space-between;
            padding: 0 8px;
            font-size: 0.65rem;
            color: #78909C;
        }

        .protection-status {
            margin-top: 12px;
            padding: 10px 16px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 700;
            text-align: center;
        }

        .protection-status.none {
            background: rgba(244,67,54,0.2);
            color: #EF5350;
            border: 2px solid #f44336;
        }

        .protection-status.partial {
            background: rgba(255,193,7,0.2);
            color: #FFD54F;
            border: 2px solid #FFC107;
        }

        .protection-status.strong {
            background: rgba(76,175,80,0.2);
            color: #81C784;
            border: 2px solid #4CAF50;
        }

        .protection-status.debate {
            background: rgba(156,39,176,0.2);
            color: #CE93D8;
            border: 2px solid #9C27B0;
        }

        .result-summary {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 12px;
            text-align: left;
        }

        .result-summary h4 {
            font-size: 0.8rem;
            color: #64B5F6;
            margin-bottom: 8px;
        }

        .result-item {
            font-size: 0.75rem;
            color: #B0BEC5;
            margin-bottom: 4px;
            display: flex;
            gap: 6px;
        }

        .result-item strong {
            color: #fff;
        }

        .watch-button {
            margin-top: 12px;
        }

        /* Record State */
        .record-state {
            text-align: center;
            animation: fadeIn 0.5s ease;
        }

        .record-state h2 {
            font-size: 1.3rem;
            color: #81C784;
            margin-bottom: 12px;
        }

        .record-state .icon {
            font-size: 3.5rem;
            margin-bottom: 12px;
        }

        .record-state p {
            color: #aaa;
            margin-bottom: 16px;
        }

        .btn-next-scenario {
            padding: 12px 32px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 700;
            background: linear-gradient(135deg, #2196F3, #1565C0);
            color: white;
            transition: all 0.3s ease;
        }

        .btn-next-scenario:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(33,150,243,0.4);
        }

        /* Right Sidebar */
        .right-sidebar {
            width: 260px;
            min-width: 260px;
            background: linear-gradient(180deg, #1e2a4a 0%, #162036 100%);
            padding: 14px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            overflow-y: auto;
            border-left: 2px solid #3d5a80;
        }

        /* HUD Stats */
        .hud-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
        }

        .hud-stat {
            background: rgba(255,255,255,0.08);
            border-radius: 10px;
            padding: 10px;
            text-align: center;
        }

        .hud-stat .value {
            font-size: 1.4rem;
            font-weight: 700;
            color: #4FC3F7;
        }

        .hud-stat .label {
            font-size: 0.65rem;
            color: #78909C;
            text-transform: uppercase;
        }

        /* Progress Bar */
        .progress-section {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 12px;
        }

        .progress-bar-container {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            height: 18px;
            overflow: hidden;
            margin-bottom: 6px;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #81C784);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .progress-message {
            font-size: 0.75rem;
            color: #81C784;
            text-align: center;
        }

        /* Data Table */
        .data-table-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .data-table-container {
            flex: 1;
            overflow-y: auto;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.65rem;
        }

        .data-table th {
            background: linear-gradient(135deg, #3d5a80, #2c4a6e);
            padding: 6px 4px;
            text-align: left;
            position: sticky;
            top: 0;
            font-weight: 700;
            color: #B0BEC5;
        }

        .data-table td {
            padding: 6px 4px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            color: #e0e0e0;
        }

        .data-table tr:nth-child(even) {
            background: rgba(255,255,255,0.03);
        }

        .toward-ok {
            font-weight: 700;
        }

        .toward-ok.yes {
            color: #81C784;
        }

        .toward-ok.no {
            color: #EF5350;
        }

        /* Completion Badge */
        .completion-badge {
            background: linear-gradient(135deg, #FFD700, #FFA000);
            color: #333;
            padding: 10px;
            border-radius: 12px;
            text-align: center;
            font-weight: 700;
            font-size: 0.8rem;
            display: none;
            animation: bounceIn 0.5s ease;
        }

        .completion-badge.show {
            display: block;
        }

        .completion-badge.extra-credit {
            background: linear-gradient(135deg, #9C27B0, #7B1FA2);
            color: white;
        }

        @keyframes bounceIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* SVG Animations */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes shrink {
            from { transform: scale(1); }
            to { transform: scale(0.3); }
        }

        @keyframes pulse-glow {
            0%, 100% { filter: drop-shadow(0 0 5px currentColor); }
            50% { filter: drop-shadow(0 0 15px currentColor); }
        }

        @keyframes smoke-rise {
            0% { transform: translateY(0) scale(1); opacity: 0.8; }
            100% { transform: translateY(-30px) scale(1.5); opacity: 0; }
        }

        @keyframes checkmark-appear {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        .animate-float {
            animation: float 2s ease-in-out infinite;
        }

        .animate-fade-in {
            animation: fadeInUp 0.8s ease forwards;
        }

        .animate-pulse {
            animation: pulse-glow 1.5s ease-in-out infinite;
        }

        .hidden {
            display: none !important;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.2);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ü´Å Science Department Simulation: Respiratory System ‚Äî Policy and Responsibility</h1>
            <p class="mission">Every day, millions of kids breathe air that damages their lungs‚Äîbut who should fix it?</p>
        </header>

        <div class="main-content">
            <!-- Left Sidebar -->
            <aside class="left-sidebar">
                <div class="sidebar-section">
                    <div class="sidebar-title">
                        Pick Any You Like
                        <span class="scenario-count" id="scenarioCount">0/5</span>
                    </div>
                    <div class="scenario-cards" id="scenarioCards"></div>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-title">üìö Reading Level</div>
                    <div class="reading-level-tabs">
                        <button class="level-tab active" data-level="low">Low</button>
                        <button class="level-tab" data-level="medium">Med</button>
                        <button class="level-tab" data-level="high">High</button>
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-title">üîë Key Words</div>
                    <div class="key-words-list">
                        <span class="key-word">Policy</span>
                        <span class="key-word">Regulation</span>
                        <span class="key-word">Disparity</span>
                        <span class="key-word">Advocate</span>
                    </div>
                </div>

                <div class="sidebar-buttons">
                    <button class="btn-reset" onclick="resetSimulation()">Reset</button>
                    <button class="btn-new" onclick="newRun()">New Run</button>
                </div>
            </aside>

            <!-- Center Panel -->
            <main class="center-panel">
                <div class="step-indicator">
                    <div class="step-tab" data-step="1">1. PREDICT</div>
                    <div class="step-tab" data-step="2">2. READ</div>
                    <div class="step-tab" data-step="3">3. WATCH</div>
                    <div class="step-tab" data-step="4">4. RECORD</div>
                </div>

                <div class="content-area" id="contentArea">
                    <!-- Welcome State -->
                    <div class="welcome-state" id="welcomeState">
                        <div class="icon">üëà</div>
                        <h2>Pick a Policy Scenario</h2>
                        <p>Choose any scenario from the left that interests you.<br>Complete 5 to earn your Lung Defender badge!</p>
                    </div>

                    <!-- Predict State -->
                    <div class="predict-state hidden" id="predictState">
                        <h2>ü§î Make Your Prediction</h2>
                        <div class="predict-question">
                            <p id="predictQuestion">Will this policy move lung health toward OK?</p>
                        </div>
                        <div class="predict-buttons">
                            <button class="predict-btn yes" onclick="makePrediction('yes')">‚úì Yes</button>
                            <button class="predict-btn no" onclick="makePrediction('no')">‚úó No</button>
                        </div>
                    </div>

                    <!-- Read State -->
                    <div class="read-state hidden" id="readState">
                        <h2>üìñ Read About the Policy</h2>
                        <div class="reading-card">
                            <div class="reading-text" id="readingText"></div>
                        </div>
                        <div class="read-buttons">
                            <button class="btn-read-aloud" onclick="readAloud()">üîä Read Aloud</button>
                            <button class="btn-continue" onclick="goToWatch()">Watch What Happens ‚Üí</button>
                        </div>
                    </div>

                    <!-- Watch State - ENHANCED -->
                    <div class="watch-state hidden" id="watchState">
                        <h2>üëÄ Watch What Happens</h2>
                        <div class="watch-content">
                            <div class="scene-visual">
                                <div class="scene-title" id="sceneTitle">Scene Title</div>
                                <div class="scene-container" id="sceneContainer">
                                    <!-- SVG scene rendered here -->
                                </div>
                            </div>
                            <div class="meter-visual">
                                <div class="meter-container" id="meterContainer">
                                    <div class="meter-title">ü´Å Lung Health Meter</div>
                                    <div class="meter-gauge">
                                        <div class="ok-zone-marker">OK</div>
                                        <div class="meter-zones">
                                            <div class="meter-zone" style="color:#fff;">Bad</div>
                                            <div class="meter-zone" style="color:#333;">Partial</div>
                                            <div class="meter-zone" style="color:#fff;">Good</div>
                                        </div>
                                        <div class="meter-needle" id="meterNeedle"></div>
                                    </div>
                                    <div class="meter-labels">
                                        <span>üî¥</span>
                                        <span>üü°</span>
                                        <span>üü¢</span>
                                    </div>
                                    <div class="protection-status" id="protectionStatus">Waiting...</div>
                                </div>
                                <div class="result-summary" id="resultSummary">
                                    <h4>üìã What Happened</h4>
                                    <div class="result-item"><span>üìç</span><span id="resultChange">Loading...</span></div>
                                    <div class="result-item"><span>‚ö°</span><span id="resultResponse">Loading...</span></div>
                                    <div class="result-item"><span>üéØ</span><span id="resultOK">Loading...</span></div>
                                </div>
                                <div class="watch-button">
                                    <button class="btn-continue" onclick="goToRecord()">Record Data ‚Üí</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Record State -->
                    <div class="record-state hidden" id="recordState">
                        <div class="icon">‚úÖ</div>
                        <h2>Data Recorded!</h2>
                        <p id="recordMessage">Great job! Pick another scenario to continue.</p>
                        <button class="btn-next-scenario" onclick="selectNextScenario()">Pick Next Scenario</button>
                    </div>
                </div>
            </main>

            <!-- Right Sidebar -->
            <aside class="right-sidebar">
                <div class="sidebar-section">
                    <div class="sidebar-title">üìä Progress</div>
                    <div class="hud-grid">
                        <div class="hud-stat">
                            <div class="value" id="scoreValue">0</div>
                            <div class="label">Score</div>
                        </div>
                        <div class="hud-stat">
                            <div class="value" id="streakValue">0</div>
                            <div class="label">Streak</div>
                        </div>
                        <div class="hud-stat">
                            <div class="value" id="completedValue">0</div>
                            <div class="label">Done</div>
                        </div>
                        <div class="hud-stat">
                            <div class="value" id="accuracyValue">--%</div>
                            <div class="label">Accuracy</div>
                        </div>
                    </div>
                </div>

                <div class="progress-section">
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <div class="progress-message" id="progressMessage">Pick 5 scenarios you like!</div>
                </div>

                <div class="completion-badge" id="completionBadge">
                    üèÜ Lung Defender Badge!
                </div>

                <div class="completion-badge extra-credit" id="extraCreditBadge">
                    ‚≠ê Policy Expert! All 8!
                </div>

                <div class="sidebar-section data-table-section">
                    <div class="sidebar-title">üìã Data Table</div>
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Scenario</th>
                                    <th>Changed</th>
                                    <th>Response</th>
                                    <th>OK?</th>
                                </tr>
                            </thead>
                            <tbody id="dataTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <script>
        // Scenario Data with SVG scenes
        const scenarios = [
            {
                id: 1,
                name: "Vape Detectors",
                emoji: "üö®",
                whatChanged: "School installs vape detectors",
                systemResponse: "Bathroom vaping dropped 70%",
                towardOK: "Yes",
                meterPosition: 50,
                protection: "partial",
                sceneTitle: "Vape Detectors in School Bathrooms",
                readings: {
                    low: `Many teens vape in school bathrooms where no one can see them. Some schools installed <span class="keyword">vape detectors</span> that alert staff when vapor is detected. After installing detectors, one school saw bathroom vaping drop by 70%. But detectors cost $1,000 each, so only some schools can afford them‚Äîprotection is uneven.`,
                    medium: `Vaping in school bathrooms became a chronic problem because students could hide easily. Schools tried education programs, but many teens kept vaping. Some schools decided to install <span class="keyword">vape detectors</span> that sense vapor and alert staff immediately. After one school installed detectors, bathroom vaping incidents dropped by 70% in the first semester. The <span class="keyword">policy</span> was effective where it was used, but each detector costs about $1,000. Because only some schools can afford detectors, lung protection is uneven across the country.`,
                    high: `Vaping became a chronic problem in school bathrooms across America because students could hide from teachers. Traditional methods like education programs and bathroom monitors weren't stopping the behavior. Some school districts invested in <span class="keyword">vape detectors</span>‚Äîsensors that identify vapor in the air and immediately alert staff. One high school reported a 70% decrease in bathroom vaping incidents after installation. The <span class="keyword">policy</span> showed real results in protecting student lung health where it was implemented. However, each detector costs approximately $1,000, and schools need multiple units. Districts faced a <span class="keyword">disparity</span> in who could afford this protection‚Äîwealthy schools could buy detectors while underfunded schools could not. The meter reaches only YELLOW because protection is uneven: effective where installed, but many students remain unprotected.`
                }
            },
            {
                id: 2,
                name: "Highway Filters",
                emoji: "üõ£Ô∏è",
                whatChanged: "Community demands air filters",
                systemResponse: "City refused‚Äîtoo expensive",
                towardOK: "No",
                meterPosition: 15,
                protection: "none",
                sceneTitle: "School Near Highway ‚Äî No Protection",
                readings: {
                    low: `A highway was built 200 feet from an elementary school decades ago. Kids at that school had more asthma attacks than kids at other schools. Parents became <span class="keyword">advocates</span> and demanded air filters. The city said filters were too expensive, so the <span class="keyword">disparity</span> continued.`,
                    medium: `Decades ago, a highway was built just 200 feet from an elementary school in a low-income neighborhood. Particulate matter from car exhaust floated into classrooms every day. Students at that school had significantly more asthma attacks and missed more school than kids in cleaner areas. Parents organized and became <span class="keyword">advocates</span>, demanding the city install air filters. City officials said the <span class="keyword">regulation</span> would cost too much money. The <span class="keyword">disparity</span> between this school and wealthier schools with clean air remained unchanged.`,
                    high: `When highways were built in the 1960s, they often cut through low-income neighborhoods and near schools that had less political power to resist. One elementary school ended up just 200 feet from a major highway, exposing students to particulate matter from thousands of cars daily. Research showed these students had 30% more asthma attacks than students at schools with clean air. Parents organized and became <span class="keyword">advocates</span>, presenting data to city council and demanding air filtration systems. City officials acknowledged the problem but claimed <span class="keyword">regulations</span> requiring filters would cost millions the city didn't have. Meanwhile, wealthier neighborhoods had schools far from highways with naturally cleaner air. This <span class="keyword">disparity</span> meant that a child's lung health depended largely on their zip code. The <span class="keyword">policy</span> debate continues: should cities be required to protect all schools equally?`
                }
            },
            {
                id: 3,
                name: "Flavor Ban",
                emoji: "üç¨",
                whatChanged: "FDA banned flavored vapes",
                systemResponse: "Teen vaping: 20% ‚Üí 6%",
                towardOK: "Yes",
                meterPosition: 85,
                protection: "strong",
                sceneTitle: "FDA Flavored Vape Ban ‚Äî Big Success!",
                readings: {
                    low: `In 2019, about 20% of high schoolers vaped regularly. Many were attracted by sweet flavors like mango and mint. The FDA created a <span class="keyword">policy</span> banning most flavored vapes. By 2024, teen vaping dropped to about 6%.`,
                    medium: `Teen vaping reached crisis levels in 2019, with about 20% of high schoolers using e-cigarettes regularly. Sweet flavors like mango, mint, and fruit punch were the main trigger attracting young users. Health <span class="keyword">advocates</span> pushed the FDA to take action against flavored products. The FDA responded with <span class="keyword">regulations</span> banning most flavored vape cartridges in 2020. The <span class="keyword">policy</span> showed dramatic results‚Äîby 2024, teen vaping had dropped to approximately 6%. Critics argued adults should still have flavor choices, but the data showed the ban protected youth lung health.`,
                    high: `By 2019, teen vaping had become an epidemic, with approximately 20% of high school students reporting regular e-cigarette use. Research showed that sweet flavors like mango, mint, and cotton candy were the primary trigger attracting young users who might never have tried tobacco products. Health organizations and parent groups became powerful <span class="keyword">advocates</span>, demanding federal action to protect children. The FDA responded by implementing <span class="keyword">regulations</span> that banned most flavored vape cartridges from the market in early 2020. The <span class="keyword">policy</span> produced dramatic results that surprised even supporters‚Äîby 2024, teen vaping rates had plummeted to approximately 6%. Some adults argued this <span class="keyword">regulation</span> unfairly limited their choices, creating a debate about whose rights matter more. However, the data clearly showed that removing the flavor trigger significantly reduced chronic lung damage in young people. This case became an example of how targeted <span class="keyword">policy</span> can produce measurable health improvements.`
                }
            },
            {
                id: 4,
                name: "HEPA Filters",
                emoji: "üè´",
                whatChanged: "Schools installed HEPA filters",
                systemResponse: "Fewer sick days, less asthma",
                towardOK: "Yes",
                meterPosition: 80,
                protection: "strong",
                sceneTitle: "HEPA Air Filters Clean the Classroom",
                readings: {
                    low: `During COVID, people learned that indoor air quality matters for health. Some schools installed HEPA filters that remove particulate matter from the air. Students in those schools had fewer sick days. But filters cost money to buy and maintain, so not all schools got them.`,
                    medium: `The COVID pandemic taught everyone that indoor air quality affects health more than most people realized. Schools that installed HEPA filters could remove viruses, particulate matter, and asthma triggers from classroom air. Districts that invested in filtration saw students with fewer sick days and fewer asthma attacks. The <span class="keyword">policy</span> of requiring air filtration clearly worked for lung health. However, HEPA systems cost money to purchase and require ongoing maintenance costs. This created a <span class="keyword">disparity</span>‚Äîwealthy districts could afford protection while underfunded schools could not.`,
                    high: `Before COVID, most people rarely thought about the quality of air inside school buildings. The pandemic changed that‚Äîsuddenly everyone understood that indoor air could carry harmful particles that affect health. Schools that installed HEPA filtration systems could remove not just viruses but also particulate matter, mold spores, and common asthma triggers from classroom air. Research showed that students in filtered schools had significantly fewer sick days and reduced chronic respiratory symptoms. The <span class="keyword">policy</span> of investing in air quality produced measurable health benefits that extended beyond pandemic protection. However, HEPA systems require substantial upfront costs plus ongoing maintenance and filter replacement. This financial barrier created a <span class="keyword">disparity</span> between well-funded suburban districts and underfunded urban schools. <span class="keyword">Advocates</span> now push for <span class="keyword">regulations</span> requiring minimum air quality standards in all public schools, arguing that clean air shouldn't depend on a district's tax base.`
                }
            },
            {
                id: 5,
                name: "Inhaler Laws",
                emoji: "üí®",
                whatChanged: "States let kids carry inhalers",
                systemResponse: "Faster access to medicine",
                towardOK: "Yes",
                meterPosition: 75,
                protection: "strong",
                sceneTitle: "Kids Can Now Carry Their Inhalers",
                readings: {
                    low: `A student had an asthma attack at school but her inhaler was locked in the nurse's office. The nurse wasn't there, so staff called 911 instead. After incidents like this, some states passed laws letting kids carry their own inhalers. The new <span class="keyword">policy</span> helped kids get medicine faster.`,
                    medium: `Schools traditionally required all medications to be stored in the nurse's office for safety reasons. But this <span class="keyword">policy</span> created dangerous situations for students with chronic asthma who needed immediate access to inhalers. In several cases, students had severe attacks when nurses weren't available, and staff couldn't legally give them their own medication. These emergencies led <span class="keyword">advocates</span> to push for change at the state level. Many states now have <span class="keyword">regulations</span> allowing students to carry and self-administer rescue inhalers. The updated <span class="keyword">policy</span> recognizes that quick access to medication can prevent life-threatening situations.`,
                    high: `For decades, school <span class="keyword">policies</span> required all student medications to be locked in the nurse's office, even rescue inhalers for asthma. While this rule aimed to prevent medication misuse, it created dangerous situations for students with chronic respiratory conditions. Multiple cases made national news where students had severe asthma attacks and school staff couldn't legally give them their own medication because the nurse was unavailable. Some of these delays resulted in hospitalizations that could have been prevented with immediate inhaler access. Parent <span class="keyword">advocates</span> and medical organizations pressured state legislators to change the rules. Today, most states have <span class="keyword">regulations</span> explicitly allowing students to carry and self-administer their rescue inhalers at school. Schools still require doctor documentation and parent permission, but the <span class="keyword">policy</span> shift prioritizes student safety over liability concerns. This change shows how <span class="keyword">advocacy</span> can transform <span class="keyword">policies</span> that unintentionally harm the people they're meant to protect.`
                }
            },
            {
                id: 6,
                name: "Factory Limits",
                emoji: "üè≠",
                whatChanged: "EPA set stricter emission rules",
                systemResponse: "Air quality slowly improved",
                towardOK: "Yes",
                meterPosition: 50,
                protection: "partial",
                sceneTitle: "Factory Emissions Get Regulated",
                readings: {
                    low: `A factory near a neighborhood released smoke containing particulate matter for 40 years. Kids living nearby had 30% worse lung function than kids in clean-air areas. The EPA set stricter <span class="keyword">regulations</span> on factory emissions. After the rules changed, air quality slowly improved.`,
                    medium: `For 40 years, a coal plant operated near a residential neighborhood, releasing smoke filled with particulate matter. Studies showed children living within a mile of the plant had approximately 30% lower lung function than children in areas with clean air. Community members organized and became <span class="keyword">advocates</span>, documenting health problems and demanding change. The EPA responded by setting stricter <span class="keyword">regulations</span> on emissions, forcing the plant to install filters or shut down. After the new <span class="keyword">policy</span> took effect, air quality measurements showed gradual improvement. However, researchers noted that some lung damage in children who grew up breathing polluted air may be permanent.`,
                    high: `Industrial facilities were often built near low-income neighborhoods where residents had less political power to resist‚Äîa pattern that created lasting <span class="keyword">disparities</span> in lung health. One coal plant operated for 40 years just blocks from homes and schools, releasing smoke containing particulate matter and other pollutants. Long-term studies revealed that children who grew up within a mile of the plant had approximately 30% lower lung function than children in clean-air communities. These weren't temporary problems‚Äîthe chronic exposure caused permanent damage to developing lungs. Community <span class="keyword">advocates</span> spent years documenting health impacts, testifying at hearings, and pressuring officials to act. Eventually, the EPA implemented stricter <span class="keyword">regulations</span> that required the plant to either install expensive filtration systems or cease operations. The plant ultimately closed, and air quality measurements showed gradual improvement over the following years. This case illustrates both the power of <span class="keyword">advocacy</span> and the tragic reality that <span class="keyword">policy</span> change often comes too late for those already harmed.`
                }
            },
            {
                id: 7,
                name: "Housing Checks",
                emoji: "üè†",
                whatChanged: "City requires rental inspections",
                systemResponse: "Some improvement, debate continues",
                towardOK: "Yes",
                meterPosition: 45,
                protection: "partial",
                sceneTitle: "Housing Inspections for Health Hazards",
                readings: {
                    low: `Many apartment buildings have mold, mice, and poor ventilation that trigger asthma. In some housing projects, 40% of kids have asthma‚Äîfour times the normal rate. Some cities created <span class="keyword">policies</span> requiring health inspections for rentals. Landlords complained inspections would raise rent costs.`,
                    medium: `Poor housing conditions are one of the biggest asthma triggers for children in urban areas. Mold, cockroaches, mice, and poor ventilation all irritate airways and cause chronic breathing problems. In some housing projects, studies found that 40% of children had asthma‚Äîapproximately four times the national average. Health <span class="keyword">advocates</span> pushed cities to require regular inspections of rental properties for health hazards. Some cities implemented these <span class="keyword">policies</span>, but landlords argued that inspection requirements would increase their costs and raise rents. The debate continues about whether <span class="keyword">regulations</span> protecting tenant health are worth potential impacts on housing costs.`,
                    high: `Housing quality is one of the most significant‚Äîand least discussed‚Äîfactors in childhood respiratory health. Common problems in older apartment buildings include mold growth, cockroach and mouse allergens, poor ventilation, and dust accumulation, all of which trigger asthma attacks. Research in urban housing projects found that approximately 40% of children living there had asthma, compared to roughly 10% nationally‚Äîa <span class="keyword">disparity</span> directly linked to housing conditions. Health <span class="keyword">advocates</span> have long pushed for <span class="keyword">policies</span> requiring regular inspections of rental properties for health hazards. Cities that implemented inspection programs saw improvements in housing conditions and reductions in childhood asthma rates. However, landlords argue that inspection requirements increase their costs, which they pass on to tenants through higher rents. This creates a difficult <span class="keyword">policy</span> tradeoff between protecting health and maintaining affordable housing. The debate highlights how chronic health problems often require systemic solutions that balance competing interests.`
                }
            },
            {
                id: 8,
                name: "Who Decides?",
                emoji: "‚öñÔ∏è",
                whatChanged: "Debate: personal vs system responsibility",
                systemResponse: "Debate ongoing, no single answer",
                towardOK: "Debate",
                meterPosition: -1,
                protection: "debate",
                sceneTitle: "The Big Question: Who's Responsible?",
                readings: {
                    low: `Some people say lung health is a personal choice‚Äîdon't smoke, don't vape, exercise more. But kids can't choose what neighborhood they live in or what school they attend. This debate asks: where does personal responsibility end and system responsibility begin? The system response so far: debate ongoing, no single <span class="keyword">policy</span> answer yet.`,
                    medium: `A major debate in health <span class="keyword">policy</span> is about responsibility‚Äîwho should be accountable for protecting lung health? Some argue it's personal responsibility: individuals should choose not to vape, avoid polluted areas, and maintain their health. Others point out that children can't choose their zip code, their school, or whether a factory operates nearby. Kids in low-income neighborhoods face <span class="keyword">disparities</span> in air quality they didn't create and can't escape. <span class="keyword">Advocates</span> argue that when individuals can't protect themselves, systems and governments must step in. The system response so far: debate ongoing, no single <span class="keyword">policy</span> answer yet.`,
                    high: `At the heart of every lung health <span class="keyword">policy</span> lies a fundamental question: who bears responsibility for protecting respiratory health? One perspective emphasizes personal responsibility‚Äîindividuals should make choices to protect themselves, like refusing to vape, exercising regularly, and avoiding known triggers. This view argues that government <span class="keyword">regulations</span> should be limited and people should manage their own health. The opposing perspective points out that personal choice has clear limits, especially for children. A child cannot choose their neighborhood, their school's proximity to highways, whether their apartment has mold, or the air quality in their city. These factors create <span class="keyword">disparities</span> where some children face lasting respiratory damage through no fault of their own. <span class="keyword">Advocates</span> for systemic solutions argue that when individuals‚Äîespecially children‚Äîcannot protect themselves, society has an obligation to create protective <span class="keyword">policies</span>. The system response so far: debate ongoing, no single <span class="keyword">policy</span> answer‚Äîthis core disagreement shapes every <span class="keyword">regulation</span> we consider.`
                }
            }
        ];

        // SVG Scene generators for each scenario
        function generateSceneSVG(scenarioId) {
            switch(scenarioId) {
                case 1: return generateVapeDetectorScene();
                case 2: return generateHighwayScene();
                case 3: return generateFlavorBanScene();
                case 4: return generateHEPAScene();
                case 5: return generateInhalerScene();
                case 6: return generateFactoryScene();
                case 7: return generateHousingScene();
                case 8: return generateDebateScene();
                default: return '';
            }
        }

        function generateVapeDetectorScene() {
            return `
            <svg class="scene-svg" viewBox="0 0 400 280">
                <!-- Background: Bathroom -->
                <rect x="0" y="0" width="400" height="280" fill="#2c3e50"/>
                <rect x="20" y="40" width="360" height="200" fill="#34495e" rx="10"/>
                
                <!-- Bathroom tiles -->
                <pattern id="tiles" patternUnits="userSpaceOnUse" width="30" height="30">
                    <rect width="30" height="30" fill="#3498db" opacity="0.3"/>
                    <rect width="29" height="29" fill="#2c3e50"/>
                </pattern>
                <rect x="20" y="40" width="360" height="200" fill="url(#tiles)" rx="10"/>
                
                <!-- Vape Detector on ceiling -->
                <g id="vapeDetector">
                    <circle cx="200" cy="60" r="25" fill="#ecf0f1"/>
                    <circle cx="200" cy="60" r="18" fill="#bdc3c7"/>
                    <circle cx="200" cy="60" r="8" fill="#e74c3c" class="animate-pulse" id="detectorLight"/>
                    <text x="200" y="95" text-anchor="middle" fill="#fff" font-size="10" font-weight="bold">DETECTOR</text>
                </g>
                
                <!-- Before: Vape cloud (fades out) -->
                <g id="vapeCloud" style="animation: fadeOut 2s ease forwards 1s;">
                    <ellipse cx="150" cy="150" rx="40" ry="25" fill="#95a5a6" opacity="0.6"/>
                    <ellipse cx="170" cy="140" rx="30" ry="20" fill="#bdc3c7" opacity="0.5"/>
                    <ellipse cx="130" cy="160" rx="25" ry="15" fill="#7f8c8d" opacity="0.4"/>
                </g>
                
                <!-- Student silhouette -->
                <g id="student" transform="translate(140, 120)">
                    <circle cx="30" cy="20" r="18" fill="#5d6d7e"/>
                    <rect x="15" y="38" width="30" height="50" fill="#5d6d7e" rx="5"/>
                </g>
                
                <!-- Alert notification -->
                <g id="alertBubble" style="animation: fadeInUp 0.5s ease forwards 1.5s; opacity: 0;">
                    <rect x="250" y="100" width="120" height="50" fill="#e74c3c" rx="10"/>
                    <polygon points="250,125 235,135 250,140" fill="#e74c3c"/>
                    <text x="310" y="120" text-anchor="middle" fill="#fff" font-size="11" font-weight="bold">üö® ALERT!</text>
                    <text x="310" y="138" text-anchor="middle" fill="#fff" font-size="9">Vapor Detected</text>
                </g>
                
                <!-- Stats box -->
                <g transform="translate(20, 250)">
                    <rect x="0" y="0" width="170" height="25" fill="#27ae60" rx="5"/>
                    <text x="85" y="17" text-anchor="middle" fill="#fff" font-size="11" font-weight="bold">üìâ Vaping Down 70%!</text>
                </g>
                
                <!-- Cost warning -->
                <g transform="translate(210, 250)">
                    <rect x="0" y="0" width="170" height="25" fill="#f39c12" rx="5"/>
                    <text x="85" y="17" text-anchor="middle" fill="#fff" font-size="11" font-weight="bold">‚ö†Ô∏è $1,000 per detector</text>
                </g>
                
                <style>
                    @keyframes fadeOut {
                        to { opacity: 0; }
                    }
                </style>
            </svg>`;
        }

        function generateHighwayScene() {
            return `
            <svg class="scene-svg" viewBox="0 0 400 280">
                <!-- Sky (polluted) -->
                <rect x="0" y="0" width="400" height="140" fill="#7f8c8d"/>
                
                <!-- Ground -->
                <rect x="0" y="140" width="400" height="140" fill="#27ae60" opacity="0.6"/>
                
                <!-- Highway -->
                <rect x="0" y="100" width="180" height="60" fill="#2c3e50"/>
                <line x1="0" y1="130" x2="180" y2="130" stroke="#f1c40f" stroke-width="3" stroke-dasharray="20,10"/>
                
                <!-- Cars on highway -->
                <g id="cars">
                    <rect x="20" y="108" width="40" height="20" fill="#e74c3c" rx="5"/>
                    <rect x="80" y="135" width="40" height="20" fill="#3498db" rx="5"/>
                    <rect x="130" y="108" width="40" height="20" fill="#9b59b6" rx="5"/>
                </g>
                
                <!-- Exhaust clouds -->
                <g id="exhaust" style="animation: smoke-rise 2s ease-in-out infinite;">
                    <circle cx="60" cy="105" r="8" fill="#95a5a6" opacity="0.7"/>
                    <circle cx="120" cy="105" r="10" fill="#7f8c8d" opacity="0.6"/>
                    <circle cx="170" cy="105" r="7" fill="#95a5a6" opacity="0.5"/>
                </g>
                
                <!-- School building (close to highway!) -->
                <g transform="translate(220, 80)">
                    <rect x="0" y="40" width="150" height="100" fill="#e74c3c"/>
                    <rect x="10" y="50" width="30" height="25" fill="#85c1e9"/>
                    <rect x="50" y="50" width="30" height="25" fill="#85c1e9"/>
                    <rect x="90" y="50" width="30" height="25" fill="#85c1e9"/>
                    <rect x="10" y="85" width="30" height="25" fill="#85c1e9"/>
                    <rect x="50" y="85" width="30" height="25" fill="#85c1e9"/>
                    <rect x="90" y="85" width="30" height="25" fill="#85c1e9"/>
                    <rect x="60" y="110" width="25" height="30" fill="#8b4513"/>
                    <polygon points="0,40 75,10 150,40" fill="#c0392b"/>
                    <text x="75" y="30" text-anchor="middle" fill="#fff" font-size="10" font-weight="bold">SCHOOL</text>
                </g>
                
                <!-- Distance marker -->
                <g transform="translate(180, 160)">
                    <line x1="0" y1="0" x2="40" y2="0" stroke="#fff" stroke-width="2"/>
                    <line x1="0" y1="-5" x2="0" y2="5" stroke="#fff" stroke-width="2"/>
                    <line x1="40" y1="-5" x2="40" y2="5" stroke="#fff" stroke-width="2"/>
                    <text x="20" y="15" text-anchor="middle" fill="#fff" font-size="9">200 ft!</text>
                </g>
                
                <!-- Sick kid icon -->
                <g transform="translate(280, 190)">
                    <circle cx="20" cy="15" r="12" fill="#f5b041"/>
                    <text x="20" y="20" text-anchor="middle" font-size="14">üò∑</text>
                    <text x="20" y="45" text-anchor="middle" fill="#fff" font-size="8">30% more</text>
                    <text x="20" y="55" text-anchor="middle" fill="#fff" font-size="8">asthma</text>
                </g>
                
                <!-- Red X for no protection -->
                <g transform="translate(30, 200)">
                    <circle cx="25" cy="25" r="25" fill="#c0392b"/>
                    <text x="25" y="33" text-anchor="middle" fill="#fff" font-size="24" font-weight="bold">‚úó</text>
                    <text x="25" y="65" text-anchor="middle" fill="#fff" font-size="9" font-weight="bold">NO FILTERS</text>
                    <text x="25" y="77" text-anchor="middle" fill="#fff" font-size="8">"Too expensive"</text>
                </g>
            </svg>`;
        }

        function generateFlavorBanScene() {
            return `
            <svg class="scene-svg" viewBox="0 0 400 280">
                <!-- Background -->
                <rect x="0" y="0" width="400" height="280" fill="#1a5276"/>
                
                <!-- Title -->
                <text x="200" y="30" text-anchor="middle" fill="#fff" font-size="14" font-weight="bold">FDA FLAVOR BAN RESULTS</text>
                
                <!-- Before section -->
                <g transform="translate(30, 50)">
                    <text x="70" y="15" text-anchor="middle" fill="#e74c3c" font-size="12" font-weight="bold">BEFORE (2019)</text>
                    
                    <!-- Flavored vapes -->
                    <g transform="translate(20, 25)">
                        <rect x="0" y="0" width="25" height="60" fill="#e91e63" rx="5"/>
                        <text x="12" y="75" text-anchor="middle" fill="#fff" font-size="8">üçì</text>
                        
                        <rect x="35" y="0" width="25" height="60" fill="#9c27b0" rx="5"/>
                        <text x="47" y="75" text-anchor="middle" fill="#fff" font-size="8">üçá</text>
                        
                        <rect x="70" y="0" width="25" height="60" fill="#4caf50" rx="5"/>
                        <text x="82" y="75" text-anchor="middle" fill="#fff" font-size="8">üçÉ</text>
                    </g>
                    
                    <!-- 20% stat -->
                    <g transform="translate(20, 110)">
                        <circle cx="50" cy="40" r="35" fill="#e74c3c"/>
                        <text x="50" y="35" text-anchor="middle" fill="#fff" font-size="20" font-weight="bold">20%</text>
                        <text x="50" y="50" text-anchor="middle" fill="#fff" font-size="9">of teens</text>
                        <text x="50" y="62" text-anchor="middle" fill="#fff" font-size="9">vaping</text>
                    </g>
                </g>
                
                <!-- Arrow -->
                <g transform="translate(170, 120)">
                    <rect x="0" y="20" width="60" height="30" fill="#f39c12" rx="5"/>
                    <text x="30" y="40" text-anchor="middle" fill="#fff" font-size="16">‚Üí</text>
                    <text x="30" y="70" text-anchor="middle" fill="#fff" font-size="9" font-weight="bold">BAN!</text>
                </g>
                
                <!-- After section -->
                <g transform="translate(250, 50)">
                    <text x="70" y="15" text-anchor="middle" fill="#27ae60" font-size="12" font-weight="bold">AFTER (2024)</text>
                    
                    <!-- Banned vapes with X -->
                    <g transform="translate(20, 25)" opacity="0.4">
                        <rect x="0" y="0" width="25" height="60" fill="#666" rx="5"/>
                        <rect x="35" y="0" width="25" height="60" fill="#666" rx="5"/>
                        <rect x="70" y="0" width="25" height="60" fill="#666" rx="5"/>
                        <text x="50" y="40" text-anchor="middle" fill="#e74c3c" font-size="40" font-weight="bold">üö´</text>
                    </g>
                    
                    <!-- 6% stat -->
                    <g transform="translate(20, 110)">
                        <circle cx="50" cy="40" r="35" fill="#27ae60"/>
                        <text x="50" y="35" text-anchor="middle" fill="#fff" font-size="20" font-weight="bold">6%</text>
                        <text x="50" y="50" text-anchor="middle" fill="#fff" font-size="9">of teens</text>
                        <text x="50" y="62" text-anchor="middle" fill="#fff" font-size="9">vaping</text>
                    </g>
                </g>
                
                <!-- Success message -->
                <g transform="translate(100, 230)">
                    <rect x="0" y="0" width="200" height="40" fill="#27ae60" rx="10"/>
                    <text x="100" y="17" text-anchor="middle" fill="#fff" font-size="11" font-weight="bold">‚úì STRONG PROTECTION</text>
                    <text x="100" y="32" text-anchor="middle" fill="#fff" font-size="10">Policy worked! Teen lungs safer!</text>
                </g>
            </svg>`;
        }

        function generateHEPAScene() {
            return `
            <svg class="scene-svg" viewBox="0 0 400 280">
                <!-- Classroom background -->
                <rect x="0" y="0" width="400" height="280" fill="#2c3e50"/>
                <rect x="20" y="30" width="360" height="200" fill="#34495e" rx="10"/>
                
                <!-- Whiteboard -->
                <rect x="120" y="40" width="160" height="80" fill="#ecf0f1" rx="5"/>
                <text x="200" y="85" text-anchor="middle" fill="#2c3e50" font-size="12" font-weight="bold">SCIENCE CLASS</text>
                
                <!-- HEPA Filter unit -->
                <g transform="translate(300, 50)">
                    <rect x="0" y="0" width="60" height="100" fill="#3498db" rx="8"/>
                    <rect x="5" y="10" width="50" height="30" fill="#85c1e9"/>
                    <text x="30" y="60" text-anchor="middle" fill="#fff" font-size="8" font-weight="bold">HEPA</text>
                    <text x="30" y="72" text-anchor="middle" fill="#fff" font-size="8" font-weight="bold">FILTER</text>
                    
                    <!-- Air flow arrows -->
                    <g style="animation: float 1s ease-in-out infinite;">
                        <text x="30" y="95" text-anchor="middle" fill="#2ecc71" font-size="14">‚Üë‚Üë‚Üë</text>
                    </g>
                </g>
                
                <!-- Dirty air particles (left side) -->
                <g id="dirtyAir" transform="translate(40, 80)">
                    <circle cx="10" cy="10" r="4" fill="#e74c3c" opacity="0.7"/>
                    <circle cx="25" cy="20" r="3" fill="#f39c12" opacity="0.6"/>
                    <circle cx="15" cy="35" r="5" fill="#e74c3c" opacity="0.5"/>
                    <circle cx="35" cy="15" r="3" fill="#95a5a6" opacity="0.6"/>
                    <text x="25" y="60" text-anchor="middle" fill="#e74c3c" font-size="8">Dirty Air</text>
                </g>
                
                <!-- Clean air (right side) -->
                <g transform="translate(300, 160)">
                    <circle cx="30" cy="10" r="6" fill="#2ecc71" opacity="0.5"/>
                    <circle cx="45" cy="25" r="5" fill="#2ecc71" opacity="0.4"/>
                    <circle cx="20" cy="30" r="4" fill="#2ecc71" opacity="0.6"/>
                    <text x="30" y="55" text-anchor="middle" fill="#2ecc71" font-size="8">Clean Air!</text>
                </g>
                
                <!-- Students (happy) -->
                <g transform="translate(80, 140)">
                    <circle cx="20" cy="15" r="15" fill="#f5b041"/>
                    <text x="20" y="20" text-anchor="middle" font-size="16">üòä</text>
                    <rect x="10" y="30" width="20" height="30" fill="#3498db" rx="3"/>
                </g>
                
                <g transform="translate(140, 140)">
                    <circle cx="20" cy="15" r="15" fill="#f5b041"/>
                    <text x="20" y="20" text-anchor="middle" font-size="16">üòÄ</text>
                    <rect x="10" y="30" width="20" height="30" fill="#e74c3c" rx="3"/>
                </g>
                
                <g transform="translate(200, 140)">
                    <circle cx="20" cy="15" r="15" fill="#f5b041"/>
                    <text x="20" y="20" text-anchor="middle" font-size="16">üôÇ</text>
                    <rect x="10" y="30" width="20" height="30" fill="#27ae60" rx="3"/>
                </g>
                
                <!-- Results -->
                <g transform="translate(20, 240)">
                    <rect x="0" y="0" width="175" height="30" fill="#27ae60" rx="5"/>
                    <text x="87" y="20" text-anchor="middle" fill="#fff" font-size="10" font-weight="bold">‚úì Fewer sick days!</text>
                </g>
                
                <g transform="translate(205, 240)">
                    <rect x="0" y="0" width="175" height="30" fill="#f39c12" rx="5"/>
                    <text x="87" y="20" text-anchor="middle" fill="#fff" font-size="10" font-weight="bold">‚ö†Ô∏è Not all schools can afford</text>
                </g>
            </svg>`;
        }

        function generateInhalerScene() {
            return `
            <svg class="scene-svg" viewBox="0 0 400 280">
                <!-- Background -->
                <rect x="0" y="0" width="400" height="280" fill="#1a5276"/>
                
                <!-- Before/After split -->
                <line x1="200" y1="40" x2="200" y2="240" stroke="#fff" stroke-width="2" stroke-dasharray="5,5"/>
                
                <!-- BEFORE section -->
                <g transform="translate(10, 30)">
                    <text x="90" y="20" text-anchor="middle" fill="#e74c3c" font-size="14" font-weight="bold">‚ùå BEFORE</text>
                    
                    <!-- Locked cabinet -->
                    <g transform="translate(40, 40)">
                        <rect x="0" y="0" width="100" height="80" fill="#7f8c8d" rx="5"/>
                        <rect x="10" y="10" width="80" height="60" fill="#95a5a6" rx="3"/>
                        <circle cx="80" cy="40" r="8" fill="#f1c40f"/>
                        <text x="50" y="45" text-anchor="middle" fill="#2c3e50" font-size="10" font-weight="bold">üîí</text>
                        <text x="50" y="90" text-anchor="middle" fill="#fff" font-size="9">Nurse's Office</text>
                    </g>
                    
                    <!-- Distressed student -->
                    <g transform="translate(50, 140)">
                        <circle cx="40" cy="20" r="20" fill="#f5b041"/>
                        <text x="40" y="27" text-anchor="middle" font-size="20">üò∞</text>
                        <rect x="25" y="40" width="30" height="40" fill="#e74c3c" rx="3"/>
                        <text x="40" y="100" text-anchor="middle" fill="#fff" font-size="9">Can't breathe!</text>
                        <text x="40" y="112" text-anchor="middle" fill="#fff" font-size="8">Nurse not here!</text>
                    </g>
                </g>
                
                <!-- AFTER section -->
                <g transform="translate(210, 30)">
                    <text x="90" y="20" text-anchor="middle" fill="#27ae60" font-size="14" font-weight="bold">‚úì AFTER</text>
                    
                    <!-- Student with inhaler -->
                    <g transform="translate(40, 50)">
                        <circle cx="50" cy="30" r="25" fill="#f5b041"/>
                        <text x="50" y="38" text-anchor="middle" font-size="24">üòä</text>
                        <rect x="35" y="55" width="30" height="45" fill="#3498db" rx="3"/>
                        
                        <!-- Inhaler in hand -->
                        <g transform="translate(75, 70)">
                            <rect x="0" y="0" width="15" height="35" fill="#9b59b6" rx="3"/>
                            <rect x="2" y="5" width="11" height="10" fill="#8e44ad" rx="2"/>
                            <ellipse cx="7" cy="0" rx="8" ry="5" fill="#9b59b6"/>
                        </g>
                        
                        <text x="50" y="120" text-anchor="middle" fill="#fff" font-size="9" font-weight="bold">I have my inhaler!</text>
                    </g>
                    
                    <!-- Checkmark badge -->
                    <g transform="translate(40, 160)">
                        <circle cx="50" cy="30" r="25" fill="#27ae60"/>
                        <text x="50" y="38" text-anchor="middle" fill="#fff" font-size="24">‚úì</text>
                        <text x="50" y="70" text-anchor="middle" fill="#fff" font-size="9">Fast access</text>
                        <text x="50" y="82" text-anchor="middle" fill="#fff" font-size="9">= safer kids!</text>
                    </g>
                </g>
                
                <!-- Policy change banner -->
                <g transform="translate(50, 245)">
                    <rect x="0" y="0" width="300" height="28" fill="#27ae60" rx="8"/>
                    <text x="150" y="19" text-anchor="middle" fill="#fff" font-size="11" font-weight="bold">üìã New Law: Kids CAN carry inhalers at school!</text>
                </g>
            </svg>`;
        }

        function generateFactoryScene() {
            return `
            <svg class="scene-svg" viewBox="0 0 400 280">
                <!-- Sky gradient (improving) -->
                <defs>
                    <linearGradient id="skyGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#7f8c8d"/>
                        <stop offset="100%" style="stop-color:#85c1e9"/>
                    </linearGradient>
                </defs>
                <rect x="0" y="0" width="400" height="150" fill="url(#skyGradient)"/>
                
                <!-- Ground -->
                <rect x="0" y="150" width="400" height="130" fill="#27ae60" opacity="0.7"/>
                
                <!-- Factory (dimming) -->
                <g transform="translate(20, 60)" opacity="0.6">
                    <rect x="0" y="50" width="120" height="90" fill="#5d6d7e"/>
                    <rect x="30" y="0" width="30" height="50" fill="#5d6d7e"/>
                    <rect x="70" y="20" width="25" height="30" fill="#5d6d7e"/>
                    
                    <!-- Smokestacks (less smoke) -->
                    <g id="smoke" style="animation: smoke-rise 3s ease-in-out infinite;" opacity="0.4">
                        <circle cx="45" cy="-10" r="10" fill="#95a5a6"/>
                        <circle cx="82" cy="10" r="8" fill="#7f8c8d"/>
                    </g>
                    
                    <text x="60" y="105" text-anchor="middle" fill="#fff" font-size="10" font-weight="bold">FACTORY</text>
                </g>
                
                <!-- EPA Regulation sign -->
                <g transform="translate(150, 80)">
                    <rect x="0" y="0" width="100" height="60" fill="#2980b9" rx="5"/>
                    <text x="50" y="20" text-anchor="middle" fill="#fff" font-size="10" font-weight="bold">EPA</text>
                    <text x="50" y="35" text-anchor="middle" fill="#fff" font-size="8">REGULATION</text>
                    <text x="50" y="50" text-anchor="middle" fill="#fff" font-size="16">üìã</text>
                </g>
                
                <!-- Houses/neighborhood -->
                <g transform="translate(270, 100)">
                    <rect x="0" y="30" width="50" height="40" fill="#e74c3c"/>
                    <polygon points="0,30 25,10 50,30" fill="#c0392b"/>
                    <rect x="18" y="45" width="15" height="25" fill="#8b4513"/>
                    
                    <rect x="60" y="35" width="45" height="35" fill="#3498db"/>
                    <polygon points="60,35 82,18 105,35" fill="#2980b9"/>
                    <rect x="75" y="48" width="12" height="22" fill="#8b4513"/>
                </g>
                
                <!-- Air quality improving arrow -->
                <g transform="translate(160, 160)">
                    <rect x="0" y="0" width="80" height="35" fill="#f39c12" rx="5"/>
                    <text x="40" y="15" text-anchor="middle" fill="#fff" font-size="9" font-weight="bold">Air Quality</text>
                    <text x="40" y="28" text-anchor="middle" fill="#fff" font-size="12">üìà Improving</text>
                </g>
                
                <!-- Results -->
                <g transform="translate(20, 210)">
                    <rect x="0" y="0" width="170" height="55" fill="#27ae60" rx="8"/>
                    <text x="85" y="18" text-anchor="middle" fill="#fff" font-size="10" font-weight="bold">‚úì GOOD NEWS</text>
                    <text x="85" y="33" text-anchor="middle" fill="#fff" font-size="9">Stricter rules working</text>
                    <text x="85" y="47" text-anchor="middle" fill="#fff" font-size="9">Air getting cleaner</text>
                </g>
                
                <g transform="translate(210, 210)">
                    <rect x="0" y="0" width="170" height="55" fill="#e74c3c" rx="8"/>
                    <text x="85" y="18" text-anchor="middle" fill="#fff" font-size="10" font-weight="bold">‚ö†Ô∏è BAD NEWS</text>
                    <text x="85" y="33" text-anchor="middle" fill="#fff" font-size="9">40 years of damage</text>
                    <text x="85" y="47" text-anchor="middle" fill="#fff" font-size="9">Some harm permanent</text>
                </g>
            </svg>`;
        }

        function generateHousingScene() {
            return `
            <svg class="scene-svg" viewBox="0 0 400 280">
                <!-- Background -->
                <rect x="0" y="0" width="400" height="280" fill="#34495e"/>
                
                <!-- Apartment building -->
                <g transform="translate(50, 30)">
                    <rect x="0" y="30" width="140" height="180" fill="#7f8c8d"/>
                    
                    <!-- Windows with problems -->
                    <g transform="translate(15, 45)">
                        <!-- Window 1: Mold -->
                        <rect x="0" y="0" width="35" height="30" fill="#5d6d7e"/>
                        <circle cx="8" cy="8" r="5" fill="#27ae60" opacity="0.7"/>
                        <circle cx="20" cy="15" r="4" fill="#2ecc71" opacity="0.6"/>
                        <text x="17" y="45" text-anchor="middle" fill="#fff" font-size="7">ü¶† Mold</text>
                        
                        <!-- Window 2: Mouse -->
                        <rect x="50" y="0" width="35" height="30" fill="#5d6d7e"/>
                        <text x="67" y="22" text-anchor="middle" font-size="14">üê≠</text>
                        <text x="67" y="45" text-anchor="middle" fill="#fff" font-size="7">Mice</text>
                        
                        <!-- Window 3: Poor ventilation -->
                        <rect x="0" y="60" width="35" height="30" fill="#5d6d7e"/>
                        <text x="17" y="80" text-anchor="middle" fill="#95a5a6" font-size="10">üí®</text>
                        <text x="17" y="105" text-anchor="middle" fill="#fff" font-size="7">Bad Air</text>
                        
                        <!-- Window 4: Cockroach -->
                        <rect x="50" y="60" width="35" height="30" fill="#5d6d7e"/>
                        <text x="67" y="82" text-anchor="middle" font-size="14">ü™≥</text>
                        <text x="67" y="105" text-anchor="middle" fill="#fff" font-size="7">Bugs</text>
                    </g>
                    
                    <text x="70" y="25" text-anchor="middle" fill="#fff" font-size="10" font-weight="bold">APARTMENT</text>
                </g>
                
                <!-- Inspection clipboard -->
                <g transform="translate(220, 50)">
                    <rect x="0" y="0" width="130" height="100" fill="#f5b041" rx="5"/>
                    <rect x="45" y="-10" width="40" height="15" fill="#d68910" rx="3"/>
                    <text x="65" y="25" text-anchor="middle" fill="#2c3e50" font-size="10" font-weight="bold">INSPECTION</text>
                    
                    <g transform="translate(15, 35)">
                        <text x="0" y="12" fill="#2c3e50" font-size="9">‚òëÔ∏è Check for mold</text>
                        <text x="0" y="27" fill="#2c3e50" font-size="9">‚òëÔ∏è Check ventilation</text>
                        <text x="0" y="42" fill="#2c3e50" font-size="9">‚òëÔ∏è Check for pests</text>
                        <text x="0" y="57" fill="#2c3e50" font-size="9">‚òëÔ∏è Check air quality</text>
                    </g>
                </g>
                
                <!-- Stats -->
                <g transform="translate(220, 160)">
                    <rect x="0" y="0" width="130" height="50" fill="#e74c3c" rx="8"/>
                    <text x="65" y="20" text-anchor="middle" fill="#fff" font-size="11" font-weight="bold">40% have asthma</text>
                    <text x="65" y="38" text-anchor="middle" fill="#fff" font-size="9">(4x the normal rate!)</text>
                </g>
                
                <!-- Debate section -->
                <g transform="translate(30, 230)">
                    <rect x="0" y="0" width="160" height="40" fill="#27ae60" rx="5"/>
                    <text x="80" y="16" text-anchor="middle" fill="#fff" font-size="9" font-weight="bold">üëç HELPS:</text>
                    <text x="80" y="32" text-anchor="middle" fill="#fff" font-size="8">Finds health hazards</text>
                </g>
                
                <g transform="translate(210, 230)">
                    <rect x="0" y="0" width="160" height="40" fill="#f39c12" rx="5"/>
                    <text x="80" y="16" text-anchor="middle" fill="#fff" font-size="9" font-weight="bold">‚ö†Ô∏è CONCERN:</text>
                    <text x="80" y="32" text-anchor="middle" fill="#fff" font-size="8">May raise rent costs</text>
                </g>
            </svg>`;
        }

        function generateDebateScene() {
            return `
            <svg class="scene-svg" viewBox="0 0 400 280">
                <!-- Background -->
                <rect x="0" y="0" width="400" height="280" fill="#1a1a2e"/>
                
                <!-- Title -->
                <text x="200" y="30" text-anchor="middle" fill="#fff" font-size="16" font-weight="bold">THE BIG QUESTION</text>
                
                <!-- Balance scale -->
                <g transform="translate(200, 80)">
                    <!-- Center pole -->
                    <rect x="-5" y="0" width="10" height="120" fill="#bdc3c7"/>
                    <circle cx="0" cy="0" r="12" fill="#f1c40f"/>
                    <text x="0" y="5" text-anchor="middle" font-size="12">‚öñÔ∏è</text>
                    
                    <!-- Balance beam -->
                    <rect x="-120" y="10" width="240" height="8" fill="#95a5a6" rx="4"/>
                    
                    <!-- Left pan: Personal -->
                    <g transform="translate(-100, 25)">
                        <line x1="0" y1="0" x2="0" y2="40" stroke="#95a5a6" stroke-width="3"/>
                        <ellipse cx="0" cy="50" rx="60" ry="20" fill="#3498db"/>
                        <text x="0" y="55" text-anchor="middle" fill="#fff" font-size="9" font-weight="bold">PERSONAL</text>
                        
                        <!-- Items -->
                        <text x="-30" y="85" text-anchor="middle" font-size="16">üèÉ</text>
                        <text x="0" y="85" text-anchor="middle" font-size="16">üö≠</text>
                        <text x="30" y="85" text-anchor="middle" font-size="16">üí™</text>
                        <text x="0" y="105" text-anchor="middle" fill="#3498db" font-size="8">"Your choices"</text>
                    </g>
                    
                    <!-- Right pan: System -->
                    <g transform="translate(100, 25)">
                        <line x1="0" y1="0" x2="0" y2="40" stroke="#95a5a6" stroke-width="3"/>
                        <ellipse cx="0" cy="50" rx="60" ry="20" fill="#e74c3c"/>
                        <text x="0" y="55" text-anchor="middle" fill="#fff" font-size="9" font-weight="bold">SYSTEM</text>
                        
                        <!-- Items -->
                        <text x="-30" y="85" text-anchor="middle" font-size="16">üè≠</text>
                        <text x="0" y="85" text-anchor="middle" font-size="16">üè´</text>
                        <text x="30" y="85" text-anchor="middle" font-size="16">üè†</text>
                        <text x="0" y="105" text-anchor="middle" fill="#e74c3c" font-size="8">"Your ZIP code"</text>
                    </g>
                </g>
                
                <!-- Key question -->
                <g transform="translate(50, 210)">
                    <rect x="0" y="0" width="300" height="60" fill="#9b59b6" rx="10"/>
                    <text x="150" y="22" text-anchor="middle" fill="#fff" font-size="11" font-weight="bold">ü§î CAN KIDS CHOOSE...</text>
                    <text x="150" y="38" text-anchor="middle" fill="#fff" font-size="9">Their neighborhood? Their school?</text>
                    <text x="150" y="52" text-anchor="middle" fill="#fff" font-size="9">The air they breathe?</text>
                </g>
                
                <!-- No clear answer -->
                <g transform="translate(100, 185)">
                    <rect x="0" y="0" width="200" height="20" fill="#f39c12" rx="5"/>
                    <text x="100" y="14" text-anchor="middle" fill="#fff" font-size="10" font-weight="bold">‚öñÔ∏è DEBATE ONGOING ‚Äî No single answer!</text>
                </g>
            </svg>`;
        }

        // State
        let currentScenario = null;
        let currentStep = 0;
        let readingLevel = 'low';
        let prediction = null;
        let completedScenarios = [];
        let score = 0;
        let streak = 0;
        let correctPredictions = 0;
        let totalPredictions = 0;
        let speechSynthesis = window.speechSynthesis;
        let currentUtterance = null;

        // Initialize
        function init() {
            renderScenarioCards();
            setupLevelTabs();
            updateHUD();
            updateStepIndicator();
        }

        function renderScenarioCards() {
            const container = document.getElementById('scenarioCards');
            container.innerHTML = scenarios.map(s => `
                <div class="scenario-card ${completedScenarios.includes(s.id) ? 'completed' : ''}" 
                     data-id="${s.id}" 
                     onclick="selectScenario(${s.id})">
                    <span class="emoji">${s.emoji}</span>
                    <span class="name">${s.name}</span>
                </div>
            `).join('');
        }

        function setupLevelTabs() {
            document.querySelectorAll('.level-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.level-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    readingLevel = tab.dataset.level;
                    if (currentStep === 2 && currentScenario) {
                        renderReading();
                    }
                });
            });
        }

        function selectScenario(id) {
            if (currentStep !== 0 && currentStep !== 4) return;
            
            currentScenario = scenarios.find(s => s.id === id);
            if (!currentScenario) return;

            document.querySelectorAll('.scenario-card').forEach(card => {
                card.classList.remove('selected');
                if (parseInt(card.dataset.id) === id) {
                    card.classList.add('selected');
                }
            });

            goToPredict();
        }

        function goToPredict() {
            currentStep = 1;
            prediction = null;
            hideAllStates();
            document.getElementById('predictState').classList.remove('hidden');
            document.getElementById('predictQuestion').textContent = 
                `Will the "${currentScenario.name}" policy move lung health toward OK?`;
            updateStepIndicator();
        }

        function makePrediction(pred) {
            prediction = pred;
            goToRead();
        }

        function goToRead() {
            currentStep = 2;
            hideAllStates();
            document.getElementById('readState').classList.remove('hidden');
            renderReading();
            updateStepIndicator();
        }

        function renderReading() {
            const text = currentScenario.readings[readingLevel];
            document.getElementById('readingText').innerHTML = text;
        }

        function readAloud() {
            if (currentUtterance) {
                speechSynthesis.cancel();
                currentUtterance = null;
                return;
            }

            const textElement = document.getElementById('readingText');
            const text = textElement.textContent || textElement.innerText;
            
            currentUtterance = new SpeechSynthesisUtterance(text);
            currentUtterance.rate = 0.9;
            currentUtterance.onend = () => {
                currentUtterance = null;
            };
            
            speechSynthesis.speak(currentUtterance);
        }

        function goToWatch() {
            if (currentUtterance) {
                speechSynthesis.cancel();
                currentUtterance = null;
            }
            
            currentStep = 3;
            hideAllStates();
            document.getElementById('watchState').classList.remove('hidden');
            updateStepIndicator();

            // Set scene title
            document.getElementById('sceneTitle').textContent = currentScenario.sceneTitle;
            
            // Render scene SVG
            document.getElementById('sceneContainer').innerHTML = generateSceneSVG(currentScenario.id);
            
            // Update result summary
            document.getElementById('resultChange').innerHTML = `<strong>Changed:</strong> ${currentScenario.whatChanged}`;
            document.getElementById('resultResponse').innerHTML = `<strong>Response:</strong> ${currentScenario.systemResponse}`;
            document.getElementById('resultOK').innerHTML = `<strong>Toward OK?</strong> ${currentScenario.towardOK}`;

            // Animate meter after delay
            setTimeout(() => animateMeter(), 800);
        }

        function animateMeter() {
            const needle = document.getElementById('meterNeedle');
            const status = document.getElementById('protectionStatus');

            if (currentScenario.id === 8) {
                // Special debate scenario
                status.className = 'protection-status debate';
                status.textContent = '‚öñÔ∏è Debate Ongoing';
                if (needle) needle.style.left = '50%';
                return;
            }

            const position = currentScenario.meterPosition;
            if (needle) needle.style.left = `${position}%`;

            status.className = 'protection-status ' + currentScenario.protection;
            if (currentScenario.protection === 'none') {
                status.textContent = 'üî¥ No Protection';
            } else if (currentScenario.protection === 'partial') {
                status.textContent = 'üü° Partial Protection';
            } else {
                status.textContent = 'üü¢ Strong Protection';
            }
        }

        function goToRecord() {
            currentStep = 4;
            hideAllStates();
            document.getElementById('recordState').classList.remove('hidden');
            updateStepIndicator();

            const actualResult = currentScenario.towardOK.toLowerCase();
            const isCorrect = (prediction === 'yes' && actualResult === 'yes') || 
                             (prediction === 'no' && actualResult === 'no') ||
                             (actualResult === 'debate');
            
            totalPredictions++;
            if (isCorrect) {
                correctPredictions++;
                streak++;
                score += 100 + (streak * 10);
            } else {
                streak = 0;
                score += 50;
            }

            if (!completedScenarios.includes(currentScenario.id)) {
                completedScenarios.push(currentScenario.id);
            }

            addDataRow();
            renderScenarioCards();
            updateHUD();
            checkCompletion();
        }

        function addDataRow() {
            const tbody = document.getElementById('dataTableBody');
            const towardOK = currentScenario.towardOK;
            const okClass = towardOK.toLowerCase() === 'yes' ? 'yes' : 
                           (towardOK.toLowerCase() === 'no' ? 'no' : '');
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${currentScenario.name}</td>
                <td>${currentScenario.whatChanged.substring(0, 20)}...</td>
                <td>${currentScenario.systemResponse.substring(0, 20)}...</td>
                <td class="toward-ok ${okClass}">${towardOK}</td>
            `;
            tbody.appendChild(row);
        }

        function updateHUD() {
            document.getElementById('scoreValue').textContent = score;
            document.getElementById('streakValue').textContent = streak;
            document.getElementById('completedValue').textContent = completedScenarios.length;
            
            const accuracy = totalPredictions > 0 
                ? Math.round((correctPredictions / totalPredictions) * 100) + '%'
                : '--%';
            document.getElementById('accuracyValue').textContent = accuracy;

            const progress = Math.min((completedScenarios.length / 5) * 100, 100);
            document.getElementById('progressFill').style.width = progress + '%';
            
            document.getElementById('scenarioCount').textContent = 
                `${completedScenarios.length}/5`;

            const remaining = Math.max(5 - completedScenarios.length, 0);
            if (remaining > 0) {
                document.getElementById('progressMessage').textContent = 
                    `Pick ${remaining} more you like!`;
            } else if (completedScenarios.length < 8) {
                document.getElementById('progressMessage').textContent = 
                    `Extra credit: ${8 - completedScenarios.length} more!`;
            } else {
                document.getElementById('progressMessage').textContent = 
                    `All complete! üéâ`;
            }
        }

        function checkCompletion() {
            const badge = document.getElementById('completionBadge');
            const extraBadge = document.getElementById('extraCreditBadge');
            
            if (completedScenarios.length >= 5 && !badge.classList.contains('show')) {
                badge.classList.add('show');
                document.getElementById('recordMessage').textContent = 
                    'üèÜ Lung Defender badge earned! Continue for extra credit!';
            }
            
            if (completedScenarios.length >= 8 && !extraBadge.classList.contains('show')) {
                extraBadge.classList.add('show');
                document.getElementById('recordMessage').textContent = 
                    '‚≠ê Policy Expert! All 8 complete!';
            }
        }

        function selectNextScenario() {
            currentStep = 0;
            currentScenario = null;
            prediction = null;
            
            document.querySelectorAll('.scenario-card').forEach(c => c.classList.remove('selected'));
            
            hideAllStates();
            document.getElementById('welcomeState').classList.remove('hidden');
            updateStepIndicator();
        }

        function hideAllStates() {
            document.getElementById('welcomeState').classList.add('hidden');
            document.getElementById('predictState').classList.add('hidden');
            document.getElementById('readState').classList.add('hidden');
            document.getElementById('watchState').classList.add('hidden');
            document.getElementById('recordState').classList.add('hidden');
        }

        function updateStepIndicator() {
            document.querySelectorAll('.step-tab').forEach(tab => {
                const step = parseInt(tab.dataset.step);
                tab.classList.remove('active', 'completed');
                
                if (step === currentStep) {
                    tab.classList.add('active');
                } else if (step < currentStep) {
                    tab.classList.add('completed');
                }
            });
        }

        function resetSimulation() {
            if (confirm('Reset all progress?')) {
                currentScenario = null;
                currentStep = 0;
                prediction = null;
                completedScenarios = [];
                score = 0;
                streak = 0;
                correctPredictions = 0;
                totalPredictions = 0;
                
                document.getElementById('dataTableBody').innerHTML = '';
                document.getElementById('completionBadge').classList.remove('show');
                document.getElementById('extraCreditBadge').classList.remove('show');
                
                renderScenarioCards();
                updateHUD();
                hideAllStates();
                document.getElementById('welcomeState').classList.remove('hidden');
                updateStepIndicator();
            }
        }

        function newRun() {
            currentScenario = null;
            currentStep = 0;
            prediction = null;
            
            document.querySelectorAll('.scenario-card').forEach(c => c.classList.remove('selected'));
            hideAllStates();
            document.getElementById('welcomeState').classList.remove('hidden');
            updateStepIndicator();
        }

        init();
    </script>
</body>
</html>
