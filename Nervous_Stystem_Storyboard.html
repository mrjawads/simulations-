<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mr. Jawad's Simulation: Teen Brain Development</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
@keyframes pulse{0%,100%{transform:scale(1);}50%{transform:scale(1.08);}}
@keyframes glow{0%,100%{filter:brightness(1);}50%{filter:brightness(1.4);}}
@keyframes fadeIn{from{opacity:0;transform:translateY(12px);}to{opacity:1;transform:translateY(0);}}
@keyframes slideUp{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
@keyframes barShift{from{width:var(--from);}to{width:var(--to);}}
@keyframes bruisePulse{0%,100%{opacity:.7;transform:scale(1);}50%{opacity:1;transform:scale(1.15);}}
@keyframes pathGrow{from{stroke-dashoffset:200;}to{stroke-dashoffset:0;}}
@keyframes heartbeat{0%,100%{transform:scale(1);}25%{transform:scale(1.2);}50%{transform:scale(1);}75%{transform:scale(1.15);}}
@keyframes blueLightBeam{0%{opacity:0.3;}50%{opacity:1;}100%{opacity:0.3;}}
@keyframes cycleArrow{from{transform:rotate(0deg);}to{transform:rotate(360deg);}}
body{font-family:'Segoe UI',system-ui,-apple-system,sans-serif;background:linear-gradient(135deg,#0f0c29,#302b63,#24243e);color:#e0e0e0;height:100vh;overflow:hidden;user-select:none;}
#app{display:flex;height:100vh;width:100vw;}
/* LEFT SIDEBAR */
#left{width:280px;min-width:280px;background:linear-gradient(180deg,#1a1a2e,#16213e);border-right:1px solid rgba(255,255,255,.08);display:flex;flex-direction:column;overflow-y:auto;scrollbar-width:thin;}
#left::-webkit-scrollbar{width:4px;}
#left::-webkit-scrollbar-thumb{background:#444;border-radius:4px;}
.sidebar-header{padding:14px 16px 8px;font-size:15px;font-weight:700;color:#aaa;text-transform:uppercase;letter-spacing:1px;}
.scenario-count{font-size:12px;color:#888;padding:0 16px 10px;font-weight:400;}
.scenario-card{margin:3px 10px;padding:10px 12px;border-radius:10px;cursor:pointer;display:flex;align-items:center;gap:10px;transition:all .2s;border:2px solid transparent;position:relative;background:rgba(255,255,255,.04);}
.scenario-card:hover{background:rgba(255,255,255,.08);border-color:rgba(255,255,255,.15);}
.scenario-card.active{background:linear-gradient(135deg,rgba(33,150,243,.2),rgba(156,39,176,.2));border-color:#2196F3;box-shadow:0 0 12px rgba(33,150,243,.25);}
.scenario-card.completed{opacity:.75;}
.scenario-card.completed::after{content:'‚úì';position:absolute;right:10px;top:50%;transform:translateY(-50%);color:#4CAF50;font-weight:700;font-size:16px;}
.sc-emoji{font-size:24px;flex-shrink:0;}
.sc-name{font-size:13px;font-weight:600;color:#ccc;line-height:1.3;}
.divider{height:1px;background:rgba(255,255,255,.08);margin:12px 16px;}
.section-label{padding:6px 16px;font-size:12px;font-weight:700;color:#888;text-transform:uppercase;letter-spacing:.8px;}
.reading-tabs{display:flex;gap:4px;padding:4px 16px 8px;}
.rtab{flex:1;text-align:center;padding:7px 4px;border-radius:8px;font-size:12px;font-weight:700;cursor:pointer;transition:all .2s;border:1px solid rgba(255,255,255,.1);background:rgba(255,255,255,.04);color:#999;}
.rtab:hover{background:rgba(255,255,255,.08);}
.rtab.active{color:#fff;border-color:transparent;}
.rtab.low.active{background:linear-gradient(135deg,#4CAF50,#2E7D32);}
.rtab.med.active{background:linear-gradient(135deg,#FF9800,#E65100);}
.rtab.high.active{background:linear-gradient(135deg,#F44336,#B71C1C);}
#keywords-area{padding:4px 16px 8px;}
.kw-tag{display:inline-block;padding:3px 8px;margin:2px;border-radius:6px;font-size:11px;font-weight:600;background:rgba(33,150,243,.15);color:#64B5F6;border:1px solid rgba(33,150,243,.2);}
.bottom-btns{padding:12px 16px;display:flex;gap:8px;margin-top:auto;}
.btn-reset{flex:1;padding:10px;border:none;border-radius:8px;font-size:13px;font-weight:700;cursor:pointer;transition:all .2s;}
.btn-reset:hover{transform:translateY(-1px);}
#btnReset{background:linear-gradient(135deg,#ef5350,#c62828);color:#fff;}
#btnNewRun{background:linear-gradient(135deg,#42A5F5,#1565C0);color:#fff;}
/* CENTER PANEL */
#center{flex:1;display:flex;flex-direction:column;overflow:hidden;position:relative;}
#topbar{background:linear-gradient(90deg,#1a237e,#4a148c);padding:10px 20px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 2px 8px rgba(0,0,0,.3);}
#topbar h1{font-size:16px;font-weight:700;color:#fff;text-shadow:0 1px 4px rgba(0,0,0,.3);}
#mission{font-size:11px;color:rgba(255,255,255,.7);max-width:400px;text-align:right;}
/* STEP TABS */
#step-tabs{display:flex;background:rgba(0,0,0,.2);border-bottom:1px solid rgba(255,255,255,.06);}
.stab{flex:1;text-align:center;padding:10px 8px;font-size:13px;font-weight:700;color:#555;cursor:default;transition:all .3s;position:relative;}
.stab.active{color:#fff;background:rgba(33,150,243,.15);}
.stab.active::after{content:'';position:absolute;bottom:0;left:20%;right:20%;height:3px;background:linear-gradient(90deg,#2196F3,#9C27B0);border-radius:3px 3px 0 0;box-shadow:0 0 8px rgba(33,150,243,.5);}
.stab.done{color:#4CAF50;}
/* CENTER CONTENT */
#center-content{flex:1;display:flex;align-items:center;justify-content:center;padding:20px;overflow:hidden;}
.content-card{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:28px;max-width:720px;width:100%;animation:fadeIn .4s ease;box-shadow:0 4px 24px rgba(0,0,0,.2);}
.content-card h2{font-size:20px;margin-bottom:12px;color:#fff;}
.content-card p{font-size:15px;line-height:1.65;color:#ccc;}
.content-card .highlight{color:#64B5F6;font-weight:700;}
#predict-options{display:flex;flex-direction:column;gap:8px;margin-top:16px;}
.predict-btn{padding:12px 16px;border:2px solid rgba(255,255,255,.12);border-radius:10px;background:rgba(255,255,255,.04);color:#ddd;font-size:14px;cursor:pointer;transition:all .2s;text-align:left;}
.predict-btn:hover{border-color:#2196F3;background:rgba(33,150,243,.1);transform:translateX(4px);}
.predict-btn.selected{border-color:#4CAF50;background:rgba(76,175,80,.15);color:#fff;}
/* READ CARD */
#read-card{max-height:calc(100vh - 260px);overflow:hidden;}
#read-card .reading-text{font-size:15px;line-height:1.7;color:#ddd;}
#read-card .reading-text .kw{color:#64B5F6;font-weight:700;}
#read-aloud-btn{display:inline-flex;align-items:center;gap:6px;margin-top:12px;padding:8px 16px;border-radius:8px;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.06);color:#aaa;font-size:12px;cursor:pointer;transition:all .2s;}
#read-aloud-btn:hover{background:rgba(255,255,255,.1);color:#fff;}
#read-aloud-btn.speaking{color:#4CAF50;border-color:#4CAF50;background:rgba(76,175,80,.1);}
/* WATCH AREA */
#watch-area{width:100%;display:flex;flex-direction:column;align-items:center;gap:16px;}
#brain-visual{position:relative;width:100%;max-width:650px;height:320px;background:radial-gradient(ellipse at center,rgba(20,20,50,.8),rgba(10,10,30,.9));border-radius:16px;border:1px solid rgba(255,255,255,.08);overflow:hidden;}
/* Brain SVG */
#brain-svg{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:240px;height:200px;}
.brain-outline{fill:rgba(180,180,220,.08);stroke:rgba(180,180,220,.25);stroke-width:2;}
#prefrontal-area{fill:rgba(33,150,243,.05);stroke:rgba(33,150,243,.15);stroke-width:1.5;transition:all .8s;}
#prefrontal-area.active{fill:rgba(33,150,243,.3);stroke:#2196F3;filter:drop-shadow(0 0 8px rgba(33,150,243,.5));}
#prefrontal-area.dim{fill:rgba(100,100,100,.1);stroke:rgba(100,100,100,.2);filter:none;}
#amygdala-area{fill:rgba(244,67,54,.05);stroke:rgba(244,67,54,.15);stroke-width:1.5;transition:all .8s;}
#amygdala-area.active{fill:rgba(244,67,54,.35);stroke:#F44336;filter:drop-shadow(0 0 10px rgba(244,67,54,.6));animation:pulse 1s infinite;}
.brain-label{font-size:9px;fill:#999;font-weight:600;text-anchor:middle;}
/* Meters */
.meter-group{position:absolute;right:20px;top:50%;transform:translateY(-50%);display:flex;flex-direction:column;gap:14px;width:180px;}
.meter{display:flex;align-items:center;gap:8px;}
.meter-label{font-size:11px;font-weight:700;width:55px;text-align:right;}
.meter-label.focus{color:#42A5F5;}
.meter-label.memory{color:#66BB6A;}
.meter-label.mood{color:#FDD835;}
.meter-track{flex:1;height:14px;background:rgba(255,255,255,.06);border-radius:7px;position:relative;overflow:hidden;border:1px solid rgba(255,255,255,.1);}
.meter-fill{height:100%;border-radius:7px;transition:width 1.2s ease,background .8s;}
.meter-ok{position:absolute;left:35%;right:35%;top:-1px;bottom:-1px;border-left:2px dashed rgba(255,255,255,.25);border-right:2px dashed rgba(255,255,255,.25);}
.meter-ok-label{position:absolute;top:-14px;left:50%;transform:translateX(-50%);font-size:8px;color:#888;font-weight:600;}
/* Overlay icons */
.brain-icon{position:absolute;font-size:28px;transition:all .8s;opacity:0;}
.brain-icon.visible{opacity:1;}
#icon-bruise{left:80px;top:60px;}
#icon-cortisol{left:40px;top:100px;font-size:22px;}
#icon-melatonin{right:100px;top:50px;font-size:22px;}
#icon-consolidation{left:60px;top:140px;font-size:20px;}
#icon-heart{right:20px;bottom:20px;font-size:24px;}
#icon-bluelight{left:20px;top:30px;font-size:22px;}
#icon-clock{right:80px;bottom:20px;font-size:22px;}
#icon-neuroplasticity{left:100px;top:80px;font-size:20px;}
#icon-cycle{right:40px;top:30px;font-size:24px;}
.recovery-bar{position:absolute;bottom:12px;left:50%;transform:translateX(-50%);width:60%;height:6px;background:rgba(255,255,255,.08);border-radius:3px;overflow:hidden;opacity:0;transition:opacity .5s;}
.recovery-bar.visible{opacity:1;}
.recovery-fill{height:100%;background:linear-gradient(90deg,#F44336,#FF9800,#4CAF50);border-radius:3px;width:0;transition:width 2s ease;}
.recovery-label{position:absolute;bottom:22px;left:50%;transform:translateX(-50%);font-size:10px;color:#aaa;opacity:0;transition:opacity .5s;}
.recovery-label.visible{opacity:1;}
/* Pathway lines for neuroplasticity */
.pathway-line{stroke:#4CAF50;stroke-width:2;fill:none;stroke-dasharray:200;stroke-dashoffset:200;opacity:0;filter:drop-shadow(0 0 4px rgba(76,175,80,.6));}
.pathway-line.growing{opacity:1;animation:pathGrow 2s ease forwards;}
/* RECORD */
#record-card{text-align:center;}
#record-card .checkmark{font-size:56px;margin-bottom:10px;}
/* ACTION BUTTON */
#action-area{padding:12px 20px;display:flex;justify-content:center;gap:10px;background:rgba(0,0,0,.15);}
#action-btn{padding:12px 32px;border:none;border-radius:10px;font-size:14px;font-weight:700;color:#fff;cursor:pointer;transition:all .25s;background:linear-gradient(135deg,#2196F3,#1565C0);box-shadow:0 4px 12px rgba(33,150,243,.3);}
#action-btn:hover{transform:translateY(-2px);box-shadow:0 6px 16px rgba(33,150,243,.4);}
#action-btn:disabled{opacity:.4;cursor:default;transform:none;box-shadow:none;}
/* RIGHT SIDEBAR */
#right{width:280px;min-width:280px;background:linear-gradient(180deg,#1a1a2e,#16213e);border-left:1px solid rgba(255,255,255,.08);display:flex;flex-direction:column;overflow-y:auto;scrollbar-width:thin;}
#right::-webkit-scrollbar{width:4px;}
#right::-webkit-scrollbar-thumb{background:#444;border-radius:4px;}
.hud-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px;padding:10px 14px;}
.hud-item{background:rgba(255,255,255,.04);border-radius:8px;padding:8px;text-align:center;border:1px solid rgba(255,255,255,.06);}
.hud-value{font-size:20px;font-weight:800;color:#fff;}
.hud-label{font-size:10px;color:#888;text-transform:uppercase;letter-spacing:.5px;margin-top:2px;}
#progress-bar-wrap{padding:6px 14px;}
#progress-bar{height:8px;background:rgba(255,255,255,.06);border-radius:4px;overflow:hidden;}
#progress-fill{height:100%;background:linear-gradient(90deg,#4CAF50,#81C784);border-radius:4px;transition:width .5s;width:0;}
#progress-msg{font-size:11px;color:#888;text-align:center;padding:4px 14px;}
#data-table-header{padding:10px 14px 6px;font-size:13px;font-weight:700;color:#aaa;text-transform:uppercase;letter-spacing:.8px;}
#data-table-wrap{flex:1;padding:0 10px 10px;overflow-y:auto;}
#data-table{width:100%;border-collapse:collapse;font-size:10px;}
#data-table th{background:rgba(33,150,243,.15);color:#90CAF9;padding:6px 4px;text-align:left;font-size:9px;text-transform:uppercase;letter-spacing:.5px;position:sticky;top:0;}
#data-table td{padding:5px 4px;border-bottom:1px solid rgba(255,255,255,.04);color:#bbb;vertical-align:top;line-height:1.3;}
#data-table tr:nth-child(even){background:rgba(255,255,255,.02);}
/* WELCOME SCREEN */
#welcome{position:absolute;inset:0;background:radial-gradient(ellipse at center,rgba(26,35,62,.95),rgba(15,12,41,.98));display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:100;text-align:center;animation:fadeIn .6s;}
#welcome h1{font-size:36px;font-weight:800;background:linear-gradient(135deg,#64B5F6,#CE93D8);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:8px;}
#welcome .subtitle{font-size:16px;color:#999;margin-bottom:24px;max-width:500px;line-height:1.5;}
#welcome .start-btn{padding:14px 40px;font-size:16px;font-weight:700;border:none;border-radius:12px;background:linear-gradient(135deg,#2196F3,#9C27B0);color:#fff;cursor:pointer;transition:all .3s;box-shadow:0 4px 20px rgba(33,150,243,.3);}
#welcome .start-btn:hover{transform:translateY(-3px);box-shadow:0 8px 28px rgba(33,150,243,.4);}
#welcome .brain-icon-big{font-size:72px;margin-bottom:16px;}
/* COMPLETION */
#completion{display:none;position:absolute;inset:0;background:radial-gradient(ellipse at center,rgba(26,35,62,.97),rgba(15,12,41,.99));flex-direction:column;align-items:center;justify-content:center;z-index:100;text-align:center;}
#completion.show{display:flex;animation:fadeIn .6s;}
#completion h1{font-size:32px;font-weight:800;color:#4CAF50;margin-bottom:8px;}
#completion .sub{font-size:15px;color:#aaa;margin-bottom:6px;}
#extra-credit-badge{display:none;padding:8px 20px;border-radius:20px;background:linear-gradient(135deg,#FF9800,#F44336);color:#fff;font-weight:700;font-size:14px;margin:10px 0;}
/* Scrollbar right */
#right::-webkit-scrollbar{width:4px;}
#right::-webkit-scrollbar-thumb{background:#444;border-radius:4px;}
/* RESPONSIVE */
@media(max-width:1100px){
#left,#right{width:240px;min-width:240px;}
}
</style>
</head>
<body>
<div id="app">
<!-- LEFT SIDEBAR -->
<div id="left">
<div class="sidebar-header">Pick Any You Like</div>
<div class="scenario-count" id="scenario-count">Choose 5 of 8 stories</div>
<div id="scenario-list"></div>
<div class="divider"></div>
<div class="section-label">Reading Level</div>
<div class="reading-tabs">
<div class="rtab low active" data-level="low" onclick="setLevel('low')">Low</div>
<div class="rtab med" data-level="med" onclick="setLevel('med')">Med</div>
<div class="rtab high" data-level="high" onclick="setLevel('high')">High</div>
</div>
<div class="divider"></div>
<div class="section-label">Key Words</div>
<div id="keywords-area"></div>
<div class="bottom-btns">
<button class="btn-reset" id="btnReset" onclick="resetAll()">Reset</button>
<button class="btn-reset" id="btnNewRun" onclick="newRun()">New Run</button>
</div>
</div>
<!-- CENTER -->
<div id="center">
<div id="topbar">
<h1>üß† Mr. Jawad's Simulation: Teen Brain Development</h1>
<div id="mission">Investigate real brain cases</div>
</div>
<div id="step-tabs">
<div class="stab" data-step="predict">1. PREDICT</div>
<div class="stab" data-step="read">2. READ</div>
<div class="stab" data-step="watch">3. WATCH</div>
<div class="stab" data-step="record">4. RECORD</div>
</div>
<div id="center-content">
<div class="content-card" id="default-card">
<h2>üëà Pick a story to begin</h2>
<p>Select any scenario from the left sidebar that interests you. Read real stories about teen brains, predict what happens, and record the data.</p>
</div>
</div>
<div id="action-area">
<button id="action-btn" disabled>Select a Scenario</button>
</div>
<!-- WELCOME -->
<div id="welcome">
<div class="brain-icon-big">üß†</div>
<h1>Brain Under Construction</h1>
<div class="subtitle">Real teens face brain injuries, sleep loss, and stress every day ‚Äî their stories reveal the science of what is actually happening inside the developing brain.</div>
<button class="start-btn" onclick="startSim()">Start Investigation</button>
</div>
<!-- COMPLETION -->
<div id="completion">
<div style="font-size:64px;margin-bottom:12px;">üèÜ</div>
<h1>Investigation Complete!</h1>
<div class="sub" id="comp-msg">You completed the required 5 scenarios.</div>
<div id="extra-credit-badge">‚≠ê EXTRA CREDIT COMPLETE ‚≠ê</div>
<div class="sub" style="margin-top:12px;">Copy your data table into your worksheet.</div>
</div>
</div>
<!-- RIGHT SIDEBAR -->
<div id="right">
<div class="sidebar-header">Progress</div>
<div class="hud-grid">
<div class="hud-item"><div class="hud-value" id="hud-score">0</div><div class="hud-label">Score</div></div>
<div class="hud-item"><div class="hud-value" id="hud-streak">0</div><div class="hud-label">Streak</div></div>
<div class="hud-item"><div class="hud-value" id="hud-completed">0/8</div><div class="hud-label">Completed</div></div>
<div class="hud-item"><div class="hud-value" id="hud-accuracy">--%</div><div class="hud-label">Accuracy</div></div>
</div>
<div id="progress-bar-wrap"><div id="progress-bar"><div id="progress-fill"></div></div></div>
<div id="progress-msg">Pick 5 stories you like!</div>
<div id="data-table-header" style="display:flex;align-items:center;justify-content:space-between;">
<span style="font-size:13px;font-weight:700;color:#aaa;text-transform:uppercase;letter-spacing:.8px;">Data Table</span>
<button id="copy-table-btn" onclick="copyTable()" style="padding:5px 10px;border:1px solid rgba(255,255,255,.15);border-radius:6px;background:rgba(255,255,255,.06);color:#aaa;font-size:11px;cursor:pointer;transition:all .2s;">üìã Copy Table</button>
</div>
<div id="data-table-wrap">
<table id="data-table">
<thead><tr><th>Scenario</th><th>What Happened?</th><th>Response</th><th>Brain Connection</th></tr></thead>
<tbody id="data-tbody"></tbody>
</table>
</div>
</div>
</div>

<script>
const SCENARIOS = [
{id:1,name:"The Concussion Comeback",emoji:"üèà",
premise:"A high school football player hides concussion symptoms and gets hit again before his brain heals.",
keywords:["prefrontal cortex","concussion","neuroplasticity","amygdala"],
predictions:["Second hit causes much worse damage","Brain heals quickly from both hits","Player feels fine after resting one day"],
correctPred:0,
readings:{
low:"Friday night game ‚Äî a football player takes a hard hit and feels dizzy, but he hides his <span class='kw'>concussion</span> and goes back in. He gets hit again before his brain heals, and this time his <span class='kw'>prefrontal cortex</span> swells so badly that he cannot think straight, remember anything, or control his mood for weeks. Playing through the pain made the damage much worse.",
med:"A football player takes a helmet-to-helmet hit during a Friday night game and feels dizzy and sick on the sideline. He does not want to let his team down, so he hides his <span class='kw'>concussion</span> and runs back onto the field. On the very next play, he gets hit again before his brain has healed. His <span class='kw'>prefrontal cortex</span> swells far worse than the first time because it was already hurt ‚Äî and for weeks after, he has crushing headaches, cannot remember what he reads, and cannot focus in class. About one in four teen athletes hide their warning signs just like he did, but the brain's <span class='kw'>neuroplasticity</span> needs full rest before it can start fixing the damage.",
high:"It is Friday night under the lights, and a football player takes a helmet-to-helmet hit that drops him to the ground. On the sideline, his head pounds and his eyes go blurry, but he tells his coach he is fine because he does not want to let his team down. About one in four teen athletes hide their <span class='kw'>concussion</span> warning signs to get back in the game faster. He runs back onto the field, and on the very next play, a second hit slams into his head before his brain has healed. His <span class='kw'>prefrontal cortex</span> ‚Äî the part of his brain that controls planning and self-control ‚Äî swells far worse than either hit alone would have caused. For three weeks after, he has crushing headaches, cannot remember what he reads, and snaps at everyone around him because his <span class='kw'>amygdala</span> is in overdrive, making every feeling hit harder. Doctors say his brain's <span class='kw'>neuroplasticity</span> will help rebuild the damaged connections, but only if he stays completely away from contact until he heals."},
watchAnim:"concussion",
dataRow:{what:"Player got hit twice before brain healed",response:"Weeks of headaches, memory loss, mood problems",connection:"Second hit damaged prefrontal cortex worse because brain was still healing"}
},
{id:2,name:"The Sleep Experiment",emoji:"üò¥",
premise:"Minneapolis schools delayed start times by 50 minutes, and students gained about 40 extra minutes of sleep.",
keywords:["prefrontal cortex","consolidation","melatonin"],
predictions:["Students sleep the same amount anyway","Extra sleep improves brain function","Later start makes students lazier"],
correctPred:1,
readings:{
low:"What if schools just let teens sleep more? That is exactly what Minneapolis tried ‚Äî they pushed start times back by 50 minutes. Students slept about 40 extra minutes each night, and their <span class='kw'>prefrontal cortex</span> worked better right away. The extra rest gave the brain more time for <span class='kw'>consolidation</span>, which is how the brain saves what you learned while you sleep.",
med:"What if one simple change could make teen brains work better? Schools in Minneapolis pushed start times back by 50 minutes, and researchers tracked what happened. Students slept about 40 more minutes each night, and the results were clear ‚Äî fewer students fell asleep in class, and more showed up on time. Their <span class='kw'>prefrontal cortex</span> had more time for <span class='kw'>consolidation</span>, the process where the brain locks in everything you learned that day while you sleep. It turned out that fighting teen sleep patterns was hurting their brains, and fixing the schedule helped their brains do what they needed to do.",
high:"What if the reason students fall asleep in class has nothing to do with being lazy ‚Äî and everything to do with brain science? Schools in Minneapolis decided to test this by pushing start times back by 50 minutes. Researchers gave students wrist trackers to measure exactly how much more sleep they got ‚Äî about 40 extra minutes each night. That may not sound like much, but it gave the <span class='kw'>prefrontal cortex</span> more time for <span class='kw'>consolidation</span>, the process where the brain sorts through everything learned during the day and saves the important parts. Before the change, students were being dragged out of bed while <span class='kw'>melatonin</span> ‚Äî the brain's sleep signal ‚Äî was still being released, which meant their brains had not finished resting. After the change, more students showed up on time, fewer fell asleep during morning classes, and focus went up. The <span class='kw'>prefrontal cortex</span> is the last part of the brain to fully grow, and it is the most hurt by lost sleep during the teen years."},
watchAnim:"sleep_improve",
dataRow:{what:"Schools delayed start by 50 min",response:"40 min more sleep, better focus and attendance",connection:"Prefrontal cortex got more consolidation time to save learning"}
},
{id:3,name:"The Energy Drink ER",emoji:"‚ö°",
premise:"A 14-year-old drinks three energy drinks before a game and ends up in the ER.",
keywords:["amygdala","prefrontal cortex"],
predictions:["Energy drinks give a safe boost","Energy drinks only affect adults","Caffeine overloads the teen brain"],
correctPred:2,
readings:{
low:"A 14-year-old chugged three energy drinks before a basketball game, thinking they would give him an edge. His heart started pounding, his hands shook so hard he could not hold the ball, and he ended up in the emergency room. The caffeine blocked the brain signal that tells you when you are tired, and his <span class='kw'>amygdala</span> went into panic mode because his body could not calm down.",
med:"A 14-year-old wanted extra energy for a basketball game, so he drank three energy drinks in a row ‚Äî each one packed with way more caffeine than a cup of coffee. The caffeine blocked the brain signal that says \"you are tired,\" so his body could not tell him to slow down. His heart started racing out of control, his hands shook, and he felt like something was seriously wrong. His <span class='kw'>amygdala</span> ‚Äî the brain's alarm system ‚Äî fired into full panic, and he ended up in the emergency room. In one year alone, over 1,400 teens his age ended up in the ER for the exact same kind of emergency.",
high:"A 14-year-old wanted to play his best in a big basketball game, so he drank three energy drinks back-to-back before tipoff. Each can had two to five times more caffeine than a regular cup of coffee. The caffeine blocked the brain's \"you are tired\" signal, so even though his body was already running hard, his brain could not feel it. Within minutes his heart was pounding out of control and his hands were shaking so badly he could not dribble. His <span class='kw'>amygdala</span> ‚Äî the brain's alarm system ‚Äî fired into full panic mode, flooding him with fear he could not shut off. He ended up in the emergency room, one of over 1,400 teens ages 12 to 17 who went to the ER for energy drink emergencies in a single year. His <span class='kw'>prefrontal cortex</span> ‚Äî still growing and not yet strong enough to calm the <span class='kw'>amygdala</span> panic ‚Äî could not get his body under control, which is why teens are hit harder by caffeine overload than adults."},
watchAnim:"energy_crash",
dataRow:{what:"Drank 3 energy drinks before game",response:"Heart racing, shaking, ER visit, panic",connection:"Amygdala went into panic, prefrontal cortex too weak to calm it"}
},
{id:4,name:"The All-Nighter Backfire",emoji:"üìö",
premise:"A student stays up all night studying but scores worse than a friend who slept.",
keywords:["consolidation","prefrontal cortex"],
predictions:["More study time always means better scores","Sleep is needed to save what you learn","All-nighters work if you study hard enough"],
correctPred:1,
readings:{
low:"A student stayed up all night studying for a big test ‚Äî from 9 PM to 6 AM, not sleeping at all. Her friend studied for just two hours and then went to bed. The friend scored higher, even though she studied less, because her brain had time for <span class='kw'>consolidation</span> ‚Äî the process where the <span class='kw'>prefrontal cortex</span> saves what you learned while you sleep.",
med:"A student had a huge test the next day, so she stayed up all night ‚Äî from 9 PM until 6 AM ‚Äî cramming every fact she could. Her friend studied the same stuff for two hours and then went to sleep at her normal time. The next morning, the all-night student felt like her brain was full of fog, and she kept going blank during the test. Her friend scored a whole letter grade higher. The reason is <span class='kw'>consolidation</span> ‚Äî while you sleep, the <span class='kw'>prefrontal cortex</span> replays what you learned and moves it from short-term to long-term memory. Without sleep, the all-night student's brain never saved what she studied ‚Äî like typing a long paper and never hitting save.",
high:"A student had a huge test the next morning, so she made a plan: study all night long, from 9 PM until 6 AM, and cover every single page of notes. Her friend looked at the same stuff for two focused hours and then got into bed at her normal time. The next morning, the all-night student walked into class with burning eyes and a foggy brain. She kept going blank on answers she had just read hours before. Her friend scored a full letter grade higher ‚Äî and she had studied less. The reason comes down to <span class='kw'>consolidation</span>: while you sleep, the <span class='kw'>prefrontal cortex</span> replays everything you learned that day and moves it from short-term to long-term memory. Without sleep, the all-night student's brain never finished this process, so most of what she crammed was gone by morning. Research shows that students who skip sleep almost always do worse than students who study less but sleep ‚Äî because the brain simply cannot save what you learn without rest."},
watchAnim:"allnighter",
dataRow:{what:"Stayed up all night studying",response:"Scored worse than friend who slept",connection:"No consolidation ‚Äî prefrontal cortex could not save memories without sleep"}
},
{id:5,name:"The Stress Spike",emoji:"üò∞",
premise:"Weeks of chronic stress cause a student to forget things and lose emotional control.",
keywords:["cortisol","amygdala","prefrontal cortex"],
predictions:["Stress always helps you perform better","Teens handle stress better than adults","Long-term stress damages brain function"],
correctPred:2,
readings:{
low:"A student had tests, projects, and drama at school for weeks with no break ‚Äî and the stress would not stop. His brain pumped out too much <span class='kw'>cortisol</span>, a stress chemical that makes it harder to remember things and keep your cool. His <span class='kw'>amygdala</span> kept firing, so he started forgetting homework and blowing up at his friends over nothing.",
med:"A student had back-to-back tests, heavy homework, and friend drama for weeks with no break in sight. At first the stress actually helped ‚Äî a quick burst of <span class='kw'>cortisol</span> sharpened his focus and gave him energy to push through. But when the pressure kept going day after day, his <span class='kw'>cortisol</span> levels stayed way too high and started doing real damage. His <span class='kw'>amygdala</span> ‚Äî the brain's alarm system ‚Äî was firing nonstop, making him snap at friends and feel crushed by tiny problems. His memory dropped because all that <span class='kw'>cortisol</span> was messing with his <span class='kw'>prefrontal cortex</span>, which needs calm to store and pull back what you have learned. Short-term stress can be a tool, but nonstop stress breaks down the brain areas students need most.",
high:"For weeks, a student had back-to-back tests, a big project due, and friend drama piled on top of everything. At first, the stress actually helped ‚Äî a quick burst of <span class='kw'>cortisol</span> gave him sharp focus and the energy to power through a tough night of homework. But the pressure never stopped, and his <span class='kw'>cortisol</span> levels stayed dangerously high day after day. All that extra <span class='kw'>cortisol</span> started messing with his <span class='kw'>prefrontal cortex</span>, the part of the brain that handles planning, memory, and self-control. He started forgetting things he had written down, blanking on test answers he knew the night before, and losing his temper over stuff that normally would not bother him. His <span class='kw'>amygdala</span> ‚Äî the brain's alarm system ‚Äî was firing on overdrive, making every small problem feel like a crisis. Meanwhile his ability to think clearly kept getting worse because his <span class='kw'>prefrontal cortex</span> was being drowned in stress chemicals. Research shows that nonstop stress in teens can actually weaken connections in the <span class='kw'>prefrontal cortex</span> while making the <span class='kw'>amygdala</span> stronger ‚Äî rewiring the brain toward big emotional reactions instead of calm, clear thinking."},
watchAnim:"stress",
dataRow:{what:"Weeks of nonstop academic stress",response:"Forgetting homework, blowing up at friends",connection:"Cortisol weakened prefrontal cortex while amygdala overactivated"}
},
{id:6,name:"The Rewired Brain",emoji:"üîÑ",
premise:"A teen who lost reading ability after injury slowly relearns through neuroplasticity.",
keywords:["neuroplasticity","prefrontal cortex"],
predictions:["Brain damage is always permanent","The teen brain can rewire around damage","Only adult brains can heal from injury"],
correctPred:1,
readings:{
low:"After a serious brain injury, a teen could not read anymore ‚Äî the words on the page looked like random shapes. Doctors gave her hard daily reading practice for months, forcing her brain to find a new path around the damage. Over time, brain scans showed something amazing: new connections were growing around the hurt area, a process called <span class='kw'>neuroplasticity</span>. Her <span class='kw'>prefrontal cortex</span> slowly rebuilt, and she learned to read again.",
med:"A teen was in a bad accident that hurt the part of her brain used for reading, and for months she could not make sense of a single word on a page. Doctors gave her hard daily exercises, making her practice reading over and over even when she wanted to quit. At first, nothing seemed to change and she felt like giving up. But brain scans showed something amazing: new brain connections were slowly growing around the hurt area, finding a fresh path through healthy parts of her brain. This process is called <span class='kw'>neuroplasticity</span> ‚Äî the brain's power to rewire itself by building new connections when old ones are destroyed. Because she was a teenager, her <span class='kw'>neuroplasticity</span> was at its strongest, giving her a better shot at getting better than an adult with the same injury.",
high:"A teen was in a bad accident that destroyed the part of her brain used for reading. For weeks, she could not read a single sentence ‚Äî the words on the page looked like random shapes that made no sense. Her doctors started her on a program of hard daily practice, making her work on reading exercises every single day. Every day for months she tried, even when it felt like nothing was changing and she wanted to give up. But brain scans taken over time showed something powerful: new brain pathways were slowly growing around the hurt area, sending the reading signal through healthy parts of her brain. This process is called <span class='kw'>neuroplasticity</span> ‚Äî the brain's power to rewire itself when old connections are broken. Because she was a teenager, her brain was in its best window for <span class='kw'>neuroplasticity</span>, meaning it could rewire faster and better than an adult brain with the same injury. By the end of the year, she had gotten most of her reading ability back ‚Äî proof that the teen brain has an amazing power to rebuild itself when given steady practice and time."},
watchAnim:"rewire",
dataRow:{what:"Lost reading ability after brain injury",response:"Daily practice rebuilt reading over months",connection:"Neuroplasticity let teen brain grow new pathways around damage"}
},
{id:7,name:"The Night Owl Mismatch",emoji:"üåô",
premise:"Teen biology pushes sleep to 11 PM but school starts at 7:15 AM ‚Äî only 6 hours of sleep.",
keywords:["melatonin","prefrontal cortex","consolidation","amygdala"],
predictions:["Biology makes teens sleep later","Teens are just being lazy about sleep","6 hours of sleep is enough for teens"],
correctPred:0,
readings:{
low:"Every night, a teen's brain did not release <span class='kw'>melatonin</span> ‚Äî the sleep signal ‚Äî until around 11 PM, which is totally normal during the teen years. But her school started at 7:15 AM, so she only got about 6 hours of sleep each night. Her <span class='kw'>prefrontal cortex</span> never fully charged up, so she kept falling asleep in class and her grades dropped. She is not alone ‚Äî 87% of high school students are not getting enough sleep.",
med:"During the teen years, the brain shifts its clock about two hours later, so <span class='kw'>melatonin</span> ‚Äî the chemical that makes you sleepy ‚Äî does not kick in until around 11 PM. This is not laziness ‚Äî it is how the teen brain is built. But this teen's school started at 7:15 AM, which meant her alarm went off when her brain was still deep asleep. She got only about 6 hours of sleep a night ‚Äî way less than the 8 to 10 her growing brain needed. Her <span class='kw'>prefrontal cortex</span> could not run at full power, so she fell asleep in class, forgot homework, and watched her grades slide. She is not alone ‚Äî about 87% of U.S. high school students are not getting enough rest.",
high:"During the teen years, the brain goes through a change that pushes <span class='kw'>melatonin</span> ‚Äî the chemical that makes you feel sleepy ‚Äî about two hours later than it comes for kids or adults. For this teen, that meant her body did not signal sleep until around 11 PM, no matter how early she tried to get in bed. But her school started at 7:15 AM, and every morning her alarm ripped her out of the deepest part of her sleep. She averaged only about 6 hours a night ‚Äî way below the 8 to 10 hours her growing <span class='kw'>prefrontal cortex</span> needed. Without enough rest, her brain could not finish <span class='kw'>consolidation</span>, the process of saving what she learned into long-term memory. She started falling asleep in morning classes, forgetting things she had written down, and feeling angry and upset over tiny things. Her <span class='kw'>amygdala</span> was more fired up than usual on so little sleep, making every small problem feel huge. About 87% of U.S. high school students are stuck in the same trap ‚Äî their brain says \"sleep later,\" but school says \"wake up now.\""},
watchAnim:"nightowl",
dataRow:{what:"Biology pushed sleep to 11 PM, school at 7:15 AM",response:"Only 6 hrs sleep, falling asleep in class, grades dropped",connection:"Prefrontal cortex never fully recharged, consolidation incomplete"}
},
{id:8,name:"The Phone Spiral",emoji:"üì±",
premise:"Blue light from a phone blocks melatonin, crashing focus, mood, and memory the next day.",
keywords:["melatonin","prefrontal cortex","amygdala","consolidation"],
predictions:["Phone screens do not affect sleep","Scrolling late helps you relax","Blue light blocks the sleep signal"],
correctPred:2,
readings:{
low:"A student could not stop scrolling his phone and stayed up until 1 AM. The blue light from the screen blocked <span class='kw'>melatonin</span>, the brain chemical that tells you it is time to sleep. The next day his <span class='kw'>prefrontal cortex</span> was running on empty, and his <span class='kw'>amygdala</span> was fired up, making everything feel way more emotional than it should. Focus, memory, and mood all crashed because his brain never got the rest it needed.",
med:"A student told himself he would put his phone down at 10 ‚Äî but one more video turned into one more hour, and by 1 AM he was still scrolling. The blue light from the screen was blocking <span class='kw'>melatonin</span>, the brain chemical that tells you it is time to sleep, so he did not even feel tired. When he finally passed out, his brain had only five hours to do all the repair and <span class='kw'>consolidation</span> work that usually takes eight. The next day, his <span class='kw'>prefrontal cortex</span> was running on empty ‚Äî he could not focus and kept zoning out in class. His <span class='kw'>amygdala</span> was way more active than normal, so when a friend made a small joke, it felt like an attack and he snapped back hard. He was not a mean person ‚Äî his brain was just too tired to keep his feelings in check.",
high:"A student lay in bed telling himself \"just one more video\" ‚Äî but notifications, clips, and feeds kept pulling him back in until it was 1 AM. The blue light from his phone screen was blocking <span class='kw'>melatonin</span>, the chemical that tells the brain it is time to sleep, so even though it was late, his brain was not getting the message. When he finally fell asleep, his brain had only about five hours to do all the repair, memory saving, and <span class='kw'>consolidation</span> work that normally takes eight or more hours. The next morning, his <span class='kw'>prefrontal cortex</span> ‚Äî already the last part of the brain to grow during the teen years ‚Äî was running at a fraction of its usual power. He could not focus in class, forgot his locker code, and felt foggy all day. His <span class='kw'>amygdala</span> was firing at full blast because teen brains with too little sleep have much stronger emotional reactions than rested ones. A harmless joke from a friend hit him like an insult, and he blew up in an argument that wrecked his whole afternoon. The same pattern repeated night after night ‚Äî blue light blocking <span class='kw'>melatonin</span>, short sleep cutting off <span class='kw'>consolidation</span>, and a fired-up <span class='kw'>amygdala</span> making each day harder than the last."},
watchAnim:"phone",
dataRow:{what:"Scrolled phone until 1 AM, blue light blocked melatonin",response:"Focus, memory, mood all crashed next day",connection:"Prefrontal cortex ran on empty, amygdala overactivated, no consolidation"}
}
];

let state={
currentScenario:null,
currentStep:null,// predict,read,watch,record
readingLevel:'low',
completed:new Set(),
predictions:{},
score:0,
streak:0,
totalPredictions:0,
correctPredictions:0,
started:false
};

function startSim(){
document.getElementById('welcome').style.display='none';
state.started=true;
renderScenarioList();
updateHUD();
showDefaultCard();
}

function renderScenarioList(){
const list=document.getElementById('scenario-list');
list.innerHTML='';
SCENARIOS.forEach(s=>{
const div=document.createElement('div');
div.className='scenario-card'+(state.completed.has(s.id)?' completed':'')+(state.currentScenario===s.id?' active':'');
div.innerHTML=`<span class="sc-emoji">${s.emoji}</span><span class="sc-name">${s.name}</span>`;
div.onclick=()=>selectScenario(s.id);
list.appendChild(div);
});
}

function selectScenario(id){
if(state.completed.has(id))return;
state.currentScenario=id;
state.currentStep='predict';
renderScenarioList();
updateStepTabs();
showPredictCard();
updateKeywords();
}

function updateKeywords(){
const area=document.getElementById('keywords-area');
if(!state.currentScenario){area.innerHTML='<span style="color:#666;font-size:11px;">Select a scenario</span>';return;}
const s=SCENARIOS.find(x=>x.id===state.currentScenario);
area.innerHTML=s.keywords.map(k=>`<span class="kw-tag">${k}</span>`).join('');
}

function updateStepTabs(){
document.querySelectorAll('.stab').forEach(tab=>{
const step=tab.dataset.step;
tab.classList.remove('active','done');
if(step===state.currentStep)tab.classList.add('active');
const steps=['predict','read','watch','record'];
const ci=steps.indexOf(state.currentStep);
const ti=steps.indexOf(step);
if(ti<ci)tab.classList.add('done');
});
}

function showDefaultCard(){
const cc=document.getElementById('center-content');
cc.innerHTML=`<div class="content-card" id="default-card"><h2>üëà Pick a story to begin</h2><p>Select any scenario from the left sidebar that interests you. Read real stories about teen brains, predict what happens, and record the data.</p></div>`;
document.getElementById('action-btn').textContent='Select a Scenario';
document.getElementById('action-btn').disabled=true;
document.getElementById('action-btn').onclick=null;
}

function showPredictCard(){
const s=SCENARIOS.find(x=>x.id===state.currentScenario);
const cc=document.getElementById('center-content');
cc.innerHTML=`<div class="content-card" style="animation:fadeIn .4s;">
<h2>${s.emoji} ${s.name}</h2>
<p style="margin-bottom:16px;color:#aaa;font-size:14px;">${s.premise}</p>
<p style="font-weight:700;margin-bottom:12px;">What do you predict will happen?</p>
<div id="predict-options">
${s.predictions.map((p,i)=>`<div class="predict-btn" data-idx="${i}" onclick="pickPrediction(${i})">${p}</div>`).join('')}
</div></div>`;
const btn=document.getElementById('action-btn');
btn.textContent='Make Your Prediction';
btn.disabled=true;
btn.onclick=()=>goToRead();
}

function pickPrediction(idx){
document.querySelectorAll('.predict-btn').forEach(b=>b.classList.remove('selected'));
document.querySelector(`.predict-btn[data-idx="${idx}"]`).classList.add('selected');
state.predictions[state.currentScenario]=idx;
document.getElementById('action-btn').disabled=false;
}

function goToRead(){
state.currentStep='read';
updateStepTabs();
showReadCard();
}

function showReadCard(){
const s=SCENARIOS.find(x=>x.id===state.currentScenario);
const text=s.readings[state.readingLevel];
const cc=document.getElementById('center-content');
cc.innerHTML=`<div class="content-card" id="read-card" style="animation:fadeIn .4s;">
<h2>${s.emoji} ${s.name}</h2>
<div class="reading-text">${text}</div>
<button id="read-aloud-btn" onclick="toggleReadAloud()">üîä Read Aloud</button>
</div>`;
const btn=document.getElementById('action-btn');
btn.textContent='Watch the Brain Respond';
btn.disabled=false;
btn.onclick=()=>goToWatch();
}

let speechUtterance=null;
function toggleReadAloud(){
const btn=document.getElementById('read-aloud-btn');
if(speechSynthesis.speaking){speechSynthesis.cancel();btn.classList.remove('speaking');btn.innerHTML='üîä Read Aloud';return;}
const text=document.querySelector('.reading-text').textContent;
speechUtterance=new SpeechSynthesisUtterance(text);
speechUtterance.rate=0.9;
speechUtterance.onend=()=>{btn.classList.remove('speaking');btn.innerHTML='üîä Read Aloud';};
btn.classList.add('speaking');
btn.innerHTML='‚èπ Stop Reading';
speechSynthesis.speak(speechUtterance);
}

function goToWatch(){
speechSynthesis.cancel();
state.currentStep='watch';
updateStepTabs();
showWatchCard();
}

function showWatchCard(){
const s=SCENARIOS.find(x=>x.id===state.currentScenario);
const cc=document.getElementById('center-content');
cc.innerHTML=`<div id="watch-area" style="animation:fadeIn .4s;">
<div id="brain-visual">
<svg id="brain-svg" viewBox="0 0 240 200">
<!-- Brain outline -->
<ellipse class="brain-outline" cx="120" cy="100" rx="100" ry="80"/>
<!-- Prefrontal cortex (front/top) -->
<ellipse id="prefrontal-area" cx="75" cy="70" rx="40" ry="30"/>
<text class="brain-label" x="75" y="105">Prefrontal Cortex</text>
<!-- Amygdala (inner) -->
<ellipse id="amygdala-area" cx="145" cy="110" rx="22" ry="18"/>
<text class="brain-label" x="145" y="140">Amygdala</text>
<!-- Pathway lines for neuroplasticity -->
<path class="pathway-line" id="path1" d="M50,60 Q30,100 60,130 Q90,150 120,120"/>
<path class="pathway-line" id="path2" d="M60,50 Q20,80 50,120 Q80,140 110,110"/>
<path class="pathway-line" id="path3" d="M70,55 Q40,90 70,125 Q100,145 125,115"/>
</svg>
<!-- Overlay icons -->
<div class="brain-icon" id="icon-bruise">üü£</div>
<div class="brain-icon" id="icon-cortisol">üß™</div>
<div class="brain-icon" id="icon-melatonin">üåô</div>
<div class="brain-icon" id="icon-consolidation">üîó</div>
<div class="brain-icon" id="icon-heart" style="animation:none;">‚ù§Ô∏è</div>
<div class="brain-icon" id="icon-bluelight">üì±</div>
<div class="brain-icon" id="icon-clock">‚è∞</div>
<div class="brain-icon" id="icon-neuroplasticity">üîÑ</div>
<div class="brain-icon" id="icon-cycle">üîÅ</div>
<!-- Recovery bar -->
<div class="recovery-label" id="recovery-label"></div>
<div class="recovery-bar" id="recovery-bar"><div class="recovery-fill" id="recovery-fill"></div></div>
<!-- Meters -->
<div class="meter-group">
<div class="meter"><span class="meter-label focus">Focus</span><div class="meter-track"><div class="meter-fill" id="meter-focus" style="width:60%;background:linear-gradient(90deg,#1565C0,#42A5F5);"></div><div class="meter-ok"><span class="meter-ok-label">OK</span></div></div></div>
<div class="meter"><span class="meter-label memory">Memory</span><div class="meter-track"><div class="meter-fill" id="meter-memory" style="width:60%;background:linear-gradient(90deg,#2E7D32,#66BB6A);"></div><div class="meter-ok"><span class="meter-ok-label">OK</span></div></div></div>
<div class="meter"><span class="meter-label mood">Mood</span><div class="meter-track"><div class="meter-fill" id="meter-mood" style="width:60%;background:linear-gradient(90deg,#F9A825,#FDD835);"></div><div class="meter-ok"><span class="meter-ok-label">OK</span></div></div></div>
</div>
</div>
</div>`;
const btn=document.getElementById('action-btn');
btn.textContent='Playing Animation...';
btn.disabled=true;
btn.onclick=null;
runAnimation(s);
}

function runAnimation(s){
// Reset visuals
const pf=document.getElementById('prefrontal-area');
const am=document.getElementById('amygdala-area');
pf.className='';am.className='';
document.querySelectorAll('.brain-icon').forEach(i=>{i.classList.remove('visible');i.style.animation='none';});
document.querySelectorAll('.pathway-line').forEach(p=>p.classList.remove('growing'));
document.getElementById('recovery-bar').classList.remove('visible');
document.getElementById('recovery-label').classList.remove('visible');
document.getElementById('recovery-fill').style.width='0';
// Start at OK
setMeters(60,60,60);
const anim=s.watchAnim;
setTimeout(()=>{
switch(anim){
case 'concussion':
// Step 1: first hit
setMeters(35,60,60);
show('icon-bruise');
pf.classList.add('active');
setTimeout(()=>{
// Step 2: second hit - crash
setMeters(12,15,18);
document.getElementById('icon-bruise').style.animation='bruisePulse 1s infinite';
am.classList.add('active');
document.getElementById('recovery-label').textContent='3+ weeks to heal';
document.getElementById('recovery-label').classList.add('visible');
document.getElementById('recovery-bar').classList.add('visible');
document.getElementById('recovery-fill').style.width='30%';
setTimeout(()=>enableRecord(),1500);
},1800);
break;
case 'sleep_improve':
// Start low
setMeters(30,30,40);
pf.classList.add('dim');
setTimeout(()=>{
show('icon-clock');
show('icon-consolidation');
pf.classList.remove('dim');
pf.classList.add('active');
setMeters(75,80,72);
setTimeout(()=>enableRecord(),1500);
},1500);
break;
case 'energy_crash':
// Spike then crash
setMeters(85,60,60);
setTimeout(()=>{
setMeters(20,50,18);
am.classList.add('active');
show('icon-heart');
document.getElementById('icon-heart').style.animation='heartbeat .4s infinite';
pf.classList.add('dim');
setTimeout(()=>enableRecord(),1500);
},1500);
break;
case 'allnighter':
// Study hours climb but memory drops
setMeters(40,25,50);
show('icon-consolidation');
document.getElementById('icon-consolidation').style.opacity='.3';
pf.classList.add('dim');
setTimeout(()=>{
setMeters(28,15,35);
setTimeout(()=>enableRecord(),1200);
},1500);
break;
case 'stress':
// Brief spike then crash
setMeters(72,60,60);
show('icon-cortisol');
setTimeout(()=>{
setMeters(25,20,15);
am.classList.add('active');
pf.classList.add('dim');
document.getElementById('icon-cortisol').style.animation='pulse 1s infinite';
setTimeout(()=>enableRecord(),1500);
},1500);
break;
case 'rewire':
// Start deep red
setMeters(10,10,15);
pf.classList.add('dim');
setTimeout(()=>{
document.getElementById('path1').classList.add('growing');
document.getElementById('path2').classList.add('growing');
document.getElementById('path3').classList.add('growing');
show('icon-neuroplasticity');
setMeters(45,50,42);
pf.classList.remove('dim');
pf.classList.add('active');
document.getElementById('recovery-label').textContent='Week 1 ‚Üí Month 12';
document.getElementById('recovery-label').classList.add('visible');
document.getElementById('recovery-bar').classList.add('visible');
document.getElementById('recovery-fill').style.width='85%';
setTimeout(()=>enableRecord(),2000);
},1800);
break;
case 'nightowl':
setMeters(28,30,32);
show('icon-melatonin');
show('icon-clock');
pf.classList.add('dim');
setTimeout(()=>{
document.getElementById('recovery-label').textContent='6 hrs / 9 hrs needed';
document.getElementById('recovery-label').classList.add('visible');
setTimeout(()=>enableRecord(),1200);
},1500);
break;
case 'phone':
setMeters(55,55,55);
setTimeout(()=>{
show('icon-bluelight');
document.getElementById('icon-bluelight').style.animation='blueLightBeam 1.5s infinite';
show('icon-melatonin');
document.getElementById('icon-melatonin').style.textDecoration='line-through';
setMeters(18,25,15);
am.classList.add('active');
pf.classList.add('dim');
show('icon-cycle');
document.getElementById('icon-cycle').style.animation='cycleArrow 3s linear infinite';
setTimeout(()=>enableRecord(),1800);
},1200);
break;
}
},600);
}

function setMeters(f,m,mo){
const focus=document.getElementById('meter-focus');
const mem=document.getElementById('meter-memory');
const mood=document.getElementById('meter-mood');
focus.style.width=f+'%';
mem.style.width=m+'%';
mood.style.width=mo+'%';
// Color coding
focus.style.background=f<35?'linear-gradient(90deg,#c62828,#ef5350)':f>65?'linear-gradient(90deg,#1B5E20,#4CAF50)':'linear-gradient(90deg,#1565C0,#42A5F5)';
mem.style.background=m<35?'linear-gradient(90deg,#c62828,#ef5350)':m>65?'linear-gradient(90deg,#1B5E20,#4CAF50)':'linear-gradient(90deg,#2E7D32,#66BB6A)';
mood.style.background=mo<35?'linear-gradient(90deg,#c62828,#ef5350)':mo>65?'linear-gradient(90deg,#1B5E20,#4CAF50)':'linear-gradient(90deg,#F9A825,#FDD835)';
}

function show(id){document.getElementById(id).classList.add('visible');}

function enableRecord(){
const btn=document.getElementById('action-btn');
btn.textContent='Record Data';
btn.disabled=false;
btn.onclick=()=>goToRecord();
}

function goToRecord(){
state.currentStep='record';
updateStepTabs();
const s=SCENARIOS.find(x=>x.id===state.currentScenario);
// Score
state.totalPredictions++;
const correct=state.predictions[s.id]===s.correctPred;
if(correct){state.correctPredictions++;state.streak++;state.score+=100+(state.streak>1?(state.streak-1)*25:0);}
else{state.streak=0;state.score+=50;}
state.completed.add(s.id);
// Add data row
addDataRow(s);
updateHUD();
renderScenarioList();
// Show record card
const cc=document.getElementById('center-content');
const n=state.completed.size;
let msg=correct?'‚úÖ Great prediction!':'üîÑ Different result ‚Äî but now you know!';
if(n>=5&&n<8)msg+=' Required complete! Keep going for extra credit!';
if(n===8)msg+=' üåü All 8 stories complete ‚Äî EXTRA CREDIT!';
cc.innerHTML=`<div class="content-card" id="record-card" style="animation:slideUp .4s;text-align:center;">
<div class="checkmark">${correct?'üéØ':'üìù'}</div>
<h2>${msg}</h2>
<p style="margin-top:12px;color:#aaa;">Data recorded for <strong>${s.name}</strong>.</p>
<p style="margin-top:8px;color:#888;font-size:13px;">${n<5?`Complete ${5-n} more stories.`:n<8?'Extra credit: finish all 8!':'All scenarios complete!'}</p>
</div>`;
const btn=document.getElementById('action-btn');
if(n>=8){
btn.textContent='View Results';
btn.disabled=false;
btn.onclick=()=>showCompletion();
}else if(n>=5){
btn.textContent='Pick Another Story (Extra Credit)';
btn.disabled=false;
btn.onclick=()=>{state.currentScenario=null;state.currentStep=null;updateStepTabs();showDefaultCard();updateKeywords();renderScenarioList();};
}else{
btn.textContent='Pick Next Story';
btn.disabled=false;
btn.onclick=()=>{state.currentScenario=null;state.currentStep=null;updateStepTabs();showDefaultCard();updateKeywords();renderScenarioList();};
}
}

function addDataRow(s){
const tbody=document.getElementById('data-tbody');
const tr=document.createElement('tr');
tr.style.animation='fadeIn .4s';
tr.innerHTML=`<td><strong>${s.emoji} ${s.name}</strong></td><td>${s.dataRow.what}</td><td>${s.dataRow.response}</td><td>${s.dataRow.connection}</td>`;
tbody.appendChild(tr);
}

function updateHUD(){
document.getElementById('hud-score').textContent=state.score;
document.getElementById('hud-streak').textContent=state.streak;
document.getElementById('hud-completed').textContent=state.completed.size+'/8';
const acc=state.totalPredictions>0?Math.round(state.correctPredictions/state.totalPredictions*100)+'%':'--%';
document.getElementById('hud-accuracy').textContent=acc;
const pct=Math.min(100,state.completed.size/5*100);
document.getElementById('progress-fill').style.width=pct+'%';
const n=state.completed.size;
const msg=n===0?'Pick 5 stories you like!':n<5?`${5-n} more to go!`:n<8?'‚úÖ Required done! Extra credit?':'üåü All 8 complete!';
document.getElementById('progress-msg').textContent=msg;
document.getElementById('scenario-count').textContent=`${n} of 8 completed (5 required)`;
}

function showCompletion(){
const comp=document.getElementById('completion');
comp.classList.add('show');
if(state.completed.size>=8){
document.getElementById('extra-credit-badge').style.display='block';
document.getElementById('comp-msg').textContent='You completed all 8 scenarios!';
}
}

function setLevel(lv){
state.readingLevel=lv;
document.querySelectorAll('.rtab').forEach(t=>{t.classList.remove('active');if(t.dataset.level===lv)t.classList.add('active');});
if(state.currentStep==='read')showReadCard();
}

function resetAll(){
speechSynthesis.cancel();
state={currentScenario:null,currentStep:null,readingLevel:state.readingLevel,completed:new Set(),predictions:{},score:0,streak:0,totalPredictions:0,correctPredictions:0,started:true};
document.getElementById('data-tbody').innerHTML='';
document.getElementById('completion').classList.remove('show');
renderScenarioList();
updateHUD();
updateKeywords();
showDefaultCard();
}

function newRun(){
resetAll();
}

function copyTable(){
const rows=document.querySelectorAll('#data-table tr');
let text='Scenario\tWhat Happened?\tPerson/Situation Response\tConnection to Brain Development?\n';
rows.forEach((r,i)=>{if(i===0)return;const cells=r.querySelectorAll('td');if(cells.length)text+=Array.from(cells).map(c=>c.textContent.trim()).join('\t')+'\n';});
navigator.clipboard.writeText(text).then(()=>{
const btn=document.getElementById('copy-table-btn');
btn.textContent='‚úÖ Copied!';btn.style.color='#4CAF50';btn.style.borderColor='#4CAF50';
setTimeout(()=>{btn.textContent='üìã Copy Table';btn.style.color='#aaa';btn.style.borderColor='rgba(255,255,255,.15)';},2000);
}).catch(()=>{});
}

// Init keywords
updateKeywords();
</script>
</body>
</html>
