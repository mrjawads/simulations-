<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mr. Jawad Simulation Inherited vs. Acquired Traits</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',Arial,sans-serif;background:linear-gradient(135deg,#0f0c29,#302b63,#24243e);color:#fff;height:100vh;overflow:hidden;display:flex;flex-direction:column;}
h1.main-title{text-align:center;padding:8px 0 4px;font-size:18px;background:linear-gradient(90deg,#4CAF50,#2196F3,#9C27B0);-webkit-background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:1px;}
.app{display:flex;flex:1;overflow:hidden;}

/* LEFT SIDEBAR */
.left-sidebar{width:280px;min-width:280px;background:rgba(255,255,255,0.06);border-right:1px solid rgba(255,255,255,0.1);display:flex;flex-direction:column;overflow-y:auto;padding:10px;}
.left-sidebar h3{font-size:14px;color:#aaa;margin-bottom:8px;text-transform:uppercase;letter-spacing:1px;}
.scenario-card{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;cursor:pointer;transition:all .3s;margin-bottom:6px;background:rgba(255,255,255,0.05);border:2px solid transparent;}
.scenario-card:hover{background:rgba(255,255,255,0.12);transform:translateX(4px);}
.scenario-card.active{border-color:#7C4DFF;background:rgba(124,77,255,0.2);box-shadow:0 0 15px rgba(124,77,255,0.3);}
.scenario-card.completed{opacity:0.7;border-color:#4CAF50;}
.scenario-card.completed::after{content:'‚úì';position:absolute;right:10px;color:#4CAF50;font-weight:bold;}
.scenario-card{position:relative;}
.scenario-emoji{font-size:28px;}
.scenario-name{font-size:13px;font-weight:600;}
.divider{height:1px;background:rgba(255,255,255,0.1);margin:10px 0;}
.reading-level-section h4,.keywords-section h4{font-size:12px;color:#888;margin-bottom:6px;text-transform:uppercase;letter-spacing:1px;}
.level-tabs{display:flex;gap:4px;margin-bottom:8px;}
.level-tab{flex:1;padding:6px;text-align:center;border-radius:8px;cursor:pointer;font-size:12px;font-weight:600;background:rgba(255,255,255,0.08);border:2px solid transparent;transition:all .3s;}
.level-tab:hover{background:rgba(255,255,255,0.15);}
.level-tab.active{border-color:#FF9800;background:rgba(255,152,0,0.2);color:#FF9800;}
.keyword-tag{display:inline-block;padding:4px 10px;margin:3px;border-radius:12px;font-size:11px;background:rgba(255,255,255,0.08);color:#ccc;transition:all .3s;}
.keyword-tag.highlighted{background:rgba(76,175,80,0.3);color:#81C784;border:1px solid #4CAF50;}
.btn-reset{width:100%;padding:8px;border:none;border-radius:8px;font-weight:600;cursor:pointer;font-size:12px;margin-top:4px;transition:all .3s;}
.btn-reset:hover{transform:scale(1.02);}
.btn-danger{background:linear-gradient(135deg,#f44336,#c62828);color:#fff;}
.btn-primary{background:linear-gradient(135deg,#2196F3,#1565C0);color:#fff;}

/* CENTER PANEL */
.center-panel{flex:1;display:flex;flex-direction:column;overflow:hidden;padding:10px 16px;}
.step-tabs{display:flex;gap:4px;margin-bottom:10px;}
.step-tab{flex:1;padding:8px;text-align:center;border-radius:10px;font-size:13px;font-weight:600;background:rgba(255,255,255,0.05);color:#666;transition:all .3s;border:2px solid transparent;}
.step-tab.active{color:#fff;border-color:#7C4DFF;background:rgba(124,77,255,0.2);box-shadow:0 0 20px rgba(124,77,255,0.3);animation:glow 2s ease-in-out infinite alternate;}
.step-tab.done{color:#4CAF50;border-color:#4CAF50;background:rgba(76,175,80,0.1);}
@keyframes glow{from{box-shadow:0 0 10px rgba(124,77,255,0.2);}to{box-shadow:0 0 25px rgba(124,77,255,0.5);}}
.center-content{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;overflow-y:auto;}
.content-card{background:rgba(255,255,255,0.07);border-radius:16px;padding:24px;width:100%;max-width:700px;border:1px solid rgba(255,255,255,0.1);box-shadow:0 8px 32px rgba(0,0,0,0.3);}
.predict-section{text-align:center;}
.predict-question{font-size:18px;margin-bottom:20px;line-height:1.5;color:#e0e0e0;}
.predict-buttons{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;}
.predict-btn{padding:14px 28px;border:3px solid transparent;border-radius:14px;font-size:15px;font-weight:700;cursor:pointer;transition:all .3s;min-width:140px;}
.predict-btn:hover{transform:translateY(-3px);box-shadow:0 8px 20px rgba(0,0,0,0.3);}
.predict-btn.inherited{background:linear-gradient(135deg,#1565C0,#0D47A1);color:#fff;border-color:#1976D2;}
.predict-btn.both{background:linear-gradient(135deg,#7B1FA2,#4A148C);color:#fff;border-color:#9C27B0;}
.predict-btn.acquired{background:linear-gradient(135deg,#E65100,#BF360C);color:#fff;border-color:#F57C00;}
.predict-btn.selected{transform:scale(1.08);box-shadow:0 0 25px rgba(255,255,255,0.3);}

/* Reading passage */
.reading-card{background:rgba(255,255,255,0.95);color:#222;border-radius:16px;padding:20px 24px;font-size:17px;line-height:1.7;max-height:calc(100vh - 280px);overflow-y:auto;}
.reading-card b{color:#1565C0;}
.read-aloud-note{font-size:12px;color:#888;margin-top:10px;font-style:italic;}
.sentence-highlight{background:rgba(255,235,59,0.4);border-radius:4px;padding:1px 2px;transition:background .3s;}

/* Watch animation */
.watch-area{width:100%;min-height:320px;position:relative;display:flex;flex-direction:column;align-items:center;justify-content:center;}
.trait-meter{width:100%;max-width:600px;height:60px;border-radius:30px;background:linear-gradient(90deg,#1565C0 0%,#1565C0 30%,#7B1FA2 30%,#7B1FA2 70%,#E65100 70%,#E65100 100%);position:relative;box-shadow:0 4px 20px rgba(0,0,0,0.3);margin:10px 0;}
.meter-labels{display:flex;justify-content:space-between;width:100%;max-width:600px;padding:0 10px;margin-bottom:4px;}
.meter-labels span{font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:1px;}
.meter-labels .lbl-inherited{color:#64B5F6;}
.meter-labels .lbl-both{color:#CE93D8;}
.meter-labels .lbl-acquired{color:#FFB74D;}
.meter-arrow{position:absolute;top:-8px;width:20px;height:76px;transition:left 1.5s cubic-bezier(0.34,1.56,0.64,1);z-index:5;}
.meter-arrow-inner{width:20px;height:20px;border-radius:50%;position:absolute;top:20px;box-shadow:0 0 20px currentColor;border:3px solid #fff;}
.meter-arrow-stem{width:4px;height:30px;background:#fff;position:absolute;top:0;left:8px;border-radius:2px;}

/* Arena */
.arena-container{width:100%;max-width:650px;min-height:200px;background:rgba(0,0,0,0.2);border-radius:16px;padding:16px;margin:10px 0;position:relative;overflow:hidden;border:1px solid rgba(255,255,255,0.1);}
.arena-element{position:absolute;transition:all 1s ease;opacity:0;}
.arena-element.show{opacity:1;}
.arena-label{font-size:12px;font-weight:700;padding:3px 8px;border-radius:6px;background:rgba(0,0,0,0.6);color:#fff;white-space:nowrap;}

/* Record */
.record-msg{text-align:center;font-size:20px;padding:20px;}
.prediction-result{font-size:28px;font-weight:800;margin:10px 0;padding:12px 24px;border-radius:14px;display:inline-block;}
.prediction-result.match{background:linear-gradient(135deg,#4CAF50,#2E7D32);color:#fff;box-shadow:0 0 30px rgba(76,175,80,0.4);}
.prediction-result.miss{background:linear-gradient(135deg,#f44336,#c62828);color:#fff;box-shadow:0 0 30px rgba(244,67,54,0.4);}

/* Action button */
.action-area{padding:10px 0;text-align:center;}
.action-btn{padding:12px 32px;border:none;border-radius:12px;font-size:15px;font-weight:700;cursor:pointer;background:linear-gradient(135deg,#7C4DFF,#651FFF);color:#fff;transition:all .3s;box-shadow:0 4px 15px rgba(124,77,255,0.3);}
.action-btn:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(124,77,255,0.5);}
.action-btn:disabled{opacity:0.4;cursor:not-allowed;transform:none;}
.action-btn.read-aloud{background:linear-gradient(135deg,#FF9800,#F57C00);box-shadow:0 4px 15px rgba(255,152,0,0.3);margin-left:10px;}
.action-btn.read-aloud:hover{box-shadow:0 8px 25px rgba(255,152,0,0.5);}

/* RIGHT SIDEBAR */
.right-sidebar{width:280px;min-width:280px;background:rgba(255,255,255,0.06);border-left:1px solid rgba(255,255,255,0.1);display:flex;flex-direction:column;padding:10px;overflow-y:auto;}
.right-sidebar h3{font-size:14px;color:#aaa;margin-bottom:8px;text-transform:uppercase;letter-spacing:1px;}
.hud-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:10px;}
.hud-stat{background:rgba(255,255,255,0.08);border-radius:10px;padding:8px;text-align:center;}
.hud-stat .value{font-size:22px;font-weight:800;background:linear-gradient(135deg,#7C4DFF,#FF4081);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.hud-stat .label{font-size:10px;color:#888;text-transform:uppercase;margin-top:2px;}
.progress-bar-container{background:rgba(255,255,255,0.1);border-radius:8px;height:16px;margin-bottom:4px;overflow:hidden;}
.progress-bar-fill{height:100%;border-radius:8px;background:linear-gradient(90deg,#4CAF50,#8BC34A);transition:width .5s;width:0%;}
.progress-status{font-size:12px;color:#aaa;text-align:center;margin-bottom:8px;}
.copy-btn{padding:6px 12px;border:none;border-radius:8px;font-size:11px;font-weight:600;cursor:pointer;background:linear-gradient(135deg,#00BCD4,#00838F);color:#fff;margin-left:auto;transition:all .3s;}
.copy-btn:hover{transform:scale(1.05);}
.data-table-container{flex:1;overflow-y:auto;}
.data-table{width:100%;border-collapse:collapse;font-size:10px;}
.data-table th{background:rgba(124,77,255,0.3);padding:5px 4px;text-align:left;font-size:9px;text-transform:uppercase;letter-spacing:0.5px;position:sticky;top:0;}
.data-table td{padding:4px;border-bottom:1px solid rgba(255,255,255,0.05);font-size:10px;color:#ccc;vertical-align:top;}
.data-table tr:nth-child(even){background:rgba(255,255,255,0.03);}

/* Welcome screen */
.welcome-screen{text-align:center;padding:30px;}
.welcome-screen h2{font-size:26px;margin-bottom:12px;background:linear-gradient(135deg,#7C4DFF,#FF4081);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.welcome-screen p{color:#aaa;font-size:15px;line-height:1.6;max-width:500px;margin:0 auto;}
.welcome-screen .mission-badge{display:inline-block;margin-top:16px;padding:10px 20px;background:rgba(124,77,255,0.2);border:2px solid #7C4DFF;border-radius:12px;font-size:14px;color:#B388FF;}

/* Animations */
@keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
@keyframes pulse{0%,100%{transform:scale(1);}50%{transform:scale(1.05);}}
@keyframes slideIn{from{opacity:0;transform:translateX(-20px);}to{opacity:1;transform:translateX(0);}}
.fade-in{animation:fadeIn .5s ease;}
.pulse{animation:pulse 1.5s ease-in-out infinite;}

/* Scrollbar */
::-webkit-scrollbar{width:6px;}
::-webkit-scrollbar-track{background:transparent;}
::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.2);border-radius:3px;}

/* Split meter for scenarios 7 & 8 */
.split-meter-info{display:flex;gap:12px;justify-content:center;margin-top:8px;font-size:13px;font-weight:600;}
.split-meter-info span{padding:4px 12px;border-radius:8px;}
.split-inherited{background:rgba(21,101,192,0.3);color:#64B5F6;border:1px solid #1565C0;}
.split-acquired{background:rgba(230,81,0,0.3);color:#FFB74D;border:1px solid #E65100;}
</style>
</head>
<body>
<h1 class="main-title">Mr. Jawad Simulation ‚Äî Inherited vs. Acquired Traits</h1>
<div class="app">

<!-- LEFT SIDEBAR -->
<div class="left-sidebar">
<h3>Pick Any 5 You Like</h3>
<div id="scenario-list"></div>
<div class="divider"></div>
<div class="reading-level-section">
<h4>Reading Level</h4>
<div class="level-tabs">
<div class="level-tab active" data-level="low" onclick="setLevel('low')">Low</div>
<div class="level-tab" data-level="med" onclick="setLevel('med')">Med</div>
<div class="level-tab" data-level="high" onclick="setLevel('high')">High</div>
</div>
</div>
<div class="divider"></div>
<div class="keywords-section">
<h4>Key Words</h4>
<div id="keywords-container"></div>
</div>
<div style="flex:1;"></div>
<button class="btn-reset btn-danger" onclick="resetSim()">Reset</button>
<div style="height:4px;"></div>
<button class="btn-reset btn-primary" onclick="newRun()">New Run</button>
</div>

<!-- CENTER PANEL -->
<div class="center-panel">
<div class="step-tabs">
<div class="step-tab" id="steptab-1">1. PREDICT</div>
<div class="step-tab" id="steptab-2">2. READ</div>
<div class="step-tab" id="steptab-3">3. WATCH</div>
<div class="step-tab" id="steptab-4">4. RECORD</div>
</div>
<div class="center-content" id="center-content">
<div class="welcome-screen fade-in">
<h2>Born With It or Built It?</h2>
<p>Your DNA writes the starting code, but your life writes the rest. Investigate 8 real trait cases ‚Äî read the evidence, watch the science, and classify each one.</p>
<div class="mission-badge">Pick a scenario from the left to begin</div>
</div>
</div>
<div class="action-area" id="action-area"></div>
</div>

<!-- RIGHT SIDEBAR -->
<div class="right-sidebar">
<h3>Progress</h3>
<div class="hud-grid">
<div class="hud-stat"><div class="value" id="hud-score">0</div><div class="label">Score</div></div>
<div class="hud-stat"><div class="value" id="hud-streak">0</div><div class="label">Streak</div></div>
<div class="hud-stat"><div class="value" id="hud-completed">0/8</div><div class="label">Done</div></div>
<div class="hud-stat"><div class="value" id="hud-accuracy">0%</div><div class="label">Accuracy</div></div>
</div>
<div class="progress-bar-container"><div class="progress-bar-fill" id="progress-fill"></div></div>
<div class="progress-status" id="progress-status">Pick 5 more you like!</div>
<div class="divider"></div>
<div style="display:flex;align-items:center;margin-bottom:6px;">
<h3 style="margin:0;">Data Table</h3>
<button class="copy-btn" id="copy-btn" onclick="copyTable()">üìã Copy Table</button>
</div>
<div class="data-table-container">
<table class="data-table">
<thead><tr><th>Scenario</th><th>What Changed?</th><th>System Response</th><th>Match?</th></tr></thead>
<tbody id="data-tbody"></tbody>
</table>
</div>
</div>

</div>

<script>
// ============ DATA ============
const scenarios = [
{id:1,name:"Speed Gene",emoji:"üèÉ",classification:"inherited",
change:"ACTN3 gene gives one runner more fast-twitch muscle fibers",
response:"Inherited ‚Äî DNA controls muscle fiber type",
keywordsUsed:["gene","genotype","phenotype","inherited trait","DNA"],
readings:{
low:{text:'Two teenage runners train the same hours every week. One always wins the sprint. Scientists found a <b>gene</b> called ACTN3 that builds fast-twitch muscle fibers ‚Äî the kind that fire for speed. If your <b>genotype</b> has two copies of ACTN3, your <b>phenotype</b> is explosive power ‚Äî an <b>inherited trait</b>.'},
med:{text:'Two teenage runners train side by side, same drills, same hours. One always pulls ahead in the sprint. Scientists discovered a <b>gene</b> called ACTN3 that controls whether your muscles build fast-twitch fibers ‚Äî the fibers that fire for explosive speed. About 18% of people worldwide are missing the protein this <b>gene</b> makes. Zero Olympic sprinters have two missing copies. If your <b>genotype</b> includes working ACTN3, your <b>phenotype</b> is raw sprinting power ‚Äî a clear <b>inherited trait</b> coded in your <b>DNA</b>.'},
high:{text:'Two teenage runners train side by side ‚Äî same drills, same coach, same hours. One always pulls ahead in the sprint. The other dominates the long run. Scientists discovered a <b>gene</b> called ACTN3 that controls muscle fiber type. If your <b>genotype</b> has two working copies, your muscles build more fast-twitch fibers ‚Äî the kind that fire for explosive speed. If you have two missing copies, your muscles lean toward slow-twitch ‚Äî better for endurance. About 18% of people are missing this protein entirely, and zero Olympic sprinters have two missing copies. Training matters, but your starting point is an <b>inherited trait</b> written in your <b>DNA</b> ‚Äî your <b>phenotype</b> for speed begins with your <b>genotype</b>.'}
},
watchAnim:{type:'single',zone:'inherited',
desc:'Muscle fibers with ACTN3 gene highlighted'}
},
{id:2,name:"Twins Diverge",emoji:"üëØ",classification:"acquired",
change:"Different habits changed which genes were active in identical twins",
response:"Acquired ‚Äî environment changed gene activity, not DNA",
keywordsUsed:["DNA","genes","genotype","phenotype","acquired trait","inherited trait"],
readings:{
low:{text:'Twin sisters share the exact same <b>DNA</b>. By age 50, one has diabetes and the other does not. Scientists found that their different diets and habits changed which <b>genes</b> were switched on or off inside their bodies. Same <b>genotype</b>, different <b>phenotype</b> ‚Äî the diabetes was an <b>acquired trait</b>, not an <b>inherited trait</b>.'},
med:{text:'Twin sisters start life with the exact same <b>DNA</b> ‚Äî same <b>genotype</b> for everything. Scientists studied them for decades. By age 50, one sister had diabetes and the other did not. Their different diets, exercise habits, and stress levels changed which <b>genes</b> were switched on or off inside their cells. The diabetes was not locked in their <b>DNA</b> ‚Äî it was an <b>acquired trait</b> shaped by environment. Same starting code, different <b>phenotype</b>.'},
high:{text:'Twin sisters are born with the exact same <b>DNA</b> ‚Äî the same <b>genotype</b> for every single <b>gene</b>. Scientists followed 80 pairs of identical twins over many years. Young twins were nearly impossible to tell apart genetically. But by age 50, 35% of twin pairs showed major differences in which <b>genes</b> were active. One sister ate processed food and rarely exercised. The other stayed active and ate whole foods. The first sister developed diabetes ‚Äî the second did not. Same <b>genotype</b>, different <b>phenotype</b>: the diabetes was an <b>acquired trait</b> driven by environment, not an <b>inherited trait</b> locked in <b>DNA</b>.'}
},
watchAnim:{type:'single',zone:'acquired',
desc:'Twin bodies with gene switches ON/OFF'}
},
{id:3,name:"Born Flexible",emoji:"ü§∏",classification:"inherited",
change:"Flexibility is 79% determined by genetics",
response:"Inherited ‚Äî genes control joint and ligament structure",
keywordsUsed:["genes","genotype","inherited trait","phenotype","DNA"],
readings:{
low:{text:'Some people stretch every day and barely get more flexible. A study of twins found that flexibility is 79% determined by your <b>genes</b>. Your <b>genotype</b> sets how loose or tight your joints are from birth. Flexibility is mostly an <b>inherited trait</b> ‚Äî your <b>phenotype</b> for bendiness starts in your <b>DNA</b>.'},
med:{text:'Some people stretch every single day and barely improve their range. Others can touch their toes without ever practicing. A study of twins found that flexibility is 79% determined by <b>genes</b> ‚Äî the most heritable fitness trait tested. Your <b>genotype</b> controls how your joints, ligaments, and tendons are built from birth. Training can push flexibility slightly further, but the starting point is an <b>inherited trait</b>. Your <b>phenotype</b> for bendiness is mostly written in your <b>DNA</b>.'},
high:{text:'Some people stretch every single day and barely improve. Others can touch their toes without ever training. Scientists studied twins to find out why. They tested 15 different fitness traits across dozens of twin pairs. Flexibility scored 79% heritable ‚Äî the highest of any fitness trait in the study. Your <b>genotype</b> determines how your joints, ligaments, and tendons are structured from birth. Shared environment like neighborhood and income had almost no effect ‚Äî only personal choices like injuries and training made a small difference. Flexibility is overwhelmingly an <b>inherited trait</b>, and your <b>phenotype</b> for range of motion starts in your <b>DNA</b> before you ever stretch.'}
},
watchAnim:{type:'single',zone:'inherited',
desc:'Joint diagram with 79% genetic label'}
},
{id:4,name:"Hating Broccoli",emoji:"ü•¶",classification:"inherited",
change:"TAS2R38 gene controls bitter taste sensitivity",
response:"Inherited ‚Äî DNA determines taste bud density",
keywordsUsed:["gene","genotype","phenotype","inherited trait","DNA"],
readings:{
low:{text:'About 25% of people are "supertasters" ‚Äî they have way more taste buds than average. A <b>gene</b> called TAS2R38 controls how strongly you taste bitter flavors. If your <b>genotype</b> includes the sensitive version, your <b>phenotype</b> is hating broccoli, kale, and coffee. This is an <b>inherited trait</b> coded in your <b>DNA</b>, not picky eating.'},
med:{text:'About 25% of people are "supertasters." They have far more taste buds than the average person, and bitter flavors hit them like a punch. A <b>gene</b> called TAS2R38 determines how intensely you taste bitter compounds in foods like broccoli, kale, and dark coffee. If your <b>genotype</b> has the sensitive version of this <b>gene</b>, your <b>phenotype</b> is an extreme reaction to bitterness. Scientists tested this by putting a bitter chemical on people\'s tongues ‚Äî supertasters gagged while others tasted almost nothing. Hating broccoli is an <b>inherited trait</b> locked in your <b>DNA</b>, not a bad attitude about vegetables.'},
high:{text:'About 25% of people are "supertasters" ‚Äî and they are not being dramatic. They have significantly more taste buds packed onto their tongues than the average person. A <b>gene</b> called TAS2R38 controls how strongly you detect bitter compounds. If your <b>genotype</b> includes the highly sensitive version, bitter foods like broccoli, kale, and dark coffee taste overwhelmingly harsh. Scientists confirmed this by placing a bitter chemical called PROP on volunteers\' tongues. Supertasters gagged or spat it out. Non-tasters barely noticed a flavor. Your <b>phenotype</b> for taste intensity is an <b>inherited trait</b> ‚Äî it is written in your <b>DNA</b>, passed down through your family, and no amount of "just try it" changes the <b>gene</b> you carry.'}
},
watchAnim:{type:'single',zone:'inherited',
desc:'Tongue with taste buds and TAS2R38 gene'}
},
{id:5,name:"Guitar Calluses",emoji:"üé∏",classification:"acquired",
change:"Calluses form from repeated pressure, not from genes",
response:"Acquired ‚Äî body changed but DNA never did",
keywordsUsed:["gene","acquired trait","phenotype","genotype","DNA"],
readings:{
low:{text:'A professional guitar player has thick calluses on their fingertips from years of practice. If they have a child, that child is born with soft, smooth fingers. Calluses form because the skin responds to repeated pressure ‚Äî not a <b>gene</b>. This is a classic <b>acquired trait</b> ‚Äî the body changed, but the <b>DNA</b> never did.'},
med:{text:'A professional guitar player has thick, tough calluses from thousands of hours pressing steel strings into skin. Now imagine that player has a child. The child is born with perfectly soft, smooth fingers ‚Äî no calluses at all. The repeated pressure changed the parent\'s skin, but that change never entered their <b>DNA</b>. Calluses are an <b>acquired trait</b> ‚Äî the <b>phenotype</b> changed because of the environment, not <b>genotype</b>. No <b>acquired trait</b> passes to the next generation.'},
high:{text:'A professional guitar player has thick, tough calluses on every fingertip. Those calluses took years of pressing steel strings into skin ‚Äî the body\'s response to repeated friction and pressure. Now imagine the player has a child. That child is born with perfectly soft, smooth fingers. No matter how many calluses the parent built, the child starts from zero. The reason is simple: calluses are an <b>acquired trait</b>. The environment changed the parent\'s <b>phenotype</b>, but that change never rewrote their <b>DNA</b> or their <b>genotype</b>. Only <b>inherited traits</b> ‚Äî the ones coded in your <b>genes</b> ‚Äî can travel from parent to child. An <b>acquired trait</b> dies with the person who built it.'}
},
watchAnim:{type:'single',zone:'acquired',
desc:'Hand with callus layers building, baby hand smooth'}
},
{id:6,name:"Left-Handed?",emoji:"‚úã",classification:"both",
change:"Handedness is 25% genetic and 75% environment",
response:"Both ‚Äî DNA sets a lean, environment finishes it",
keywordsUsed:["DNA","genotype","phenotype","inherited trait","acquired trait","gene","allele"],
readings:{
low:{text:'About 10% of people are left-handed, and it often runs in families. But identical twins ‚Äî same <b>DNA</b> ‚Äî sometimes differ, with one twin left-handed and the other right-handed. Scientists believe handedness is about 25% <b>inherited trait</b> and 75% shaped by environment, including conditions before birth. This <b>phenotype</b> is a mix of both.'},
med:{text:'About 10% of the world is left-handed, and the trait clearly runs in families. Left-handed parents are more likely to have left-handed kids. But here is the twist: identical twins share the exact same <b>genotype</b>, yet sometimes one is left-handed and the other is right-handed. Scientists estimate handedness is about 25% genetic and 75% shaped by environment ‚Äî including conditions in the womb before birth. This <b>phenotype</b> does not fit neatly into one box. Handedness is both an <b>inherited trait</b> and an <b>acquired trait</b> ‚Äî <b>DNA</b> sets a lean, but environment finishes the job.'},
high:{text:'About 10% of people worldwide are left-handed, and the trait clearly runs in families. Left-handed parents are significantly more likely to have left-handed children. So it seems genetic ‚Äî until you look at identical twins. They share the exact same <b>genotype</b> ‚Äî every <b>gene</b>, every <b>allele</b>. Yet sometimes one twin is left-handed and the other is not. Scientists studied this puzzle and estimated that handedness is roughly 25% determined by <b>genes</b> and 75% shaped by environment, including conditions in the womb before birth. This <b>phenotype</b> does not belong in a single category. Handedness is both an <b>inherited trait</b> and an <b>acquired trait</b> ‚Äî your <b>DNA</b> creates a starting lean, but your environment and early development finish writing the code.'}
},
watchAnim:{type:'single',zone:'both',
desc:'Two figures writing with different hands, pie chart'}
},
{id:7,name:"Colorblind Artist",emoji:"üé®",classification:"both-split",
change:"Colorblindness is inherited; art skill is acquired",
response:"Both ‚Äî colorblindness from DNA, art from practice",
keywordsUsed:["genes","inherited trait","acquired trait","genotype","phenotype","DNA"],
readings:{
low:{text:'A person is born completely colorblind ‚Äî their <b>genes</b> do not make the proteins needed to see color. This is an <b>inherited trait</b> they can pass to their children. But that same person learns the rules of which colors go together and becomes a successful artist. The artistic skill is an <b>acquired trait</b> ‚Äî built through practice, not <b>DNA</b>.'},
med:{text:'A person is born with complete color blindness. The <b>genes</b> that build color-detecting proteins in the eye carry a change ‚Äî the proteins do not work. This is an <b>inherited trait</b>: it is coded in their <b>genotype</b>, and they can pass it along through their <b>DNA</b>. But here is what is interesting. That same person spends years learning the rules of color ‚Äî which shades contrast, which combinations work. They become a successful artist. The color blindness is <b>inherited</b>; the artistic talent is an <b>acquired trait</b> built entirely through practice.'},
high:{text:'A person is born with complete color blindness ‚Äî a condition coded in their <b>DNA</b>. The <b>genes</b> responsible for building color-detecting proteins in the retina carry a change that stops the proteins from working. Their <b>genotype</b> determines this <b>phenotype</b>, and they will always carry the possibility of passing it to their children. It is an <b>inherited trait</b> with no cure. But that same person decides to study art. They memorize which colors contrast, which combinations create mood, and which palettes work for different styles. After years of practice, they become a successful professional artist. The artistic skill is an <b>acquired trait</b> ‚Äî built entirely by environment and effort, impossible to pass through <b>DNA</b>. One person, two traits: one inherited, one acquired.'}
},
watchAnim:{type:'split',zones:['inherited','acquired'],
labels:['Colorblindness','Art Skill'],
desc:'Eye with broken receptors + paintbrush building painting'}
},
{id:8,name:"Sunburn vs. Skin",emoji:"‚òÄÔ∏è",classification:"both-split",
change:"Skin color from melanin genes; sunburn from UV exposure",
response:"Both ‚Äî skin color inherited, sunburn acquired",
keywordsUsed:["genes","inherited trait","acquired trait","genotype","phenotype","DNA"],
readings:{
low:{text:'Your baseline skin color is controlled by <b>genes</b> that determine how much melanin your body makes. That is an <b>inherited trait</b> ‚Äî parents pass it to their children through <b>DNA</b>. A sunburn is the opposite. It is your skin\'s temporary reaction to UV light ‚Äî an <b>acquired trait</b> that fades.'},
med:{text:'Your baseline skin color is determined by <b>genes</b> that control melanin production in your cells. The amount and type of melanin in your skin is an <b>inherited trait</b> ‚Äî your <b>genotype</b> sets the starting <b>phenotype</b>, and parents pass these <b>genes</b> to children through <b>DNA</b>. Now think about a sunburn. It is your skin\'s emergency response to too much UV light. The redness, the peeling, the pain ‚Äî all temporary. A sunburn is an <b>acquired trait</b>: the environment changed your skin temporarily, but the change never enters your <b>DNA</b> and can never be passed to your children.'},
high:{text:'Your baseline skin color is an <b>inherited trait</b>. <b>Genes</b> control how much melanin your cells produce ‚Äî and melanin determines how dark or light your skin appears. Your <b>genotype</b> for melanin production sets the starting <b>phenotype</b>, and these <b>genes</b> travel from parent to child through <b>DNA</b>. The key test for any trait is simple: can you pass it to your children? Skin color <b>genes</b>: yes. Now consider a sunburn. UV light damages your skin cells, triggering redness, swelling, and peeling. That response is temporary ‚Äî your body repairs the damage and the burn fades. A sunburn is an <b>acquired trait</b>: the environment changed your <b>phenotype</b> temporarily, but the change never rewrote your <b>genotype</b>. You will never pass a sunburn to your children.'}
},
watchAnim:{type:'split',zones:['inherited','acquired'],
labels:['Skin Color','Sunburn'],
desc:'Skin cross-section with melanin and UV damage'}
}
];

const allKeywords = ["genotype","phenotype","acquired trait","inherited trait","DNA","gene","allele"];

// ============ STATE ============
let state = {
currentScenario: null,
currentStep: null, // null, 'predict', 'read', 'watch', 'record'
prediction: null,
readingLevel: 'low',
completedScenarios: new Set(),
score: 0,
streak: 0,
correctCount: 0,
totalAttempts: 0,
dataRows: []
};

// ============ INIT ============
function init() {
renderScenarioCards();
renderKeywords([]);
updateHUD();
}

function renderScenarioCards() {
const container = document.getElementById('scenario-list');
container.innerHTML = '';
scenarios.forEach(s => {
const card = document.createElement('div');
card.className = 'scenario-card' + (state.completedScenarios.has(s.id) ? ' completed' : '') + (state.currentScenario && state.currentScenario.id === s.id ? ' active' : '');
card.innerHTML = `<span class="scenario-emoji">${s.emoji}</span><span class="scenario-name">${s.name}</span>`;
card.onclick = () => selectScenario(s);
container.appendChild(card);
});
}

function renderKeywords(highlighted) {
const container = document.getElementById('keywords-container');
container.innerHTML = '';
allKeywords.forEach(kw => {
const tag = document.createElement('span');
tag.className = 'keyword-tag' + (highlighted.includes(kw) ? ' highlighted' : '');
tag.textContent = kw;
container.appendChild(tag);
});
}

function setLevel(level) {
state.readingLevel = level;
document.querySelectorAll('.level-tab').forEach(t => t.classList.toggle('active', t.dataset.level === level));
// If currently in read step, refresh the passage
if (state.currentStep === 'read' && state.currentScenario) {
showReadStep();
}
}

// ============ SCENARIO SELECTION ============
function selectScenario(s) {
if (state.currentStep === 'watch') return; // Don't interrupt animation
if (state.completedScenarios.has(s.id) && state.currentStep !== null) return;
state.currentScenario = s;
state.prediction = null;
state.currentStep = 'predict';
renderScenarioCards();
renderKeywords(s.keywordsUsed);
updateStepTabs();
showPredictStep();
}

// ============ STEP TABS ============
function updateStepTabs() {
const steps = ['predict','read','watch','record'];
const stepNum = steps.indexOf(state.currentStep) + 1;
for (let i = 1; i <= 4; i++) {
const tab = document.getElementById('steptab-' + i);
tab.classList.remove('active','done');
if (i === stepNum) tab.classList.add('active');
else if (i < stepNum) tab.classList.add('done');
}
}

// ============ PREDICT STEP ============
function showPredictStep() {
const center = document.getElementById('center-content');
center.innerHTML = `
<div class="content-card predict-section fade-in">
<div class="predict-question">What type of trait is this?<br><strong style="color:#B388FF;">${state.currentScenario.emoji} ${state.currentScenario.name}</strong></div>
<div class="predict-buttons">
<button class="predict-btn inherited" onclick="makePrediction('inherited')">üß¨ Inherited</button>
<button class="predict-btn both" onclick="makePrediction('both')">üîÄ Both</button>
<button class="predict-btn acquired" onclick="makePrediction('acquired')">üèãÔ∏è Acquired</button>
</div>
</div>`;
document.getElementById('action-area').innerHTML = '';
}

function makePrediction(pred) {
state.prediction = pred;
document.querySelectorAll('.predict-btn').forEach(b => b.classList.remove('selected'));
event.target.classList.add('selected');
// Show next button
document.getElementById('action-area').innerHTML = `<button class="action-btn" onclick="goToRead()">Next ‚Üí Read the Evidence</button>`;
}

// ============ READ STEP ============
function goToRead() {
state.currentStep = 'read';
updateStepTabs();
showReadStep();
}

function showReadStep() {
const s = state.currentScenario;
const levelKey = state.readingLevel === 'med' ? 'med' : state.readingLevel === 'high' ? 'high' : 'low';
const text = s.readings[levelKey].text;
const center = document.getElementById('center-content');
center.innerHTML = `
<div class="content-card fade-in">
<div class="reading-card" id="reading-passage">${text}</div>
<div class="read-aloud-note">Read Aloud: Tap the speaker to hear this read.</div>
</div>`;
document.getElementById('action-area').innerHTML = `
<button class="action-btn" onclick="goToWatch()">Next ‚Üí Watch the Science</button>
<button class="action-btn read-aloud" id="read-aloud-btn" onclick="readAloud()">üîä Read Aloud</button>`;
}

// ============ READ ALOUD ============
let speechResumeInterval = null;
function readAloud() {
try {
if (!('speechSynthesis' in window)) {
document.getElementById('read-aloud-btn').textContent = 'Text Only';
return;
}
window.speechSynthesis.cancel();
if (speechResumeInterval) clearInterval(speechResumeInterval);

const passage = document.getElementById('reading-passage');
if (!passage) return;
const plainText = passage.innerText;
const sentences = plainText.match(/[^.!?]+[.!?]+/g) || [plainText];

let idx = 0;
function speakNext() {
if (idx >= sentences.length) {
if (speechResumeInterval) clearInterval(speechResumeInterval);
return;
}
const utt = new SpeechSynthesisUtterance(sentences[idx].trim());
utt.rate = 0.9;
utt.onend = () => { idx++; speakNext(); };
utt.onerror = () => { idx++; speakNext(); };
window.speechSynthesis.speak(utt);
}
speakNext();
// Chrome 15-second bug workaround
speechResumeInterval = setInterval(() => {
try { if (window.speechSynthesis.speaking) window.speechSynthesis.resume(); } catch(e){}
}, 10000);
} catch(e) {
document.getElementById('read-aloud-btn').textContent = 'Text Only';
}
}

// ============ WATCH STEP ============
function goToWatch() {
try { window.speechSynthesis.cancel(); } catch(e){}
if (speechResumeInterval) clearInterval(speechResumeInterval);
state.currentStep = 'watch';
updateStepTabs();
showWatchStep();
}

function showWatchStep() {
const s = state.currentScenario;
const center = document.getElementById('center-content');
const isSplit = s.watchAnim.type === 'split';

let meterHTML = '';
if (isSplit) {
meterHTML = `
<div class="meter-labels"><span class="lbl-inherited">Inherited</span><span class="lbl-both">Both</span><span class="lbl-acquired">Acquired</span></div>
<div class="trait-meter" id="trait-meter">
<div class="meter-arrow" id="meter-arrow-1" style="left:15%;opacity:0;">
<div class="meter-arrow-stem"></div>
<div class="meter-arrow-inner" style="background:#1565C0;color:#1565C0;"></div>
</div>
<div class="meter-arrow" id="meter-arrow-2" style="left:85%;opacity:0;">
<div class="meter-arrow-stem"></div>
<div class="meter-arrow-inner" style="background:#E65100;color:#E65100;"></div>
</div>
</div>
<div class="split-meter-info">
<span class="split-inherited">üß¨ ${s.watchAnim.labels[0]}</span>
<span class="split-acquired">üèãÔ∏è ${s.watchAnim.labels[1]}</span>
</div>`;
} else {
const zonePos = s.watchAnim.zone === 'inherited' ? '15%' : s.watchAnim.zone === 'both' ? '50%' : '85%';
const zoneColor = s.watchAnim.zone === 'inherited' ? '#1565C0' : s.watchAnim.zone === 'both' ? '#7B1FA2' : '#E65100';
meterHTML = `
<div class="meter-labels"><span class="lbl-inherited">Inherited</span><span class="lbl-both">Both</span><span class="lbl-acquired">Acquired</span></div>
<div class="trait-meter" id="trait-meter">
<div class="meter-arrow" id="meter-arrow-1" style="left:50%;opacity:0;">
<div class="meter-arrow-stem"></div>
<div class="meter-arrow-inner" style="background:${zoneColor};color:${zoneColor};"></div>
</div>
</div>`;
}

center.innerHTML = `
<div class="watch-area fade-in">
${meterHTML}
<div class="arena-container" id="arena">
<canvas id="arena-canvas" width="616" height="200"></canvas>
</div>
</div>`;
document.getElementById('action-area').innerHTML = '';

// Animate after brief delay
setTimeout(() => animateWatch(s), 400);
}

function animateWatch(s) {
try {
const isSplit = s.watchAnim.type === 'split';
// Animate meter arrow(s)
if (isSplit) {
const arrow1 = document.getElementById('meter-arrow-1');
const arrow2 = document.getElementById('meter-arrow-2');
if (arrow1) { arrow1.style.opacity = '1'; arrow1.style.left = '15%'; }
setTimeout(() => { if (arrow2) { arrow2.style.opacity = '1'; arrow2.style.left = '85%'; }}, 600);
} else {
const arrow = document.getElementById('meter-arrow-1');
const zonePos = s.watchAnim.zone === 'inherited' ? '15%' : s.watchAnim.zone === 'both' ? '50%' : '85%';
if (arrow) { arrow.style.opacity = '1'; arrow.style.left = zonePos; }
}
// Draw arena visualization
drawArena(s);
// Auto-advance to RECORD after animation
setTimeout(() => goToRecord(), 4500);
} catch(e) {
setTimeout(() => goToRecord(), 3000);
}
}

function drawArena(s) {
try {
const canvas = document.getElementById('arena-canvas');
if (!canvas) return;
const ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;
ctx.clearRect(0, 0, W, H);

// Draw scenario-specific arena based on scenario id
switch(s.id) {
case 1: drawSpeedGene(ctx, W, H); break;
case 2: drawTwinsDiverge(ctx, W, H); break;
case 3: drawBornFlexible(ctx, W, H); break;
case 4: drawHatingBroccoli(ctx, W, H); break;
case 5: drawGuitarCalluses(ctx, W, H); break;
case 6: drawLeftHanded(ctx, W, H); break;
case 7: drawColorblindArtist(ctx, W, H); break;
case 8: drawSunburnSkin(ctx, W, H); break;
}
} catch(e) {}
}

// Arena drawing functions
function drawSpeedGene(ctx, W, H) {
// Muscle fiber diagram
const cx = W/2, cy = H/2;
// DNA strand
drawDNAHelix(ctx, cx - 180, 30, 80, 60);
// Label
ctx.font = 'bold 11px Segoe UI'; ctx.fillStyle = '#FFD54F';
ctx.fillText('ACTN3 Gene', cx - 195, 100);
// Fast-twitch fibers
for (let i = 0; i < 8; i++) {
let x = cx + 20 + (i % 4) * 40, y = 30 + Math.floor(i / 4) * 50;
let grd = ctx.createLinearGradient(x, y, x, y + 40);
grd.addColorStop(0, '#f44336'); grd.addColorStop(1, '#b71c1c');
ctx.fillStyle = grd;
roundRect(ctx, x, y, 30, 40, 6); ctx.fill();
// Pulse glow
ctx.shadowColor = '#f44336'; ctx.shadowBlur = 12;
roundRect(ctx, x, y, 30, 40, 6); ctx.fill();
ctx.shadowBlur = 0;
}
ctx.font = 'bold 12px Segoe UI'; ctx.fillStyle = '#EF9A9A';
ctx.fillText('Fast-Twitch Fibers', cx + 30, H - 20);
// Arrow
ctx.strokeStyle = '#FFD54F'; ctx.lineWidth = 2;
drawArrow(ctx, cx - 100, 60, cx + 15, 50);
ctx.font = 'bold 13px Segoe UI'; ctx.fillStyle = '#81D4FA';
ctx.fillText('Inherited ‚Äî DNA Controls It', cx - 80, H - 5);
}

function drawTwinsDiverge(ctx, W, H) {
// Two body silhouettes
drawBodySilhouette(ctx, W * 0.25, 20, 60, 120, '#4CAF50', '‚ô• Healthy');
drawBodySilhouette(ctx, W * 0.65, 20, 60, 120, '#FF9800', '‚ö† Diabetes');
// Gene switches
ctx.font = 'bold 11px Segoe UI';
for (let i = 0; i < 3; i++) {
ctx.fillStyle = '#4CAF50'; ctx.fillText('ON', W * 0.25 + 70, 50 + i * 30);
ctx.fillStyle = '#f44336'; ctx.fillText('OFF', W * 0.65 + 70, 50 + i * 30);
}
// Shared DNA label
ctx.fillStyle = '#CE93D8'; ctx.font = 'bold 13px Segoe UI';
ctx.textAlign = 'center'; ctx.fillText('Same DNA ‚Äî Different Outcome', W / 2, H - 10);
ctx.textAlign = 'left';
}

function drawBornFlexible(ctx, W, H) {
// Joint diagram with percentage bar
const barX = 50, barY = 40, barW = W - 100, barH = 30;
// 79% genetic
let grd = ctx.createLinearGradient(barX, barY, barX + barW * 0.79, barY);
grd.addColorStop(0, '#1565C0'); grd.addColorStop(1, '#42A5F5');
ctx.fillStyle = grd;
roundRect(ctx, barX, barY, barW * 0.79, barH, 6); ctx.fill();
// 21% training
ctx.fillStyle = '#FF9800';
roundRect(ctx, barX + barW * 0.79, barY, barW * 0.21, barH, 6); ctx.fill();
// Labels
ctx.font = 'bold 12px Segoe UI'; ctx.fillStyle = '#fff';
ctx.fillText('79% Genetic', barX + 10, barY + 20);
ctx.fillStyle = '#fff';
ctx.fillText('21%', barX + barW * 0.82, barY + 20);
// Stick figures
drawStickFigure(ctx, W * 0.3, 100, '#42A5F5', true);
drawStickFigure(ctx, W * 0.65, 100, '#FF9800', false);
ctx.font = 'bold 11px Segoe UI';
ctx.fillStyle = '#64B5F6'; ctx.fillText('Bends Easy', W * 0.22, H - 10);
ctx.fillStyle = '#FFB74D'; ctx.fillText('Strains', W * 0.60, H - 10);
}

function drawHatingBroccoli(ctx, W, H) {
// Tongue diagram split
const midX = W / 2;
// Left half ‚Äî supertaster
ctx.fillStyle = '#FFCDD2';
ctx.beginPath(); ctx.ellipse(midX - 80, H / 2, 70, 80, 0, 0, Math.PI * 2); ctx.fill();
// Dense taste buds
for (let i = 0; i < 30; i++) {
ctx.fillStyle = '#f44336';
ctx.beginPath();
ctx.arc(midX - 80 + (Math.random() - 0.5) * 100, H / 2 + (Math.random() - 0.5) * 120, 4, 0, Math.PI * 2);
ctx.fill();
}
ctx.font = 'bold 11px Segoe UI'; ctx.fillStyle = '#f44336';
ctx.fillText('Supertaster', midX - 110, H - 15);
// Right half ‚Äî normal
ctx.fillStyle = '#FFCDD2';
ctx.beginPath(); ctx.ellipse(midX + 100, H / 2, 70, 80, 0, 0, Math.PI * 2); ctx.fill();
for (let i = 0; i < 10; i++) {
ctx.fillStyle = '#BDBDBD';
ctx.beginPath();
ctx.arc(midX + 100 + (Math.random() - 0.5) * 100, H / 2 + (Math.random() - 0.5) * 120, 3, 0, Math.PI * 2);
ctx.fill();
}
ctx.font = 'bold 11px Segoe UI'; ctx.fillStyle = '#9E9E9E';
ctx.fillText('Non-taster', midX + 75, H - 15);
// DNA label
ctx.fillStyle = '#FFD54F'; ctx.font = 'bold 12px Segoe UI';
ctx.textAlign = 'center'; ctx.fillText('TAS2R38 Gene ‚Üí 25% are Supertasters', W / 2, 20);
ctx.textAlign = 'left';
}

function drawGuitarCalluses(ctx, W, H) {
// Parent hand with calluses
drawHand(ctx, W * 0.2, 30, 100, 130, '#FFCC80', true);
ctx.font = 'bold 11px Segoe UI'; ctx.fillStyle = '#FF9800';
ctx.fillText('Parent: Thick Calluses', W * 0.12, H - 10);
// Arrow with X
ctx.strokeStyle = '#f44336'; ctx.lineWidth = 3;
drawArrow(ctx, W * 0.42, H / 2, W * 0.55, H / 2);
ctx.font = 'bold 20px Segoe UI'; ctx.fillStyle = '#f44336';
ctx.fillText('‚úó', W * 0.47, H / 2 - 10);
ctx.font = 'bold 10px Segoe UI'; ctx.fillStyle = '#EF9A9A';
ctx.fillText('Cannot Pass', W * 0.44, H / 2 + 20);
// Baby hand
drawHand(ctx, W * 0.6, 30, 80, 100, '#FFECB3', false);
ctx.font = 'bold 11px Segoe UI'; ctx.fillStyle = '#81D4FA';
ctx.fillText('Child: Soft Fingers', W * 0.58, H - 10);
// Label
ctx.fillStyle = '#FFB74D'; ctx.font = 'bold 12px Segoe UI';
ctx.textAlign = 'center'; ctx.fillText('Acquired ‚Äî Not in DNA', W / 2, 20);
ctx.textAlign = 'left';
}

function drawLeftHanded(ctx, W, H) {
// Two figures writing differently
drawStickFigure(ctx, W * 0.25, 40, '#42A5F5', true);
drawStickFigure(ctx, W * 0.6, 40, '#FF9800', true);
ctx.font = 'bold 11px Segoe UI';
ctx.fillStyle = '#64B5F6'; ctx.fillText('Left Hand ‚úã', W * 0.17, 35);
ctx.fillStyle = '#FFB74D'; ctx.fillText('Right Hand ‚úã', W * 0.53, 35);
// Pie chart
const pieX = W * 0.85, pieY = H * 0.5, pieR = 40;
ctx.fillStyle = '#1565C0';
ctx.beginPath(); ctx.moveTo(pieX, pieY); ctx.arc(pieX, pieY, pieR, -Math.PI/2, -Math.PI/2 + Math.PI * 0.5); ctx.closePath(); ctx.fill();
ctx.fillStyle = '#FF9800';
ctx.beginPath(); ctx.moveTo(pieX, pieY); ctx.arc(pieX, pieY, pieR, -Math.PI/2 + Math.PI * 0.5, -Math.PI/2 + Math.PI * 2); ctx.closePath(); ctx.fill();
ctx.font = 'bold 10px Segoe UI'; ctx.fillStyle = '#fff';
ctx.fillText('25%', pieX - 14, pieY - 10);
ctx.fillText('75%', pieX - 14, pieY + 20);
ctx.fillStyle = '#CE93D8'; ctx.font = 'bold 12px Segoe UI';
ctx.textAlign = 'center'; ctx.fillText('Same DNA, Different Hands', W * 0.45, H - 8);
ctx.textAlign = 'left';
}

function drawColorblindArtist(ctx, W, H) {
// Eye with broken receptors
ctx.fillStyle = '#fff';
ctx.beginPath(); ctx.ellipse(W * 0.25, H * 0.45, 50, 35, 0, 0, Math.PI * 2); ctx.fill();
ctx.fillStyle = '#888';
ctx.beginPath(); ctx.arc(W * 0.25, H * 0.45, 15, 0, Math.PI * 2); ctx.fill();
// X marks for broken receptors
ctx.font = 'bold 14px Segoe UI'; ctx.fillStyle = '#f44336';
ctx.fillText('‚úó', W * 0.20, H * 0.45 + 25); ctx.fillText('‚úó', W * 0.26, H * 0.45 + 25); ctx.fillText('‚úó', W * 0.32, H * 0.45 + 25);
ctx.font = 'bold 11px Segoe UI'; ctx.fillStyle = '#64B5F6';
ctx.fillText('Inherited', W * 0.15, H - 15);

// Paintbrush + canvas
ctx.fillStyle = '#FFF9C4';
roundRect(ctx, W * 0.55, 20, 140, 130, 8); ctx.fill();
// Paint strokes
const colors = ['#f44336','#2196F3','#4CAF50','#FF9800','#9C27B0'];
colors.forEach((c, i) => {
ctx.fillStyle = c;
ctx.fillRect(W * 0.58 + i * 25, 40 + i * 15, 30, 8);
});
ctx.font = 'bold 11px Segoe UI'; ctx.fillStyle = '#FFB74D';
ctx.fillText('Acquired ‚Äî Practice', W * 0.55, H - 15);
// Center label
ctx.fillStyle = '#CE93D8'; ctx.font = 'bold 12px Segoe UI';
ctx.textAlign = 'center'; ctx.fillText('One Person, Two Trait Types', W / 2, H - 0);
ctx.textAlign = 'left';
}

function drawSunburnSkin(ctx, W, H) {
// Skin cross-section
const skinY = 50;
// Melanin layer (lower)
let grd = ctx.createLinearGradient(50, skinY + 60, 50, skinY + 120);
grd.addColorStop(0, '#8D6E63'); grd.addColorStop(1, '#5D4037');
ctx.fillStyle = grd;
roundRect(ctx, 50, skinY + 60, 200, 60, 0); ctx.fill();
// Melanin dots
for (let i = 0; i < 15; i++) {
ctx.fillStyle = '#3E2723';
ctx.beginPath(); ctx.arc(70 + Math.random() * 160, skinY + 75 + Math.random() * 30, 5, 0, Math.PI * 2); ctx.fill();
}
ctx.font = 'bold 11px Segoe UI'; ctx.fillStyle = '#64B5F6';
ctx.fillText('Inherited ‚Äî Melanin', 60, skinY + H * 0.1);
// DNA connection
drawDNAHelix(ctx, 100, skinY + 130, 50, 30);

// Sunburn layer (right)
grd = ctx.createLinearGradient(350, skinY, 350, skinY + 60);
grd.addColorStop(0, '#ef5350'); grd.addColorStop(1, '#FFCDD2');
ctx.fillStyle = grd;
roundRect(ctx, 350, skinY, 200, 60, 0); ctx.fill();
// UV rays
ctx.strokeStyle = '#FFD54F'; ctx.lineWidth = 2;
for (let i = 0; i < 5; i++) {
ctx.beginPath(); ctx.moveTo(380 + i * 35, skinY - 20); ctx.lineTo(390 + i * 35, skinY); ctx.stroke();
}
ctx.font = 'bold 11px Segoe UI'; ctx.fillStyle = '#FFB74D';
ctx.fillText('Acquired ‚Äî Temporary', 360, skinY + H * 0.1);
// X ‚Äî not in DNA
ctx.font = 'bold 14px Segoe UI'; ctx.fillStyle = '#f44336';
ctx.fillText('‚úó Not in DNA', 390, skinY + 100);
}

// ============ HELPER DRAWING FUNCTIONS ============
function roundRect(ctx, x, y, w, h, r) {
ctx.beginPath();
ctx.moveTo(x + r, y);
ctx.lineTo(x + w - r, y);
ctx.quadraticCurveTo(x + w, y, x + w, y + r);
ctx.lineTo(x + w, y + h - r);
ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
ctx.lineTo(x + r, y + h);
ctx.quadraticCurveTo(x, y + h, x, y + h - r);
ctx.lineTo(x, y + r);
ctx.quadraticCurveTo(x, y, x + r, y);
ctx.closePath();
}

function drawArrow(ctx, x1, y1, x2, y2) {
ctx.beginPath(); ctx.moveTo(x1, y1); ctx.lineTo(x2, y2); ctx.stroke();
const angle = Math.atan2(y2 - y1, x2 - x1);
ctx.beginPath();
ctx.moveTo(x2, y2);
ctx.lineTo(x2 - 10 * Math.cos(angle - 0.4), y2 - 10 * Math.sin(angle - 0.4));
ctx.lineTo(x2 - 10 * Math.cos(angle + 0.4), y2 - 10 * Math.sin(angle + 0.4));
ctx.closePath(); ctx.fillStyle = ctx.strokeStyle; ctx.fill();
}

function drawDNAHelix(ctx, x, y, w, h) {
ctx.strokeStyle = '#7C4DFF'; ctx.lineWidth = 2;
for (let i = 0; i < w; i += 2) {
const t = i / w * Math.PI * 3;
ctx.fillStyle = '#7C4DFF';
ctx.beginPath(); ctx.arc(x + i, y + h/2 + Math.sin(t) * h/3, 2, 0, Math.PI * 2); ctx.fill();
ctx.fillStyle = '#FF4081';
ctx.beginPath(); ctx.arc(x + i, y + h/2 - Math.sin(t) * h/3, 2, 0, Math.PI * 2); ctx.fill();
}
}

function drawBodySilhouette(ctx, x, y, w, h, color, label) {
ctx.fillStyle = color;
// Head
ctx.beginPath(); ctx.arc(x + w/2, y + 15, 15, 0, Math.PI * 2); ctx.fill();
// Body
roundRect(ctx, x + 5, y + 35, w - 10, h - 60, 8); ctx.fill();
// Label
ctx.font = 'bold 11px Segoe UI'; ctx.fillStyle = color;
ctx.fillText(label, x, y + h + 5);
}

function drawStickFigure(ctx, x, y, color, bending) {
ctx.strokeStyle = color; ctx.lineWidth = 3;
// Head
ctx.beginPath(); ctx.arc(x, y + 15, 12, 0, Math.PI * 2); ctx.stroke();
// Body
ctx.beginPath(); ctx.moveTo(x, y + 27); ctx.lineTo(x, y + 70); ctx.stroke();
// Arms
ctx.beginPath(); ctx.moveTo(x - 20, y + 40); ctx.lineTo(x + 20, y + 40); ctx.stroke();
// Legs
if (bending) {
ctx.beginPath(); ctx.moveTo(x, y + 70); ctx.lineTo(x - 15, y + 100); ctx.stroke();
ctx.beginPath(); ctx.moveTo(x, y + 70); ctx.lineTo(x + 15, y + 100); ctx.stroke();
} else {
ctx.beginPath(); ctx.moveTo(x, y + 70); ctx.lineTo(x - 10, y + 100); ctx.stroke();
ctx.beginPath(); ctx.moveTo(x, y + 70); ctx.lineTo(x + 10, y + 100); ctx.stroke();
}
}

function drawHand(ctx, x, y, w, h, color, hasCalluses) {
ctx.fillStyle = color;
roundRect(ctx, x, y, w, h, 12); ctx.fill();
// Fingers
for (let i = 0; i < 4; i++) {
ctx.fillStyle = color;
roundRect(ctx, x + 10 + i * 22, y - 25, 16, 30, 6); ctx.fill();
if (hasCalluses) {
ctx.fillStyle = '#A1887F';
roundRect(ctx, x + 10 + i * 22, y - 25, 16, 8, 4); ctx.fill();
}
}
}

// ============ RECORD STEP ============
function goToRecord() {
state.currentStep = 'record';
updateStepTabs();

const s = state.currentScenario;
const actualClass = s.classification.startsWith('both') ? 'both' : s.classification;
const predicted = state.prediction;
const isMatch = predicted === actualClass;

state.totalAttempts++;
if (isMatch) {
state.correctCount++;
state.score += 10;
state.streak++;
} else {
state.streak = 0;
}
state.completedScenarios.add(s.id);

// Add data row
state.dataRows.push({
scenario: s.name,
whatChanged: s.change,
response: s.response,
match: isMatch ? 'Yes' : 'No'
});

updateHUD();
renderScenarioCards();
renderDataTable();

const center = document.getElementById('center-content');
const completedCount = state.completedScenarios.size;
let extraMsg = '';
if (completedCount === 5) extraMsg = '<div style="margin-top:12px;color:#FFD54F;font-size:16px;">Required Complete! Continue for Extra Credit?</div>';
else if (completedCount === 8) extraMsg = '<div style="margin-top:12px;color:#FFD54F;font-size:18px;font-weight:800;">üèÜ Extra Credit Complete! üèÜ</div>';

center.innerHTML = `
<div class="content-card record-msg fade-in">
<div style="font-size:40px;margin-bottom:8px;">${s.emoji}</div>
<div style="font-size:16px;color:#aaa;margin-bottom:10px;">${s.name}</div>
<div class="prediction-result ${isMatch ? 'match' : 'miss'}">${isMatch ? '‚úì Prediction Matched!' : '‚úó Prediction Missed'}</div>
<div style="margin-top:12px;font-size:14px;color:#ccc;">
You predicted: <strong>${capitalize(predicted)}</strong><br>
Actual: <strong>${capitalize(actualClass)}</strong>
</div>
<div style="margin-top:8px;font-size:13px;color:#999;">Data recorded in your table ‚Üí</div>
${extraMsg}
</div>`;
document.getElementById('action-area').innerHTML = completedCount < 8 ? '<div style="font-size:14px;color:#aaa;">Pick your next scenario from the left sidebar</div>' : '<div style="font-size:14px;color:#4CAF50;font-weight:600;">All scenarios complete! Great work!</div>';
state.currentStep = null;
}

function capitalize(s) { return s ? s.charAt(0).toUpperCase() + s.slice(1) : ''; }

// ============ HUD ============
function updateHUD() {
document.getElementById('hud-score').textContent = state.score;
document.getElementById('hud-streak').textContent = state.streak;
const completed = state.completedScenarios.size;
document.getElementById('hud-completed').textContent = completed + '/8';
const accuracy = state.totalAttempts > 0 ? Math.round(state.correctCount / state.totalAttempts * 100) : 0;
document.getElementById('hud-accuracy').textContent = accuracy + '%';
const pct = Math.min(completed / 5 * 100, 100);
document.getElementById('progress-fill').style.width = pct + '%';
const remaining = Math.max(5 - completed, 0);
if (completed >= 8) {
document.getElementById('progress-status').textContent = 'All 8 done! Extra Credit Complete!';
document.getElementById('progress-fill').style.background = 'linear-gradient(90deg,#FFD54F,#FF9800)';
} else if (completed >= 5) {
document.getElementById('progress-status').textContent = 'Required done! ' + (8 - completed) + ' more for extra credit';
document.getElementById('progress-fill').style.background = 'linear-gradient(90deg,#4CAF50,#FFD54F)';
} else {
document.getElementById('progress-status').textContent = 'Pick ' + remaining + ' more you like!';
}
}

// ============ DATA TABLE ============
function renderDataTable() {
const tbody = document.getElementById('data-tbody');
tbody.innerHTML = '';
state.dataRows.forEach(row => {
const tr = document.createElement('tr');
tr.innerHTML = `<td>${row.scenario}</td><td>${row.whatChanged}</td><td>${row.response}</td><td style="color:${row.match === 'Yes' ? '#4CAF50' : '#f44336'};font-weight:bold;">${row.match}</td>`;
tbody.appendChild(tr);
});
}

function copyTable() {
try {
let text = 'Scenario\tWhat Changed?\tSystem Response\tPrediction Match?\n';
state.dataRows.forEach(row => {
text += `${row.scenario}\t${row.whatChanged}\t${row.response}\t${row.match}\n`;
});
navigator.clipboard.writeText(text).then(() => {
const btn = document.getElementById('copy-btn');
btn.textContent = '‚úì Copied!';
setTimeout(() => { btn.textContent = 'üìã Copy Table'; }, 2000);
});
} catch(e) {
// Fallback
const ta = document.createElement('textarea');
let text = 'Scenario\tWhat Changed?\tSystem Response\tPrediction Match?\n';
state.dataRows.forEach(row => { text += `${row.scenario}\t${row.whatChanged}\t${row.response}\t${row.match}\n`; });
ta.value = text; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
const btn = document.getElementById('copy-btn');
btn.textContent = '‚úì Copied!';
setTimeout(() => { btn.textContent = 'üìã Copy Table'; }, 2000);
}
}

// ============ RESET / NEW RUN ============
function resetSim() {
try { window.speechSynthesis.cancel(); } catch(e){}
if (speechResumeInterval) clearInterval(speechResumeInterval);
state = { currentScenario:null, currentStep:null, prediction:null, readingLevel:state.readingLevel, completedScenarios:new Set(), score:0, streak:0, correctCount:0, totalAttempts:0, dataRows:[] };
renderScenarioCards();
renderKeywords([]);
updateHUD();
renderDataTable();
document.getElementById('center-content').innerHTML = `
<div class="welcome-screen fade-in">
<h2>Born With It or Built It?</h2>
<p>Your DNA writes the starting code, but your life writes the rest. Investigate 8 real trait cases ‚Äî read the evidence, watch the science, and classify each one.</p>
<div class="mission-badge">Pick a scenario from the left to begin</div>
</div>`;
document.getElementById('action-area').innerHTML = '';
for (let i = 1; i <= 4; i++) {
document.getElementById('steptab-' + i).classList.remove('active','done');
}
}

function newRun() { resetSim(); }

// ============ START ============
init();
</script>
</body>
</html>
