<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Science Department Simulation ‚Äî Extreme Lungs</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',system-ui,-apple-system,sans-serif;background:#0a1628;color:#e0e0e0;overflow:hidden;height:100vh;}
.app{display:grid;grid-template-columns:280px 1fr 280px;grid-template-rows:auto 1fr;height:100vh;}
.top-bar{grid-column:1/-1;background:linear-gradient(135deg,#0d2137,#1a3a5c);padding:8px 20px;display:flex;align-items:center;justify-content:space-between;border-bottom:2px solid #00bcd4;box-shadow:0 2px 12px rgba(0,188,212,0.3);}
.top-bar h1{font-size:17px;color:#fff;text-shadow:0 0 10px rgba(0,188,212,0.5);}
.top-bar h1 span{color:#00e5ff;}
.top-bar .mission{font-size:12px;color:#80cbc4;max-width:500px;text-align:center;}
.top-bar .btns{display:flex;gap:8px;}
.top-bar .btns button{padding:6px 14px;border:none;border-radius:6px;font-size:12px;font-weight:700;cursor:pointer;transition:all 0.2s;}
.btn-reset{background:#e53935;color:#fff;}.btn-reset:hover{background:#c62828;}
.btn-new{background:#1e88e5;color:#fff;}.btn-new:hover{background:#1565c0;}
.left{background:linear-gradient(180deg,#0d1f33,#132d4a);padding:10px;overflow-y:auto;border-right:1px solid #1a3a5c;}
.left h3{font-size:13px;color:#00e5ff;margin-bottom:8px;text-transform:uppercase;letter-spacing:1px;}
.left .pick-label{font-size:11px;color:#80cbc4;margin-bottom:6px;}
.scenario-card{padding:8px 10px;margin-bottom:4px;border-radius:8px;cursor:pointer;transition:all 0.25s;display:flex;align-items:center;gap:8px;font-size:13px;border:1px solid transparent;position:relative;}
.scenario-card:hover{background:rgba(0,188,212,0.1);border-color:rgba(0,188,212,0.3);}
.scenario-card.active{background:linear-gradient(135deg,rgba(0,188,212,0.2),rgba(0,188,212,0.05));border-color:#00bcd4;box-shadow:0 0 8px rgba(0,188,212,0.2);}
.scenario-card.done{opacity:0.7;}.scenario-card.done::after{content:'‚úì';position:absolute;right:8px;color:#4caf50;font-weight:700;}
.scenario-card .sc-emoji{font-size:20px;}.scenario-card .sc-name{color:#e0e0e0;}
.divider{height:1px;background:linear-gradient(90deg,transparent,#1a3a5c,transparent);margin:10px 0;}
.reading-lvl{display:flex;gap:4px;margin-bottom:10px;}
.rl-btn{flex:1;padding:6px;border:1px solid #1a3a5c;background:transparent;color:#80cbc4;border-radius:6px;font-size:11px;font-weight:700;cursor:pointer;transition:all 0.2s;text-align:center;}
.rl-btn.active{background:#00bcd4;color:#fff;border-color:#00bcd4;box-shadow:0 0 8px rgba(0,188,212,0.4);}
.kw-section{margin-top:6px;}
.kw-section h4{font-size:11px;color:#ffab40;margin-bottom:4px;text-transform:uppercase;}
.kw-tag{display:inline-block;padding:2px 8px;margin:2px;border-radius:4px;font-size:11px;background:rgba(255,171,64,0.1);color:#ffcc80;border:1px solid rgba(255,171,64,0.2);}
.center{display:flex;flex-direction:column;overflow:hidden;background:radial-gradient(ellipse at center,#0f2940,#0a1628);}
.step-tabs{display:flex;padding:8px 16px;gap:4px;background:rgba(0,0,0,0.3);}
.step-tab{flex:1;text-align:center;padding:8px;border-radius:8px;font-size:12px;font-weight:700;color:#546e7a;background:rgba(255,255,255,0.03);transition:all 0.3s;text-transform:uppercase;letter-spacing:1px;}
.step-tab.current{color:#fff;background:linear-gradient(135deg,#00bcd4,#0097a7);box-shadow:0 0 15px rgba(0,188,212,0.4);animation:glow 2s ease-in-out infinite alternate;}
.step-tab.completed{color:#4caf50;background:rgba(76,175,80,0.1);}
@keyframes glow{0%{box-shadow:0 0 10px rgba(0,188,212,0.3);}100%{box-shadow:0 0 20px rgba(0,188,212,0.6);}}
.center-content{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:12px;position:relative;overflow:hidden;}
.card{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);border-radius:16px;padding:24px;max-width:700px;width:100%;box-shadow:0 8px 32px rgba(0,0,0,0.3);backdrop-filter:blur(10px);animation:fadeIn 0.4s ease;}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
.card h2{font-size:20px;color:#00e5ff;margin-bottom:12px;text-align:center;}
.card p{font-size:14px;line-height:1.6;color:#cfd8dc;}
.card .keyword{color:#ffab40;font-weight:700;}
.predict-options{display:flex;flex-direction:column;gap:8px;margin-top:12px;}
.predict-group{margin-bottom:8px;}
.predict-group label{display:block;font-size:12px;color:#80cbc4;margin-bottom:4px;text-transform:uppercase;}
.pred-btns{display:flex;gap:6px;}
.pred-btn{padding:8px 16px;border:1px solid #1a3a5c;background:rgba(255,255,255,0.03);color:#cfd8dc;border-radius:8px;cursor:pointer;font-size:13px;transition:all 0.2s;}
.pred-btn:hover{border-color:#00bcd4;background:rgba(0,188,212,0.1);}
.pred-btn.selected{background:#00bcd4;color:#fff;border-color:#00bcd4;}
.action-area{display:flex;justify-content:center;gap:10px;padding:10px;margin-top:auto;}
.action-btn{padding:10px 28px;border:none;border-radius:10px;font-size:14px;font-weight:700;cursor:pointer;transition:all 0.25s;text-transform:uppercase;letter-spacing:1px;}
.action-btn.primary{background:linear-gradient(135deg,#00bcd4,#0097a7);color:#fff;box-shadow:0 4px 15px rgba(0,188,212,0.4);}
.action-btn.primary:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,188,212,0.6);}
.action-btn.primary:disabled{opacity:0.4;cursor:not-allowed;transform:none;}
.action-btn.read-aloud{background:linear-gradient(135deg,#7c4dff,#651fff);color:#fff;box-shadow:0 4px 15px rgba(124,77,255,0.3);}
.action-btn.read-aloud:hover{transform:translateY(-2px);}
.welcome-card{text-align:center;}
.welcome-card .big-emoji{font-size:64px;margin-bottom:12px;}
.welcome-card h2{font-size:24px;margin-bottom:8px;}
.welcome-card p{font-size:14px;color:#80cbc4;}
.reading-card{max-height:380px;overflow-y:auto;}
.reading-card::-webkit-scrollbar{width:6px;}
.reading-card::-webkit-scrollbar-track{background:transparent;}
.reading-card::-webkit-scrollbar-thumb{background:#1a3a5c;border-radius:3px;}
.read-sentence{transition:background 0.3s;}
.read-sentence.highlight{background:rgba(0,188,212,0.15);border-radius:4px;padding:1px 2px;}
.watch-wrapper{width:100%;max-width:720px;animation:fadeIn 0.4s ease;}
.watch-title{text-align:center;font-size:18px;color:#00e5ff;margin-bottom:8px;font-weight:700;}
.meter-section{margin-bottom:8px;}
.meter-labels{display:flex;justify-content:space-between;padding:0 8px;font-size:10px;text-transform:uppercase;letter-spacing:1px;margin-bottom:3px;}
.meter-labels span:first-child{color:#e53935;}.meter-labels span:nth-child(2){color:#4caf50;}.meter-labels span:last-child{color:#ff9800;}
.lung-meter{position:relative;height:36px;background:linear-gradient(90deg,#c62828 0%,#e53935 20%,#66bb6a 35%,#4caf50 50%,#66bb6a 65%,#ff9800 80%,#f57c00 100%);border-radius:18px;overflow:visible;box-shadow:inset 0 2px 6px rgba(0,0,0,0.4),0 0 12px rgba(0,0,0,0.3);}
.needle{position:absolute;top:-6px;width:5px;height:48px;background:#fff;border-radius:3px;transition:left 1.8s cubic-bezier(0.4,0,0.2,1);box-shadow:0 0 12px rgba(255,255,255,0.9);z-index:2;}
.needle::after{content:'‚ñº';position:absolute;top:-18px;left:50%;transform:translateX(-50%);font-size:14px;color:#fff;text-shadow:0 0 6px rgba(255,255,255,0.8);}
.scene-canvas-wrap{position:relative;width:100%;height:320px;background:linear-gradient(180deg,rgba(13,33,55,0.9),rgba(10,22,40,0.95));border-radius:16px;border:1px solid rgba(0,188,212,0.15);overflow:hidden;box-shadow:inset 0 0 40px rgba(0,0,0,0.4);}
.scene-canvas-wrap canvas{display:block;width:100%;height:100%;}
.phase-label{position:absolute;bottom:0;left:0;right:0;text-align:center;font-size:14px;font-weight:700;color:#fff;text-shadow:0 2px 8px rgba(0,0,0,0.8);padding:6px 16px;background:linear-gradient(transparent,rgba(0,0,0,0.7));transition:opacity 0.5s;}
.phase-label .sub{display:block;font-size:11px;font-weight:400;color:#80cbc4;margin-top:2px;}
.complete-card{text-align:center;}
.complete-card .big-emoji{font-size:48px;margin-bottom:8px;}
.right{background:linear-gradient(180deg,#0d1f33,#132d4a);padding:10px;overflow-y:auto;border-left:1px solid #1a3a5c;}
.right h3{font-size:13px;color:#00e5ff;margin-bottom:8px;text-transform:uppercase;letter-spacing:1px;}
.hud-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:12px;}
.hud-box{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);border-radius:8px;padding:8px;text-align:center;}
.hud-box .hud-val{font-size:22px;font-weight:800;color:#00e5ff;}
.hud-box .hud-label{font-size:10px;color:#80cbc4;text-transform:uppercase;margin-top:2px;}
.progress-bar-wrap{background:rgba(255,255,255,0.06);border-radius:10px;height:16px;overflow:hidden;margin-bottom:4px;}
.progress-bar-fill{height:100%;background:linear-gradient(90deg,#00bcd4,#4caf50);border-radius:10px;transition:width 0.6s ease;box-shadow:0 0 10px rgba(0,188,212,0.4);}
.progress-msg{font-size:11px;color:#80cbc4;text-align:center;margin-bottom:10px;}
.data-table-wrap{margin-top:6px;}
.data-table{width:100%;border-collapse:collapse;font-size:10px;}
.data-table th{background:#00838f;color:#fff;padding:4px 3px;text-align:left;font-size:9px;text-transform:uppercase;}
.data-table td{padding:4px 3px;border-bottom:1px solid rgba(255,255,255,0.06);color:#b0bec5;font-size:10px;word-break:break-word;}
.data-table tr:nth-child(even){background:rgba(255,255,255,0.02);}
.extra-badge{display:inline-block;background:linear-gradient(135deg,#ff6f00,#f57c00);color:#fff;font-size:10px;font-weight:700;padding:2px 8px;border-radius:4px;margin-top:4px;animation:pulse 1.5s ease-in-out infinite;}
@keyframes pulse{0%,100%{transform:scale(1);}50%{transform:scale(1.05);}}
.left::-webkit-scrollbar,.right::-webkit-scrollbar{width:5px;}
.left::-webkit-scrollbar-track,.right::-webkit-scrollbar-track{background:transparent;}
.left::-webkit-scrollbar-thumb,.right::-webkit-scrollbar-thumb{background:#1a3a5c;border-radius:3px;}
.done-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.85);display:flex;align-items:center;justify-content:center;z-index:100;animation:fadeIn 0.5s ease;}
.done-box{background:linear-gradient(135deg,#0d2137,#1a3a5c);border:2px solid #00bcd4;border-radius:20px;padding:40px;text-align:center;max-width:500px;box-shadow:0 0 40px rgba(0,188,212,0.3);}
.done-box .big-emoji{font-size:72px;margin-bottom:16px;}
.done-box h2{font-size:28px;color:#00e5ff;margin-bottom:8px;}
.done-box p{color:#80cbc4;font-size:14px;margin-bottom:16px;}
.done-box button{padding:10px 24px;border:none;border-radius:8px;font-size:14px;font-weight:700;cursor:pointer;background:#00bcd4;color:#fff;}
.hidden{display:none !important;}
</style>
</head>
<body>
<div class="app">
<div class="top-bar">
<h1>ü´Å Science Department Simulation ‚Äî <span>Extreme Lungs</span></h1>
<div class="mission">Your lungs process 2,000+ gallons of air daily ‚Äî what happens when conditions get extreme?</div>
<div class="btns"><button class="btn-reset" onclick="resetSim()">Reset</button><button class="btn-new" onclick="newRun()">New Run</button></div>
</div>
<div class="left">
<h3>üî¨ Explore</h3>
<div class="pick-label" id="pickLabel">Pick any 5 you like!</div>
<div id="scenarioList"></div>
<div class="divider"></div>
<h3>üìñ Reading Level</h3>
<div class="reading-lvl">
<button class="rl-btn active" onclick="setLevel('low',this)">Low</button>
<button class="rl-btn" onclick="setLevel('med',this)">Med</button>
<button class="rl-btn" onclick="setLevel('high',this)">High</button>
</div>
<div class="divider"></div>
<div class="kw-section"><h4>Key Words</h4><div id="keyWords"></div></div>
</div>
<div class="center">
<div class="step-tabs">
<div class="step-tab" id="tab1">1. Predict</div>
<div class="step-tab" id="tab2">2. Read</div>
<div class="step-tab" id="tab3">3. Watch</div>
<div class="step-tab" id="tab4">4. Record</div>
</div>
<div class="center-content" id="centerContent"></div>
<div class="action-area" id="actionArea"></div>
</div>
<div class="right">
<h3>üìä Progress</h3>
<div class="hud-grid">
<div class="hud-box"><div class="hud-val" id="hudScore">0</div><div class="hud-label">Score</div></div>
<div class="hud-box"><div class="hud-val" id="hudStreak">0</div><div class="hud-label">Streak</div></div>
<div class="hud-box"><div class="hud-val" id="hudDone">0/8</div><div class="hud-label">Done</div></div>
<div class="hud-box"><div class="hud-val" id="hudAcc">‚Äî</div><div class="hud-label">Accuracy</div></div>
</div>
<div class="progress-bar-wrap"><div class="progress-bar-fill" id="progBar" style="width:0%"></div></div>
<div class="progress-msg" id="progMsg">Complete 5 to finish!</div>
<div class="divider"></div>
<h3>üìã Data Table</h3>
<div class="data-table-wrap">
<table class="data-table"><thead><tr><th>Scenario</th><th>What Changed?</th><th>System Response</th><th>Back to OK?</th></tr></thead><tbody id="dataBody"></tbody></table>
</div>
</div>
</div>
<div class="done-overlay hidden" id="doneOverlay">
<div class="done-box"><div class="big-emoji">üèÜ</div><h2 id="doneTitle"></h2><p id="doneMsg"></p><button onclick="closeDone()">Continue</button></div>
</div>
<script>
const S=[
{id:0,name:"Deep Water Dive",emoji:"ü§ø",change:"Extreme pressure crushes lungs to 1/5 size",response:"Body shifts blood into chest to protect lungs",backOk:"Yes ‚Äî blood shift kept lungs safe",ms:48,mm:80,me:55,
low:`Free divers swim more than 100 meters deep on just one breath. The water <span class="keyword">pressure</span> crushes their lungs to one-fifth of their normal <span class="keyword">lung capacity</span>. Their body responds with an <span class="keyword">adaptation</span> ‚Äî it shifts blood into the chest to protect the lungs. Scientists once said humans could not dive past 40 meters, but divers proved them wrong.`,
med:`Free divers descend more than 100 meters underwater without an air tank ‚Äî on just one breath. As they go deeper, the water <span class="keyword">pressure</span> increases and compresses the lungs to a fraction of their normal <span class="keyword">lung capacity</span>. The <span class="keyword">alveoli</span> get squeezed tightly together, and very little <span class="keyword">oxygen</span> remains inside. The body responds with an incredible <span class="keyword">adaptation</span> ‚Äî it shifts blood from the arms and legs into the chest to cushion the lungs. This blood shift keeps the <span class="keyword">alveoli</span> from collapsing under the extreme <span class="keyword">pressure</span>. In a record-setting dive, a free diver reached about 214 meters on a single breath.`,
high:`Free divers descend more than 100 meters underwater without any air tank ‚Äî relying on a single breath. As the diver goes deeper, the water <span class="keyword">pressure</span> increases dramatically with every meter. At just 10 meters, <span class="keyword">lung capacity</span> is already cut in half. By 40 meters, the lungs are compressed to one-fifth their normal size, and the <span class="keyword">alveoli</span> are squeezed tightly together. Scientists once believed the <span class="keyword">pressure</span> at those depths would destroy human lungs. But the body has a remarkable <span class="keyword">adaptation</span> ‚Äî it shifts blood from the limbs into the chest cavity to cushion the lung tissue. This blood shift prevents the <span class="keyword">alveoli</span> from collapsing and allows <span class="keyword">gas exchange</span> to continue even at extreme depths. In a record-setting dive, a free diver reached about 214 meters ‚Äî over 700 feet down ‚Äî on one breath.`,
pc:{meter:"pushed",dots:"decrease"}},
{id:1,name:"First Breath",emoji:"üë∂",change:"Fluid-filled lungs switch to air in seconds",response:"First cry forces fluid out, air rushes into alveoli",backOk:"Yes ‚Äî lungs start gas exchange immediately",ms:48,mm:15,me:48,
low:`Inside the womb, a baby's lungs are filled with fluid, not air. When the baby is born, its first cry forces the fluid out and pulls air into the <span class="keyword">alveoli</span> for the first time. This moment starts <span class="keyword">gas exchange</span> ‚Äî <span class="keyword">oxygen</span> enters the blood and <span class="keyword">carbon dioxide</span> exits. Newborns only have about half the <span class="keyword">alveoli</span> they will have as adults.`,
med:`Before birth, a baby's lungs are completely filled with fluid ‚Äî they have never taken a breath. The baby gets all its <span class="keyword">oxygen</span> through the mother's blood, so <span class="keyword">gas exchange</span> in the lungs has never happened. At the moment of birth, the baby's first cry creates enough <span class="keyword">pressure</span> to force the fluid out of the lungs. Air rushes into the <span class="keyword">alveoli</span> for the first time, and <span class="keyword">gas exchange</span> begins. This is one of the most dramatic <span class="keyword">adaptations</span> in the human body ‚Äî switching from fluid to air in seconds. Newborns only have 30 to 50 percent of the <span class="keyword">alveoli</span> they will have as adults, because lungs keep growing for years.`,
high:`Inside the womb, a baby's lungs are completely filled with fluid ‚Äî they have never held a single breath of air. During pregnancy, the baby receives all its <span class="keyword">oxygen</span> through the mother's blood supply, so <span class="keyword">gas exchange</span> in the lungs has never occurred. At the moment of birth, everything changes in seconds. The baby's first cry creates a burst of <span class="keyword">pressure</span> that forces fluid out of the airways. Air rushes into the <span class="keyword">alveoli</span> for the very first time, and <span class="keyword">gas exchange</span> begins immediately. <span class="keyword">Oxygen</span> flows into the blood while <span class="keyword">carbon dioxide</span> flows out ‚Äî the lungs are officially working. This instant switch from fluid to air is one of the most dramatic <span class="keyword">adaptations</span> in human biology. Remarkably, newborns start life with only 30 to 50 percent of the <span class="keyword">alveoli</span> they will develop as adults ‚Äî their <span class="keyword">lung capacity</span> keeps growing for years.`,
pc:{meter:"stressed",dots:"increase"}},
{id:2,name:"Olympic Athlete",emoji:"üèÖ",change:"Elite training demands maximum oxygen delivery",response:"Lung capacity nearly double; gas exchange more efficient",backOk:"Yes ‚Äî enhanced beyond normal",ms:48,mm:72,me:72,
low:`Olympic rower Pete Reed won three gold medals. Doctors tested his <span class="keyword">lung capacity</span> and measured 11.68 liters ‚Äî almost double the average adult's 6 liters. His lungs could deliver more <span class="keyword">oxygen</span> to his muscles with every breath. Training improved how efficiently his lungs performed <span class="keyword">gas exchange</span>, even though lung size is mostly genetic.`,
med:`British rower Pete Reed competed in three Olympic Games and won three gold medals. When doctors measured his <span class="keyword">lung capacity</span>, they found it was 11.68 liters ‚Äî nearly double the average adult's 6 liters. This massive <span class="keyword">lung capacity</span> meant his <span class="keyword">alveoli</span> could take in far more <span class="keyword">oxygen</span> per breath than a normal person. His years of intense training improved how efficiently his lungs performed <span class="keyword">gas exchange</span>. However, scientists note that actual lung size is mostly determined by genetics ‚Äî training cannot grow bigger lungs. The <span class="keyword">adaptation</span> from training is mostly about efficiency, not size.`,
high:`British rower Pete Reed competed in three Olympic Games and won three gold medals, making him one of the most decorated rowers in history. When sports scientists tested his respiratory system, they discovered his <span class="keyword">lung capacity</span> measured an extraordinary 11.68 liters. The average adult's <span class="keyword">lung capacity</span> is about 6 liters, meaning Reed's lungs could hold nearly twice as much air. This gave his <span class="keyword">alveoli</span> access to far more <span class="keyword">oxygen</span> with every breath, fueling his muscles during intense races. His years of training improved the efficiency of <span class="keyword">gas exchange</span> ‚Äî how quickly <span class="keyword">oxygen</span> enters the blood and <span class="keyword">carbon dioxide</span> exits. However, scientists point out that actual lung size is largely genetic ‚Äî you cannot grow bigger lungs through training alone. The real <span class="keyword">adaptation</span> from exercise is improved efficiency: trained lungs extract more <span class="keyword">oxygen</span> from each breath. Reed's extraordinary lungs show what the human respiratory system is capable of at its peak.`,
pc:{meter:"pushed",dots:"increase"}},
{id:3,name:"Mount Everest",emoji:"üèîÔ∏è",change:"Oxygen drops to 1/3 of sea level at 29,032 ft",response:"Body makes more red blood cells over 21-28 days",backOk:"Partially ‚Äî helps but doesn't fully fix it",ms:48,mm:10,me:35,
low:`At the top of Mount Everest, there is only one-third the <span class="keyword">oxygen</span> available at sea level. Climbers struggle to breathe because each breath delivers much less <span class="keyword">oxygen</span> to the <span class="keyword">alveoli</span>. The body's <span class="keyword">adaptation</span> is to make more red blood cells to carry <span class="keyword">oxygen</span> more efficiently. This process takes 21 to 28 days, which is why climbers must adjust slowly.`,
med:`At the summit of Mount Everest ‚Äî 29,032 feet high ‚Äî the air contains only one-third the <span class="keyword">oxygen</span> found at sea level. Every breath a climber takes delivers far less <span class="keyword">oxygen</span> to the <span class="keyword">alveoli</span>, making <span class="keyword">gas exchange</span> much less effective. The body responds with a powerful <span class="keyword">adaptation</span>: it produces more red blood cells to carry whatever <span class="keyword">oxygen</span> is available more efficiently. This process takes 21 to 28 days, which is why climbers spend weeks at base camp before attempting the summit. Interestingly, people living in Denver, Colorado at 5,280 feet breathe 17 percent less <span class="keyword">oxygen</span> than at sea level and most never notice. The human body can handle reduced <span class="keyword">pressure</span> and <span class="keyword">oxygen</span> ‚Äî but only if given time to adapt.`,
high:`At the summit of Mount Everest ‚Äî 29,032 feet above sea level ‚Äî the air contains roughly one-third the <span class="keyword">oxygen</span> available at ground level. The low air <span class="keyword">pressure</span> at extreme altitude means each breath delivers far fewer <span class="keyword">oxygen</span> molecules to the <span class="keyword">alveoli</span>. This makes <span class="keyword">gas exchange</span> dramatically less efficient, and the body struggles to supply organs with enough <span class="keyword">oxygen</span> to function. The body's primary <span class="keyword">adaptation</span> is to produce more red blood cells, which increases the blood's ability to carry whatever <span class="keyword">oxygen</span> is available. This process requires 21 to 28 days, which is why climbers spend weeks gradually ascending to allow their bodies to adjust. Without this <span class="keyword">adaptation</span> period, climbers risk altitude sickness, confusion, and even death. Remarkably, people in Denver, Colorado at 5,280 feet breathe 17 percent less <span class="keyword">oxygen</span> than at sea level ‚Äî and most never notice because their bodies have already adapted. The respiratory system's ability to adjust to <span class="keyword">pressure</span> and <span class="keyword">oxygen</span> changes is one of the most important <span class="keyword">adaptations</span> humans possess.`,
pc:{meter:"stressed",dots:"decrease"}},
{id:4,name:"Breath Holding",emoji:"‚è±Ô∏è",change:"CO‚ÇÇ builds up when no fresh air enters lungs",response:"Diaphragm spasms; trained holders tolerate more CO‚ÇÇ",backOk:"Yes ‚Äî breathing resumes and CO‚ÇÇ exits",ms:48,mm:8,me:48,
low:`The world record for holding your breath underwater is over 24 minutes. When you stop breathing, <span class="keyword">carbon dioxide</span> builds up because <span class="keyword">gas exchange</span> stops. The rising <span class="keyword">carbon dioxide</span> causes your diaphragm to spasm ‚Äî that is the urge to breathe. Most people can only hold their breath for about one minute without training.`,
med:`The world record for holding a breath underwater is over 24 minutes. When a person stops breathing, <span class="keyword">gas exchange</span> in the <span class="keyword">alveoli</span> halts ‚Äî no fresh <span class="keyword">oxygen</span> enters and <span class="keyword">carbon dioxide</span> cannot exit. The rising <span class="keyword">carbon dioxide</span> level triggers the diaphragm to spasm, creating the powerful urge to breathe. Surprisingly, it is the buildup of <span class="keyword">carbon dioxide</span> ‚Äî not the lack of <span class="keyword">oxygen</span> ‚Äî that makes you feel like you need air. Trained breath-holders develop an <span class="keyword">adaptation</span>: their brains learn to tolerate higher levels of <span class="keyword">carbon dioxide</span> before triggering the urge to breathe. Most untrained people can only hold their breath for about one minute.`,
high:`The world record for holding a breath underwater is over 24 minutes. When a person stops breathing, <span class="keyword">gas exchange</span> in the <span class="keyword">alveoli</span> comes to a complete halt. No fresh <span class="keyword">oxygen</span> enters the blood, and <span class="keyword">carbon dioxide</span> cannot be expelled from the body. As <span class="keyword">carbon dioxide</span> levels rise, the diaphragm begins to spasm involuntarily ‚Äî this is the body's urgent signal to breathe. Surprisingly, the urge to breathe comes from rising <span class="keyword">carbon dioxide</span>, not from low <span class="keyword">oxygen</span> levels. Trained breath-holders develop a remarkable <span class="keyword">adaptation</span>: their brains learn to tolerate much higher levels of <span class="keyword">carbon dioxide</span> before triggering the spasm response. This mental and physical training separates a 24-minute record holder from the average person, who can hold their breath for roughly one minute. The body's response to <span class="keyword">carbon dioxide</span> buildup is a critical safety system that prevents <span class="keyword">oxygen</span> levels from dropping to dangerous levels.`,
pc:{meter:"stressed",dots:"decrease"}},
{id:5,name:"Zero Gravity",emoji:"üöÄ",change:"Blood and air distribute differently without gravity",response:"Gas exchange improves but breathing muscles weaken",backOk:"Mixed ‚Äî gas exchange better, muscles worse",ms:48,mm:65,me:58,
low:`Astronauts on the space station live in zero gravity for months. Without gravity, blood spreads evenly through the lungs instead of pooling at the bottom. This actually improves <span class="keyword">gas exchange</span> because more <span class="keyword">alveoli</span> can access blood flow. However, the breathing muscles weaken over time because they do not have to work against gravity.`,
med:`Astronauts on the International Space Station live without gravity for months at a time. On Earth, gravity pulls blood to the bottom of the lungs, so <span class="keyword">gas exchange</span> works unevenly ‚Äî the lower <span class="keyword">alveoli</span> do more work. In zero gravity, blood distributes evenly throughout the lungs, and <span class="keyword">gas exchange</span> actually improves because all <span class="keyword">alveoli</span> get more equal blood flow. This is a surprising benefit of living in space. However, there is a trade-off ‚Äî the breathing muscles weaken over time because they no longer work against gravity. After long missions, astronauts' <span class="keyword">lung capacity</span> decreases because the respiratory muscles have lost strength.`,
high:`Astronauts aboard the International Space Station spend months living in zero gravity, and their respiratory systems respond in surprising ways. On Earth, gravity pulls blood toward the bottom of the lungs, meaning the lower <span class="keyword">alveoli</span> handle most of the <span class="keyword">gas exchange</span> while the upper <span class="keyword">alveoli</span> do less work. In zero gravity, blood distributes evenly throughout all the <span class="keyword">alveoli</span>, and <span class="keyword">gas exchange</span> actually becomes more efficient. Every part of the lung gets equal blood flow, which means more <span class="keyword">oxygen</span> transfers into the blood per breath. However, this benefit comes with a significant trade-off. Without gravity providing resistance, the diaphragm and other breathing muscles gradually weaken from reduced workload. After long missions, astronauts experience decreased <span class="keyword">lung capacity</span> because their respiratory muscles have lost strength ‚Äî an <span class="keyword">adaptation</span> to the low-demand environment. Returning to Earth requires rehabilitation to rebuild the muscle strength needed for normal breathing under gravity.`,
pc:{meter:"pushed",dots:"increase"}},
{id:6,name:"Lung Design",emoji:"üî¨",change:"Body processes 2,000+ gallons of air daily",response:"300-500M alveoli create tennis-court surface area",backOk:"Yes ‚Äî design keeps lungs in the OK zone",ms:48,mm:48,me:48,
low:`Your lungs contain 300 to 500 million tiny air sacs called <span class="keyword">alveoli</span>. If you spread all the <span class="keyword">alveoli</span> flat, they would cover a tennis court ‚Äî all packed inside your chest. This massive surface area is needed because your body processes over 2,000 gallons of air per day. The <span class="keyword">alveoli</span> are where all <span class="keyword">gas exchange</span> happens ‚Äî <span class="keyword">oxygen</span> in and <span class="keyword">carbon dioxide</span> out.`,
med:`Every day, your body processes over 2,000 gallons of air ‚Äî enough to fill a swimming pool. To handle this enormous demand, your lungs contain 300 to 500 million tiny air sacs called <span class="keyword">alveoli</span>. If you could flatten all of these <span class="keyword">alveoli</span> and spread them out, the total surface area would equal roughly one tennis court. All of this surface is packed inside your chest cavity, creating a massive area for <span class="keyword">gas exchange</span>. The airways that carry air to the <span class="keyword">alveoli</span> stretch about 1,500 miles ‚Äî the distance from Chicago to Las Vegas. This incredible design allows <span class="keyword">oxygen</span> to enter the blood and <span class="keyword">carbon dioxide</span> to exit with every single breath.`,
high:`Your body processes a staggering 2,000 or more gallons of air every single day ‚Äî enough to fill a swimming pool. To handle this enormous demand for <span class="keyword">oxygen</span>, your lungs contain between 300 and 500 million tiny air sacs called <span class="keyword">alveoli</span>. If you could flatten every one of these <span class="keyword">alveoli</span> and lay them out side by side, the total surface area would cover roughly one tennis court. This massive surface is packed tightly inside your chest, maximizing the area available for <span class="keyword">gas exchange</span>. The airways that deliver air to the <span class="keyword">alveoli</span> branch into smaller and smaller tubes, stretching about 1,500 miles in total ‚Äî the distance from Chicago to Las Vegas. This remarkable design creates the most efficient possible system for moving <span class="keyword">oxygen</span> into the blood and <span class="keyword">carbon dioxide</span> out. Every breath you take, roughly 17,000 to 22,000 times per day, relies on this architecture to keep your cells alive. The <span class="keyword">lung capacity</span> and surface area of healthy lungs make human survival possible even during high-demand activities.`,
pc:{meter:"ok",dots:"increase"}},
{id:7,name:"Pollution Recovery",emoji:"üå±",change:"Children move from polluted to clean-air areas",response:"Lung capacity improves but permanent scarring remains",backOk:"Partially ‚Äî some healing, some permanent damage",ms:48,mm:18,me:38,
low:`Scientists studied children who moved from cities with dirty air to areas with clean air. The children's lungs showed real improvement in growth and <span class="keyword">lung capacity</span> over time. This means some <span class="keyword">adaptation</span> and healing is possible when air quality gets better. However, scarring from long-term pollution exposure can be permanent.`,
med:`Scientists studied what happened when children moved from cities with high air pollution to areas with much cleaner air. The results showed that these children's lungs actually improved ‚Äî their <span class="keyword">lung capacity</span> increased and lung development got back on track. The <span class="keyword">alveoli</span> were able to grow and develop more normally once the pollution was removed. This is a hopeful finding because it shows the respiratory system has some ability to recover and adapt. However, researchers also found that some damage is not reversible. Children who were exposed to pollution for many years developed permanent scarring in their lungs, and that scarring reduced <span class="keyword">gas exchange</span> forever.`,
high:`In a landmark study, scientists tracked children who moved from cities with dangerously high air pollution to areas with significantly cleaner air. The results were both hopeful and sobering. Children who moved to cleaner areas showed measurable improvement in lung development ‚Äî their <span class="keyword">lung capacity</span> increased and <span class="keyword">gas exchange</span> efficiency improved over time. The <span class="keyword">alveoli</span> were able to grow more normally once the constant exposure to particulate matter was removed. This demonstrated that the respiratory system retains a remarkable ability for <span class="keyword">adaptation</span> and partial recovery, especially in young people whose lungs are still developing. However, the study also revealed a critical limit to this recovery. Children who had been exposed to heavy pollution for many years developed permanent scarring in their lung tissue, and that scarring could not be reversed. The damaged <span class="keyword">alveoli</span> never fully recovered, meaning their <span class="keyword">gas exchange</span> would be reduced for life ‚Äî a reminder that early protection matters more than treatment.`,
pc:{meter:"stressed",dots:"decrease"}}
];
const KW=["lung capacity","gas exchange","alveoli","adaptation","pressure","oxygen","carbon dioxide"];
let st={cur:null,step:'welcome',lv:'low',done:new Set(),sc:0,str:0,cp:0,tp:0,pred:{m:null,d:null},sr:false,se:false,spk:false};
let af=null;
function init(){rS();rK();showWelcome();uH();}
function rS(){document.getElementById('scenarioList').innerHTML=S.map((s,i)=>`<div class="scenario-card ${st.done.has(i)?'done':''}" id="sc${i}" onclick="sel(${i})"><span class="sc-emoji">${s.emoji}</span><span class="sc-name">${s.name}</span></div>`).join('');}
function rK(){document.getElementById('keyWords').innerHTML=KW.map(w=>`<span class="kw-tag">${w}</span>`).join('');}
function setLevel(l,b){st.lv=l;document.querySelectorAll('.rl-btn').forEach(x=>x.classList.remove('active'));b.classList.add('active');if(st.step==='read'&&st.cur!==null)showRead();}
function sel(i){if(st.step!=='welcome'&&st.step!=='record'&&st.cur!==null&&!st.done.has(st.cur))return;st.cur=i;st.pred={m:null,d:null};rS();document.querySelectorAll('.scenario-card').forEach(c=>c.classList.remove('active'));document.getElementById('sc'+i).classList.add('active');go('predict');}
function go(s){st.step=s;uT();({predict:showPredict,read:showRead,watch:showWatch,record:showRecord})[s]();}
function uT(){const ss=['predict','read','watch','record'],tt=[document.getElementById('tab1'),document.getElementById('tab2'),document.getElementById('tab3'),document.getElementById('tab4')],ci=ss.indexOf(st.step);tt.forEach((t,i)=>{t.className='step-tab';if(i<ci)t.classList.add('completed');else if(i===ci)t.classList.add('current');});}
function showWelcome(){st.step='welcome';uT();document.getElementById('centerContent').innerHTML=`<div class="card welcome-card"><div class="big-emoji">ü´Å</div><h2>Extreme Lungs</h2><p>Your lungs process over 2,000 gallons of air every day ‚Äî but what happens when conditions get extreme?</p><p style="margin-top:12px;color:#ffab40;">Explore 8 scenarios. Complete at least 5. All 8 = extra credit!</p><p style="margin-top:8px;font-size:12px;">‚Üê Pick any scenario to begin</p></div>`;document.getElementById('actionArea').innerHTML='';}
function showPredict(){const s=S[st.cur];document.getElementById('centerContent').innerHTML=`<div class="card"><h2>${s.emoji} ${s.name}</h2><p style="margin-bottom:16px;text-align:center;color:#ffab40;">What do you think will happen?</p><div class="predict-options"><div class="predict-group"><label>Meter shifts to...</label><div class="pred-btns"><div class="pred-btn" onclick="sP('m','stressed',this)">‚¨ÖÔ∏è Stressed</div><div class="pred-btn" onclick="sP('m','ok',this)">‚úÖ Stays OK</div><div class="pred-btn" onclick="sP('m','pushed',this)">‚û°Ô∏è Pushed</div></div></div><div class="predict-group"><label>Oxygen dots...</label><div class="pred-btns"><div class="pred-btn" onclick="sP('d','decrease',this)">üìâ Decrease</div><div class="pred-btn" onclick="sP('d','increase',this)">üìà Increase</div></div></div></div></div>`;document.getElementById('actionArea').innerHTML=`<button class="action-btn primary" id="pN" disabled onclick="go('read')">Next: Read ‚Üí</button>`;}
function sP(t,v,e){st.pred[t]=v;e.parentElement.querySelectorAll('.pred-btn').forEach(b=>b.classList.remove('selected'));e.classList.add('selected');if(st.pred.m&&st.pred.d)document.getElementById('pN').disabled=false;}
function showRead(){const s=S[st.cur],txt=st.lv==='low'?s.low:st.lv==='med'?s.med:s.high;document.getElementById('centerContent').innerHTML=`<div class="card reading-card"><h2>${s.emoji} ${s.name}</h2><div id="rT" style="font-size:15px;line-height:1.8;">${wS(txt)}</div></div>`;document.getElementById('actionArea').innerHTML=`<button class="action-btn read-aloud" onclick="rA()">üîä Read Aloud</button><button class="action-btn primary" onclick="go('watch')">Next: Watch ‚Üí</button>`;}
function wS(h){let i=0;return h.replace(/([^<]*?)([.!?])(\s|$)/g,(m,t,p,sp)=>{i++;return`<span class="read-sentence" data-si="${i}">${t}${p}</span>${sp}`;});}
function rA(){if(st.spk){speechSynthesis.cancel();st.spk=false;return;}const el=document.getElementById('rT');if(!el)return;const ss=el.querySelectorAll('.read-sentence');if(!ss.length)return;st.spk=true;let i=0;function nx(){if(i>=ss.length||!st.spk){ss.forEach(s=>s.classList.remove('highlight'));st.spk=false;return;}ss.forEach(s=>s.classList.remove('highlight'));ss[i].classList.add('highlight');const u=new SpeechSynthesisUtterance(ss[i].textContent);u.rate=0.9;u.onend=()=>{i++;nx();};speechSynthesis.speak(u);}nx();}

// ===== WATCH: RICH CANVAS ANIMATIONS =====
function showWatch(){speechSynthesis.cancel();st.spk=false;if(af)cancelAnimationFrame(af);const s=S[st.cur];
document.getElementById('centerContent').innerHTML=`<div class="watch-wrapper"><div class="watch-title">${s.emoji} ${s.name} ‚Äî Watch the Body Respond</div><div class="meter-section"><div class="meter-labels"><span>üî¥ Stressed</span><span>üü¢ OK Zone</span><span>üü† Pushed</span></div><div class="lung-meter"><div class="needle" id="ndl" style="left:${s.ms}%"></div></div></div><div class="scene-canvas-wrap"><canvas id="cv"></canvas><div class="phase-label" id="pL"></div></div></div>`;
document.getElementById('actionArea').innerHTML='';
const cv=document.getElementById('cv'),wr=cv.parentElement.getBoundingClientRect();
cv.width=wr.width*2;cv.height=wr.height*2;cv.style.width=wr.width+'px';cv.style.height=wr.height+'px';
const cx=cv.getContext('2d');cx.scale(2,2);runAnim(cx,wr.width,wr.height,s);}

function runAnim(cx,W,H,s){
const ph=GP(s.id),T=7500,pd=T/ph.length,ndl=document.getElementById('ndl'),lb=document.getElementById('pL');
let t0=performance.now();
function fr(now){const el=now-t0,pr=Math.min(el/T,1),pi=Math.min(Math.floor(el/pd),ph.length-1),pp=Math.min((el-pi*pd)/pd,1);
let np;if(pr<0.4)np=lr(s.ms,s.mm,pr/0.4);else np=lr(s.mm,s.me,(pr-0.4)/0.6);ndl.style.left=np+'%';
lb.innerHTML=ph[pi].l+'<span class="sub">'+ph[pi].s+'</span>';
cx.clearRect(0,0,W,H);ph[pi].d(cx,W,H,pp,el);
if(pr<1)af=requestAnimationFrame(fr);else document.getElementById('actionArea').innerHTML=`<button class="action-btn primary" onclick="go('record')">Next: Record ‚Üí</button>`;}
af=requestAnimationFrame(fr);}

function lr(a,b,t){return a+(b-a)*Math.min(Math.max(t,0),1);}
function eo(t){return 1-Math.pow(1-t,3);}
function eio(t){return t<0.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2;}

function dLung(c,cx,cy,sx,sy,col,gl){
c.save();if(gl){c.shadowColor=gl;c.shadowBlur=20;}c.fillStyle=col;
c.beginPath();c.ellipse(cx-28*sx,cy,26*sx,48*sy,0,0,Math.PI*2);c.fill();
c.beginPath();c.ellipse(cx+28*sx,cy,26*sx,48*sy,0,0,Math.PI*2);c.fill();
c.fillStyle='#bcaaa4';c.shadowBlur=0;c.fillRect(cx-3,cy-62*sy,6,28*sy);
c.strokeStyle='#bcaaa4';c.lineWidth=3;c.beginPath();c.moveTo(cx,cy-34*sy);c.quadraticCurveTo(cx-14*sx,cy-18*sy,cx-22*sx,cy-4*sy);c.stroke();
c.beginPath();c.moveTo(cx,cy-34*sy);c.quadraticCurveTo(cx+14*sx,cy-18*sy,cx+22*sx,cy-4*sy);c.stroke();c.restore();}
function dDot(c,x,y,r,col,gl){c.save();if(gl){c.shadowColor=col;c.shadowBlur=8;}c.fillStyle=col;c.beginPath();c.arc(x,y,r,0,Math.PI*2);c.fill();c.restore();}
function dLbl(c,x,y,t,sz,col,al){c.save();c.fillStyle=col||'#fff';c.font=`bold ${sz||14}px 'Segoe UI',sans-serif`;c.textAlign=al||'center';c.textBaseline='middle';c.shadowColor='rgba(0,0,0,0.8)';c.shadowBlur=4;c.fillText(t,x,y);c.restore();}
function dArr(c,x1,y1,x2,y2,col,w){c.save();c.strokeStyle=col;c.lineWidth=w||3;c.lineCap='round';c.shadowColor=col;c.shadowBlur=6;c.beginPath();c.moveTo(x1,y1);c.lineTo(x2,y2);c.stroke();const a=Math.atan2(y2-y1,x2-x1),h=10;c.beginPath();c.moveTo(x2,y2);c.lineTo(x2-h*Math.cos(a-0.4),y2-h*Math.sin(a-0.4));c.stroke();c.beginPath();c.moveTo(x2,y2);c.lineTo(x2-h*Math.cos(a+0.4),y2-h*Math.sin(a+0.4));c.stroke();c.restore();}
function dWater(c,W,H,el){const g=c.createLinearGradient(0,0,0,H);g.addColorStop(0,'#0d47a1');g.addColorStop(0.5,'#1565c0');g.addColorStop(1,'#0a1628');c.fillStyle=g;c.fillRect(0,0,W,H);c.strokeStyle='rgba(100,181,246,0.12)';c.lineWidth=1;for(let i=0;i<8;i++){const y=25+i*32;c.beginPath();for(let x=0;x<W;x+=8)c.lineTo(x,y+Math.sin(el/500+i+x/50)*4);c.stroke();}c.fillStyle='rgba(255,255,255,0.25)';c.font='10px sans-serif';c.textAlign='right';['0m','10m','40m','100m','214m'].forEach((d,i)=>{c.fillText(d,W-8,18+i*(H-30)/4);});}
function dMtn(c,W,H,el){c.fillStyle='#1a237e';c.fillRect(0,0,W,H);for(let i=0;i<30;i++){c.fillStyle=`rgba(255,255,255,${0.3+Math.sin(el/800+i)*0.2})`;c.beginPath();c.arc((i*137)%W,(i*73)%55,1.5,0,Math.PI*2);c.fill();}c.fillStyle='#37474f';c.beginPath();c.moveTo(0,H);c.lineTo(W*.15,H*.6);c.lineTo(W*.35,H*.18);c.lineTo(W*.5,H*.12);c.lineTo(W*.65,H*.18);c.lineTo(W*.85,H*.55);c.lineTo(W,H);c.fill();c.fillStyle='#eceff1';c.beginPath();c.moveTo(W*.42,H*.22);c.lineTo(W*.5,H*.12);c.lineTo(W*.58,H*.22);c.quadraticCurveTo(W*.5,H*.25,W*.42,H*.22);c.fill();}

function GP(id){return[g0,g1,g2,g3,g4,g5,g6,g7][id]();}

function g0(){return[// Deep Dive
{l:'ü§ø Phase 1: Diver descends ‚Äî pressure increases',s:'Water pressure crushes the lungs smaller and smaller',d(c,W,H,t,el){dWater(c,W,H,el);const dy=lr(55,H*.65,eio(t));c.fillStyle='#ffd54f';c.beginPath();c.arc(W*.22,dy,10,0,Math.PI*2);c.fill();c.fillStyle='#333';c.fillRect(W*.22-5,dy+12,10,18);const sc=lr(1,.35,eo(t));dLung(c,W*.62,H*.42,sc,sc,`rgba(239,154,154,${lr(.9,.45,t)})`,null);dLbl(c,W*.62,H*.08,'LUNGS COMPRESS',14,'#ef9a9a');c.globalAlpha=eo(t);dArr(c,W*.35,H*.25,W*.48,H*.42,'#42a5f5',3);dArr(c,W*.9,H*.25,W*.76,H*.42,'#42a5f5',3);dArr(c,W*.62,H*.82,W*.62,H*.68,'#42a5f5',3);c.globalAlpha=1;dLbl(c,W*.32,H*.18,'PRESSURE',11,'#64b5f6');dLbl(c,W*.88,H*.18,'PRESSURE',11,'#64b5f6');}},
{l:'ü©∏ Phase 2: Body shifts blood into chest',s:'Blood cushions the lungs ‚Äî prevents them from collapsing!',d(c,W,H,t,el){dWater(c,W,H,el);dLung(c,W*.5,H*.4,.45,.45,'rgba(239,154,154,.65)',null);for(let i=0;i<12;i++){const a=(i/12)*Math.PI*2,sr=125,er=35,r=lr(sr,er,eo(Math.min(t*1.5-i*.04,1)));dDot(c,W*.5+Math.cos(a)*r,H*.4+Math.sin(a)*r*.6,5,'#c62828','#c62828');}c.save();c.shadowColor='#c62828';c.shadowBlur=30*eo(t);c.strokeStyle=`rgba(198,40,40,${eo(t)*.6})`;c.lineWidth=4;c.beginPath();c.ellipse(W*.5,H*.4,55,40,0,0,Math.PI*2);c.stroke();c.restore();dLbl(c,W*.5,H*.06,'BLOOD RUSHES TO PROTECT LUNGS',14,'#ef5350');dLbl(c,W*.12,H*.32,'Arms ‚Üí',11,'#ef9a9a');dLbl(c,W*.88,H*.32,'‚Üê Legs',11,'#ef9a9a');if(t>.5)dLbl(c,W*.5,H*.82,'‚úì Lungs protected by blood cushion!',13,'#66bb6a');}},
{l:'‚úÖ Phase 3: Lungs survive ‚Äî diver returns safely',s:'The blood shift kept the alveoli from collapsing',d(c,W,H,t,el){dWater(c,W,H,el);dLung(c,W*.5,H*.4,lr(.45,.85,eo(t)),lr(.45,.85,eo(t)),'rgba(239,154,154,.9)','rgba(76,175,80,.3)');for(let i=0;i<6;i++){const ox=W*.5+Math.sin(el/400+i*1.2)*22,oy=H*.22+i*16;if(t>i*.1)dDot(c,ox,oy,4,'#42a5f5','#42a5f5');}const dy=lr(H*.65,70,eio(t));c.fillStyle='#ffd54f';c.beginPath();c.arc(W*.18,dy,10,0,Math.PI*2);c.fill();c.fillStyle='#333';c.fillRect(W*.18-5,dy+12,10,18);dLbl(c,W*.18,dy-20,'‚Üë Rising',11,'#ffd54f');dLbl(c,W*.5,H*.85,'Back toward OK ‚Äî adaptation saved the lungs!',13,'#4caf50');}}
];}

function g1(){return[// First Breath
{l:'üíß Phase 1: Before birth ‚Äî lungs filled with fluid',s:'The baby gets oxygen from mom, not from breathing',d(c,W,H,t,el){c.fillStyle='#1a237e';c.fillRect(0,0,W,H);const g=c.createRadialGradient(W*.5,H*.5,20,W*.5,H*.5,200);g.addColorStop(0,'rgba(206,147,216,.2)');g.addColorStop(1,'transparent');c.fillStyle=g;c.fillRect(0,0,W,H);dLung(c,W*.5,H*.4,1,1,'rgba(120,144,156,.85)',null);for(let i=0;i<10;i++)dDot(c,W*.5+Math.sin(i*2.1)*22-10,H*.25+i*15+Math.sin(el/600+i)*4,3,'#546e7a',null);dLbl(c,W*.5,H*.06,'LUNGS FILLED WITH FLUID',15,'#90a4ae');dLbl(c,W*.5,H*.85,'No air. No gas exchange yet.',12,'#78909c');c.strokeStyle='#ce93d8';c.lineWidth=4;c.setLineDash([8,4]);c.beginPath();c.moveTo(W*.5,H*.68);c.quadraticCurveTo(W*.7,H*.85,W*.85,H*.9);c.stroke();c.setLineDash([]);dLbl(c,W*.82,H*.87,'O‚ÇÇ from mom ‚Üí',10,'#ce93d8');}},
{l:'üò≠ Phase 2: First cry! Air rushes in, fluid forced out!',s:'The lungs switch from fluid to air in just seconds',d(c,W,H,t,el){c.fillStyle='#1a237e';c.fillRect(0,0,W,H);dLung(c,W*.5,H*.4,1,1,`rgba(120,144,156,${lr(.8,0,eo(t))})`,null);if(t>.2)dLung(c,W*.5,H*.4,lr(.2,1,eo((t-.2)/.8)),lr(.2,1,eo((t-.2)/.8)),`rgba(239,154,154,${lr(0,.9,eo(t))})`,t>.6?'rgba(239,154,154,.3)':null);for(let i=0;i<8;i++){const p=Math.min(t*2-i*.1,1);if(p<0)continue;c.globalAlpha=lr(.8,0,p);dDot(c,W*.5+Math.cos(i*.8)*lr(18,75,eo(p)),H*.4+Math.sin(i*1.2)*lr(8,55,eo(p)),4,'#546e7a',null);c.globalAlpha=1;}if(t>.35)for(let i=0;i<6;i++){const p=Math.min((t-.35)*2.5-i*.1,1);if(p<0)continue;dDot(c,W*.5+Math.sin(i*1.5)*12,lr(H*.02,H*.32,eo(p)),5,'#42a5f5','#42a5f5');}dLbl(c,W*.5,H*.05,'FIRST CRY ‚Äî AIR IN, FLUID OUT!',15,'#fff');if(t>.5)dLbl(c,W*.5,H*.85,'Gas exchange begins!',14,'#4caf50');if(t<.5){c.strokeStyle='rgba(255,255,255,.35)';c.lineWidth=2;for(let i=0;i<4;i++){c.beginPath();c.arc(W*.5,H*.05,18+t*55,-.5+i*.3,-.4+i*.3);c.stroke();}}}},
{l:'‚úÖ Phase 3: Lungs working! Oxygen flows in',s:'Alveoli fill with air ‚Äî the body is breathing on its own',d(c,W,H,t,el){c.fillStyle='#0d1f33';c.fillRect(0,0,W,H);dLung(c,W*.5,H*.4,1,1,'rgba(239,154,154,.9)','rgba(76,175,80,.3)');for(let i=0;i<8;i++)dDot(c,W*.5+Math.sin(el/400+i)*28,H*.18+i*12,4,'#42a5f5','#42a5f5');for(let i=0;i<4;i++)dDot(c,W*.5+Math.cos(el/500+i)*22,H*.6+i*10,3,'#ef5350','#ef5350');dLbl(c,W*.3,H*.12,'O‚ÇÇ IN ‚Üì',12,'#42a5f5');dLbl(c,W*.7,H*.72,'CO‚ÇÇ OUT ‚Üë',12,'#ef5350');dLbl(c,W*.5,H*.88,'Lungs working! Back to OK zone!',14,'#4caf50');}}
];}

function g2(){return[// Olympic
{l:'üèãÔ∏è Phase 1: Average lungs vs. athlete lungs',s:'Pete Reed\'s lungs: 11.68L ‚Äî almost DOUBLE normal (6L)',d(c,W,H,t,el){c.fillStyle='#0d1f33';c.fillRect(0,0,W,H);dLung(c,W*.25,H*.45,.7*eo(Math.min(t*2,1)),.7*eo(Math.min(t*2,1)),'rgba(239,154,154,.55)',null);dLbl(c,W*.25,H*.1,'Average Person',13,'#90a4ae');dLbl(c,W*.25,H*.82,'6 liters',16,'#90a4ae');const as=eo(Math.min(t*2-.3,1));if(as>0){dLung(c,W*.72,H*.42,1.3*as,1.3*as,'rgba(239,154,154,.95)','rgba(255,183,77,.3)');dLbl(c,W*.72,H*.06,'üèÖ Olympic Athlete',14,'#ffd54f');dLbl(c,W*.72,H*.84,'11.68 liters!',18,'#ffd54f');}dLbl(c,W*.48,H*.45,'VS',20,'rgba(255,255,255,.25)');}},
{l:'üí® Phase 2: More O‚ÇÇ per breath ‚Üí muscles get fuel',s:'Training improved gas exchange efficiency, not lung size',d(c,W,H,t,el){c.fillStyle='#0d1f33';c.fillRect(0,0,W,H);dLung(c,W*.38,H*.4,1.2,1.2,'rgba(239,154,154,.9)','rgba(255,183,77,.2)');for(let i=0;i<14;i++){const p=(t*2+i/14)%1;dDot(c,W*.38+Math.sin(i*1.1)*18,lr(-8,H*.58,p),5,'#42a5f5','#42a5f5');}if(t>.3){dArr(c,W*.58,H*.4,W*.78,H*.35,'#66bb6a',3);dLbl(c,W*.8,H*.26,'üí™ Muscles',13,'#66bb6a');dLbl(c,W*.8,H*.42,'More O‚ÇÇ = Power',11,'#a5d6a7');}dLbl(c,W*.38,H*.88,'Gas exchange is highly efficient',13,'#ffd54f');}},
{l:'üß¨ Phase 3: Genetics vs. training',s:'Lung SIZE is genetic ‚Äî but efficiency improves with training',d(c,W,H,t,el){c.fillStyle='#0d1f33';c.fillRect(0,0,W,H);dLung(c,W*.5,H*.4,1.1,1.1,'rgba(239,154,154,.9)','rgba(76,175,80,.2)');c.strokeStyle='#ce93d8';c.lineWidth=2.5;for(let i=0;i<10;i++){const y=H*.15+i*16,x1=W*.1+Math.sin(el/500+i*.5)*12,x2=W*.1-Math.sin(el/500+i*.5)*12;c.beginPath();c.moveTo(x1,y);c.lineTo(x2,y);c.stroke();dDot(c,x1,y,2.5,'#ce93d8',null);dDot(c,x2,y,2.5,'#ce93d8',null);}dLbl(c,W*.1,H*.88,'üß¨ Size = Genes',11,'#ce93d8');for(let i=0;i<5;i++){const bh=lr(8,38,eo(Math.min(t*2-i*.15,1)));c.fillStyle=i<3?'#66bb6a':'#4caf50';c.fillRect(W*.82+i*13,H*.7-bh,10,bh);}dLbl(c,W*.88,H*.88,'üìà Training',11,'#66bb6a');dLbl(c,W*.5,H*.92,'Enhanced ‚Äî meter stays in Pushed zone',12,'#ff9800');}}
];}

function g3(){return[// Everest
{l:'üèîÔ∏è Phase 1: Thin air ‚Äî only 1/3 oxygen at summit',s:'Every breath delivers far less oxygen to the alveoli',d(c,W,H,t,el){dMtn(c,W,H,el);const nd=Math.floor(lr(12,3,eo(t)));for(let i=0;i<nd;i++){c.globalAlpha=.4+Math.sin(el/400+i)*.2;dDot(c,W*.3+Math.random()*(W*.4),H*.3+Math.random()*(H*.3),3,'#42a5f5',null);c.globalAlpha=1;}c.fillStyle='#42a5f5';c.fillRect(W*.08,H*.5,38,-(78*eo(t)));dLbl(c,W*.08+19,H*.56,'Sea Level',9,'#64b5f6');c.fillStyle='#ef5350';c.fillRect(W*.08+52,H*.5,38,-(26*eo(t)));dLbl(c,W*.08+71,H*.56,'Everest',9,'#ef9a9a');dLbl(c,W*.5,H*.92,'‚ö†Ô∏è Oxygen drops to 1/3!',14,'#ef5350');}},
{l:'üò∞ Phase 2: Lungs struggle ‚Äî gas exchange drops',s:'Not enough oxygen reaching the alveoli',d(c,W,H,t,el){dMtn(c,W,H,el);dLung(c,W*.5,H*.52,.85,.85,'rgba(206,147,216,.65)',null);for(let i=0;i<3;i++){c.globalAlpha=.35;dDot(c,W*.5+Math.sin(el/500+i*2)*18,H*.35+i*12,4,'#42a5f5','#42a5f5');c.globalAlpha=1;}if(t>.3){c.fillStyle='#e53935';c.font='bold 16px sans-serif';c.textAlign='center';c.fillText('‚ö†',W*.3,H*.45);c.fillText('‚ö†',W*.7,H*.45);}dLbl(c,W*.5,H*.92,'Gas exchange way down ‚Äî body needs to adapt',13,'#ffab40');}},
{l:'ü©∏ Phase 3: Body makes MORE red blood cells',s:'Takes 21-28 days ‚Äî extra cells carry more oxygen',d(c,W,H,t,el){dMtn(c,W,H,el);dLung(c,W*.5,H*.48,.9,.9,'rgba(239,154,154,.8)','rgba(198,40,40,.2)');const n=Math.floor(lr(2,16,eo(t)));for(let i=0;i<n;i++){const rx=W*.3+Math.sin(i*1.7)*78+Math.sin(el/600+i)*7,ry=H*.33+Math.cos(i*2.3)*32+Math.cos(el/500+i)*5;c.save();c.fillStyle='#c62828';c.shadowColor='#c62828';c.shadowBlur=5;c.beginPath();c.ellipse(rx,ry,7,4,i*.5,0,Math.PI*2);c.fill();c.fillStyle='#b71c1c';c.beginPath();c.ellipse(rx,ry,2.5,1.5,i*.5,0,Math.PI*2);c.fill();c.restore();}dLbl(c,W*.85,H*.22,'Day '+Math.floor(lr(1,28,eo(t)))+'/28',14,'#ffab40');dLbl(c,W*.5,H*.88,'Red blood cells ‚Üë ‚Üí More oxygen carried',13,'#ef5350');if(t>.7)dLbl(c,W*.5,H*.95,'Partial recovery ‚Äî not fully back to normal',11,'#ffab40');}}
];}

function g4(){return[// Breath Hold
{l:'ü´Å Phase 1: Breath held ‚Äî gas exchange STOPS',s:'No fresh oxygen enters. CO‚ÇÇ is trapped inside.',d(c,W,H,t,el){c.fillStyle='#0d1f33';c.fillRect(0,0,W,H);dLung(c,W*.5,H*.4,1,1,'rgba(239,154,154,.7)',null);c.strokeStyle='#e53935';c.lineWidth=4;c.beginPath();c.moveTo(W*.45,H*.02);c.lineTo(W*.55,H*.14);c.stroke();c.beginPath();c.moveTo(W*.55,H*.02);c.lineTo(W*.45,H*.14);c.stroke();dLbl(c,W*.5,H*.18,'NO AIR IN OR OUT',13,'#e53935');dLbl(c,W*.85,H*.13,'‚è± '+Math.floor(lr(0,60,t))+'s',18,'#ffd54f');for(let i=0;i<5;i++){c.globalAlpha=lr(.8,.08,eo(t));dDot(c,W*.5+Math.sin(i*1.5)*20,H*.3+i*10,4,'#42a5f5','#42a5f5');c.globalAlpha=1;}dLbl(c,W*.25,H*.82,'O‚ÇÇ dropping...',11,'#64b5f6');}},
{l:'üî¥ Phase 2: CO‚ÇÇ builds up! Diaphragm spasms!',s:'Rising CO‚ÇÇ ‚Äî not low O‚ÇÇ ‚Äî triggers the urge to breathe',d(c,W,H,t,el){c.fillStyle='#0d1f33';c.fillRect(0,0,W,H);dLung(c,W*.5,H*.4,1,1,'rgba(255,171,145,.8)',null);const n=Math.floor(lr(2,20,eo(t)));for(let i=0;i<n;i++)dDot(c,W*.5+Math.sin(i*1.3+el/400)*28,H*.23+i*8+Math.sin(el/300+i)*4,5,'#e53935','#e53935');if(t>.4){c.fillStyle='rgba(255,183,77,.6)';c.beginPath();c.ellipse(W*.5,H*.68+Math.sin(el/80)*4,55,7,0,0,Math.PI*2);c.fill();dLbl(c,W*.5,H*.78,'DIAPHRAGM SPASMS!',14,'#ffab40');}c.fillStyle='rgba(229,57,53,.25)';c.fillRect(W*.83,H*.18,22,115);c.fillStyle='#e53935';c.fillRect(W*.83,H*.18+115-eo(t)*115,22,eo(t)*115);dLbl(c,W*.845,H*.13,'CO‚ÇÇ',11,'#ef5350');dLbl(c,W*.5,H*.92,'‚ö†Ô∏è CO‚ÇÇ buildup triggers the urge to breathe!',12,'#e53935');}},
{l:'üòÆ‚Äçüí® Phase 3: Breathing resumes ‚Äî CO‚ÇÇ out, O‚ÇÇ returns',s:'Gas exchange restarts ‚Äî everything returns to normal',d(c,W,H,t,el){c.fillStyle='#0d1f33';c.fillRect(0,0,W,H);dLung(c,W*.5,H*.4,1,1,'rgba(239,154,154,.9)','rgba(76,175,80,.3)');for(let i=0;i<8;i++){const p=Math.min(t*2-i*.08,1);if(p<0)continue;c.globalAlpha=lr(.8,0,p);dDot(c,W*.5+Math.sin(i*1.2)*18,lr(H*.4,-8,eo(p)),4,'#e53935','#e53935');c.globalAlpha=1;}if(t>.3)for(let i=0;i<6;i++){const p=Math.min((t-.3)*2.5-i*.1,1);if(p<0)continue;dDot(c,W*.5+Math.sin(i*1.5)*13,lr(-8,H*.32,eo(p)),5,'#42a5f5','#42a5f5');}dLbl(c,W*.3,H*.06,'CO‚ÇÇ OUT ‚Üë',12,'#ef5350');dLbl(c,W*.7,H*.06,'O‚ÇÇ IN ‚Üì',12,'#42a5f5');if(t>.5)dLbl(c,W*.5,H*.88,'‚úÖ Back to OK ‚Äî gas exchange restored!',14,'#4caf50');}}
];}

function g5(){return[// Zero G
{l:'üåç Phase 1: On Earth ‚Äî gravity pulls blood DOWN',s:'Lower alveoli do most work. Upper alveoli do less.',d(c,W,H,t,el){c.fillStyle='#0d1f33';c.fillRect(0,0,W,H);dLung(c,W*.5,H*.4,1,1,'rgba(239,154,154,.65)',null);for(let i=0;i<8;i++)dDot(c,W*.5+Math.sin(i*1.8)*22,H*.5+i*4+Math.abs(Math.sin(el/500+i))*3,5*eo(t),'#c62828','#c62828');dArr(c,W*.13,H*.18,W*.13,H*.65,'#ffab40',3);dLbl(c,W*.13,H*.12,'GRAVITY',11,'#ffab40');dLbl(c,W*.78,H*.22,'Upper: less blood',10,'#78909c');dLbl(c,W*.78,H*.6,'Lower: more blood',10,'#ef5350');dLbl(c,W*.5,H*.88,'Blood pools at bottom ‚Üí uneven gas exchange',12,'#90a4ae');}},
{l:'üöÄ Phase 2: Zero gravity ‚Äî blood spreads EVENLY!',s:'All alveoli get equal blood flow ‚Üí gas exchange improves',d(c,W,H,t,el){c.fillStyle='#0a0a2e';c.fillRect(0,0,W,H);for(let i=0;i<40;i++){c.fillStyle=`rgba(255,255,255,${.2+Math.sin(el/500+i)*.12})`;c.beginPath();c.arc((i*97)%W,(i*53)%H,1,0,Math.PI*2);c.fill();}dLung(c,W*.5,H*.4,1.05,1.05,'rgba(239,154,154,.9)','rgba(0,188,212,.2)');for(let i=0;i<12;i++){const a=(i/12)*Math.PI*2,r=23+Math.sin(el/500+i)*4;dDot(c,W*.5+Math.cos(a)*r,H*.4+Math.sin(a)*r*.8,4*eo(t),'#c62828','#c62828');}for(let i=0;i<8;i++)dDot(c,W*.5+Math.sin(el/400+i*.9)*28,H*.2+i*11,4,'#42a5f5','#42a5f5');dLbl(c,W*.5,H*.88,'‚úÖ Gas exchange IMPROVES in zero gravity!',13,'#4caf50');dLbl(c,W*.13,H*.13,'No gravity!',11,'#80cbc4');}},
{l:'‚ö†Ô∏è Phase 3: Trade-off ‚Äî breathing muscles WEAKEN',s:'Diaphragm shrinks without gravity to push against',d(c,W,H,t,el){c.fillStyle='#0a0a2e';c.fillRect(0,0,W,H);for(let i=0;i<40;i++){c.fillStyle=`rgba(255,255,255,${.2+Math.sin(el/500+i)*.12})`;c.beginPath();c.arc((i*97)%W,(i*53)%H,1,0,Math.PI*2);c.fill();}dLung(c,W*.5,H*.38,1.05,1.05,'rgba(239,154,154,.85)',null);c.fillStyle=`rgba(255,183,77,${lr(.6,.25,t)})`;c.beginPath();c.ellipse(W*.5,H*.65,lr(55,30,eo(t)),9,0,0,Math.PI*2);c.fill();dLbl(c,W*.5,H*.73,'Diaphragm',11,'#ffab40');c.fillStyle='rgba(255,183,77,.25)';c.fillRect(W*.83,H*.28,18,55);c.fillStyle='#ffab40';c.fillRect(W*.83,H*.28+55-lr(55,22,eo(t)),18,lr(55,22,eo(t)));dLbl(c,W*.845,H*.22,'üí™',16);dLbl(c,W*.5,H*.88,'Mixed: better gas exchange, weaker muscles',12,'#ff9800');dLbl(c,W*.18,H*.28,'Gas exchange ‚Üë',11,'#4caf50');dLbl(c,W*.18,H*.42,'Muscle strength ‚Üì',11,'#ef5350');}}
];}

function g6(){return[// Lung Design
{l:'ü´Å Phase 1: 300-500 MILLION tiny alveoli',s:'Each one is a tiny air sac where gas exchange happens',d(c,W,H,t,el){c.fillStyle='#0d1f33';c.fillRect(0,0,W,H);dLung(c,W*.28,H*.45,.85,.85,'rgba(239,154,154,.55)',null);if(t>.25){c.strokeStyle='#00e5ff';c.lineWidth=1.5;c.setLineDash([4,4]);c.beginPath();c.moveTo(W*.4,H*.38);c.lineTo(W*.54,H*.2);c.stroke();c.beginPath();c.moveTo(W*.4,H*.52);c.lineTo(W*.54,H*.65);c.stroke();c.setLineDash([]);c.strokeStyle='rgba(0,229,255,.25)';c.lineWidth=1;c.beginPath();c.rect(W*.54,H*.14,W*.4,H*.58);c.stroke();dLbl(c,W*.74,H*.1,'üî¨ ZOOMED IN',11,'#00e5ff');const na=Math.floor(lr(3,55,eo(Math.min((t-.25)/.75,1))));for(let i=0;i<na;i++){c.fillStyle=`rgba(244,143,177,${.35+Math.sin(el/400+i)*.2})`;c.beginPath();c.arc(W*.57+((i*17)%(W*.34)),H*.18+((i*21)%(H*.5)),3.5+Math.sin(el/500+i)*1,0,Math.PI*2);c.fill();}}dLbl(c,W*.28,H*.88,'300-500 million alveoli!',14,'#f48fb1');}},
{l:'üéæ Phase 2: Spread flat = ONE TENNIS COURT!',s:'All that surface area packed inside your chest',d(c,W,H,t,el){c.fillStyle='#0d1f33';c.fillRect(0,0,W,H);const cw=lr(15,W*.62,eo(t)),ch=lr(8,H*.42,eo(t)),cx2=W*.5-cw/2,cy=H*.28;c.fillStyle='#2e7d32';c.fillRect(cx2,cy,cw,ch);c.strokeStyle='#fff';c.lineWidth=2;c.strokeRect(cx2,cy,cw,ch);if(cw>80){c.beginPath();c.moveTo(cx2+cw/2,cy);c.lineTo(cx2+cw/2,cy+ch);c.stroke();c.setLineDash([4,4]);c.beginPath();c.moveTo(cx2,cy+ch/2);c.lineTo(cx2+cw,cy+ch/2);c.stroke();c.setLineDash([]);}dLbl(c,W*.5,H*.2,'üéæ',28);if(t>.5){dLung(c,W*.13,H*.55,.4,.4,'rgba(239,154,154,.45)',null);dLbl(c,W*.13,H*.72,'Your chest',10,'#90a4ae');dArr(c,W*.22,H*.55,W*.32,H*.48,'#00e5ff',2);dLbl(c,W*.5,H*.88,'All of this packed inside you!',13,'#00e5ff');}}},
{l:'üí® Phase 3: 2,000+ gallons of air processed DAILY',s:'17,000-22,000 breaths per day keep cells alive',d(c,W,H,t,el){c.fillStyle='#0d1f33';c.fillRect(0,0,W,H);dLung(c,W*.5,H*.4,1,1,'rgba(239,154,154,.9)','rgba(76,175,80,.2)');for(let s=0;s<3;s++)for(let i=0;i<6;i++){const p=(t*3+i/6+s*.33)%1;c.globalAlpha=1-p;dDot(c,W*(.35+s*.1)+Math.sin(el/400+i+s)*8,lr(-8,H*.58,p),3,'#81d4fa','#81d4fa');c.globalAlpha=1;}dLbl(c,W*.5,H*.06,Math.floor(lr(0,2000,eo(t))).toLocaleString()+' gallons/day',20,'#00e5ff');dLbl(c,W*.5,H*.88,Math.floor(lr(0,20000,eo(t))).toLocaleString()+' breaths per day',14,'#80cbc4');dLbl(c,W*.5,H*.95,'Meter stays in OK zone ‚Äî perfect design!',12,'#4caf50');}}
];}

function g7(){return[// Pollution
{l:'üè≠ Phase 1: City pollution damages the lungs',s:'Dirty air particles damage the alveoli and cause scarring',d(c,W,H,t,el){c.fillStyle='#263238';c.fillRect(0,0,W,H);c.fillStyle='#37474f';[[.1,.32,28,95],[.2,.22,22,118],[.32,.28,32,108],[.58,.26,28,112],[.73,.32,22,95],[.85,.2,28,125]].forEach(([x,y,w,h])=>c.fillRect(W*x,H*y,w,h));for(let i=0;i<14;i++){c.globalAlpha=.28+Math.sin(el/400+i)*.1;c.fillStyle='#78909c';c.beginPath();c.arc(((i*71+el/10)%W),H*.13+Math.sin(el/600+i)*18,4+Math.sin(i)*2,0,Math.PI*2);c.fill();c.globalAlpha=1;}dLung(c,W*.5,H*.6,.75,.75,'rgba(120,144,156,.65)',null);const np=Math.floor(lr(1,8,eo(t)));for(let i=0;i<np;i++){c.fillStyle='rgba(69,90,100,.65)';c.beginPath();c.ellipse(W*.5+Math.sin(i*2.1)*22-8,H*.5+Math.cos(i*1.7)*18+8,7,5,i,0,Math.PI*2);c.fill();}dLbl(c,W*.5,H*.92,'Pollution damages alveoli ‚Üí scarring builds up',12,'#e53935');}},
{l:'üåø Phase 2: Move to clean air ‚Üí lungs HEAL',s:'Children\'s lungs improved ‚Äî lung capacity increased!',d(c,W,H,t,el){const r=lr(38,21,eo(t)),g=lr(50,100,eo(t)),b=lr(56,50,eo(t));c.fillStyle=`rgb(${r},${g},${b})`;c.fillRect(0,0,W,H);if(t>.2){const nt=Math.floor(lr(0,6,eo((t-.2)/.8)));for(let i=0;i<nt;i++){c.fillStyle='#5d4037';c.fillRect(W*.08+i*(W*.15),H*.72,5,22);c.fillStyle='#4caf50';c.beginPath();c.arc(W*.08+i*(W*.15)+2.5,H*.67,13,0,Math.PI*2);c.fill();}}const pa=eo(t),lc=`rgba(${lr(120,239,pa)},${lr(144,154,pa)},${lr(156,154,pa)},.85)`;dLung(c,W*.5,H*.4,lr(.75,1,eo(t)),lr(.75,1,eo(t)),lc,t>.5?'rgba(76,175,80,.2)':null);for(let i=0;i<3;i++){c.fillStyle=`rgba(69,90,100,${lr(.65,.4,t)})`;c.beginPath();c.ellipse(W*.5+Math.sin(i*2.5)*18,H*.35+Math.cos(i*1.8)*13+8,5,3.5,i,0,Math.PI*2);c.fill();}if(t>.4){dArr(c,W*.75,H*.55,W*.75,H*.28,'#4caf50',3);dLbl(c,W*.75,H*.6,'Lung capacity ‚Üë',11,'#4caf50');}dLbl(c,W*.5,H*.88,'Clean air ‚Üí lungs start recovering!',13,'#66bb6a');}},
{l:'‚ö†Ô∏è Phase 3: Some scars are PERMANENT',s:'Lungs improved, but long-term damage can\'t be fully reversed',d(c,W,H,t,el){c.fillStyle='#1b3a25';c.fillRect(0,0,W,H);for(let i=0;i<5;i++){c.fillStyle='#5d4037';c.fillRect(W*.05+i*(W*.2)+8,H*.75,5,18);c.fillStyle='#4caf50';c.beginPath();c.arc(W*.05+i*(W*.2)+10.5,H*.7,12,0,Math.PI*2);c.fill();}dLung(c,W*.5,H*.4,1,1,'rgba(239,154,154,.85)','rgba(76,175,80,.12)');for(let i=0;i<3;i++){const px=W*.47+Math.sin(i*2.5)*16,py=H*.37+i*11,sa=lr(0,.65,eo(t));c.fillStyle=`rgba(69,90,100,${sa})`;c.beginPath();c.ellipse(px,py,6,4,i*.5,0,Math.PI*2);c.fill();if(t>.4){c.strokeStyle=`rgba(229,57,53,${sa})`;c.lineWidth=2;c.beginPath();c.moveTo(px-3.5,py-3.5);c.lineTo(px+3.5,py+3.5);c.stroke();c.beginPath();c.moveTo(px+3.5,py-3.5);c.lineTo(px-3.5,py+3.5);c.stroke();}}if(t>.25){dDot(c,W*.11,H*.18,5,'#ef9a9a',null);dLbl(c,W*.21,H*.18,'= Healed',10,'#ef9a9a','left');dDot(c,W*.11,H*.25,5,'#546e7a',null);dLbl(c,W*.21,H*.25,'= Permanent scar',10,'#78909c','left');}dLbl(c,W*.5,H*.86,'Partially recovered ‚Äî some scars are forever',13,'#ffab40');if(t>.6)dLbl(c,W*.5,H*.94,'Early protection matters more than treatment',11,'#e0e0e0');}}
];}

// ===== RECORD & HUD =====
function showRecord(){const s=S[st.cur];if(af)cancelAnimationFrame(af);let c=0;if(st.pred.m===s.pc.meter)c++;if(st.pred.d===s.pc.dots)c++;st.tp+=2;st.cp+=c;st.sc+=c===2?20:c===1?10:5;if(c===2)st.str++;else st.str=0;st.done.add(st.cur);rS();aR(s);uH();
document.getElementById('centerContent').innerHTML=`<div class="card complete-card"><div class="big-emoji">${c===2?'üéØ':c===1?'üëç':'üìù'}</div><h2>${s.emoji} ${s.name} ‚Äî Recorded!</h2><p style="font-size:16px;color:#00e5ff;margin:8px 0;">${c===2?'üéØ Both predictions correct! +20 pts':c===1?'üëç One prediction correct! +10 pts':'üìù Recorded! +5 pts'}</p><p style="font-size:13px;color:#80cbc4;margin-top:8px;">Select another scenario from the left panel.</p></div>`;document.getElementById('actionArea').innerHTML='';
if(st.done.size===5&&!st.sr){st.sr=true;setTimeout(()=>sO('‚úÖ Required Complete!','You finished 5 scenarios! Keep going for extra credit!'),500);}
if(st.done.size===8&&!st.se){st.se=true;setTimeout(()=>sO('üåü Extra Credit Complete!','Amazing! You explored all 8 extreme lung scenarios!'),500);}}
function aR(s){const tr=document.createElement('tr');tr.innerHTML=`<td>${s.emoji} ${s.name}</td><td>${s.change}</td><td>${s.response}</td><td>${s.backOk}</td>`;tr.style.animation='fadeIn .4s ease';document.getElementById('dataBody').appendChild(tr);}
function uH(){document.getElementById('hudScore').textContent=st.sc;document.getElementById('hudStreak').textContent=st.str;document.getElementById('hudDone').textContent=st.done.size+'/8';document.getElementById('hudAcc').textContent=st.tp>0?Math.round(st.cp/st.tp*100)+'%':'‚Äî';document.getElementById('progBar').style.width=Math.min(100,(st.done.size/5)*100)+'%';const r=Math.max(0,5-st.done.size);document.getElementById('progMsg').innerHTML=st.done.size>=8?'<span class="extra-badge">üåü ALL 8 ‚Äî EXTRA CREDIT!</span>':st.done.size>=5?'<span class="extra-badge">‚úÖ Done! '+(8-st.done.size)+' more for EC</span>':'Pick '+r+' more you like!';document.getElementById('pickLabel').textContent=st.done.size>=5?'Extra credit: finish all 8!':'Pick any '+r+' more!';}
function sO(t,m){document.getElementById('doneTitle').textContent=t;document.getElementById('doneMsg').textContent=m;document.getElementById('doneOverlay').classList.remove('hidden');}
function closeDone(){document.getElementById('doneOverlay').classList.add('hidden');}
function resetSim(){if(!confirm('Reset all progress?'))return;speechSynthesis.cancel();if(af)cancelAnimationFrame(af);st={cur:null,step:'welcome',lv:st.lv,done:new Set(),sc:0,str:0,cp:0,tp:0,pred:{m:null,d:null},sr:false,se:false,spk:false};document.getElementById('dataBody').innerHTML='';rS();uH();showWelcome();}
function newRun(){resetSim();}
init();
</script>
</body>
</html>
